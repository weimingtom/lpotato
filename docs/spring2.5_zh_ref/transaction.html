<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;9.&nbsp;&#20107;&#21153;&#31649;&#29702;</title><link rel="stylesheet" href="html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.60.1"><link rel="home" href="index.html" title="Spring Framework &#24320;&#21457;&#21442;&#32771;&#25163;&#20876;"><link rel="up" href="spring-middle-tier.html" title="Part&nbsp;II.&nbsp;&#20013;&#38388;&#23618;&#25968;&#25454;&#35775;&#38382;"><link rel="previous" href="spring-middle-tier.html" title="Part&nbsp;II.&nbsp;&#20013;&#38388;&#23618;&#25968;&#25454;&#35775;&#38382;"><link rel="next" href="dao.html" title="Chapter&nbsp;10.&nbsp;DAO&#25903;&#25345;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div xmlns="http://www.w3.org/TR/xhtml1/transitional" style="background-color:white;border:none;height:73px;border:1px solid black;"><a style="border:none;" href="http://www.springframework.org/" title="The Spring Framework"><img style="border:none;" src="images/xdev-spring_logo.jpg"></a><a style="border:none;" href="http://www.springsource.com/" title="SpringSource"><img style="border:none;position:absolute;padding-top:5px;right:42px;" src="images/springsource-banner-rhs.png"></a></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="transaction"></a>Chapter&nbsp;9.&nbsp;&#20107;&#21153;&#31649;&#29702;</h2></div></div><div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-intro"></a>9.1.&nbsp;&#31616;&#20171;</h2></div></div><div></div></div><p>Spring&#26694;&#26550;&#24341;&#20154;&#27880;&#30446;&#30340;&#37325;&#35201;&#22240;&#32032;&#20043;&#19968;&#26159;&#23427;&#20840;&#38754;&#30340;&#20107;&#21153;&#25903;&#25345;&#12290;Spring&#26694;&#26550;&#25552;&#20379;&#20102;&#19968;&#33268;&#30340;&#20107;&#21153;&#31649;&#29702;&#25277;&#35937;&#65292;&#36825;&#24102;&#26469;&#20102;&#20197;&#19979;&#22909;&#22788;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p>&#20026;&#22797;&#26434;&#30340;&#20107;&#21153;API&#25552;&#20379;&#20102;&#19968;&#33268;&#30340;&#32534;&#31243;&#27169;&#22411;&#65292;&#22914;JTA&#12289;JDBC&#12289;Hibernate&#12289;JPA&#21644;JDO</p></li><li><p>&#25903;&#25345; <a href="transaction.html#transaction-declarative" title="9.5.&nbsp;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;">&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;</a></p></li><li><p>&#25552;&#20379;&#27604;&#22823;&#22810;&#25968;&#22797;&#26434;&#30340;&#20107;&#21153;API&#65288;&#35832;&#22914;JTA&#65289;&#26356;&#31616;&#21333;&#30340;&#65292;&#26356;&#26131;&#20110;&#20351;&#29992;&#30340; <a href="transaction.html#transaction-programmatic" title="9.6.&nbsp;&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;">&#32534;&#31243;&#24335;</a> &#20107;&#21153;&#31649;&#29702;API</p></li><li><p>&#38750;&#24120;&#22909;&#22320;&#25972;&#21512;Spring&#30340;&#21508;&#31181;&#25968;&#25454;&#35775;&#38382;&#25277;&#35937;</p></li></ul></div><p>
		&#36825;&#31456;&#34987;&#20998;&#25104;&#20960;&#20010;&#23567;&#33410;&#65292;&#27599;&#19968;&#33410;&#23558;&#25551;&#36848;&#19968;&#31181;Spring&#26694;&#26550;&#20107;&#21153;&#25903;&#25345;&#30340;&#38468;&#21152;&#20540;&#25110;&#25216;&#26415;&#12290;&#26412;&#31456;&#26411;&#23614;&#35752;&#35770;&#20102;&#19968;&#20123;&#20851;&#20110;&#20107;&#21153;&#31649;&#29702;&#30340;&#26368;&#20339;&#23454;&#36341;&#65288;&#27604;&#22914;&#65292;&#22914;&#20309;&#22312;&#32534;&#31243;&#24335;&#21644;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#20043;&#38388;&#20570;&#36873;&#25321;&#65289;&#12290;
        </p><div class="itemizedlist"><ul type="disc"><li><p>&#31532;&#19968;&#33410;&#65292;<a href="transaction.html#transaction-motivation" title="9.2.&nbsp;&#21160;&#26426;">&#21160;&#26426;</a>&#65292;&#25551;&#36848; <span class="emphasis"><em>&#20026;&#20309;</em></span> &#24895;&#24847;&#20351;&#29992;Spring&#26694;&#26550;&#30340;&#20107;&#21153;&#25277;&#35937;&#65292;&#32780;&#19981;&#26159;EJB CMT&#25110;&#32773;&#19968;&#20010;&#31169;&#26377;&#30340;API&#65292;&#27604;&#22914;Hibernate&#30340;&#20107;&#21153;&#22788;&#29702;&#12290;</p></li><li><p>&#31532;&#20108;&#33410;&#65292;<a href="transaction.html#transaction-strategies" title="9.3.&nbsp;&#20851;&#38190;&#25277;&#35937;">&#20851;&#38190;&#25277;&#35937;</a>&#65292;&#21015;&#20030;&#20102;Spring&#26694;&#26550;&#20107;&#21153;&#25903;&#25345;&#30340;&#26680;&#24515;&#31867;&#65292;&#20197;&#21450;&#22914;&#20309;&#20174;&#22810;&#31181;&#19981;&#21516;&#30340;&#25968;&#25454;&#28304;&#21435;&#37197;&#32622;&#24182;&#33719;&#24471;&#19968;&#20010; <tt class="interfacename">DataSource</tt> &#23454;&#20363;&#12290;
                </p></li><li><p>&#31532;&#19977;&#33410;&#65292;<a href="transaction.html#transaction-declarative" title="9.5.&nbsp;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;">&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;</a>&#65292;&#35762;&#36848;&#20102;Spring&#26694;&#26550;&#22914;&#20309;&#25903;&#25345;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#12290;</p></li><li><p>&#31532;&#22235;&#33410;&#65292;<a href="transaction.html#transaction-programmatic" title="9.6.&nbsp;&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;">&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;</a>&#65292;&#20171;&#32461;&#20102;Spring&#26694;&#26550;&#22914;&#20309;&#25903;&#25345;&#32534;&#31243;&#24335;&#65288;&#21363;&#30828;&#32534;&#30721;&#65289;&#20107;&#21153;&#31649;&#29702;&#12290;</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-motivation"></a>9.2.&nbsp;&#21160;&#26426;</h2></div></div><div></div></div><div class="sidebar"><p class="title"><b>&#20107;&#21153;&#31649;&#29702;&#31350;&#31455;&#26159;&#21542;&#38656;&#35201;&#24212;&#29992;&#26381;&#21153;&#22120;&#65311;</b></p><p>Spring&#26694;&#26550;&#23545;&#20107;&#21153;&#31649;&#29702;&#30340;&#25903;&#25345;&#26497;&#22823;&#22320;&#25913;&#21464;&#20102;&#20256;&#32479;&#19978;&#35748;&#20026;J2EE&#24212;&#29992;&#38656;&#35201;&#24212;&#29992;&#26381;&#21153;&#22120;&#30340;&#35748;&#35782;&#12290;</p><p>&#36825;&#31181;&#25913;&#21464;&#23588;&#20854;&#22312;&#20110;&#20320;&#19981;&#38656;&#35201;&#20165;&#20165;&#20026;&#20102;&#36890;&#36807;EJB&#26469;&#20351;&#29992;&#22768;&#26126;&#24335;&#20107;&#21153;&#32780;&#20351;&#29992;&#24212;&#29992;&#26381;&#21153;&#22120;&#12290;&#20107;&#23454;&#19978;&#65292;&#21363;&#20351;&#20320;&#30340;&#24212;&#29992;&#26381;&#21153;&#22120;&#25317;&#26377;&#24378;&#22823;&#30340;JTA&#21151;&#33021;&#65292;&#20320;&#20063;&#26377;&#20805;&#20998;&#30340;&#29702;&#30001;&#21487;&#20197;&#21457;&#29616;&#65292;Spring&#26694;&#26550;&#30340;&#22768;&#26126;&#24335;&#20107;&#21153;&#25552;&#20379;&#20102;&#27604;EJB CMT&#26356;&#21152;&#24378;&#22823;&#12289;&#39640;&#25928;&#30340;&#32534;&#31243;&#27169;&#22411;&#12290;</p><p>&#19968;&#33324;&#26469;&#35828;&#65292;&#21482;&#26377;&#24403;&#20320;&#38656;&#35201;&#25903;&#25345;&#22810;&#20010;&#20107;&#21153;&#24615;&#36164;&#28304;&#26102;&#65292;&#20320;&#25165;&#38656;&#35201;&#24212;&#29992;&#26381;&#21153;&#22120;&#30340;JTA&#21151;&#33021;&#12290;&#32780;&#22823;&#22810;&#25968;&#24212;&#29992;&#24182;&#19981;&#38656;&#35201;&#33021;&#22815;&#22788;&#29702;&#36328;&#36234;&#22810;&#31181;&#36164;&#28304;&#12290;&#35768;&#22810;&#39640;&#31471;&#24212;&#29992;&#20351;&#29992;&#21333;&#19968;&#30340;&#12289;&#39640;&#20280;&#32553;&#24615;&#30340;&#25968;&#25454;&#24211;&#65292;&#27604;&#22914;Oracle 9i RAC&#12290;</p><p>&#65288;&#24403;&#28982;&#65292;&#20063;&#35768;&#20320;&#38656;&#35201;&#24212;&#29992;&#26381;&#21153;&#22120;&#30340;&#20854;&#20182;&#21151;&#33021;&#65292;&#27604;&#22914;JMS&#25110;JCA&#12290;&#65289;</p><p>&#26368;&#37325;&#35201;&#30340;&#19968;&#28857;&#26159;&#65292;&#20351;&#29992;Spring&#65292;<span class="emphasis"><em>&#20320;&#21487;&#20197;&#36873;&#25321;&#20309;&#26102;&#25226;&#20320;&#30340;&#24212;&#29992;&#36801;&#31227;&#21040;&#20840;&#21151;&#33021;&#30340;&#24212;&#29992;&#26381;&#21153;&#22120;</em></span>&#12290;&#29992;&#30828;&#32534;&#30721;&#21435;&#23454;&#29616;&#26412;&#22320;&#20107;&#21153;&#26469;&#26367;&#20195;EJB CMT&#25110;JTA&#65292;&#22788;&#29702;JDBC&#36830;&#25509;&#65292;&#25110;&#32773;&#36824;&#38656;&#35201;&#20351;&#29992;&#30828;&#32534;&#30721;&#26469;&#22788;&#29702;&#37027;&#20123;&#20840;&#23616;&#30340;&#12289;&#21463;&#21040;&#23481;&#22120;&#31649;&#29702;&#30340;&#20107;&#21153;&#65292;&#36825;&#26679;&#30340;&#26085;&#23376;&#23558;&#19968;&#21435;&#19981;&#22797;&#36820;&#20102;&#12290;&#20351;&#29992;Spring&#65292;&#20320;&#20165;&#38656;&#35201;&#25913;&#21160;&#37197;&#32622;&#25991;&#20214;&#65292;&#32780;&#19981;&#24517;&#25913;&#21160;&#20320;&#30340;&#20195;&#30721;&#12290;</p></div><p>&#20256;&#32479;&#19978;&#65292;J2EE&#24320;&#21457;&#32773;&#26377;&#20004;&#20010;&#20107;&#21153;&#31649;&#29702;&#30340;&#36873;&#25321;&#65306; <span class="emphasis"><em>&#20840;&#23616;</em></span> &#25110; <span class="emphasis"><em>&#26412;&#22320;</em></span> &#20107;&#21153;&#12290;&#20840;&#23616;&#20107;&#21153;&#30001;&#24212;&#29992;&#26381;&#21153;&#22120;&#31649;&#29702;&#65292;&#20351;&#29992;JTA&#12290;&#23616;&#37096;&#20107;&#21153;&#26159;&#21644;&#36164;&#28304;&#30456;&#20851;&#30340;&#65292;&#27604;&#22914;&#19968;&#20010;&#21644;JDBC&#36830;&#25509;&#20851;&#32852;&#30340;&#20107;&#21153;&#12290;&#36825;&#20010;&#36873;&#25321;&#26377;&#28145;&#21051;&#30340;&#21547;&#20041;&#12290;&#20363;&#22914;&#65292;&#20840;&#23616;&#20107;&#21153;&#21487;&#20197;&#29992;&#20110;&#22810;&#20010;&#20107;&#21153;&#24615;&#30340;&#36164;&#28304;&#65288;&#20856;&#22411;&#20363;&#23376;&#26159;&#20851;&#31995;&#25968;&#25454;&#24211;&#21644;&#28040;&#24687;&#38431;&#21015;&#65289;&#12290;&#20351;&#29992;&#23616;&#37096;&#20107;&#21153;&#65292;&#24212;&#29992;&#26381;&#21153;&#22120;&#19981;&#38656;&#35201;&#21442;&#19982;&#20107;&#21153;&#31649;&#29702;&#65292;&#24182;&#19988;&#19981;&#33021;&#24110;&#21161;&#30830;&#20445;&#36328;&#36234;&#22810;&#20010;&#36164;&#28304;&#65288;&#38656;&#35201;&#25351;&#20986;&#30340;&#26159;&#22810;&#25968;&#24212;&#29992;&#20351;&#29992;&#21333;&#19968;&#20107;&#21153;&#24615;&#30340;&#36164;&#28304;&#65289;&#30340;&#20107;&#21153;&#30340;&#27491;&#30830;&#24615;&#12290;</p><p><b>&#20840;&#23616;&#20107;&#21153;.&nbsp;</b>
				&#20840;&#23616;&#20107;&#21153;&#26377;&#19968;&#20010;&#37325;&#22823;&#30340;&#32570;&#38519;&#65292;&#20195;&#30721;&#38656;&#35201;&#20351;&#29992;JTA&#65306;&#19968;&#20010;&#31528;&#37325;&#30340;API&#65288;&#37096;&#20998;&#26159;&#22240;&#20026;&#23427;&#30340;&#24322;&#24120;&#27169;&#22411;&#65289;&#12290;&#27492;&#22806;&#65292;JTA&#30340;<tt class="interfacename">UserTransaction</tt>&#36890;&#24120;&#38656;&#35201;&#20174;JNDI&#33719;&#24471;&#65292;&#36825;&#24847;&#21619;&#30528;&#25105;&#20204;&#20026;&#20102;JTA&#65292;&#38656;&#35201; <span class="emphasis"><em>&#21516;&#26102;</em></span> &#20351;&#29992;JNDI <span class="emphasis"><em>&#21644;</em></span> JTA&#12290;&#26174;&#28982;&#20840;&#37096;&#20351;&#29992;&#20840;&#23616;&#20107;&#21153;&#38480;&#21046;&#20102;&#24212;&#29992;&#20195;&#30721;&#30340;&#37325;&#29992;&#24615;&#65292;&#22240;&#20026;JTA&#36890;&#24120;&#21482;&#22312;&#24212;&#29992;&#26381;&#21153;&#22120;&#30340;&#29615;&#22659;&#20013;&#25165;&#33021;&#20351;&#29992;&#12290;
				&#20197;&#21069;&#65292;&#20351;&#29992;&#20840;&#23616;&#20107;&#21153;&#30340;&#39318;&#36873;&#26041;&#24335;&#26159;&#36890;&#36807;EJB&#30340; <span class="emphasis"><em>CMT</em></span>&#65288;<span class="emphasis"><em>&#23481;&#22120;&#31649;&#29702;&#20107;&#21153;</em></span>&#65289;&#65306;CMT&#26159; <span class="bold"><b>&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;</b></span> &#30340;&#19968;&#31181;&#24418;&#24335;&#65288;&#21306;&#21035;&#20110; <span class="bold"><b>&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;</b></span>&#65289;&#12290;EJB&#30340;CMT&#19981;&#38656;&#35201;&#20219;&#20309;&#21644;&#20107;&#21153;&#30456;&#20851;&#30340;JNDI&#26597;&#25214;&#65292;&#34429;&#28982;&#20351;&#29992;EJB&#26412;&#36523;&#32943;&#23450;&#38656;&#35201;&#20351;&#29992;JNDI&#12290;&#23427;&#28040;&#38500;&#20102;&#22823;&#22810;&#25968;&#65288;&#19981;&#26159;&#20840;&#37096;&#65289;&#30828;&#32534;&#30721;&#30340;&#26041;&#24335;&#21435;&#25511;&#21046;&#20107;&#21153;&#12290;&#37325;&#22823;&#30340;&#32570;&#38519;&#26159;CMT&#32465;&#23450;&#22312;JTA&#21644;&#24212;&#29992;&#26381;&#21153;&#22120;&#29615;&#22659;&#19978;&#65292;&#24182;&#19988;&#21482;&#26377;&#25105;&#20204;&#36873;&#25321;&#20351;&#29992;EJB&#23454;&#29616;&#19994;&#21153;&#36923;&#36753;&#65292;&#25110;&#32773;&#33267;&#23569;&#22788;&#20110;&#19968;&#20010;&#20107;&#21153;&#21270;EJB&#30340;&#22806;&#35266;&#65288;Facade&#65289;&#21518;&#25165;&#33021;&#20351;&#29992;&#23427;&#12290;EJB&#26377;&#22914;&#27492;&#22810;&#30340;&#35807;&#30149;&#65292;&#23588;&#20854;&#26159;&#23384;&#22312;&#20854;&#23427;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#26102;&#65292;EJB&#19981;&#26159;&#19968;&#20010;&#21560;&#24341;&#20154;&#30340;&#24314;&#35758;&#12290;</p><p><b>&#26412;&#22320;&#20107;&#21153;.&nbsp;</b>&#26412;&#22320;&#20107;&#21153;&#23481;&#26131;&#20351;&#29992;&#65292;&#20294;&#20063;&#26377;&#26126;&#26174;&#30340;&#32570;&#28857;&#65306;&#23427;&#20204;&#19981;&#33021;&#29992;&#20110;&#22810;&#20010;&#20107;&#21153;&#24615;&#36164;&#28304;&#12290;&#20363;&#22914;&#65292;&#20351;&#29992;JDBC&#36830;&#25509;&#20107;&#21153;&#31649;&#29702;&#30340;&#20195;&#30721;&#19981;&#33021;&#29992;&#20110;&#20840;&#23616;&#30340;JTA&#20107;&#21153;&#20013;&#12290;&#21478;&#19968;&#20010;&#32570;&#28857;&#26159;&#23616;&#37096;&#20107;&#21153;&#36235;&#21521;&#20110;&#20837;&#20405;&#24335;&#30340;&#32534;&#31243;&#27169;&#22411;&#12290;</p><p>Spring&#35299;&#20915;&#20102;&#36825;&#20123;&#38382;&#39064;&#12290;&#23427;&#20351;&#24212;&#29992;&#24320;&#21457;&#32773;&#33021;&#22815;&#20351;&#29992;&#22312; <span class="emphasis"><em>&#20219;&#20309;&#29615;&#22659;</em></span> &#19979;&#20351;&#29992; <span class="emphasis"><em>&#19968;&#33268;</em></span> &#30340;&#32534;&#31243;&#27169;&#22411;&#12290;&#20320;&#21487;&#20197;&#21482;&#20889;&#19968;&#27425;&#20320;&#30340;&#20195;&#30721;&#65292;&#36825;&#22312;&#19981;&#21516;&#29615;&#22659;&#19979;&#30340;&#19981;&#21516;&#20107;&#21153;&#31649;&#29702;&#31574;&#30053;&#20013;&#24456;&#26377;&#30410;&#22788;&#12290;Spring&#26694;&#26550;&#21516;&#26102;&#25552;&#20379;&#22768;&#26126;&#24335;&#21644;&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;&#12290;&#22768;&#26126;&#20107;&#21153;&#31649;&#29702;&#26159;&#22810;&#25968;&#20351;&#29992;&#32773;&#30340;&#39318;&#36873;&#65292;&#22312;&#22810;&#25968;&#24773;&#20917;&#19979;&#26159;&#34987;&#25512;&#33616;&#20351;&#29992;&#30340;&#12290;</p><p>&#20351;&#29992;&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;&#65292;&#24320;&#21457;&#32773;&#30452;&#25509;&#20351;&#29992;Spring&#26694;&#26550;&#20107;&#21153;&#25277;&#35937;&#65292;&#36825;&#20010;&#25277;&#35937;&#21487;&#20197;&#20351;&#29992;&#22312;&#20219;&#20309;&#24213;&#23618;&#20107;&#21153;&#22522;&#30784;&#20043;&#19978;&#12290;&#20351;&#29992;&#39318;&#36873;&#30340;&#22768;&#26126;&#24335;&#27169;&#22411;&#65292;&#24320;&#21457;&#32773;&#36890;&#24120;&#20070;&#20889;&#24456;&#23569;&#30340;&#25110;&#27809;&#26377;&#19982;&#20107;&#21153;&#30456;&#20851;&#30340;&#20195;&#30721;&#65292;&#22240;&#27492;&#19981;&#20381;&#36182;Spring&#26694;&#26550;&#25110;&#20219;&#20309;&#20854;&#20182;&#20107;&#21153;API&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-strategies"></a>9.3.&nbsp;&#20851;&#38190;&#25277;&#35937;</h2></div></div><div></div></div><p>Spring&#20107;&#21153;&#25277;&#35937;&#30340;&#20851;&#38190;&#26159;<span class="emphasis"><em>&#20107;&#21153;&#31574;&#30053;</em></span>&#30340;&#27010;&#24565;&#12290;&#36825;&#20010;&#27010;&#24565;&#30001;<tt class="interfacename">org.springframework.transaction.PlatformTransactionManager</tt>&#25509;&#21475;&#23450;&#20041;&#22914;&#19979;&#65306;</p><pre class="programlisting">public interface PlatformTransactionManager {

    TransactionStatus getTransaction(TransactionDefinition definition)
        throws TransactionException;

    void commit(TransactionStatus status) throws TransactionException;

    void rollback(TransactionStatus status) throws TransactionException;
}</pre><p>&#36825;&#39318;&#20808;&#26159;&#19968;&#20010;SPI&#25509;&#21475;&#65292;&#34429;&#28982;&#23427;&#20063;&#21487;&#20197;&#22312; <a href="transaction.html#transaction-programmatic-ptm" title="9.6.2.&nbsp;&#20351;&#29992;PlatformTransactionManager">&#32534;&#31243;</a> &#20013;&#20351;&#29992;&#12290;&#27880;&#24847;&#25353;&#29031;Spring&#26694;&#26550;&#30340;&#21746;&#23398;&#65292;<tt class="interfacename">PlatformTransactionManager</tt> &#26159;&#19968;&#20010; <span class="emphasis"><em>&#25509;&#21475;</em></span>&#12290;&#22240;&#32780;&#22914;&#26524;&#38656;&#35201;&#23427;&#21487;&#20197;&#24456;&#23481;&#26131;&#22320;&#34987;&#27169;&#25311;&#21644;&#26729;&#21270;&#12290;&#23427;&#20063;&#27809;&#26377;&#21644;&#19968;&#20010;&#26597;&#25214;&#31574;&#30053;&#22914;JNDI&#25414;&#32465;&#22312;&#19968;&#36215;&#65306;<tt class="interfacename">PlatformTransactionManager</tt> &#30340;&#23454;&#29616;&#23450;&#20041;&#21644;&#20854;&#20182;Spring IoC&#23481;&#22120;&#20013;&#30340;&#23545;&#35937;&#19968;&#26679;&#12290;&#36825;&#20010;&#22909;&#22788;&#20351;&#24471;&#21363;&#20351;&#20351;&#29992;JTA&#65292;&#20063;&#26159;&#19968;&#20010;&#24456;&#26377;&#20215;&#20540;&#30340;&#25277;&#35937;&#65306;&#20107;&#21153;&#20195;&#30721;&#21487;&#20197;&#27604;&#30452;&#25509;&#20351;&#29992;JTA&#26356;&#21152;&#23481;&#26131;&#27979;&#35797;&#12290;</p><p>&#32487;&#32493;Spring&#21746;&#23398;&#65292;&#21487;&#30001;&#20219;&#20309; <tt class="interfacename">PlatformTransactionManager</tt> &#30340;&#25509;&#21475;&#26041;&#27861;&#25243;&#20986;&#30340; <tt class="exceptionname">TransactionException</tt> &#26159;unchecked exception&#65288;&#32487;&#25215;&#33258;<tt class="exceptionname">java.lang.RuntimeException</tt>&#65289;&#30340;&#12290;&#24213;&#23618;&#30340;&#20107;&#21153;&#22833;&#36133;&#20960;&#20046;&#24635;&#26159;&#33268;&#21629;&#30340;&#12290;&#24456;&#23569;&#24773;&#20917;&#19979;&#24212;&#29992;&#31243;&#24207;&#20195;&#30721;&#21487;&#20197;&#20174;&#23427;&#20204;&#20013;&#24674;&#22797;&#65292;&#19981;&#36807;&#24212;&#29992;&#24320;&#21457;&#32773;&#20381;&#28982;&#21487;&#20197;&#25429;&#33719;&#24182;&#22788;&#29702;<tt class="exceptionname">TransactionException</tt>&#65292;&#20182;&#20204;&#21487;&#20197;&#33258;&#30001;&#20915;&#23450;&#24590;&#20040;&#24178;&#12290;</p><p>
			<tt class="methodname">getTransaction(..)</tt>&#26041;&#27861;&#26681;&#25454;&#19968;&#20010;&#31867;&#22411;&#20026; <tt class="interfacename">TransactionDefinition</tt> &#30340;&#21442;&#25968;&#36820;&#22238;&#19968;&#20010; <tt class="interfacename">TransactionStatus</tt> &#23545;&#35937;&#12290;&#36820;&#22238;&#30340; <tt class="interfacename">TransactionStatus</tt> &#23545;&#35937;&#21487;&#33021;&#20195;&#34920;&#19968;&#20010;&#26032;&#30340;&#25110;&#24050;&#32463;&#23384;&#22312;&#30340;&#20107;&#21153;&#65288;&#22914;&#26524;&#22312;&#24403;&#21069;&#35843;&#29992;&#22534;&#26632;&#26377;&#19968;&#20010;&#31526;&#21512;&#26465;&#20214;&#30340;&#20107;&#21153;&#12290;&#22914;&#21516;J2EE&#20107;&#21153;&#29615;&#22659;&#65292;&#19968;&#20010; <tt class="interfacename">TransactionStatus</tt> &#20063;&#26159;&#21644;&#25191;&#34892; <span class="bold"><b>&#32447;&#31243;</b></span> &#32465;&#23450;&#30340;&#65289;&#12290;</p><p>
			<tt class="interfacename">TransactionDefinition</tt>&#25509;&#21475;&#25351;&#23450;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p>
					<span class="bold"><b>&#20107;&#21153;&#38548;&#31163;</b></span>&#65306;&#24403;&#21069;&#20107;&#21153;&#21644;&#20854;&#23427;&#20107;&#21153;&#30340;&#38548;&#31163;&#30340;&#31243;&#24230;&#12290;&#20363;&#22914;&#65292;&#36825;&#20010;&#20107;&#21153;&#33021;&#21542;&#30475;&#21040;&#20854;&#20182;&#20107;&#21153;&#26410;&#25552;&#20132;&#30340;&#20889;&#25968;&#25454;&#65311;</p></li><li><p>
					<span class="bold"><b>&#20107;&#21153;&#20256;&#25773;</b></span>&#65306;&#36890;&#24120;&#22312;&#19968;&#20010;&#20107;&#21153;&#20013;&#25191;&#34892;&#30340;&#25152;&#26377;&#20195;&#30721;&#37117;&#20250;&#22312;&#36825;&#20010;&#20107;&#21153;&#20013;&#36816;&#34892;&#12290;&#20294;&#26159;&#65292;&#22914;&#26524;&#19968;&#20010;&#20107;&#21153;&#19978;&#19979;&#25991;&#24050;&#32463;&#23384;&#22312;&#65292;&#26377;&#20960;&#20010;&#36873;&#39033;&#21487;&#20197;&#25351;&#23450;&#19968;&#20010;&#20107;&#21153;&#24615;&#26041;&#27861;&#30340;&#25191;&#34892;&#34892;&#20026;&#65306;&#20363;&#22914;&#65292;&#31616;&#21333;&#22320;&#22312;&#29616;&#26377;&#30340;&#20107;&#21153;&#20013;&#32487;&#32493;&#36816;&#34892;&#65288;&#22823;&#22810;&#25968;&#24773;&#20917;&#65289;&#65307;&#25110;&#32773;&#25346;&#36215;&#29616;&#26377;&#20107;&#21153;&#65292;&#21019;&#24314;&#19968;&#20010;&#26032;&#30340;&#20107;&#21153;&#12290;<span class="emphasis"><em>Spring&#25552;&#20379;EJB CMT&#20013;&#24120;&#35265;&#30340;&#20107;&#21153;&#20256;&#25773;&#36873;&#39033;</em></span>&#12290;</p></li><li><p>
					<span class="bold"><b>&#20107;&#21153;&#36229;&#26102;</b></span>: &#20107;&#21153;&#22312;&#36229;&#26102;&#21069;&#33021;&#36816;&#34892;&#22810;&#20037;&#65288;&#33258;&#21160;&#34987;&#24213;&#23618;&#30340;&#20107;&#21153;&#22522;&#30784;&#35774;&#26045;&#22238;&#28378;&#65289;&#12290;</p></li><li><p>
					<span class="bold"><b>&#21482;&#35835;&#29366;&#24577;</b></span>: &#21482;&#35835;&#20107;&#21153;&#19981;&#20462;&#25913;&#20219;&#20309;&#25968;&#25454;&#12290;&#21482;&#35835;&#20107;&#21153;&#22312;&#26576;&#20123;&#24773;&#20917;&#19979;&#65288;&#20363;&#22914;&#24403;&#20351;&#29992;Hibernate&#26102;&#65289;&#65292;&#26159;&#19968;&#31181;&#38750;&#24120;&#26377;&#29992;&#30340;&#20248;&#21270;&#12290;</p></li></ul></div><p>&#36825;&#20123;&#35774;&#32622;&#21453;&#26144;&#20102;&#26631;&#20934;&#27010;&#24565;&#12290;&#22914;&#26524;&#38656;&#35201;&#65292;&#35831;&#26597;&#38405;&#35752;&#35770;&#20107;&#21153;&#38548;&#31163;&#23618;&#27425;&#21644;&#20854;&#20182;&#26680;&#24515;&#20107;&#21153;&#27010;&#24565;&#30340;&#36164;&#28304;&#65306;&#29702;&#35299;&#36825;&#20123;&#27010;&#24565;&#22312;&#20351;&#29992;Spring&#26694;&#26550;&#21644;&#20854;&#20182;&#20107;&#21153;&#31649;&#29702;&#35299;&#20915;&#26041;&#26696;&#26102;&#26159;&#38750;&#24120;&#20851;&#38190;&#30340;&#12290;</p><p>
			<tt class="interfacename">TransactionStatus</tt> &#25509;&#21475;&#20026;&#22788;&#29702;&#20107;&#21153;&#30340;&#20195;&#30721;&#25552;&#20379;&#19968;&#20010;&#31616;&#21333;&#30340;&#25511;&#21046;&#20107;&#21153;&#25191;&#34892;&#21644;&#26597;&#35810;&#20107;&#21153;&#29366;&#24577;&#30340;&#26041;&#27861;&#12290;&#36825;&#20010;&#27010;&#24565;&#24212;&#35813;&#26159;&#29087;&#24713;&#30340;&#65292;&#22240;&#20026;&#23427;&#20204;&#22312;&#25152;&#26377;&#30340;&#20107;&#21153;API&#20013;&#26159;&#30456;&#21516;&#30340;:</p><pre class="programlisting">public interface TransactionStatus {

    boolean isNewTransaction();

    void setRollbackOnly();

    boolean isRollbackOnly();
}</pre><p>&#20351;&#29992;Spring&#26102;&#65292;&#26080;&#35770;&#20320;&#36873;&#25321;&#32534;&#31243;&#24335;&#36824;&#26159;&#22768;&#26126;&#24335;&#30340;&#20107;&#21153;&#31649;&#29702;&#65292;&#23450;&#20041;&#19968;&#20010;&#27491;&#30830;&#30340; <tt class="interfacename">PlatformTransactionManager</tt> &#23454;&#29616;&#37117;&#26159;&#33267;&#20851;&#37325;&#35201;&#30340;&#12290;&#25353;&#29031;Spring&#30340;&#33391;&#22909;&#39118;&#26684;&#65292;&#36825;&#31181;&#37325;&#35201;&#23450;&#20041;&#37117;&#26159;&#36890;&#36807;IoC&#23454;&#29616;&#30340;&#12290;</p><p>&#19968;&#33324;&#26469;&#35828;&#65292;&#36873;&#25321;<tt class="interfacename">PlatformTransactionManager</tt>&#23454;&#29616;&#26102;&#38656;&#35201;&#30693;&#36947;&#24403;&#21069;&#30340;&#24037;&#20316;&#29615;&#22659;&#65292;&#22914;JDBC&#12289;JTA&#12289;Hibernate&#31561;&#12290;&#19979;&#38754;&#30340;&#20363;&#23376;&#26469;&#33258;Spring&#31034;&#20363;&#24212;&#29992;&#8212;&#8212;<span class="bold"><b>jPetStore</b></span>&#8212;&#8212;&#20013;&#30340;<tt class="literal">dataAccessContext-local.xml</tt>&#25991;&#20214;&#65292;&#20854;&#20013;&#23637;&#31034;&#20102;&#19968;&#20010;&#23616;&#37096;<tt class="interfacename">PlatformTransactionManager</tt>&#23454;&#29616;&#26159;&#24590;&#20040;&#23450;&#20041;&#30340;&#65288;&#20165;&#38480;&#20110;&#32431;&#31929;JDBC&#29615;&#22659;&#65289;</p><p>&#25105;&#20204;&#24517;&#39035;&#20808;&#23450;&#20041;&#19968;&#20010;JDBC <tt class="interfacename">DataSource</tt>&#65292;&#28982;&#21518;&#20351;&#29992;Spring&#30340;<tt class="classname">DataSourceTransactionManager</tt>&#65292;&#24182;&#20256;&#20837;&#25351;&#21521;<tt class="interfacename">DataSource</tt>&#30340;&#24341;&#29992;&#12290;</p><pre class="programlisting">&lt;bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"&gt;
  &lt;property name="driverClassName" value="${jdbc.driverClassName}" /&gt;
  &lt;property name="url" value="${jdbc.url}" /&gt;
  &lt;property name="username" value="${jdbc.username}" /&gt;
  &lt;property name="password" value="${jdbc.password}" /&gt;
&lt;/bean&gt;</pre><p>
			<tt class="interfacename">PlatformTransactionManager</tt> bean&#30340;&#23450;&#20041;&#22914;&#19979;&#65306;</p><pre class="programlisting">&lt;bean id="txManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt;
  &lt;property name="dataSource" ref="dataSource"/&gt;
&lt;/bean&gt;</pre><p>&#22914;&#26524;&#25105;&#20204;&#22312;J2EE&#23481;&#22120;&#37324;&#20351;&#29992;JTA&#65292;&#23601;&#20687;&#31034;&#20363;&#20013; <tt class="filename">'dataAccessContext-jta.xml'</tt> &#25991;&#20214;&#25152;&#31034;&#65292;&#25105;&#20204;&#23558;&#36890;&#36807;JNDI&#21644;Spring&#30340; <tt class="classname">JtaTransactionManager</tt> &#26469;&#33719;&#21462;&#19968;&#20010;&#23481;&#22120;&#31649;&#29702;&#30340; <tt class="interfacename">DataSource</tt>&#12290;<tt class="classname">JtaTransactionManager</tt> &#19981;&#38656;&#35201;&#30693;&#36947; <tt class="interfacename">DataSource</tt> &#21644;&#20854;&#20182;&#29305;&#23450;&#30340;&#36164;&#28304;&#65292;&#22240;&#20026;&#23427;&#23558;&#20351;&#29992;&#23481;&#22120;&#25552;&#20379;&#30340;&#20840;&#23616;&#20107;&#21153;&#31649;&#29702;&#12290;</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:jee="http://www.springframework.org/schema/jee"
xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
       http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-2.0.xsd"&gt;

  &lt;jee:jndi-lookup id="dataSource" jndi-name="jdbc/jpetstore"/&gt;

  &lt;bean id="txManager" class="org.springframework.transaction.jta.JtaTransactionManager" /&gt;

  <i class="lineannotation"><span class="lineannotation">&lt;!-- other <tt class="literal">&lt;bean/&gt;</tt> definitions here --&gt;</span></i>

&lt;/beans&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>&#19978;&#38754; <tt class="literal">'dataSource'</tt> &#30340;bean&#23450;&#20041;&#20351;&#29992;&#20102; <tt class="literal">'jee'</tt> &#21517;&#31216;&#31354;&#38388;&#19979;&#30340; <tt class="literal">&lt;jndi-lookup/&gt;</tt> &#26631;&#31614;&#12290;&#24819;&#20102;&#35299;&#26356;&#22810;&#30340;&#37197;&#32622;&#20449;&#24687;, &#35831;&#30475; <a href="xsd-config.html" title="Appendix&nbsp;A.&nbsp;XML Schema-based configuration">Appendix&nbsp;A, <i>XML Schema-based configuration</i></a>&#65292;&#20851;&#20110; <tt class="literal">&lt;jee/&gt;</tt> &#26631;&#31614;&#30340;&#20449;&#24687;&#65292;&#21487;&#21442;&#32771; <a href="xsd-config.html#xsd-config-body-schemas-jee" title="A.2.3.&nbsp;The jee schema">Section&nbsp;A.2.3, &#8220;The jee schema&#8221;</a> &#33410;&#12290;</p></td></tr></table></div><p>&#25105;&#20204;&#20063;&#21487;&#20197;&#24456;&#23481;&#26131;&#22320;&#20351;&#29992;Hibernate&#23616;&#37096;&#20107;&#21153;&#65292;&#23601;&#20687;&#19979;&#38754;&#30340;Spring&#26694;&#26550;&#30340; <span class="bold"><b>PetClinic</b></span> &#31034;&#20363;&#24212;&#29992;&#20013;&#30340;&#20363;&#23376;&#19968;&#26679;&#65289;&#12290;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#25105;&#20204;&#38656;&#35201;&#23450;&#20041;&#19968;&#20010;Hibernate&#30340; <tt class="classname">LocalSessionFactoryBean</tt>&#65292;&#24212;&#29992;&#31243;&#24207;&#20174;&#20013;&#33719;&#21462;&#21040;Hibernate <tt class="interfacename">Session</tt> &#23454;&#20363;&#12290;</p><p>
			<tt class="interfacename">DataSource</tt> &#30340;bean&#23450;&#20041;&#21516;&#19978;&#20363;&#31867;&#20284;&#65288;&#36825;&#37324;&#19981;&#20877;&#23637;&#31034;&#65289;&#12290;&#19981;&#36807;&#65292;&#22914;&#26524;&#26159;&#19968;&#20010;JEE&#23481;&#22120;&#25552;&#20379;&#30340; <tt class="interfacename">DataSource</tt>&#65292;&#23427;&#23558;&#30001;JEE&#23481;&#22120;&#33258;&#36523;&#65292;&#32780;&#19981;&#26159;Spring&#26694;&#26550;&#26469;&#31649;&#29702;&#20107;&#21153;&#12290;</p><p>&#36825;&#31181;&#24773;&#20917;&#20013;<tt class="literal">'txManager'</tt> bean&#30340;&#31867;&#22411;&#20026; <tt class="classname">HibernateTransactionManager</tt>&#12290;&#21516;&#26679;&#22320;&#65292;<tt class="classname">DataSourceTransactionManager</tt> &#38656;&#35201;&#19968;&#20010;&#25351;&#21521; <tt class="interfacename">DataSource</tt> &#30340;&#24341;&#29992;&#65292;&#32780; <tt class="classname">HibernateTransactionManager</tt> &#38656;&#35201;&#19968;&#20010;&#25351;&#21521; <tt class="interfacename">SessionFactory</tt> &#30340;&#24341;&#29992;&#12290;</p><pre class="programlisting">&lt;bean id="sessionFactory" class="org.springframework.orm.hibernate.LocalSessionFactoryBean"&gt;
  &lt;property name="dataSource" ref="dataSource" /&gt;
  &lt;property name="mappingResources"&gt;
    &lt;list&gt;
      &lt;value&gt;org/springframework/samples/petclinic/hibernate/petclinic.hbm.xml&lt;/value&gt;
    &lt;/list&gt;
  &lt;/property&gt;
  &lt;property name="hibernateProperties"&gt;
    &lt;value&gt;
	  hibernate.dialect=${hibernate.dialect}
	&lt;/value&gt;
  &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="txManager" class="org.springframework.orm.hibernate.HibernateTransactionManager"&gt;
  &lt;property name="sessionFactory" ref="sessionFactory" /&gt;
&lt;/bean&gt;</pre><p>&#25105;&#20204;&#21487;&#20197;&#31616;&#21333;&#22320;&#20351;&#29992; <tt class="classname">JtaTransactionManager</tt> &#26469;&#22788;&#29702;Hibernate&#20107;&#21153;&#21644;JTA&#20107;&#21153;&#65292;&#23601;&#20687;&#25105;&#20204;&#22788;&#29702;JDBC&#65292;&#25110;&#32773;&#20219;&#20309;&#20854;&#23427;&#30340;&#36164;&#28304;&#31574;&#30053;&#19968;&#26679;&#12290;</p><pre class="programlisting">&lt;bean id="txManager" class="org.springframework.transaction.jta.JtaTransactionManager"/&gt;</pre><p>&#27880;&#24847;&#20219;&#20309;&#36164;&#28304;&#30340;JTA&#37197;&#32622;&#37117;&#26159;&#36825;&#26679;&#30340;&#65292;&#22240;&#20026;&#23427;&#20204;&#37117;&#26159;&#20840;&#23616;&#20107;&#21153;&#65292;&#21487;&#20197;&#25903;&#25345;&#20219;&#20309;&#20107;&#21153;&#24615;&#36164;&#28304;&#12290;</p><p>
			<i><span class="remark">
			&#22312;&#25152;&#26377;&#36825;&#20123;&#24773;&#20917;&#19979;&#65292;&#24212;&#29992;&#31243;&#24207;&#20195;&#30721;&#26681;&#26412;&#19981;&#38656;&#35201;&#20570;&#20219;&#20309;&#25913;&#21160;&#12290;&#25105;&#20204;&#20165;&#20165;&#36890;&#36807;&#25913;&#21464;&#37197;&#32622;&#23601;&#21487;&#20197;&#25913;&#21464;&#20107;&#21153;&#31649;&#29702;&#26041;&#24335;&#65292;&#21363;&#20351;&#36825;&#20123;&#26356;&#25913;&#26159;&#22312;&#23616;&#37096;&#20107;&#21153;&#21644;&#20840;&#23616;&#20107;&#21153;&#38388;&#20999;&#25442;&#12290;
			</span></i>
		</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tx-resource-synchronization"></a>9.4.&nbsp;&#20351;&#29992;&#36164;&#28304;&#21516;&#27493;&#30340;&#20107;&#21153;</h2></div></div><div></div></div><p>&#29616;&#22312;&#24212;&#35813;&#27604;&#36739;&#28165;&#26970;&#30340;&#26159;&#65306;&#19981;&#21516;&#30340;&#20107;&#21153;&#31649;&#29702;&#22120;&#26159;&#22914;&#20309;&#21019;&#24314;&#30340;&#65292;&#20197;&#21450;&#23427;&#20204;&#22914;&#20309;&#34987;&#36830;&#25509;&#21040;&#30456;&#24212;&#30340;&#38656;&#35201;&#34987;&#21516;&#27493;&#21040;&#20107;&#21153;&#30340;&#36164;&#28304;&#19978;&#65288;&#20363;&#22914;&#65292;<tt class="classname">DataSourceTransactionManager</tt> &#23545;&#24212;&#21040;JDBC <tt class="interfacename">DataSource</tt>&#65292;
			<tt class="classname">HibernateTransactionManager</tt> &#23545;&#24212;&#21040;Hibernate&#30340; <tt class="interfacename">SessionFactory</tt> &#31561;&#65289;&#12290;&#21487;&#26159;&#65292;&#21097;&#19979;&#30340;&#38382;&#39064;&#26159;&#65292;&#30452;&#25509;&#25110;&#38388;&#25509;&#22320;&#20351;&#29992;&#19968;&#31181;&#25345;&#20037;&#21270;API&#65288;JDBC&#12289;Hibernate&#12289;JDO&#31561;&#65289;&#30340;&#24212;&#29992;&#20195;&#30721;&#65292;&#22914;&#20309;&#30830;&#20445;&#36890;&#36807;&#30456;&#20851;&#30340; <tt class="interfacename">PlatformTransactionManager</tt> &#26469;&#24688;&#24403;&#22320;&#33719;&#21462;&#24182;&#25805;&#20316;&#36164;&#28304;&#65292;&#26469;&#28385;&#36275;&#20107;&#21153;&#21516;&#27493;&#65292;&#36825;&#20123;&#25805;&#20316;&#21253;&#25324;&#65306;&#21019;&#24314;&#12289;&#22797;&#29992;&#12289;&#28165;&#29702; &#21644; &#35302;&#21457;&#65288;&#21487;&#33021;&#27809;&#26377;&#65289;&#12290;</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="tx-resource-synchronization-high"></a>9.4.1.&nbsp;&#39640;&#23618;&#27425;&#26041;&#26696;</h3></div></div><div></div></div><p>&#39318;&#36873;&#30340;&#26041;&#27861;&#26159;&#20351;&#29992;Spring&#30340;&#39640;&#23618;&#25345;&#20037;&#21270;&#38598;&#25104;API&#12290;&#36825;&#31181;&#26041;&#24335;&#19981;&#20250;&#26367;&#25442;&#21407;&#22987;&#30340;API&#65292;&#32780;&#26159;&#22312;&#20869;&#37096;&#23553;&#35013;&#20102;&#36164;&#28304;&#21019;&#24314;&#12289;&#22797;&#29992;&#12289;&#28165;&#29702;&#12289;&#20107;&#21153;&#21516;&#27493;&#20197;&#21450;&#24322;&#24120;&#26144;&#23556;&#31561;&#21151;&#33021;&#65292;&#36825;&#26679;&#29992;&#25143;&#30340;&#25968;&#25454;&#35775;&#38382;&#20195;&#30721;&#23601;&#19981;&#24517;&#20851;&#24515;&#36825;&#20123;&#65292;&#32780;&#38598;&#20013;&#31934;&#21147;&#20110;&#33258;&#24049;&#30340;&#25345;&#20037;&#21270;&#36923;&#36753;&#12290;&#36890;&#24120;&#65292;&#23545;&#25152;&#26377;&#25345;&#20037;&#21270;API&#37117;&#37319;&#29992;&#36825;&#31181; <span class="emphasis"><em>&#27169;&#26495;</em></span> &#26041;&#27861;&#65292;&#21253;&#25324; <tt class="classname">JdbcTemplate</tt>&#12289;<tt class="classname">HibernateTemplate</tt>&#21644;<tt class="classname">JdoTemplate</tt>&#31867;&#65288;&#36825;&#20123;&#22312;&#36825;&#20221;&#21442;&#32771;&#25991;&#26723;&#21518;&#38754;&#30340;&#31456;&#33410;&#20013;&#35814;&#32454;&#21465;&#36848;&#65289;&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="tx-resource-synchronization-low"></a>9.4.2.&nbsp;&#20302;&#23618;&#27425;&#26041;&#26696;</h3></div></div><div></div></div><p>&#22312;&#36739;&#20302;&#23618;&#27425;&#19978;&#65292;&#26377;&#20197;&#19979;&#36825;&#20123;&#31867;&#65306;<tt class="classname">DataSourceUtils</tt>&#65288;&#38024;&#23545;JDBC&#65289;&#65292;<tt class="classname">SessionFactoryUtils</tt>&#65288;&#38024;&#23545;Hibernate&#65289;&#65292;<tt class="classname">PersistenceManagerFactoryUtils</tt>&#65288;&#38024;&#23545;JDO&#65289;&#31561;&#31561;&#12290;&#24403;&#23545;&#24212;&#29992;&#20195;&#30721;&#26469;&#35828;&#65292;&#30452;&#25509;&#21516;&#21407;&#22987;&#25345;&#20037;&#21270;API&#29305;&#26377;&#30340;&#36164;&#28304;&#31867;&#22411;&#25171;&#20132;&#36947;&#26159;&#26356;&#22909;&#30340;&#36873;&#25321;&#26102;&#65292;&#36825;&#20123;&#31867;&#30830;&#20445;&#24212;&#29992;&#20195;&#30721;&#33719;&#21462;&#21040;&#27491;&#30830;&#30340;Spring&#26694;&#26550;&#25152;&#31649;&#29702;&#30340;bean&#65292;&#20107;&#21153;&#34987;&#27491;&#30830;&#21516;&#27493;&#65292;&#22788;&#29702;&#36807;&#31243;&#20013;&#30340;&#24322;&#24120;&#34987;&#26144;&#23556;&#21040;&#19968;&#33268;&#30340;API&#12290;</p><p>&#20363;&#22914;&#65292;&#22312;JDBC&#29615;&#22659;&#19979;&#65292;&#20320;&#19981;&#20877;&#20351;&#29992;&#20256;&#32479;&#30340;&#35843;&#29992; <tt class="interfacename">DataSource</tt> &#30340; <tt class="literal">getConnection()</tt> &#26041;&#27861;&#30340;&#26041;&#24335;&#65292;&#32780;&#26159;&#20351;&#29992;Spring&#30340; <tt class="classname">org.springframework.jdbc.datasource.DataSourceUtils</tt>&#65292;&#20687;&#36825;&#26679;&#65306;</p><pre class="programlisting">Connection conn = DataSourceUtils.getConnection(dataSource);</pre><p>&#22914;&#26524;&#24050;&#26377;&#19968;&#20010;&#20107;&#21153;&#21450;&#19982;&#20043;&#20851;&#32852;&#30340;connection&#23384;&#22312;&#65292;&#35813;&#23454;&#20363;&#23558;&#34987;&#36820;&#22238;&#12290;&#21542;&#21017;&#65292;&#35813;&#26041;&#27861;&#35843;&#29992;&#23558;&#35302;&#21457;&#36215;&#19968;&#20010;&#26032;&#30340;connection&#30340;&#21019;&#24314;&#21160;&#20316;&#65292;&#35813;connection&#65288;&#21487;&#36873;&#22320;&#65289;&#34987;&#21516;&#27493;&#21040;&#20219;&#20309;&#29616;&#26377;&#30340;&#20107;&#21153;&#65292;&#24182;&#21487;&#20197;&#22312;&#21516;&#19968;&#20107;&#21153;&#33539;&#22260;&#20869;&#34987;&#21518;&#32493;&#30340;&#35843;&#29992;&#22797;&#29992;&#12290;&#27491;&#22914;&#19978;&#38754;&#25552;&#21040;&#30340;&#65292;&#36825;&#20010;&#36807;&#31243;&#26377;&#19968;&#20010;&#39069;&#22806;&#30340;&#22909;&#22788;&#65292;&#23601;&#26159;&#20219;&#20309; <tt class="exceptionname">SQLException</tt>&#23558;&#34987;&#21253;&#35013;&#20026;Spring&#26694;&#26550;&#30340; <tt class="exceptionname">CannotGetJdbcConnectionException</tt>&#65292;&#35813;&#31867;&#26159;Spring&#26694;&#26550;&#30340;unchecked&#30340;DataAccessExceptions&#23618;&#27425;&#20307;&#31995;&#20013;&#30340;&#19968;&#21592;&#12290;&#36825;&#23558;&#32473;&#20320;&#27604;&#20174; <tt class="exceptionname">SQLException</tt> &#20013;&#31616;&#21333;&#25152;&#24471;&#26356;&#22810;&#30340;&#20449;&#24687;&#65292;&#32780;&#19988;&#20445;&#35777;&#20102;&#36328;&#25968;&#25454;&#24211;&#8212;&#8212;&#29978;&#33267;&#20854;&#20182;&#25345;&#20037;&#21270;&#25216;&#26415;&#8212;&#8212;&#30340;&#31227;&#26893;&#24615;&#12290;</p><p>&#24212;&#35813;&#25351;&#20986;&#30340;&#26159;&#65292;&#36825;&#20123;&#31867;&#21516;&#26679;&#21487;&#20197;&#22312;&#27809;&#26377;Spring&#20107;&#21153;&#31649;&#29702;&#30340;&#29615;&#22659;&#20013;&#24037;&#20316;&#33391;&#22909;&#65288;&#20107;&#21153;&#21516;&#27493;&#33021;&#21147;&#26159;&#21487;&#36873;&#30340;&#65289;&#65292;&#25152;&#20197;&#26080;&#35770;&#20320;&#26159;&#21542;&#20351;&#29992;Spring&#30340;&#20107;&#21153;&#31649;&#29702;&#65292;&#20320;&#37117;&#21487;&#20197;&#20351;&#29992;&#36825;&#20123;&#31867;&#12290;</p><p>&#24403;&#28982;&#65292;&#19968;&#26086;&#20320;&#29992;&#36807;Spring&#30340;JDBC&#25903;&#25345;&#25110;Hibernate&#25903;&#25345;&#65292;&#20320;&#19968;&#33324;&#23601;&#19981;&#20877;&#20250;&#36873;&#25321; <tt class="classname">DataSourceUtils</tt> &#25110;&#26159;&#21035;&#30340;&#36741;&#21161;&#31867;&#20102;&#65292;&#22240;&#20026;&#20320;&#20250;&#26356;&#20048;&#24847;&#19982;Spring&#25277;&#35937;&#19968;&#36215;&#24037;&#20316;&#65292;&#32780;&#19981;&#26159;&#30452;&#25509;&#20351;&#29992;&#30456;&#20851;&#30340;API&#12290;&#20363;&#22914;&#65292;&#22914;&#26524;&#20320;&#20351;&#29992;Spring&#30340; <tt class="classname">JdbcTemplate</tt> &#25110; <tt class="literal">jdbc.object</tt> &#21253;&#26469;&#31616;&#21270;&#20351;&#29992;JDBC&#65292;Spring&#20250;&#22312;&#24149;&#21518;&#26367;&#20320;&#27491;&#30830;&#22320;&#33719;&#21462;&#36830;&#25509;&#65292;&#32780;&#20320;&#19981;&#38656;&#35201;&#20889;&#20219;&#20309;&#29305;&#27530;&#20195;&#30721;&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="tx-resource-synchronization-tadsp"></a>9.4.3.&nbsp;
				<tt class="classname">TransactionAwareDataSourceProxy</tt>
			</h3></div></div><div></div></div><p>&#24037;&#20316;&#22312;&#26368;&#24213;&#23618;&#30340;&#26159; <tt class="classname">TransactionAwareDataSourceProxy</tt> &#31867;&#12290;&#36825;&#26159;&#19968;&#20010;&#23545;&#30446;&#26631; <tt class="interfacename">DataSource</tt> &#30340;&#20195;&#29702;&#65292;&#23427;&#21253;&#35013;&#20102;&#30446;&#26631; <tt class="interfacename">DataSource</tt>&#65292;&#25552;&#20379;&#23545;Spring&#31649;&#29702;&#20107;&#21153;&#30340;&#21487;&#30693;&#24615;&#12290;&#22312;&#36825;&#28857;&#19978;&#65292;&#23427;&#31867;&#20284;&#20110;&#19968;&#20010;J2EE&#26381;&#21153;&#22120;&#25552;&#20379;&#30340;&#20107;&#21153;&#24615;JNDI <tt class="interfacename">DataSource</tt>&#12290;</p><p>&#35813;&#31867;&#24212;&#35813;&#27704;&#36828;&#19981;&#38656;&#35201;&#34987;&#24212;&#29992;&#20195;&#30721;&#20351;&#29992;&#65292;&#38500;&#38750;&#29616;&#26377;&#20195;&#30721;&#23384;&#22312;&#38656;&#35201;&#30452;&#25509;&#20256;&#36882;&#19968;&#20010;&#26631;&#20934;&#30340;JDBC&#30340; <tt class="interfacename">DataSource</tt> &#30340;&#24773;&#20917;&#12290;&#36825;&#26102;&#21487;&#20197;&#36890;&#36807;&#21442;&#19982;Spring&#31649;&#29702;&#20107;&#21153;&#35753;&#36825;&#20123;&#20195;&#30721;&#20173;&#28982;&#26377;&#29992;&#12290;&#20070;&#20889;&#26032;&#30340;&#20195;&#30721;&#26102;&#65292;&#39318;&#36873;&#30340;&#26041;&#27861;&#26159;&#37319;&#29992;&#19978;&#38754;&#25552;&#21040;&#30340;Spring&#39640;&#23618;&#25277;&#35937;&#12290;</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-declarative"></a>9.5.&nbsp;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;</h2></div></div><div></div></div><i><span class="remark">&#22823;&#22810;&#25968;Spring&#29992;&#25143;&#36873;&#25321;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#12290;&#36825;&#26159;&#23545;&#24212;&#29992;&#20195;&#30721;&#24433;&#21709;&#26368;&#23567;&#30340;&#36873;&#25321;&#65292;&#22240;&#27492;&#20063;&#26368;&#31526;&#21512; <span class="emphasis"><em>&#38750;&#20405;&#20837;&#24335;</em></span> &#36731;&#37327;&#32423;&#23481;&#22120;&#30340;&#29702;&#24565;&#12290;</span></i><p>Spring&#30340;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#26159;&#36890;&#36807;Spring AOP&#23454;&#29616;&#30340;&#65292;&#22240;&#20026;&#20107;&#21153;&#26041;&#38754;&#30340;&#20195;&#30721;&#19982;Spring&#32465;&#23450;&#24182;&#20197;&#19968;&#31181;&#26679;&#26495;&#24335;&#39118;&#26684;&#20351;&#29992;&#65292;
   &#19981;&#36807;&#23613;&#31649;&#22914;&#27492;&#65292;&#20320;&#19968;&#33324;&#24182;&#19981;&#38656;&#35201;&#29702;&#35299;AOP&#27010;&#24565;&#23601;&#21487;&#20197;&#26377;&#25928;&#22320;&#20351;&#29992;Spirng&#30340;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#12290;</p><p>&#20174;&#32771;&#34385;EJB CMT&#21644;Spring&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#30340;&#30456;&#20284;&#20197;&#21450;&#19981;&#21516;&#20043;&#22788;&#20986;&#21457;&#26159;&#24456;&#26377;&#30410;&#30340;&#12290;&#23427;&#20204;&#30340;&#22522;&#26412;&#26041;&#27861;&#26159;&#30456;&#20284;&#30340;&#65306;
		&#37117;&#21487;&#20197;&#25351;&#23450;&#20107;&#21153;&#31649;&#29702;&#21040;&#21333;&#29420;&#30340;&#26041;&#27861;&#65307;&#22914;&#26524;&#38656;&#35201;&#21487;&#20197;&#22312;&#20107;&#21153;&#19978;&#19979;&#25991;&#35843;&#29992; <tt class="methodname">setRollbackOnly()</tt> &#26041;&#27861;&#12290;&#19981;&#21516;&#20043;&#22788;&#22312;&#20110;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p>&#19981;&#20687;EJB CMT&#32465;&#23450;&#22312;JTA&#19978;&#65292;Spring&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#21487;&#20197;&#22312;&#20219;&#20309;&#29615;&#22659;&#19979;&#20351;&#29992;&#12290;&#21482;&#38656;&#26356;&#25913;&#37197;&#32622;&#25991;&#20214;&#65292;
	&#23427;&#23601;&#21487;&#20197;&#21644;JDBC&#12289;JDO&#12289;Hibernate&#25110;&#20854;&#20182;&#30340;&#20107;&#21153;&#26426;&#21046;&#19968;&#36215;&#24037;&#20316;&#12290;</p></li><li><p>Spring&#30340;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#21487;&#20197;&#34987;&#24212;&#29992;&#21040;&#20219;&#20309;&#31867;&#65288;&#20197;&#21450;&#37027;&#20010;&#31867;&#30340;&#23454;&#20363;&#65289;&#19978;&#65292;&#19981;&#20165;&#20165;&#26159;&#20687;EJB&#37027;&#26679;&#30340;&#29305;&#27530;&#31867;&#12290;</p></li><li><p>Spring&#25552;&#20379;&#20102;&#22768;&#26126;&#24335;&#30340;	<a href="transaction.html#transaction-declarative-rolling-back" title="9.5.3.&nbsp;&#22238;&#28378;"><span class="emphasis"><em>&#22238;&#28378;&#35268;&#21017;</em></span></a>&#65306;EJB&#27809;&#26377;&#23545;&#24212;&#30340;&#29305;&#24615;&#65292;&#25105;&#20204;&#23558;&#22312;&#19979;&#38754;&#35752;&#35770;&#12290;&#22238;&#28378;&#21487;&#20197;&#22768;&#26126;&#24335;&#30340;&#25511;&#21046;&#65292;&#19981;&#20165;&#20165;&#26159;&#32534;&#31243;&#24335;&#30340;&#12290;</p></li><li><p>Spring&#20801;&#35768;&#20320;&#36890;&#36807;AOP&#23450;&#21046;&#20107;&#21153;&#34892;&#20026;&#12290;&#20363;&#22914;&#65292;&#22914;&#26524;&#38656;&#35201;&#65292;&#20320;&#21487;&#20197;&#22312;&#20107;&#21153;&#22238;&#28378;&#20013;&#25554;&#20837;&#23450;&#21046;&#30340;&#34892;&#20026;&#12290;
				&#20320;&#20063;&#21487;&#20197;&#22686;&#21152;&#20219;&#24847;&#30340;&#36890;&#30693;&#65292;&#23601;&#35937;&#20107;&#21153;&#36890;&#30693;&#19968;&#26679;&#12290;&#20351;&#29992;EJB CMT&#65292;&#38500;&#20102;&#20351;&#29992;<tt class="literal">setRollbackOnly()</tt>&#65292;&#20320;&#27809;&#26377;&#21150;&#27861;&#33021;&#22815;&#24433;&#21709;&#23481;&#22120;&#30340;&#20107;&#21153;&#31649;&#29702;&#12290;</p></li><li><p>Spring&#19981;&#25552;&#20379;&#39640;&#31471;&#24212;&#29992;&#26381;&#21153;&#22120;&#25552;&#20379;&#30340;&#36328;&#36234;&#36828;&#31243;&#35843;&#29992;&#30340;&#20107;&#21153;&#19978;&#19979;&#25991;&#20256;&#25773;&#12290;&#22914;&#26524;&#20320;&#38656;&#35201;&#36825;&#20123;&#29305;&#24615;&#65292;&#25105;&#20204;&#25512;&#33616;&#20320;&#20351;&#29992;EJB&#12290;
				&#28982;&#32780;&#65292;&#19981;&#35201;&#36731;&#26131;&#20351;&#29992;&#36825;&#20123;&#29305;&#24615;&#12290;&#22240;&#20026;&#36890;&#24120;&#25105;&#20204;&#24182;&#19981;&#24076;&#26395;&#20107;&#21153;&#36328;&#36234;&#36828;&#31243;&#35843;&#29992;&#12290;</p></li></ul></div><div class="sidebar"><p class="title"><b><tt class="classname">TransactionProxyFactoryBean</tt>&#22312;&#21738;&#20799;&#65311;</b></p><p>Spring2.0&#21450;&#20197;&#21518;&#30340;&#29256;&#26412;&#20013;&#22768;&#26126;&#24335;&#20107;&#21153;&#30340;&#37197;&#32622;&#19982;&#20043;&#21069;&#30340;&#29256;&#26412;&#26377;&#30456;&#24403;&#22823;&#30340;&#19981;&#21516;&#12290;&#20027;&#35201;&#24046;&#24322;&#22312;&#20110;&#19981;&#20877;&#38656;&#35201;&#37197;&#32622;<tt class="classname">TransactionProxyFactoryBean</tt>&#20102;&#12290;</p><p>Spring2.0&#20043;&#21069;&#30340;&#26087;&#29256;&#26412;&#39118;&#26684;&#30340;&#37197;&#32622;&#20173;&#28982;&#26159;&#26377;&#25928;&#30340;&#65307;&#20320;&#21487;&#20197;&#31616;&#21333;&#22320;&#35748;&#20026;&#26032;&#30340;<tt class="literal">&lt;tx:tags/&gt;</tt>&#26367;&#20320;&#23450;&#20041;&#20102;<tt class="classname">TransactionProxyFactoryBean</tt>&#12290;</p></div><p>&#22238;&#28378;&#35268;&#21017;&#30340;&#27010;&#24565;&#27604;&#36739;&#37325;&#35201;&#65306;&#23427;&#20351;&#25105;&#20204;&#33021;&#22815;&#25351;&#23450;&#20160;&#20040;&#26679;&#30340;&#24322;&#24120;&#65288;&#21644;throwable&#65289;&#23558;&#23548;&#33268;&#33258;&#21160;&#22238;&#28378;&#12290;
&#25105;&#20204;&#22312;&#37197;&#32622;&#25991;&#20214;&#20013;&#22768;&#26126;&#24335;&#22320;&#25351;&#23450;&#65292;&#26080;&#39035;&#22312;Java&#20195;&#30721;&#20013;&#12290;&#21516;&#26102;&#65292;&#25105;&#20204;&#20173;&#26087;&#21487;&#20197;&#36890;&#36807;&#35843;&#29992; <tt class="interfacename">TransactionStatus</tt> &#30340;
 <tt class="methodname">setRollbackOnly()</tt> &#26041;&#27861;&#32534;&#31243;&#24335;&#22320;&#22238;&#28378;&#24403;&#21069;&#20107;&#21153;&#12290;&#36890;&#24120;&#65292;&#25105;&#20204;&#23450;&#20041;&#19968;&#26465;&#35268;&#21017;&#65292;
 &#22768;&#26126; <tt class="exceptionname">MyApplicationException</tt> &#24517;&#39035;&#24635;&#26159;&#23548;&#33268;&#20107;&#21153;&#22238;&#28378;&#12290;
 &#36825;&#31181;&#26041;&#24335;&#24102;&#26469;&#20102;&#26174;&#33879;&#30340;&#22909;&#22788;&#65292;&#23427;&#20351;&#20320;&#30340;&#19994;&#21153;&#23545;&#35937;&#19981;&#24517;&#20381;&#36182;&#20110;&#20107;&#21153;&#35774;&#26045;&#12290;&#20856;&#22411;&#30340;&#20363;&#23376;&#26159;&#20320;&#19981;&#24517;&#22312;&#20195;&#30721;&#20013;&#23548;&#20837;Spring API&#65292;&#20107;&#21153;&#31561;&#12290;</p><p>&#23545;EJB&#26469;&#35828;&#65292;&#40664;&#35748;&#30340;&#34892;&#20026;&#26159;EJB&#23481;&#22120;&#22312;&#36935;&#21040; <span class="emphasis"><em>&#31995;&#32479;&#24322;&#24120;</em></span>&#65288;&#36890;&#24120;&#25351;&#36816;&#34892;&#26102;&#24322;&#24120;&#65289;&#26102;&#33258;&#21160;&#22238;&#28378;&#24403;&#21069;&#20107;&#21153;&#12290;
	EJB CMT&#36935;&#21040; <span class="emphasis"><em>&#24212;&#29992;&#24322;&#24120;</em></span>&#65288;&#20363;&#22914;&#65292;&#38500;&#20102; <tt class="exceptionname">java.rmi.RemoteException</tt> &#22806;&#21035;&#30340;checked exception&#65289;&#26102;&#24182;&#19981;&#20250;&#33258;&#21160;&#22238;&#28378;&#12290;
	&#40664;&#35748;&#24335;Spring&#22788;&#29702;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#30340;&#35268;&#21017;&#36981;&#23432;EJB&#20064;&#24815;&#65288;&#21482;&#22312;&#36935;&#21040;unchecked exceptions&#26102;&#33258;&#21160;&#22238;&#28378;&#65289;&#65292;&#20294;&#36890;&#24120;&#23450;&#21046;&#36825;&#26465;&#35268;&#21017;&#20250;&#26356;&#26377;&#29992;&#12290;</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="tx-decl-explained"></a>9.5.1.&nbsp;&#29702;&#35299;Spring&#30340;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#23454;&#29616;</h3></div></div><div></div></div><p>&#26412;&#33410;&#30340;&#30446;&#30340;&#26159;&#28040;&#38500;&#19982;&#20351;&#29992;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#26377;&#20851;&#30340;&#31070;&#31192;&#24615;&#12290;&#31616;&#21333;&#28857;&#20799;&#24635;&#26159;&#22909;&#30340;&#65292;&#36825;&#20221;&#21442;&#32771;&#25991;&#26723;&#21482;&#26159;&#21578;&#35785;&#20320;&#32473;&#20320;&#30340;&#31867;&#21152;&#19978;<tt class="interfacename">@Transactional</tt>&#27880;&#35299;&#65292;&#22312;&#37197;&#32622;&#25991;&#20214;&#20013;&#28155;&#21152;&#65288;<tt class="literal">'&lt;tx:annotation-driven/&gt;'</tt>&#65289;&#34892;&#65292;&#28982;&#21518;&#26399;&#26395;&#20320;&#29702;&#35299;&#25972;&#20010;&#36807;&#31243;&#26159;&#24590;&#20040;&#24037;&#20316;&#30340;&#12290;&#27492;&#33410;&#35762;&#36848;Spring&#30340;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#20869;&#37096;&#30340;&#24037;&#20316;&#26426;&#21046;&#65292;&#20197;&#24110;&#21161;&#20320;&#22312;&#38754;&#23545;&#20107;&#21153;&#30456;&#20851;&#30340;&#38382;&#39064;&#26102;&#19981;&#33267;&#20110;&#35823;&#20837;&#36855;&#36884;&#65292;&#22238;&#26388;&#21040;&#19978;&#28216;&#24179;&#38745;&#30340;&#27700;&#22495;&#12290;</p><p>&#22312;&#29702;&#35299;Spring&#30340;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#26041;&#38754;&#26368;&#37325;&#35201;&#30340;&#27010;&#24565;&#26159;&#65306;Spring&#30340;&#20107;&#21153;&#31649;&#29702;&#26159;&#36890;&#36807;AOP<span class="emphasis"><em>&#20195;&#29702;</em></span>&#23454;&#29616;&#30340;&#12290;
	 &#20854;&#20013;&#30340;&#20107;&#21153;&#36890;&#30693;&#30001;<span class="emphasis"><em>&#20803;&#25968;&#25454;</em></span>&#65288;&#30446;&#21069;&#22522;&#20110;XML&#25110;&#27880;&#35299;&#65289;&#39537;&#21160;&#12290;
	 &#20195;&#29702;&#23545;&#35937;&#19982;&#20107;&#21153;&#20803;&#25968;&#25454;&#32467;&#21512;&#20135;&#29983;&#20102;&#19968;&#20010;AOP&#20195;&#29702;&#65292;&#23427;&#20351;&#29992;&#19968;&#20010;<tt class="classname">PlatformTransactionManager</tt>
	 &#23454;&#29616;&#21697;&#37197;&#21512;<tt class="classname">TransactionInterceptor</tt>&#65292;&#22312;<span class="emphasis"><em>&#26041;&#27861;&#35843;&#29992;</em></span>&#21069;&#21518;&#23454;&#26045;&#20107;&#21153;&#12290;</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>&#23613;&#31649;&#20351;&#29992;Spring&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#19981;&#38656;&#35201;AOP&#65288;&#23588;&#20854;&#26159;Spring AOP&#65289;&#30340;&#30693;&#35782;&#65292;&#20294;&#20102;&#35299;&#36825;&#20123;&#26159;&#24456;&#26377;&#24110;&#21161;&#30340;&#12290;&#20320;&#21487;&#20197;&#22312; <a href="aop.html" title="Chapter&nbsp;6.&nbsp;&#20351;&#29992;Spring&#36827;&#34892;&#38754;&#21521;&#20999;&#38754;&#32534;&#31243;&#65288;AOP&#65289;">Chapter&nbsp;6, <i>&#20351;&#29992;Spring&#36827;&#34892;&#38754;&#21521;&#20999;&#38754;&#32534;&#31243;&#65288;AOP&#65289;</i></a> &#31456;&#25214;&#21040;&#20851;&#20110;Spring AOP&#30340;&#20840;&#37096;&#20869;&#23481;&#12290;</p></td></tr></table></div><p>&#27010;&#24565;&#19978;&#26469;&#35828;&#65292;&#22312;&#20107;&#21153;&#20195;&#29702;&#19978;&#35843;&#29992;&#26041;&#27861;&#30340;&#24037;&#20316;&#36807;&#31243;&#30475;&#36215;&#26469;&#20687;&#36825;&#26679;&#65306;</p><p>
				</p><div class="mediaobject" align="center"><img src="images/tx.png" align="middle"></div><p>
			</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-first-example"></a>9.5.2.&nbsp;&#31532;&#19968;&#20010;&#20363;&#23376;</h3></div></div><div></div></div><p>&#35831;&#30475;&#19979;&#38754;&#30340;&#25509;&#21475;&#21644;&#23427;&#30340;&#23454;&#29616;&#12290;&#36825;&#20010;&#20363;&#23376;&#30340;&#24847;&#22270;&#26159;&#20171;&#32461;&#27010;&#24565;&#65292;&#20351;&#29992; <tt class="classname">Foo</tt> &#21644; <tt class="classname">Bar</tt> 
	 &#36825;&#26679;&#30340;&#21517;&#23383;&#21482;&#26159;&#20026;&#20102;&#35753;&#20320;&#20851;&#27880;&#20110;&#20107;&#21153;&#30340;&#29992;&#27861;&#65292;&#32780;&#19981;&#26159;&#39046;&#22495;&#27169;&#22411;&#12290;</p><pre class="programlisting"><i class="lineannotation"><span class="lineannotation">// &#25105;&#20204;&#24819;&#20570;&#25104;&#20107;&#21153;&#24615;&#30340;&#26381;&#21153;&#25509;&#21475;</span></i>

package x.y.service;

public interface FooService {

  Foo getFoo(String fooName);

  Foo getFoo(String fooName, String barName);

  void insertFoo(Foo foo);

  void updateFoo(Foo foo);

}</pre><pre class="programlisting"><i class="lineannotation"><span class="lineannotation">// &#19978;&#36848;&#25509;&#21475;&#30340;&#19968;&#20010;&#23454;&#29616;</span></i>

package x.y.service;

public class DefaultFooService implements FooService {

  public Foo getFoo(String fooName) {
    throw new UnsupportedOperationException();
  }

  public Foo getFoo(String fooName, String barName) {
    throw new UnsupportedOperationException();
  }

  public void insertFoo(Foo foo) {
    throw new UnsupportedOperationException();
  }

  public void updateFoo(Foo foo) {
    throw new UnsupportedOperationException();
  }

}</pre><p>
	 	<span class="emphasis"><em>&#65288;&#23545;&#35813;&#20363;&#30340;&#30446;&#30340;&#26469;&#35828;&#65292;&#19978;&#20363;&#20013;&#23454;&#29616;&#31867;&#65288;<tt class="classname">DefaultFooService</tt>&#65289;&#30340;&#27599;&#20010;&#26041;&#27861;&#22312;&#20854;&#26041;&#27861;&#20307;&#20013;&#25243;&#20986;
		<tt class="exceptionname">UnsupportedOperationException</tt> &#30340;&#20570;&#27861;&#26159;&#24688;&#24403;&#30340;&#65292;&#25105;&#20204;&#21487;&#20197;&#30475;&#21040;&#65292;&#20107;&#21153;&#34987;&#21019;&#24314;&#20986;&#26469;&#65292;
		&#21709;&#24212; <tt class="exceptionname">UnsupportedOperationException</tt> &#30340;&#25243;&#20986;&#65292;&#28982;&#21518;&#22238;&#28378;&#12290;&#65289;</em></span>
	</p><p>&#25105;&#20204;&#20551;&#23450;&#65292;<tt class="interfacename">FooService</tt>&#30340;&#21069;&#20004;&#20010;&#26041;&#27861;&#65288;<tt class="literal">getFoo(String)</tt>
	&#21644;<tt class="literal">getFoo(String, String)</tt>&#65289;&#24517;&#39035;&#25191;&#34892;&#22312;&#21482;&#35835;&#20107;&#21153;&#19978;&#19979;&#25991;&#20013;&#65292;&#20854;&#20182;&#30340;&#26041;&#27861;&#65288;<tt class="literal">insertFoo(Foo)</tt>&#21644;
	<tt class="literal">updateFoo(Foo)</tt>&#65289;&#24517;&#39035;&#25191;&#34892;&#22312;&#21487;&#35835;&#20889;&#20107;&#21153;&#19978;&#19979;&#25991;&#20013;&#12290;&#19981;&#35201;&#24819;&#30528;&#19968;&#27425;&#29702;&#35299;&#19979;&#38754;&#30340;&#37197;&#32622;&#65292;&#25152;&#26377;&#20869;&#23481;&#37117;&#20250;&#22312;&#21518;&#38754;&#30340;&#31456;&#33410;&#35814;&#32454;&#35752;&#35770;&#12290;</p><pre class="programlisting"><i class="lineannotation"><span class="lineannotation">&lt;!-- from the file <tt class="literal">'context.xml'</tt> --&gt;</span></i>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xmlns:aop="http://www.springframework.org/schema/aop"
     <i class="lineannotation"><span class="lineannotation"><span class="bold"><b>xmlns:tx="http://www.springframework.org/schema/tx"</b></span></span></i>
     xsi:schemaLocation="
     http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
     <i class="lineannotation"><span class="lineannotation"><span class="bold"><b>http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd</b></span></span></i>
     http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd"&gt;
  
  <i class="lineannotation"><span class="lineannotation">&lt;!-- this is the service object that we want to make transactional --&gt;</span></i>
  &lt;bean id="fooService" class="x.y.service.DefaultFooService"/&gt;

  <i class="lineannotation"><span class="lineannotation">&lt;!-- the transactional advice (what 'happens'; see the <tt class="literal">&lt;aop:advisor/&gt;</tt> bean below) --&gt;</span></i>
  &lt;tx:advice id="txAdvice" transaction-manager="txManager"&gt;
  <i class="lineannotation"><span class="lineannotation">&lt;!-- the transactional semantics... --&gt;</span></i>
  &lt;tx:attributes&gt;
    <i class="lineannotation"><span class="lineannotation">&lt;!-- all methods starting with <tt class="literal">'get'</tt> are read-only --&gt;</span></i>
    &lt;tx:method name="get*" read-only="true"/&gt;
    <i class="lineannotation"><span class="lineannotation">&lt;!-- other methods use the default transaction settings (see below) --&gt;</span></i>
    &lt;tx:method name="*"/&gt;
  &lt;/tx:attributes&gt;
  &lt;/tx:advice&gt;
  
  <i class="lineannotation"><span class="lineannotation">&lt;!-- ensure that the above transactional advice runs for any execution
    of an operation defined by the <tt class="interfacename">FooService</tt> interface --&gt;</span></i>
  &lt;aop:config&gt;
  &lt;aop:pointcut id="fooServiceOperation" expression="execution(* x.y.service.FooService.*(..))"/&gt;
  &lt;aop:advisor advice-ref="txAdvice" pointcut-ref="fooServiceOperation"/&gt;
  &lt;/aop:config&gt;
  
  <i class="lineannotation"><span class="lineannotation">&lt;!-- don't forget the <tt class="interfacename">DataSource</tt> --&gt;</span></i>
  &lt;bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"&gt;
  &lt;property name="driverClassName" value="oracle.jdbc.driver.OracleDriver"/&gt;
  &lt;property name="url" value="jdbc:oracle:thin:@rj-t42:1521:elvis"/&gt;
  &lt;property name="username" value="scott"/&gt;
  &lt;property name="password" value="tiger"/&gt;
  &lt;/bean&gt;

  <i class="lineannotation"><span class="lineannotation">&lt;!-- similarly, don't forget the <tt class="interfacename">PlatformTransactionManager</tt> --&gt;</span></i>
  &lt;bean id="txManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt;
  &lt;property name="dataSource" ref="dataSource"/&gt;
  &lt;/bean&gt;
  
  <i class="lineannotation"><span class="lineannotation">&lt;!-- other <tt class="literal">&lt;bean/&gt;</tt> definitions here --&gt;</span></i>

&lt;/beans&gt;</pre><p>
				&#25105;&#20204;&#26469;&#20998;&#26512;&#19968;&#19979;&#19978;&#38754;&#30340;&#37197;&#32622;&#12290;&#25105;&#20204;&#35201;&#25226;&#19968;&#20010;&#26381;&#21153;&#23545;&#35937;&#65288;<tt class="literal">'fooService'</tt> bean&#65289;&#20570;&#25104;&#20107;&#21153;&#24615;&#30340;&#12290;
				&#25105;&#20204;&#24819;&#26045;&#21152;&#30340;&#20107;&#21153;&#35821;&#20041;&#23553;&#35013;&#22312;<tt class="literal">&lt;tx:advice/&gt;</tt>&#23450;&#20041;&#20013;&#12290;<tt class="literal">&lt;tx:advice/&gt;</tt>
				&#8220;<span class="quote"><span class="emphasis"><em>&#25226;&#25152;&#26377;&#20197; <tt class="literal">'get'</tt> &#24320;&#22836;&#30340;&#26041;&#27861;&#30475;&#20570;&#25191;&#34892;&#22312;&#21482;&#35835;&#20107;&#21153;&#19978;&#19979;&#25991;&#20013;&#65292;
				&#20854;&#20313;&#30340;&#26041;&#27861;&#25191;&#34892;&#22312;&#40664;&#35748;&#35821;&#20041;&#30340;&#20107;&#21153;&#19978;&#19979;&#25991;&#20013;</em></span></span>&#8221;&#12290;
				&#20854;&#20013;&#30340; <tt class="literal">'transaction-manager'</tt> &#23646;&#24615;&#34987;&#35774;&#32622;&#20026;&#19968;&#20010;&#25351;&#21521;
				<tt class="interfacename">PlatformTransactionManager</tt> bean&#30340;&#21517;&#23383;&#65288;&#36825;&#37324;&#25351; <tt class="literal">'txManager'</tt>&#65289;&#65292;
				&#35813;bean&#23558;&#20250;&#30495;&#27491;&#31649;&#29702;&#20107;&#21153;&#12290;</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="../images/admons/tip.png"></td><th align="left">Tip</th></tr><tr><td colspan="2" align="left" valign="top"><p>&#20107;&#23454;&#19978;&#65292;&#22914;&#26524; <tt class="interfacename">PlatformTransactionManager</tt> bean&#30340;&#21517;&#23383;&#26159; 
				<tt class="literal">'transactionManager'</tt> &#30340;&#35805;&#65292;&#20320;&#30340;&#20107;&#21153;&#36890;&#30693;&#65288;<tt class="literal">&lt;tx:advice/&gt;</tt>&#65289;&#20013;&#30340; 
				<tt class="literal">'transaction-manager'</tt> &#23646;&#24615;&#21487;&#20197;&#24573;&#30053;&#12290;&#21542;&#21017;&#20320;&#21017;&#38656;&#35201;&#20687;&#19978;&#20363;&#37027;&#26679;&#26126;&#30830;&#25351;&#23450;&#12290;</p></td></tr></table></div><p>&#37197;&#32622;&#20013;&#26368;&#21518;&#19968;&#27573;&#26159; <tt class="literal">&lt;aop:config/&gt;</tt> &#30340;&#23450;&#20041;&#65292;
	  &#23427;&#30830;&#20445;&#30001; <tt class="literal">'txAdvice'</tt> bean&#23450;&#20041;&#30340;&#20107;&#21153;&#36890;&#30693;&#22312;&#24212;&#29992;&#20013;&#21512;&#36866;&#30340;&#28857;&#34987;&#25191;&#34892;&#12290;
	  &#39318;&#20808;&#25105;&#20204;&#23450;&#20041;&#20102; &#19968;&#20010;&#20999;&#38754;&#65292;&#23427;&#21305;&#37197; <tt class="interfacename">FooService</tt> &#25509;&#21475;&#23450;&#20041;&#30340;&#25152;&#26377;&#25805;&#20316;&#65292;
	  &#25105;&#20204;&#25226;&#35813;&#20999;&#38754;&#21483;&#20570; <tt class="literal">'fooServiceOperation'</tt>&#12290;&#28982;&#21518;&#25105;&#20204;&#29992;&#19968;&#20010;&#36890;&#30693;&#22120;&#65288;advisor&#65289;&#25226;&#36825;&#20010;&#20999;&#38754;&#19982; <tt class="literal">'txAdvice'</tt> &#32465;&#23450;&#22312;&#19968;&#36215;&#65292;
	  &#34920;&#31034;&#24403; <tt class="literal">'fooServiceOperation'</tt> &#25191;&#34892;&#26102;&#65292;<tt class="literal">'txAdvice'</tt> &#23450;&#20041;&#30340;&#36890;&#30693;&#36923;&#36753;&#23558;&#34987;&#25191;&#34892;&#12290;</p><p><tt class="literal">&lt;aop:pointcut/&gt;</tt> &#20803;&#32032;&#23450;&#20041;&#26159;AspectJ&#30340;&#20999;&#38754;&#34920;&#31034;&#27861;&#65292;&#21487;&#21442;&#32771;Spring 2.0 <a href="aop.html" title="Chapter&nbsp;6.&nbsp;&#20351;&#29992;Spring&#36827;&#34892;&#38754;&#21521;&#20999;&#38754;&#32534;&#31243;&#65288;AOP&#65289;">Chapter&nbsp;6, <i>&#20351;&#29992;Spring&#36827;&#34892;&#38754;&#21521;&#20999;&#38754;&#32534;&#31243;&#65288;AOP&#65289;</i></a>&#31456;&#33719;&#24471;&#26356;&#35814;&#32454;&#30340;&#20869;&#23481;&#12290;</p><p>&#19968;&#20010;&#26222;&#36941;&#24615;&#30340;&#38656;&#27714;&#26159;&#35753;&#25972;&#20010;&#26381;&#21153;&#23618;&#25104;&#20026;&#20107;&#21153;&#24615;&#30340;&#12290;&#28385;&#36275;&#35813;&#38656;&#27714;&#30340;&#26368;&#22909;&#26041;&#24335;&#26159;&#35753;&#20999;&#38754;&#34920;&#36798;&#24335;&#21305;&#37197;&#26381;&#21153;&#23618;&#30340;&#25152;&#26377;&#25805;&#20316;&#26041;&#27861;&#12290;&#20363;&#22914;&#65306;</p><pre class="programlisting">&lt;aop:config&gt;
  &lt;aop:pointcut id="fooServiceMethods" expression="execution(* x.y.service.*.*(..))"/&gt;
  &lt;aop:advisor advice-ref="txAdvice" pointcut-ref="fooServiceMethods"/&gt;
  &lt;/aop:config&gt;</pre><p>
			<span class="emphasis"><em>&#65288;&#36825;&#20010;&#20363;&#23376;&#20013;&#20551;&#23450;&#20320;&#25152;&#26377;&#30340;&#26381;&#21153;&#25509;&#21475;&#23450;&#20041;&#22312; <tt class="literal">'x.y.service'</tt> &#21253;&#20013;&#12290;&#20320;&#21516;&#26679;&#21487;&#20197;&#21442;&#32771; <a href="aop.html" title="Chapter&nbsp;6.&nbsp;&#20351;&#29992;Spring&#36827;&#34892;&#38754;&#21521;&#20999;&#38754;&#32534;&#31243;&#65288;AOP&#65289;">Chapter&nbsp;6, <i>&#20351;&#29992;Spring&#36827;&#34892;&#38754;&#21521;&#20999;&#38754;&#32534;&#31243;&#65288;AOP&#65289;</i></a> &#31456;&#33719;&#24471;&#26356;&#35814;&#32454;&#20869;&#23481;&#12290;&#65289;</em></span>
			</p><p>&#29616;&#22312;&#65292;&#26082;&#28982;&#25105;&#20204;&#24050;&#32463;&#20998;&#26512;&#20102;&#25972;&#20010;&#37197;&#32622;&#65292;&#20320;&#21487;&#33021;&#20250;&#38382;&#20102;&#65292;&#8220;<span class="quote"><span class="emphasis"><em>&#22909;&#21543;&#65292;&#20294;&#26159;&#25152;&#26377;&#36825;&#20123;&#37197;&#32622;&#20570;&#20102;&#20160;&#20040;&#65311;</em></span></span>&#8221;&#12290;</p><p>&#19978;&#38754;&#30340;&#37197;&#32622;&#23558;&#20026;<tt class="literal">'fooService'</tt> bean&#21019;&#24314;&#19968;&#20010;&#20195;&#29702;&#23545;&#35937;&#65292;&#36825;&#20010;&#20195;&#29702;&#23545;&#35937;&#34987;&#35013;&#37197;&#20102;&#20107;&#21153;&#36890;&#30693;&#65292;&#25152;&#20197;&#24403;&#23427;&#30340;&#30456;&#24212;&#26041;&#27861;&#34987;&#35843;&#29992;&#26102;&#65292;&#19968;&#20010;&#20107;&#21153;&#23558;&#34987;&#21551;&#21160;&#12289;&#25346;&#36215;&#12289;&#34987;&#26631;&#35760;&#20026;&#21482;&#35835;&#65292;&#25110;&#32773;&#20854;&#23427;&#65288;&#26681;&#25454;&#35813;&#26041;&#27861;&#25152;&#37197;&#32622;&#30340;&#20107;&#21153;&#35821;&#20041;&#65289;&#12290;&#25105;&#20204;&#26469;&#30475;&#30475;&#19979;&#38754;&#30340;&#20363;&#23376;&#65292;&#27979;&#35797;&#19968;&#19979;&#19978;&#38754;&#30340;&#37197;&#32622;&#12290;</p><pre class="programlisting">public final class Boot {

  public static void main(final String[] args) throws Exception {
    ApplicationContext ctx = new ClassPathXmlApplicationContext("context.xml", Boot.class);
    FooService fooService = (FooService) ctx.getBean("fooService");
    fooService.insertFoo (new Foo());
  }
}</pre><p>&#36816;&#34892;&#19978;&#38754;&#31243;&#24207;&#30340;&#36755;&#20986;&#32467;&#26524;&#30475;&#36215;&#26469;&#20687;&#36825;&#26679;&#65288;&#27880;&#24847;&#20026;&#20102;&#28165;&#26970;&#36215;&#35265;&#65292;Log4J&#30340;&#28040;&#24687;&#21644;&#20174; <tt class="classname">DefaultFooService</tt> &#30340; <tt class="methodname">insertFoo(..)</tt> &#26041;&#27861;&#25243;&#20986;&#30340; <tt class="exceptionname">UnsupportedOperationException</tt> &#24322;&#24120;&#22534;&#26632;&#20449;&#24687;&#34987;&#30465;&#30053;&#20102;&#65289;&#12290;</p><pre class="programlisting">
				<i class="lineannotation"><span class="lineannotation">&lt;!-- Spring&#23481;&#22120;&#24320;&#22987;&#21551;&#21160;... --&gt;
				</span></i>
[AspectJInvocationContextExposingAdvisorAutoProxyCreator] - Creating implicit proxy
        for bean 'fooService' with 0 common interceptors and 1 specific interceptors
    <i class="lineannotation"><span class="lineannotation">&lt;!-- the <tt class="classname">DefaultFooService</tt> is actually proxied --&gt;
    </span></i>
[JdkDynamicAopProxy] - Creating JDK dynamic proxy for [x.y.service.DefaultFooService]

    <i class="lineannotation"><span class="lineannotation">&lt;!-- ... the <tt class="literal">insertFoo(..)</tt> method is now being invoked on the proxy --&gt;
    </span></i>

[TransactionInterceptor] - Getting transaction for x.y.service.FooService.insertFoo
    <i class="lineannotation"><span class="lineannotation">&lt;!-- the transactional advice kicks in here... --&gt;
    </span></i>
[DataSourceTransactionManager] - Creating new transaction with name [x.y.service.FooService.insertFoo]
[DataSourceTransactionManager] - Acquired Connection
        [org.apache.commons.dbcp.PoolableConnection@a53de4] for JDBC transaction

    <i class="lineannotation"><span class="lineannotation">&lt;!-- the <tt class="literal">insertFoo(..)</tt> method from <tt class="classname">DefaultFooService</tt> throws an exception... --&gt;
    </span></i>
[RuleBasedTransactionAttribute] - Applying rules to determine whether transaction should
        rollback on java.lang.UnsupportedOperationException
[TransactionInterceptor] - Invoking rollback for transaction on x.y.service.FooService.insertFoo
        due to throwable [java.lang.UnsupportedOperationException]

   <i class="lineannotation"><span class="lineannotation">&lt;!-- and the transaction is rolled back (by default, <tt class="exceptionname">RuntimeException</tt> instances cause rollback) --&gt;
   </span></i>
[DataSourceTransactionManager] - Rolling back JDBC transaction on Connection
        [org.apache.commons.dbcp.PoolableConnection@a53de4]
[DataSourceTransactionManager] - Releasing JDBC Connection after transaction
[DataSourceUtils] - Returning JDBC Connection to DataSource

Exception in thread "main" java.lang.UnsupportedOperationException
	at x.y.service.DefaultFooService.insertFoo(DefaultFooService.java:14)
   <i class="lineannotation"><span class="lineannotation">&lt;!-- AOP infrastructure stack trace elements removed for clarity --&gt;
   </span></i>
	at $Proxy0.insertFoo(Unknown Source)
	at Boot.main(Boot.java:11)</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-rolling-back"></a>9.5.3.&nbsp;&#22238;&#28378;</h3></div></div><div></div></div><p>
            &#22312;&#21069;&#38754;&#30340;&#31456;&#33410;&#37324;&#65292;&#27010;&#36848;&#20102;&#22914;&#20309;&#22312;&#20320;&#30340;&#24212;&#29992;&#20013;&#29992;&#22768;&#26126;&#30340;&#39118;&#26684;&#20026;&#31867;&#65288;&#29305;&#21035;&#26159;&#26381;&#21153;&#23618;&#30340;&#31867;&#65289;&#25351;&#23450;&#20107;&#21153;&#37197;&#32622;&#12290;
			&#36825;&#19968;&#31456;&#23558;&#25551;&#36848;&#22914;&#20309;&#20351;&#29992;&#19968;&#20010;&#31616;&#21333;&#30340;&#22768;&#26126;&#24335;&#37197;&#32622;&#26469;&#25511;&#21046;&#20107;&#21153;&#30340;&#22238;&#28378;&#12290;</p><p>
             &#25105;&#20204;&#25512;&#33616;&#20570;&#27861;&#26159;&#22312;Spring&#26694;&#26550;&#30340;&#20107;&#21153;&#26550;&#26500;&#37324;&#25351;&#20986;&#24403;context&#30340;&#20107;&#21153;&#37324;&#30340;&#20195;&#30721;&#25243;&#20986; 
			<tt class="exceptionname">Exception</tt> &#26102;&#20107;&#21153;&#36827;&#34892;&#22238;&#28378;&#12290;Spring&#26694;&#26550;&#30340;&#20107;&#21153;&#22522;&#30784;&#26550;&#26500;&#20195;&#30721;&#23558;&#20174;&#35843;&#29992;&#30340;&#22534;&#26632;&#37324;&#25429;&#33719;&#21040;&#20219;&#20309;&#26410;&#22788;&#29702;&#30340; 
			<tt class="exceptionname">Exception</tt>&#65292;&#24182;&#23558;&#26631;&#35782;&#20107;&#21153;&#23558;&#22238;&#28378;&#12290;
            </p><p>
            &#28982;&#32780;&#65292;&#35831;&#27880;&#24847;Spring&#26694;&#26550;&#30340;&#20107;&#21153;&#22522;&#30784;&#26550;&#26500;&#20195;&#30721;&#23558;&#40664;&#35748;&#22320; <span class="emphasis"><em>&#21482;</em></span> &#22312;&#25243;&#20986;&#36816;&#34892;&#26102;&#21644;unchecked exceptions&#26102;&#25165;&#26631;&#35782;&#20107;&#21153;&#22238;&#28378;&#12290;
            &#20063;&#23601;&#26159;&#35828;&#65292;&#24403;&#25243;&#20986;&#19968;&#20010; <tt class="exceptionname">RuntimeException</tt> &#25110;&#20854;&#23376;&#31867;&#20363;&#30340;&#23454;&#20363;&#26102;&#12290;&#65288;<tt class="literal">Errors</tt> &#20063;&#19968;&#26679; - &#40664;&#35748;&#22320; - &#26631;&#35782;&#20107;&#21153;&#22238;&#28378;&#12290;&#65289;&#20174;&#20107;&#21153;&#26041;&#27861;&#20013;&#25243;&#20986;&#30340;Checked exceptions&#23558; <span class="emphasis"><em>&#19981;</em></span> &#34987;&#26631;&#35782;&#36827;&#34892;&#20107;&#21153;&#22238;&#28378;&#12290;
            </p><p>&#21487;&#20197;&#37197;&#32622;&#21738;&#20123; <tt class="exceptionname">Exception</tt>&#31867;&#22411;&#23558;&#34987;&#26631;&#35782;&#36827;&#34892;&#20107;&#21153;&#22238;&#28378;&#12290;
	      &#19979;&#38754;&#30340;XML&#37197;&#32622;&#29255;&#26029;&#37324;&#31034;&#33539;&#20102;&#22914;&#20309;&#37197;&#32622;&#19968;&#20010;&#29992;&#20110;&#22238;&#28378;&#30340;checked&#12289;&#24212;&#29992;&#31243;&#24207;&#29305;&#23450;&#30340; <tt class="exceptionname">Exception</tt> &#31867;&#22411;&#12290; </p><pre class="programlisting">&lt;tx:advice id="txAdvice" transaction-manager="txManager"&gt;
  &lt;tx:attributes&gt;
  &lt;tx:method name="get*" read-only="true" <i class="lineannotation"><span class="lineannotation"><span class="bold"><b>rollback-for="NoProductInStockException"</b></span></span></i>/&gt;
  &lt;tx:method name="*"/&gt;
  &lt;/tx:attributes&gt;
&lt;/tx:advice&gt;</pre><p>&#26377;&#26102;&#20505;&#20320;<span class="emphasis"><em>&#19981;</em></span>&#24819;&#22312;&#24322;&#24120;&#25243;&#20986;&#30340;&#26102;&#20505;&#22238;&#28378;&#20107;&#21153;&#65292;&#23601;&#21487;&#20197;&#20351;&#29992;&#8220;&#19981;&#22238;&#28378;&#35268;&#21017;&#8221;&#12290;
				&#22312;&#19979;&#38754;&#30340;&#20363;&#23376;&#20013;&#65292;&#25105;&#20204;&#21578;&#35785;Spring &#26694;&#26550;&#21363;&#20351;&#36935;&#21040;&#27809;&#26377;&#32463;&#36807;&#22788;&#29702;&#30340;<tt class="exceptionname">InstrumentNotFoundException</tt>&#24322;&#24120;&#65292;&#20063;&#19981;&#35201;&#22238;&#28378;&#20107;&#21153;&#12290;</p><pre class="programlisting">&lt;tx:advice id="txAdvice"&gt;
  &lt;tx:attributes&gt;
  &lt;tx:method name="updateStock" <i class="lineannotation"><span class="lineannotation"><span class="bold"><b>no-rollback-for="InstrumentNotFoundException"</b></span></span></i>/&gt;
  &lt;tx:method name="*"/&gt;
  &lt;/tx:attributes&gt;
&lt;/tx:advice&gt;</pre><p>&#24403;Spring&#26694;&#26550;&#25429;&#33719;&#21040;&#19968;&#20010;&#24322;&#24120;&#21518;&#20250;&#26816;&#26597;&#37197;&#32622;&#22238;&#28378;&#35268;&#21017;&#26469;&#20915;&#23450;&#26159;&#19981;&#26159;&#35201;&#22238;&#28378;&#20107;&#21153;&#65292;&#36825;&#26102;&#20505;&#20250;&#36981;&#24490;<span class="emphasis"><em>&#26368;&#21305;&#37197;</em></span>&#30340;&#35268;&#21017;&#12290;
			&#25152;&#20197;&#22312;&#19979;&#38754;&#36825;&#31181;&#37197;&#32622;&#20013;&#65292;&#38500;&#20102;<tt class="exceptionname">InstrumentNotFoundException</tt>&#36825;&#31181;&#31867;&#22411;&#30340;&#24322;&#24120;&#19981;&#20250;&#23548;&#33268;&#20107;&#21153;&#22238;&#28378;&#20197;&#22806;&#65292;&#20854;&#20182;&#20219;&#20309;&#31867;&#22411;&#30340;&#24322;&#24120;&#37117;&#20250;&#12290;</p><pre class="programlisting">&lt;tx:advice id="txAdvice"&gt;
  &lt;tx:attributes&gt;
  &lt;tx:method name="*" rollback-for="Throwable" no-rollback-for="InstrumentNotFoundException"/&gt;
  &lt;/tx:attributes&gt;
&lt;/tx:advice&gt;</pre><p>
            &#31532;&#20108;&#31181;&#26041;&#27861;&#26159;&#36890;&#36807; <span class="emphasis"><em>&#32534;&#31243;&#24335;</em></span> &#26041;&#24335;&#26469;&#25351;&#23450;&#22238;&#28378;&#20107;&#21153;&#12290;
            &#34429;&#28982;&#20889;&#27861;&#38750;&#24120;&#30340;&#31616;&#21333;&#65292;&#20294;&#26159;&#36825;&#20010;&#26041;&#27861;&#26159;&#39640;&#20405;&#20837;&#24615;&#30340;&#65292;&#24182;&#19988;&#20351;&#20320;&#30340;&#20195;&#30721;&#19982;Spring&#26694;&#26550;&#30340;&#20107;&#21153;&#26550;&#26500;&#39640;&#24230;&#32806;&#21512;&#12290;
            &#19979;&#38754;&#30340;&#20195;&#30721;&#29255;&#26029;&#37324;&#31034;&#33539;&#20102;Spring&#26694;&#26550;&#31649;&#29702;&#20107;&#21153;&#30340;&#32534;&#31243;&#24335;&#22238;&#28378;&#65306;
            </p><pre class="programlisting">public void resolvePosition() {
  try {
    <i class="lineannotation"><span class="lineannotation">// some business logic...</span></i>
  } catch (NoProductInStockException ex) {
    <i class="lineannotation"><span class="lineannotation">// trigger rollback programmatically</span></i>
    TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();
  }
}</pre><p>
            &#24378;&#28872;&#25512;&#33616;&#20320;&#23613;&#21487;&#33021;&#22320;&#20351;&#29992;&#22768;&#26126;&#24335;&#20107;&#21153;&#22238;&#28378;&#26041;&#27861;&#12290;
            &#32534;&#31243;&#24335;&#26041;&#27861;&#30340;&#22238;&#28378;&#23545;&#20320;&#26469;&#35828;&#26159;&#21487;&#35265;&#65292;&#22914;&#26524;&#20320;&#38656;&#35201;&#23427;&#20320;&#23601;&#21487;&#20197;&#20351;&#29992;&#65292;&#20294;&#26159;&#20351;&#29992;&#23427;&#23601;&#30452;&#25509;&#36829;&#21453;&#20102;&#22312;&#20320;&#30340;&#24212;&#29992;&#20013;&#20351;&#29992;&#19968;&#20010;&#32431;&#22522;&#20110;POJO&#30340;&#27169;&#22411;&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-diff-tx"></a>9.5.4.&nbsp;&#20026;&#19981;&#21516;&#30340;bean&#37197;&#32622;&#19981;&#21516;&#30340;&#20107;&#21153;&#35821;&#20041;</h3></div></div><div></div></div><p>&#29616;&#22312;&#35753;&#25105;&#20204;&#32771;&#34385;&#19968;&#19979;&#36825;&#26679;&#30340;&#22330;&#26223;&#65292;&#20551;&#35774;&#20320;&#26377;&#35768;&#22810;&#26381;&#21153;&#23545;&#35937;&#65292;&#20320;&#24819;&#20026;&#20182;&#20204;&#20998;&#21035;&#35774;&#32622; <span class="emphasis"><em>&#23436;&#20840;&#19981;&#21516;</em></span> &#30340;&#20107;&#21153;&#35821;&#20041;&#12290;
			&#22312;Spring&#20013;&#65292;&#20320;&#21487;&#20197;&#36890;&#36807;&#20998;&#21035;&#23450;&#20041;&#29305;&#23450;&#30340; <tt class="literal">&lt;aop:advisor/&gt;</tt> &#20803;&#32032;&#65292;
			&#35753;&#27599;&#20010;advisor&#37319;&#29992;&#19981;&#21516;&#30340; <tt class="literal">'pointcut'</tt> &#21644; <tt class="literal">'advice-ref'</tt> &#23646;&#24615;&#65292;&#26469;&#36798;&#21040;&#30446;&#30340;&#12290;</p><p>&#35753;&#25105;&#20204;&#20551;&#23450;&#20320;&#25152;&#26377;&#30340;&#26381;&#21153;&#23618;&#31867;&#23450;&#20041;&#22312;&#20197; <tt class="literal">'x.y.service'</tt> &#20026;&#26681;&#30340;&#21253;&#20869;&#12290;
			&#20026;&#20102;&#35753;service&#21253;&#65288;&#25110;&#23376;&#21253;&#65289;&#19979;&#25152;&#26377;&#21517;&#23383;&#20197; <tt class="literal">'Service'</tt> &#32467;&#23614;&#30340;&#31867;&#30340;&#23545;&#35937;&#25317;&#26377;&#40664;&#35748;&#30340;&#20107;&#21153;&#35821;&#20041;&#65292;&#20320;&#21487;&#20197;&#20570;&#22914;&#19979;&#30340;&#37197;&#32622;&#65306;</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:aop="http://www.springframework.org/schema/aop"
  xmlns:tx="http://www.springframework.org/schema/tx"
  xsi:schemaLocation="
  http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
  http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd
  http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd"&gt;

  &lt;aop:config&gt;

    &lt;aop:pointcut id="serviceOperation"
          expression="<i class="lineannotation"><span class="lineannotation">execution(* x.y.service..*Service.*(..))</span></i>"/&gt;

    &lt;aop:advisor pointcut-ref="serviceOperation" advice-ref="txAdvice"/&gt;

  &lt;/aop:config&gt;

  <i class="lineannotation"><span class="lineannotation">&lt;!-- these two beans will be transactional... --&gt;</span></i>
  &lt;bean id="fooService" class="x.y.service.DefaultFooService"/&gt;
  &lt;bean id="barService" class="x.y.service.extras.SimpleBarService"/&gt;

  <i class="lineannotation"><span class="lineannotation">&lt;!-- ... and these two beans won't --&gt;</span></i>
  &lt;bean id="anotherService" class="org.xyz.SomeService"/&gt; <i class="lineannotation"><span class="lineannotation">&lt;!-- (not in the right package) --&gt;</span></i>
  &lt;bean id="barManager" class="x.y.service.SimpleBarManager"/&gt; <i class="lineannotation"><span class="lineannotation">&lt;!-- (doesn't end in 'Service') --&gt;</span></i>

  &lt;tx:advice id="txAdvice"&gt;
    &lt;tx:attributes&gt;
      &lt;tx:method name="get*" read-only="true"/&gt;
      &lt;tx:method name="*"/&gt;
    &lt;/tx:attributes&gt;
  &lt;/tx:advice&gt;

  <i class="lineannotation"><span class="lineannotation">&lt;!-- other transaction infrastructure beans such as a <tt class="interfacename">PlatformTransactionManager</tt> omitted... --&gt;</span></i>

&lt;/beans&gt;</pre><p>
        &#19979;&#38754;&#30340;&#37197;&#32622;&#31034;&#20363;&#28436;&#31034;&#20102;&#20004;&#20010;&#25317;&#26377;&#23436;&#20840;&#19981;&#21516;&#30340;&#20107;&#21153;&#37197;&#32622;&#30340;bean&#12290;
        </p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:aop="http://www.springframework.org/schema/aop"
  xmlns:tx="http://www.springframework.org/schema/tx"
  xsi:schemaLocation="
  http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
  http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd
  http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd"&gt;

  &lt;aop:config&gt;

    &lt;aop:pointcut id="defaultServiceOperation"
          expression="<i class="lineannotation"><span class="lineannotation">execution(* x.y.service.*Service.*(..))</span></i>"/&gt;

    &lt;aop:pointcut id="noTxServiceOperation"
          expression="<i class="lineannotation"><span class="lineannotation">execution(* x.y.service.ddl.DefaultDdlManager.*(..))</span></i>"/&gt;

    &lt;aop:advisor pointcut-ref="defaultServiceOperation" advice-ref="defaultTxAdvice"/&gt;

    &lt;aop:advisor pointcut-ref="noTxServiceOperation" advice-ref="noTxAdvice"/&gt;

  &lt;/aop:config&gt;

  <i class="lineannotation"><span class="lineannotation">&lt;!-- this bean will be transactional (see the <tt class="literal">'defaultServiceOperation'</tt> pointcut) --&gt;</span></i>
  &lt;bean id="fooService" class="x.y.service.DefaultFooService"/&gt;

  <i class="lineannotation"><span class="lineannotation">&lt;!-- this bean will also be transactional, but with totally different transactional settings --&gt;</span></i>
  &lt;bean id="anotherFooService" class="x.y.service.ddl.DefaultDdlManager"/&gt;

  &lt;tx:advice id="defaultTxAdvice"&gt;
    &lt;tx:attributes&gt;
      &lt;tx:method name="get*" read-only="true"/&gt;
      &lt;tx:method name="*"/&gt;
    &lt;/tx:attributes&gt;
  &lt;/tx:advice&gt;

  &lt;tx:advice id="noTxAdvice"&gt;
    &lt;tx:attributes&gt;
      &lt;tx:method name="*" propagation="NEVER"/&gt;
    &lt;/tx:attributes&gt;
  &lt;/tx:advice&gt;

  <i class="lineannotation"><span class="lineannotation">&lt;!-- other transaction infrastructure beans such as a <tt class="interfacename">PlatformTransactionManager</tt> omitted... --&gt;</span></i>

&lt;/beans&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-txadvice-settings"></a>9.5.5.&nbsp;<tt class="literal">&lt;tx:advice/&gt;</tt> &#26377;&#20851;&#30340;&#35774;&#32622;</h3></div></div><div></div></div><p>
			&#36825;&#19968;&#33410;&#37324;&#23558;&#25551;&#36848;&#36890;&#36807; <tt class="literal">&lt;tx:advice/&gt;</tt> &#26631;&#31614;&#26469;&#25351;&#23450;&#19981;&#21516;&#30340;&#20107;&#21153;&#24615;&#35774;&#32622;&#12290;&#40664;&#35748;&#30340; <tt class="literal">&lt;tx:advice/&gt;</tt> &#35774;&#32622;&#22914;&#19979;&#65306;
            </p><p>
        </p><div class="itemizedlist"><ul type="disc"><li><p> <a href="transaction.html#tx-propagation" title="9.5.7.&nbsp;&#20107;&#21153;&#20256;&#25773;">&#20107;&#21153;&#20256;&#25773;&#35774;&#32622;</a> &#26159; <tt class="literal">REQUIRED</tt></p></li><li><p>&#38548;&#31163;&#32423;&#21035;&#26159;<tt class="literal">DEFAULT</tt></p></li><li><p>&#20107;&#21153;&#26159; &#35835;/&#20889;</p></li><li><p>&#20107;&#21153;&#36229;&#26102;&#40664;&#35748;&#26159;&#20381;&#36182;&#20110;&#20107;&#21153;&#31995;&#32479;&#30340;&#65292;&#25110;&#32773;&#20107;&#21153;&#36229;&#26102;&#27809;&#26377;&#34987;&#25903;&#25345;&#12290;</p></li><li><p>&#20219;&#20309; <tt class="exceptionname">RuntimeException</tt> &#23558;&#35302;&#21457;&#20107;&#21153;&#22238;&#28378;&#65292;&#20294;&#26159;&#20219;&#20309; checked <tt class="exceptionname">Exception</tt> &#23558;&#19981;&#35302;&#21457;&#20107;&#21153;&#22238;&#28378;</p></li></ul></div><p>
      </p><p>
            &#36825;&#20123;&#40664;&#35748;&#30340;&#35774;&#32622;&#24403;&#28982;&#20063;&#26159;&#21487;&#20197;&#34987;&#25913;&#21464;&#30340;&#12290; 
            <tt class="literal">&lt;tx:advice/&gt;</tt> &#21644; <tt class="literal">&lt;tx:attributes/&gt;</tt> &#26631;&#31614;&#37324;&#30340; <tt class="literal">&lt;tx:method/&gt;</tt> &#21508;&#31181;&#23646;&#24615;&#35774;&#32622;&#24635;&#32467;&#22914;&#19979;&#65306;
            </p><p>
                </p><div class="table"><a name="d0e17347"></a><p class="title"><b>Table&nbsp;9.1.&nbsp;<tt class="literal">&lt;tx:method/&gt;</tt> &#26377;&#20851;&#30340;&#35774;&#32622;</b></p><table summary="<tx:method/&gt; &#26377;&#20851;&#30340;&#35774;&#32622;" border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th>&#23646;&#24615;</th><th>&#26159;&#21542;&#38656;&#35201;&#65311;</th><th>&#40664;&#35748;&#20540;</th><th>&#25551;&#36848;</th></tr></thead><tbody><tr><td><tt class="literal">name</tt></td><td>&#26159;</td><td>&nbsp;</td><td><p>
                                    &#19982;&#20107;&#21153;&#23646;&#24615;&#20851;&#32852;&#30340;&#26041;&#27861;&#21517;&#12290;&#36890;&#37197;&#31526;&#65288;*&#65289;&#21487;&#20197;&#29992;&#26469;&#25351;&#23450;&#19968;&#25209;&#20851;&#32852;&#21040;&#30456;&#21516;&#30340;&#20107;&#21153;&#23646;&#24615;&#30340;&#26041;&#27861;&#12290;
                                    &#22914;&#65306;<tt class="literal">'get*'</tt>&#12289;<tt class="literal">'handle*'</tt>&#12289;<tt class="literal">'on*Event'</tt>&#31561;&#31561;&#12290;
                                    </p></td></tr><tr><td><tt class="literal">propagation</tt></td><td>&#19981;</td><td>REQUIRED</td><td>&#20107;&#21153;&#20256;&#25773;&#34892;&#20026;</td></tr><tr><td><tt class="literal">isolation</tt></td><td>&#19981;</td><td>DEFAULT</td><td>&#20107;&#21153;&#38548;&#31163;&#32423;&#21035;</td></tr><tr><td><tt class="literal">timeout</tt></td><td>&#19981;</td><td>-1</td><td>&#20107;&#21153;&#36229;&#26102;&#30340;&#26102;&#38388;&#65288;&#20197;&#31186;&#20026;&#21333;&#20301;&#65289;</td></tr><tr><td><tt class="literal">read-only</tt></td><td>&#19981;</td><td>false</td><td>&#20107;&#21153;&#26159;&#21542;&#21482;&#35835;&#65311;</td></tr><tr><td><tt class="literal">rollback-for</tt></td><td>&#19981;</td><td>&nbsp;</td><td><p>
                                    &#23558;&#34987;&#35302;&#21457;&#36827;&#34892;&#22238;&#28378;&#30340; <tt class="literal">Exception(s)</tt>&#65307;&#20197;&#36887;&#21495;&#20998;&#24320;&#12290;
	                                &#22914;&#65306;<tt class="literal">'com.foo.MyBusinessException,ServletException'</tt>
	                                </p></td></tr><tr><td><tt class="literal">no-rollback-for</tt></td><td>&#19981;</td><td>&nbsp;</td><td><p>
                                    <span class="emphasis"><em>&#19981;</em></span> &#34987;&#35302;&#21457;&#36827;&#34892;&#22238;&#28378;&#30340; <tt class="literal">Exception(s)</tt>&#65307;&#20197;&#36887;&#21495;&#20998;&#24320;&#12290;
	                                &#22914;&#65306;<tt class="literal">'com.foo.MyBusinessException,ServletException'</tt>
	                                </p></td></tr></tbody></table></div><p>
            </p><p>&#22312;&#20889;&#20195;&#30721;&#30340;&#26102;&#20505;&#65292;&#19981;&#21487;&#33021;&#23545;&#20107;&#21153;&#30340;&#21517;&#23383;&#26377;&#20010;&#24456;&#28165;&#26224;&#30340;&#35748;&#35782;&#65292;&#36825;&#37324;&#30340;&#21517;&#23383;&#26159;&#25351;&#20250;&#22312;&#20107;&#21153;&#30417;&#35270;&#22120;&#65288;&#27604;&#22914;WebLogic&#30340;&#20107;&#21153;&#31649;&#29702;&#22120;&#65289;&#25110;&#32773;&#26085;&#24535;&#36755;&#20986;&#20013;&#26174;&#31034;&#30340;&#21517;&#23383;&#65292;
			&#23545;&#20110;&#22768;&#26126;&#24335;&#30340;&#20107;&#21153;&#35774;&#32622;&#65292;&#20107;&#21153;&#21517;&#23383;&#24635;&#26159;&#21253;&#21547;&#23436;&#25972;&#21253;&#21517;&#30340;&#31867;&#21517;&#21152;&#19978;"."&#21644;&#26041;&#27861;&#21517;&#65292;&#27604;&#22914; <tt class="literal">'com.foo.BusinessService.handlePayment'</tt>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-annotations"></a>9.5.6.&nbsp;&#20351;&#29992; <tt class="interfacename">@Transactional</tt></h3></div></div><div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>
					<tt class="interfacename">@Transactional</tt> &#27880;&#35299;&#21450;&#20854;&#25903;&#25345;&#31867;&#25152;&#25552;&#20379;&#30340;&#21151;&#33021;&#26368;&#20302;&#35201;&#27714;&#20351;&#29992;Java 5&#65288;Tiger&#65289;&#12290;
				</p></td></tr></table></div><p>
			&#38500;&#20102;&#22522;&#20110;XML&#25991;&#20214;&#30340;&#22768;&#26126;&#24335;&#20107;&#21153;&#37197;&#32622;&#22806;&#65292;&#20320;&#20063;&#21487;&#20197;&#37319;&#29992;&#22522;&#20110;&#27880;&#35299;&#24335;&#30340;&#20107;&#21153;&#37197;&#32622;&#26041;&#27861;&#12290;&#30452;&#25509;&#22312;Java&#28304;&#20195;&#30721;&#20013;&#22768;&#26126;&#20107;&#21153;&#35821;&#20041;&#30340;&#20570;&#27861;&#35753;&#20107;&#21153;&#22768;&#26126;&#21644;&#23558;&#21463;&#20854;&#24433;&#21709;&#30340;&#20195;&#30721;&#36317;&#31163;&#26356;&#36817;&#20102;&#65292;&#32780;&#19988;&#19968;&#33324;&#26469;&#35828;&#19981;&#20250;&#26377;&#19981;&#24688;&#24403;&#30340;&#32806;&#21512;&#30340;&#39118;&#38505;&#65292;&#22240;&#20026;&#65292;&#20351;&#29992;&#20107;&#21153;&#24615;&#30340;&#20195;&#30721;&#20960;&#20046;&#24635;&#26159;&#34987;&#37096;&#32626;&#22312;&#20107;&#21153;&#29615;&#22659;&#20013;&#12290;
			</p><p>&#19979;&#38754;&#30340;&#20363;&#23376;&#24456;&#22909;&#22320;&#28436;&#31034;&#20102; <tt class="interfacename">@Transactional</tt> &#27880;&#35299;&#30340;&#26131;&#29992;&#24615;&#65292;&#38543;&#21518;&#35299;&#37322;&#20854;&#20013;&#30340;&#32454;&#33410;&#12290;&#20808;&#30475;&#30475;&#20854;&#20013;&#30340;&#31867;&#23450;&#20041;&#65306;</p><pre class="programlisting"><i class="lineannotation"><span class="lineannotation">// the service class that we want to make transactional</span></i>
<span class="bold"><b>@Transactional</b></span>
public class DefaultFooService implements FooService {

  Foo getFoo(String fooName);

  Foo getFoo(String fooName, String barName);

  void insertFoo(Foo foo);

  void updateFoo(Foo foo);
}</pre><p>&#24403;&#19978;&#36848;&#30340;POJO&#23450;&#20041;&#22312;Spring IoC&#23481;&#22120;&#37324;&#26102;&#65292;&#19978;&#36848;bean&#23454;&#20363;&#20165;&#20165;&#36890;&#36807;<span class="emphasis"><em>&#19968;</em></span> &#34892;xml&#37197;&#32622;&#23601;&#21487;&#20197;&#20351;&#23427;&#20855;&#26377;&#20107;&#21153;&#24615;&#30340;&#12290;&#22914;&#19979;&#65306;</p><pre class="programlisting"><i class="lineannotation"><span class="lineannotation">&lt;!-- from the file <tt class="literal">'context.xml'</tt> --&gt;</span></i>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xmlns:aop="http://www.springframework.org/schema/aop"
     xmlns:tx="http://www.springframework.org/schema/tx"
     xsi:schemaLocation="
     http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
     http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd
     http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd"&gt;
  
  <i class="lineannotation"><span class="lineannotation">&lt;!-- this is the service object that we want to make transactional --&gt;</span></i>
  &lt;bean id="fooService" class="x.y.service.DefaultFooService"/&gt;

  <i class="lineannotation"><span class="lineannotation">&lt;!-- enable the configuration of transactional behavior based on annotations --&gt;</span></i>
  <span class="bold"><b>&lt;tx:annotation-driven transaction-manager="txManager"/&gt;</b></span>

  <i class="lineannotation"><span class="lineannotation">&lt;!-- a <tt class="interfacename">PlatformTransactionManager</tt> is still required --&gt;</span></i>
  &lt;bean id="txManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt;
  <i class="lineannotation"><span class="lineannotation">&lt;!-- (this dependency is defined somewhere else) --&gt;</span></i>
  &lt;property name="dataSource" ref="dataSource"/&gt;
  &lt;/bean&gt;
  
  <i class="lineannotation"><span class="lineannotation">&lt;!-- other <tt class="literal">&lt;bean/&gt;</tt> definitions here --&gt;</span></i>

&lt;/beans&gt;</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="../images/admons/tip.png"></td><th align="left">Tip</th></tr><tr><td colspan="2" align="left" valign="top"><p>
                &#23454;&#38469;&#19978;&#65292;&#22914;&#26524;&#20320;&#29992;  <tt class="literal">'transactionManager'</tt> &#26469;&#23450;&#20041; <tt class="interfacename">PlatformTransactionManager</tt> bean&#30340;&#21517;&#23383;&#30340;&#35805;&#65292;&#20320;&#23601;&#21487;&#20197;&#24573;&#30053; <tt class="literal">&lt;tx:annotation-driven/&gt;</tt> &#26631;&#31614;&#37324;&#30340; <tt class="literal">'transaction-manager'</tt> &#23646;&#24615;&#12290;
                &#22914;&#26524; <tt class="interfacename">PlatformTransactionManager</tt> bean&#20320;&#35201;&#36890;&#36807;&#20854;&#23427;&#21517;&#31216;&#26469;&#27880;&#20837;&#30340;&#35805;&#65292;&#20320;&#24517;&#39035;&#29992; <tt class="literal">'transaction-manager'</tt> &#23646;&#24615;&#26469;&#25351;&#23450;&#23427;&#65292;&#22914;&#19978;&#25152;&#31034;&#12290;
                </p></td></tr></table></div><div class="sidebar"><p class="title"><b>&#26041;&#27861;&#30340;&#21487;&#35265;&#24230;&#21644; <tt class="interfacename">@Transactional</tt></b></p><p>
                &#22312;&#20351;&#29992;&#20195;&#29702;&#30340;&#26102;&#20505;&#65292;<tt class="interfacename">@Transactional</tt> &#27880;&#35299;&#24212;&#35813;&#21482;&#34987;&#24212;&#29992;&#21040; <span class="emphasis"><em>public</em></span> &#21487;&#35265;&#24230;&#30340;&#26041;&#27861;&#19978;&#12290;
                &#22914;&#26524;&#20320;&#22312; protected&#12289;private &#25110;&#32773; package-visible &#30340;&#26041;&#27861;&#19978;&#20351;&#29992; <tt class="interfacename">@Transactional</tt> &#27880;&#35299;&#65292;&#31995;&#32479;&#20063;&#19981;&#20250;&#25253;&#38169;&#65292;
                &#20294;&#26159;&#36825;&#20010;&#34987;&#27880;&#35299;&#30340;&#26041;&#27861;&#23558;&#19981;&#20250;&#25191;&#34892;&#24050;&#37197;&#32622;&#30340;&#20107;&#21153;&#35774;&#32622;&#12290;&#22914;&#26524;&#20320;&#38750;&#35201;&#27880;&#35299;&#38750;&#20844;&#20849;&#26041;&#27861;&#30340;&#35805;&#65292;&#35831;&#21442;&#32771;&#20351;&#29992;AspectJ (&#21442;&#35265;&#19979;&#38754;)&#12290;
                </p></div><p>
				<tt class="interfacename">@Transactional</tt> &#27880;&#35299;&#21487;&#20197;&#34987;&#24212;&#29992;&#20110;&#25509;&#21475;&#23450;&#20041;&#21644;&#25509;&#21475;&#26041;&#27861;&#12289;&#31867;&#23450;&#20041;&#21644;&#31867;&#30340; <span class="emphasis"><em>public</em></span> &#26041;&#27861;&#19978;&#12290;
				&#28982;&#32780;&#65292;&#35831;&#27880;&#24847;&#21482;&#26159;&#20351;&#29992; <tt class="interfacename">@Transactional</tt> &#27880;&#35299;&#24182;&#19981;&#20250;&#21551;&#29992;&#20107;&#21153;&#34892;&#20026;&#65292;
				&#23427;&#20165;&#20165; <span class="emphasis"><em>&#26159;&#19968;&#31181;&#20803;&#25968;&#25454;</em></span>&#65292;&#33021;&#22815;&#34987;&#21487;&#20197;&#35782;&#21035; <tt class="interfacename">@Transactional</tt> 
				&#27880;&#35299;&#21644;&#19978;&#36848;&#30340;&#37197;&#32622;&#36866;&#24403;&#30340;&#20855;&#26377;&#20107;&#21153;&#34892;&#20026;&#30340;beans&#25152;&#20351;&#29992;&#12290;&#19978;&#38754;&#30340;&#20363;&#23376;&#20013;&#65292;&#20854;&#23454;&#27491;&#26159; <tt class="literal">&lt;tx:annotation-driven/&gt;</tt>&#20803;&#32032;&#30340;&#20986;&#29616; 
				<span class="emphasis"><em>&#24320;&#21551;</em></span> &#20102;&#20107;&#21153;&#34892;&#20026;&#12290;</p><p>
            Spring&#22242;&#38431;&#30340;&#24314;&#35758;&#26159;&#20320;&#21482;&#22312;&#20855;&#20307;&#30340;&#31867;&#19978;&#20351;&#29992; <tt class="interfacename">@Transactional</tt> &#27880;&#35299;&#65292;
            &#32780;&#19981;&#35201;&#27880;&#35299;&#22312;&#25509;&#21475;&#19978;&#12290;&#20320;&#24403;&#28982;&#21487;&#20197;&#22312;&#25509;&#21475;&#65288;&#25110;&#25509;&#21475;&#26041;&#27861;&#65289;&#19978;&#20351;&#29992; <tt class="interfacename">@Transactional</tt> &#27880;&#35299;&#65292;
            &#20294;&#26159;&#36825;&#21482;&#26377;&#22312;&#20320;&#20351;&#29992;&#22522;&#20110;&#25509;&#21475;&#30340;&#20195;&#29702;&#26102;&#23427;&#25165;&#20250;&#29983;&#25928;&#12290;&#22240;&#20026;&#27880;&#35299;&#26159; <span class="emphasis"><em>&#19981;&#33021;&#32487;&#25215;</em></span> &#30340;&#65292;
            &#36825;&#23601;&#24847;&#21619;&#30528;&#22914;&#26524;&#20320;&#27491;&#22312;&#20351;&#29992;&#22522;&#20110;&#31867;&#30340;&#20195;&#29702;&#26102;&#65292;&#20107;&#21153;&#30340;&#35774;&#32622;&#23558;&#19981;&#33021;&#34987;&#22522;&#20110;&#31867;&#30340;&#20195;&#29702;&#25152;&#35782;&#21035;&#65292;&#32780;&#19988;&#23545;&#35937;&#20063;&#19981;&#20250;&#34987;&#20107;&#21153;&#20195;&#29702;&#25152;&#21253;&#35013;
            &#65288;&#36825;&#26159;&#24456;<span class="emphasis"><em>&#31967;&#31957;&#30340;</em></span>&#65289;&#12290;
			&#22240;&#27492;&#65292;&#35831;&#25509;&#21463;Spring&#22242;&#38431;&#30340;&#24314;&#35758;&#65292;&#22312;&#20855;&#20307;&#30340;&#31867;&#65288;&#21253;&#25324;&#35813;&#31867;&#30340;&#26041;&#27861;&#65289;&#19978;&#20351;&#29992; <tt class="interfacename">@Transactional</tt> &#27880;&#35299;&#12290;
            </p><p><span class="emphasis"><em>&#27880;&#24847;&#65306;&#22312;&#20195;&#29702;&#27169;&#24335;&#19979;&#65288;&#40664;&#35748;&#30340;&#24773;&#20917;&#65289;&#65292;&#21482;&#26377;&#20174;&#20195;&#29702;&#20256;&#36807;&#26469;&#30340;&#8216;&#22806;&#37096;&#8217;&#26041;&#27861;&#35843;&#29992;&#25165;&#20250;&#34987;&#25318;&#25130;&#12290;</em></span>
	  &#36825;&#23601;&#24847;&#21619;&#30528;&#8216;&#33258;&#25105;&#35843;&#29992;&#8217;&#26159;&#19981;&#20250;&#35302;&#21457;&#20107;&#21153;&#30340;&#65292;&#27604;&#22914;&#35828;&#65292;&#19968;&#20010;&#22312;&#30446;&#26631;&#23545;&#35937;&#20013;&#35843;&#29992;&#30446;&#26631;&#23545;&#35937;&#20854;&#20182;&#26041;&#27861;&#30340;&#26041;&#27861;&#26159;&#19981;&#20250;&#35302;&#21457;&#19968;&#20010;&#20107;&#21153;&#30340;&#65292;&#21363;&#20351;&#36825;&#20010;&#26041;&#27861;&#34987;&#26631;&#35760;&#20026; 
      <tt class="interfacename">@Transactional</tt>!</p><p>&#22914;&#26524;&#20320;&#26399;&#26395;&#8216;&#33258;&#25105;&#35843;&#29992;&#8217;&#34987;&#20107;&#21153;&#35206;&#30422;&#21040;&#65292;&#21487;&#20197;&#32771;&#34385;&#20351;&#29992;AspectJ &#27169;&#24335;&#65288;&#22914;&#19979;&#25152;&#31034;&#65289;&#12290;&#22312;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#19968;&#24320;&#22987;&#23601;&#27809;&#26377;&#20219;&#20309;&#20195;&#29702;&#30340;&#23384;&#22312;&#65307;
      &#20026;&#20102;&#25226;<tt class="interfacename">@Transactional</tt>&#30340;&#26041;&#27861;&#21464;&#25104;&#36816;&#34892;&#26102;&#30340;&#34892;&#20026;&#65292;&#30446;&#26631;&#31867;&#20250;&#34987;&#8216;&#32534;&#32455;&#8217;&#36215;&#26469;&#65288;&#27604;&#22914;&#20462;&#25913;&#23427;&#30340;&#23383;&#33410;&#30721;&#65289;&#12290;
   </p><p>
        </p><div class="table"><a name="tx-annotation-driven-settings"></a><p class="title"><b>Table&nbsp;9.2.&nbsp;<tt class="literal">&lt;tx:annotation-driven/&gt;</tt> &#35774;&#32622;</b></p><table summary="<tx:annotation-driven/&gt; &#35774;&#32622;" border="1"><colgroup><col><col><col></colgroup><thead><tr><th>&#23646;&#24615;</th><th>&#40664;&#35748;&#20540;</th><th>&#25551;&#36848;</th></tr></thead><tbody><tr><td><tt class="literal">transaction-manager</tt></td><td>transactionManager</td><td><p>&#20351;&#29992;&#30340;&#20107;&#21153;&#31649;&#29702;&#22120;&#30340;&#21517;&#23383;&#12290;&#21482;&#26377;&#20687;&#22312;&#19978;&#38754;&#30340;&#20363;&#23376;&#37027;&#26679;&#65292;&#20107;&#21153;&#31649;&#29702;&#22120;&#19981;&#26159; <tt class="literal">transactionManager</tt>&#30340;&#24773;&#20917;&#19979;&#25165;&#38656;&#35201;&#12290;</p></td></tr><tr><td><tt class="literal">mode</tt></td><td>proxy</td><td><p>&#40664;&#35748;&#30340;&#27169;&#24335;&#8220;proxy&#8221;&#20250;&#29992;Spring&#30340;AOP&#26694;&#26550;&#26469;&#20195;&#29702;&#27880;&#35299;&#36807;&#30340;bean&#65288;&#23601;&#20687;&#22312;&#21069;&#38754;&#35752;&#35770;&#36807;&#30340;&#37027;&#26679;&#65292;
				&#19979;&#38754;&#20195;&#29702;&#30340;&#35821;&#20041;&#21482;&#23545;&#36890;&#36807;&#20195;&#29702;&#20256;&#36882;&#36807;&#26469;&#30340;&#26041;&#27861;&#35843;&#29992;&#36215;&#25928;&#65289;&#12290;
				&#21478;&#19968;&#31181;&#21487;&#34892;&#30340;&#27169;&#24335;"aspectj"&#20250;&#20351;&#29992;Spring&#30340;AspectJ&#20107;&#21153;&#20999;&#38754;&#26469;&#32534;&#32455;&#31867;&#65288;&#36890;&#36807;&#20462;&#25913;&#30446;&#26631;&#23545;&#35937;&#30340;&#23383;&#33410;&#30721;&#24212;&#29992;&#21040;&#20219;&#20309;&#26041;&#27861;&#35843;&#29992;&#19978;&#65289;&#12290;
                AspectJ&#32455;&#20837;&#38656;&#35201;&#22312;classpath&#20013;&#26377;spring-aspects.jar&#36825;&#20010;&#25991;&#20214;&#65292;&#24182;&#19988;&#21551;&#29992;&#35013;&#36733;&#26102;&#32455;&#20837; (&#25110;&#32773;&#32534;&#35793;&#26102;&#32455;&#20837;).
                (&#20851;&#20110;&#22914;&#20309;&#35774;&#32622;&#35013;&#36733;&#26102;&#32534;&#32455;&#30340;&#35814;&#24773;&#35831;&#21442;&#35265; <a href="aop.html#aop-aj-ltw-spring" title="6.8.4.5.&nbsp;Spring&#37197;&#32622;">Section&nbsp;6.8.4.5, &#8220;Spring&#37197;&#32622;&#8221;</a> )</p></td></tr><tr></tr><tr><td><tt class="literal">proxy-target-class</tt></td><td>false</td><td><p>&#21482;&#23545;&#20195;&#29702;&#27169;&#24335;&#26377;&#25928;&#12290;&#25511;&#21046;&#37027;&#20123;&#20026;&#20351;&#29992;<tt class="interfacename">@Transactional</tt>&#20511;&#21475;&#26469;&#27880;&#35299;&#31867;&#32780;&#21019;&#24314;&#30340;&#20107;&#21153;&#24615;&#20195;&#29702;&#12290; 
                &#22914;&#26524; "<tt class="literal">proxy-target-class</tt>" &#23646;&#24615;&#34987;&#35774;&#20026; 
                "<tt class="literal">true</tt>"&#65292; &#37027;&#20040;&#22522;&#20110;&#31867;&#30340;&#20195;&#29702;&#23601;&#20250;&#34987;&#21019;&#24314;&#12290;&#22914;&#26524; "<tt class="literal">proxy-target-class</tt>"&#23646;&#24615;&#34987;&#35774;&#20026;  "<tt class="literal">false</tt>"
                &#25110;&#32773;&#27809;&#35774;&#65292;&#37027;&#20040;&#22522;&#20110;&#20511;&#21475;&#30340;&#26631;&#20934;JDK&#20195;&#29702;&#23601;&#20250;&#34987;&#21019;&#24314; (&#20851;&#20110;&#19981;&#21516;&#20195;&#29702;&#31867;&#22411;&#30340;&#35299;&#37322;&#35831;&#21442;&#35265; <a href="aop.html#aop-proxying" title="6.6.&nbsp;&#20195;&#29702;&#26426;&#21046;">Section&nbsp;6.6, &#8220;&#20195;&#29702;&#26426;&#21046;&#8221;</a> )</p></td></tr><tr><td><tt class="literal">order</tt></td><td>Ordered.LOWEST_PRECEDENCE</td><td><p>&#23450;&#20041;&#20107;&#21153;&#36890;&#30693;&#30340;&#39034;&#24207;&#20250;&#20316;&#29992;&#21040;&#20351;&#29992;<tt class="interfacename">@Transactional</tt>&#27880;&#35299;&#30340;bean&#19978;&#12290;
                &#26356;&#22810;&#30340;&#20851;&#20110;AOP&#36890;&#30693;&#39034;&#24207;&#30340;&#23450;&#20041;&#21487;&#20197;&#22312;&#31456;&#33410;(&#21442;&#35265; <a href="aop.html#aop-ataspectj-advice-ordering" title="6.2.4.7.&nbsp;&#36890;&#30693;&#39034;&#24207;">Section&nbsp;6.2.4.7, &#8220;&#36890;&#30693;&#39034;&#24207;&#8221;</a>)&#12290;
                &#35831;&#27880;&#24847;&#22914;&#26524;&#19981;&#25351;&#23450;&#20219;&#20309;&#39034;&#24207;&#23558;&#20250;&#25226;&#20915;&#23450;&#26435;&#20132;&#32473;AOP&#23376;&#31995;&#32479;&#12290; </p></td></tr></tbody></table></div><p>
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>&#22312;<tt class="literal">&lt;tx:annotation-driven/&gt;</tt>&#20803;&#32032;&#19978;&#30340;"<tt class="literal">proxy-target-class</tt>" &#23646;&#24615; 
       &#25511;&#21046;&#20102;&#26377;&#20160;&#20040;&#31867;&#22411;&#30340;&#20107;&#21153;&#24615;&#20195;&#29702;&#20250;&#20026;&#20351;&#29992;<tt class="interfacename">@Transactional</tt> &#26469;&#27880;&#35299;&#30340;&#31867;&#21019;&#24314;&#20195;&#29702;&#12290;
	   &#22914;&#26524;"<tt class="literal">proxy-target-class</tt>" &#23646;&#24615;&#34987;&#35774;&#20026;"<tt class="literal">true</tt>"&#65292;&#37027;&#20040;&#22522;&#20110;&#31867;&#30340;&#20195;&#29702;&#23601;&#20250;&#34987;&#21019;&#24314;&#12290;
	   &#22914;&#26524;"<tt class="literal">proxy-target-class</tt>" &#23646;&#24615;&#34987;&#35774;&#20026;"<tt class="literal">false</tt>"
    &#25110;&#32773;&#27809;&#35774;&#65292;&#37027;&#20040;&#20250;&#21019;&#24314;&#22522;&#20110;&#25509;&#21475;&#30340;&#26631;&#20934;JDK&#20195;&#29702;&#12290;&#65288;&#20851;&#20110;&#19981;&#21516;&#20195;&#29702;&#31867;&#22411;&#30340;&#35299;&#37322;&#35831;&#21442;&#35265; <a href="aop.html#aop-proxying" title="6.6.&nbsp;&#20195;&#29702;&#26426;&#21046;">Section&nbsp;6.6, &#8220;&#20195;&#29702;&#26426;&#21046;&#8221;</a>)</p></td></tr></table></div><p>
            &#22312;&#22810;&#25968;&#24773;&#24418;&#19979;&#65292;&#26041;&#27861;&#30340;&#20107;&#21153;&#35774;&#32622;&#23558;&#34987;&#20248;&#20808;&#25191;&#34892;&#12290;&#22312;&#19979;&#21015;&#24773;&#20917;&#19979;&#65292;&#20363;&#22914;&#65306;
            <tt class="classname">DefaultFooService</tt> &#31867;&#22312;&#31867;&#30340;&#32423;&#21035;&#19978;&#34987;&#27880;&#35299;&#20026;&#21482;&#35835;&#20107;&#21153;&#65292;&#20294;&#26159;&#65292;&#36825;&#20010;&#31867;&#20013;&#30340; <tt class="methodname">updateFoo(Foo)</tt> &#26041;&#27861;&#30340; <tt class="interfacename">@Transactional</tt> &#27880;&#35299;&#30340;&#20107;&#21153;&#35774;&#32622;&#23558;&#20248;&#20808;&#20110;&#31867;&#32423;&#21035;&#27880;&#35299;&#30340;&#20107;&#21153;&#35774;&#32622;&#12290;
      </p><pre class="programlisting">@Transactional(readOnly = true)
public class DefaultFooService implements FooService {

  public Foo getFoo(String fooName) {
    <i class="lineannotation"><span class="lineannotation">// do something</span></i>
  }

    <i class="lineannotation"><span class="lineannotation">// <span class="bold"><b>these</b></span> settings have precedence for this method</span></i>
    @Transactional(readOnly = false, propagation = Propagation.REQUIRES_NEW)
    public void updateFoo(Foo foo) {
        <i class="lineannotation"><span class="lineannotation">// do something
        </span></i>
    }
}</pre><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="transaction-declarative-attransactional-settings"></a>9.5.6.1.&nbsp;<tt class="interfacename">@Transactional</tt> &#26377;&#20851;&#30340;&#35774;&#32622;</h4></div></div><div></div></div><p>
                <tt class="interfacename">@Transactional</tt> &#27880;&#35299;&#26159;&#29992;&#26469;&#25351;&#23450;&#25509;&#21475;&#12289;&#31867;&#25110;&#26041;&#27861;&#24517;&#39035;&#25317;&#26377;&#20107;&#21153;&#35821;&#20041;&#30340;&#20803;&#25968;&#25454;&#12290;
                &#22914;&#65306;&#8220;<span class="quote"><span class="emphasis"><em>&#24403;&#19968;&#20010;&#26041;&#27861;&#24320;&#22987;&#35843;&#29992;&#26102;&#23601;&#24320;&#21551;&#19968;&#20010;&#26032;&#30340;&#21482;&#35835;&#20107;&#21153;&#65292;&#24182;&#20572;&#27490;&#25481;&#20219;&#20309;&#29616;&#23384;&#30340;&#20107;&#21153;</em></span></span>&#8221;&#12290;
                &#40664;&#35748;&#30340; <tt class="interfacename">@Transactional</tt> &#35774;&#32622;&#22914;&#19979;&#65306;
                </p><div class="itemizedlist"><ul type="disc"><li><p>&#20107;&#21153;&#20256;&#25773;&#35774;&#32622;&#26159; <tt class="literal">PROPAGATION_REQUIRED</tt></p></li><li><p>&#20107;&#21153;&#38548;&#31163;&#32423;&#21035;&#26159; <tt class="literal">ISOLATION_DEFAULT</tt></p></li><li><p>&#20107;&#21153;&#26159; &#35835;/&#20889;</p></li><li><p>&#20107;&#21153;&#36229;&#26102;&#40664;&#35748;&#26159;&#20381;&#36182;&#20110;&#20107;&#21153;&#31995;&#32479;&#30340;&#65292;&#25110;&#32773;&#20107;&#21153;&#36229;&#26102;&#27809;&#26377;&#34987;&#25903;&#25345;&#12290;</p></li><li><p>&#20219;&#20309; <tt class="exceptionname">RuntimeException</tt> &#23558;&#35302;&#21457;&#20107;&#21153;&#22238;&#28378;&#65292;&#20294;&#26159;&#20219;&#20309; checked <tt class="exceptionname">Exception</tt> &#23558;&#19981;&#35302;&#21457;&#20107;&#21153;&#22238;&#28378;</p></li></ul></div><p>
	            &#36825;&#20123;&#40664;&#35748;&#30340;&#35774;&#32622;&#24403;&#28982;&#20063;&#26159;&#21487;&#20197;&#34987;&#25913;&#21464;&#30340;&#12290; 
	            <tt class="interfacename">@Transactional</tt> &#27880;&#35299;&#30340;&#21508;&#31181;&#23646;&#24615;&#35774;&#32622;&#24635;&#32467;&#22914;&#19979;&#65306;
				</p><p>
          </p><div class="table"><a name="tx-attransactional-properties"></a><p class="title"><b>Table&nbsp;9.3.&nbsp;<tt class="interfacename">@Transactional</tt> &#27880;&#35299;&#30340;&#23646;&#24615;</b></p><table summary="@Transactional &#27880;&#35299;&#30340;&#23646;&#24615;" border="1"><colgroup><col><col><col></colgroup><thead><tr><th>&#23646;&#24615;</th><th>&#31867;&#22411;</th><th>&#25551;&#36848;</th></tr></thead><tbody><tr><td><tt class="literal"><a href="transaction.html#tx-propagation" title="9.5.7.&nbsp;&#20107;&#21153;&#20256;&#25773;">propagation</a></tt></td><td>&#26522;&#20030;&#22411;&#65306;<tt class="classname">Propagation</tt></td><td>&#21487;&#36873;&#30340;&#20256;&#25773;&#24615;&#35774;&#32622;</td></tr><tr><td><tt class="literal">isolation</tt></td><td>&#26522;&#20030;&#22411;&#65306;<tt class="classname">Isolation</tt></td><td>&#21487;&#36873;&#30340;&#38548;&#31163;&#24615;&#32423;&#21035;&#65288;&#40664;&#35748;&#20540;&#65306;<tt class="literal">ISOLATION_DEFAULT</tt>&#65289;</td></tr><tr><td><tt class="literal">readOnly</tt></td><td>&#24067;&#23572;&#22411;</td><td>&#35835;&#20889;&#22411;&#20107;&#21153; vs. &#21482;&#35835;&#22411;&#20107;&#21153;</td></tr><tr><td><tt class="literal">timeout</tt></td><td>int&#22411;&#65288;&#20197;&#31186;&#20026;&#21333;&#20301;&#65289;</td><td>&#20107;&#21153;&#36229;&#26102;</td></tr><tr><td><tt class="literal">rollbackFor</tt></td><td>&#19968;&#32452; <tt class="classname">Class</tt> &#31867;&#30340;&#23454;&#20363;&#65292;&#24517;&#39035;&#26159;<tt class="classname">Throwable</tt> &#30340;&#23376;&#31867;</td><td>&#19968;&#32452;&#24322;&#24120;&#31867;&#65292;&#36935;&#21040;&#26102; <span class="bold"><b>&#24517;&#39035;</b></span> &#36827;&#34892;&#22238;&#28378;&#12290;&#40664;&#35748;&#24773;&#20917;&#19979;checked exceptions&#19981;&#36827;&#34892;&#22238;&#28378;&#65292;&#20165;unchecked  exceptions&#65288;&#21363;<tt class="classname">RuntimeException</tt>&#30340;&#23376;&#31867;&#65289;&#25165;&#36827;&#34892;&#20107;&#21153;&#22238;&#28378;&#12290;</td></tr><tr><td><tt class="literal">rollbackForClassname</tt></td><td>&#19968;&#32452; <tt class="classname">Class</tt> &#31867;&#30340;&#21517;&#23383;&#65292;&#24517;&#39035;&#26159;<tt class="classname">Throwable</tt>&#30340;&#23376;&#31867;</td><td>&#19968;&#32452;&#24322;&#24120;&#31867;&#21517;&#65292;&#36935;&#21040;&#26102; <span class="bold"><b>&#24517;&#39035;</b></span> &#36827;&#34892;&#22238;&#28378;</td></tr><tr><td><tt class="literal">noRollbackFor</tt></td><td>&#19968;&#32452; <tt class="classname">Class</tt> &#31867;&#30340;&#23454;&#20363;&#65292;&#24517;&#39035;&#26159;<tt class="classname">Throwable</tt> &#30340;&#23376;&#31867;</td><td>&#19968;&#32452;&#24322;&#24120;&#31867;&#65292;&#36935;&#21040;&#26102; <span class="bold"><b>&#24517;&#39035;&#19981;</b></span> &#22238;&#28378;&#12290;</td></tr><tr><td><tt class="literal">noRollbackForClassname</tt></td><td>&#19968;&#32452; <tt class="classname">Class</tt> &#31867;&#30340;&#21517;&#23383;&#65292;&#24517;&#39035;&#26159;<tt class="classname">Throwable</tt> &#30340;&#23376;&#31867;</td><td>&#19968;&#32452;&#24322;&#24120;&#31867;&#65292;&#36935;&#21040;&#26102; <span class="bold"><b>&#24517;&#39035;&#19981;</b></span> &#22238;&#28378;</td></tr></tbody></table></div><p>
        </p><p>&#22312;&#20889;&#20195;&#30721;&#30340;&#26102;&#20505;&#65292;&#19981;&#21487;&#33021;&#23545;&#20107;&#21153;&#30340;&#21517;&#23383;&#26377;&#20010;&#24456;&#28165;&#26224;&#30340;&#35748;&#35782;&#65292;&#36825;&#37324;&#30340;&#21517;&#23383;&#26159;&#25351;&#20250;&#22312;&#20107;&#21153;&#30417;&#35270;&#22120;&#65288;&#27604;&#22914;WebLogic&#30340;&#20107;&#21153;&#31649;&#29702;&#22120;&#65289;&#25110;&#32773;&#26085;&#24535;&#36755;&#20986;&#20013;&#26174;&#31034;&#30340;&#21517;&#23383;&#65292;
			&#23545;&#20110;&#22768;&#26126;&#24335;&#30340;&#20107;&#21153;&#35774;&#32622;&#65292;&#20107;&#21153;&#21517;&#23383;&#24635;&#26159;&#20840;&#38480;&#23450;&#21517;+"."+&#20107;&#21153;&#36890;&#30693;&#30340;&#31867;&#30340;&#26041;&#27861;&#21517;&#12290;&#27604;&#22914;<tt class="classname">BusinessService</tt>&#31867;&#30340;<tt class="methodname">handlePayment(..)</tt>&#26041;&#27861;&#21551;&#21160;&#20102;&#19968;&#20010;&#20107;&#21153;&#65292;&#20107;&#21153;&#30340;&#21517;&#31216;&#26159;&#65306;</p><pre class="programlisting">com.foo.BusinessService.handlePayment</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="tx-propagation"></a>9.5.7.&nbsp;&#20107;&#21153;&#20256;&#25773;</h3></div></div><div></div></div><p><span class="emphasis"><em>&#35831;&#27880;&#24847;&#36825;&#37096;&#20998;&#30340;Spring&#21442;&#32771;&#25991;&#26723;<span class="emphasis"><em>&#19981;&#26159;</em></span> &#20107;&#21153;&#20256;&#25773;&#30340;&#20171;&#32461;&#65292;
			&#32780;&#26159;&#35814;&#32454;&#20171;&#32461;&#20102;&#22312;Spring&#20013;&#19982;&#20107;&#21153;&#20256;&#25773;&#30456;&#20851;&#30340;&#19968;&#20123;&#35821;&#20041;&#12290; </em></span></p><p>&#22312;&#30001;Spring&#31649;&#29702;&#30340;&#20107;&#21153;&#20013;&#65292;&#35831;&#35760;&#20303; <span class="emphasis"><em>&#29289;&#29702;</em></span> &#21644; <span class="emphasis"><em>&#36923;&#36753;</em></span> &#20107;&#21153;&#23384;&#22312;&#30340;&#24046;&#24322;&#65292;
			&#20197;&#21450;&#20256;&#25773;&#35774;&#32622;&#26159;&#22914;&#20309;&#24433;&#21709;&#21040;&#36825;&#20123;&#24046;&#24322;&#30340;&#12290; </p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="tx-propagation-required"></a>9.5.7.1.&nbsp;required</h4></div></div><div></div></div><p>
					</p><div class="mediaobject" align="center"><img src="images/tx_prop_required.png" align="middle"><div class="caption"><p>PROPAGATION_REQUIRED</p></div></div><p>
				</p><p>&#24403;&#20107;&#21153;&#20256;&#25773;&#34987;&#35774;&#32622;<tt class="literal">PROPAGATION_REQUIRED</tt>&#30340;&#26102;&#20505;&#65292;
				&#20250;&#20026;&#27599;&#19968;&#20010;&#34987;&#24212;&#29992;&#21040;&#30340;&#26041;&#27861;&#21019;&#24314;&#19968;&#20010;<span class="emphasis"><em>&#36923;&#36753;</em></span>&#20107;&#21153;&#20316;&#29992;&#22495;&#12290;
				&#27599;&#19968;&#20010;&#36825;&#26679;&#30340;&#36923;&#36753;&#20107;&#21153;&#20316;&#29992;&#22495;&#37117;&#21487;&#20197;&#33258;&#20027;&#22320;&#20915;&#23450;rollback-only&#29366;&#24577;&#65292;&#24403;&#36825;&#26679;&#30340;&#36923;&#36753;&#20107;&#21153;&#20316;&#29992;&#22495;&#34987;&#22806;&#37096;&#30340;&#19968;&#20010;&#36923;&#36753;&#20107;&#21153;&#20316;&#29992;&#22495;&#25152;&#21253;&#21547;&#30340;&#26102;&#20505;&#65292;
				&#20182;&#20204;&#22312;&#36923;&#36753;&#19978;&#26159;&#29420;&#31435;&#30340;&#12290;&#24403;&#28982;&#20102;&#65292;&#23545;&#20110;&#27491;&#24120;&#30340; <tt class="literal">PROPAGATION_REQUIRED</tt>&#35774;&#32622;&#26469;&#35828;&#65292;&#20182;&#20250;&#34987;&#26144;&#23556;&#21040;&#30456;&#21516;&#30340;&#29289;&#29702;&#20107;&#21153;&#19978;&#12290;
				&#25152;&#20197;&#19968;&#20010;&#26631;&#35760;&#26377;rollback-only&#30340;&#20869;&#37096;&#36923;&#36753;&#20107;&#21153;&#20316;&#29992;&#22495;&#30340;&#30830;&#20250;&#24433;&#21709;&#21040;&#22806;&#37096;&#30340;&#36923;&#36753;&#20107;&#21153;&#20316;&#29992;&#22495;&#65288;&#23601;&#20687;&#20320;&#25152;&#39044;&#26009;&#30340;&#37027;&#26679;&#65289;&#12290; </p><p>&#28982;&#32780;&#65292;&#24403;&#20869;&#37096;&#30340;&#20107;&#21153;&#20316;&#29992;&#22495;&#26631;&#35760;&#20026;rollback-only&#65292;&#21516;&#26102;&#22806;&#37096;&#30340;&#20107;&#21153;&#20316;&#29992;&#22495;&#24182;&#27809;&#26377;&#20915;&#23450;&#35201;&#22238;&#28378;&#65292;
				&#36825;&#26679;&#30340;&#22238;&#28378;&#26159;&#24847;&#26009;&#19981;&#21040;&#30340;&#65288;&#38745;&#24708;&#24708;&#22320;&#30001;&#20869;&#37096;&#20107;&#21153;&#20316;&#29992;&#22495;&#35302;&#21457;&#30340;&#65289;&#65306;
				&#19968;&#20010;&#23545;&#24212;&#30340;<tt class="classname">UnexpectedRollbackException</tt> &#24322;&#24120;&#20250;&#22312;&#36825;&#20010;&#26102;&#20505;&#34987;&#25243;&#20986;&#12290;&#36825;&#26159; <span class="emphasis"><em>&#21487;&#20197;&#39044;&#26009;&#21040;&#30340;&#34892;&#20026;</em></span>&#65292;
				&#21482;&#26377;&#36825;&#26679;&#65292;&#36825;&#20010;&#20107;&#21153;&#30340;&#35843;&#29992;&#32773;&#25165;&#19981;&#20250;&#34987;&#35823;&#23548;&#65292;&#22312;&#20107;&#21153;&#27809;&#26377;&#25552;&#20132;&#30340;&#24773;&#20917;&#19979;&#35823;&#20197;&#20026;&#20107;&#21153;&#24050;&#32463;&#25552;&#20132;&#12290;&#25152;&#20197;&#22914;&#26524;&#20869;&#37096;&#30340;&#20107;&#21153;&#65288;&#22806;&#37096;&#30340;&#35843;&#29992;&#32773;&#24182;&#19981;&#30693;&#24773;&#65289;&#26631;&#35760;&#35813;&#20107;&#21153;&#20026;
				rollback-only&#65292;&#32780;&#22806;&#37096;&#30340;&#35843;&#29992;&#32773;&#21364;&#20381;&#26087;&#22312;&#19981;&#30693;&#24773;&#30340;&#24773;&#20917;&#19979;&#25552;&#20132;&#21518;&#65292;&#23427;&#38656;&#35201;&#25910;&#21040;&#19968;&#20010; <tt class="classname">UnexpectedRollbackException</tt>
				&#24322;&#24120;&#26469;&#28165;&#26970;&#30340;&#20102;&#35299;&#20107;&#21153;&#24182;&#27809;&#26377;&#25552;&#20132;&#32780;&#26159;&#21457;&#29983;&#20102;&#22238;&#28378;&#12290;
				 </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="tx-propagation-requires_new"></a>9.5.7.2.&nbsp;RequiresNew</h4></div></div><div></div></div><p>
					</p><div class="mediaobject" align="center"><img src="images/tx_prop_requires_new.png" align="middle"><div class="caption"><p>PROPAGATION_REQUIRES_NEW</p></div></div><p>
				</p><p><tt class="literal">PROPAGATION_REQUIRES_NEW</tt>&#65292;&#19982;&#20043;&#21069;&#30456;&#21453;&#65292;&#20026;&#27599;&#19968;&#20010;&#30456;&#20851;&#30340;&#20107;&#21153;&#20316;&#29992;&#22495;&#20351;&#29992;&#20102;&#19968;&#20010;<span class="emphasis"><em>&#23436;&#20840;</em></span>
				&#29420;&#31435;&#30340;&#20107;&#21153;&#12290;&#22312;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#29289;&#29702;&#20107;&#21153;&#20063;&#23558;&#26159;&#19981;&#21516;&#30340;&#65292;&#22240;&#27492;&#22806;&#37096;&#20107;&#21153;&#21487;&#20197;&#19981;&#21463;&#20869;&#37096;&#20107;&#21153;&#22238;&#28378;&#29366;&#24577;&#30340;&#24433;&#21709;&#29420;&#31435;&#25552;&#20132;&#25110;&#32773;&#22238;&#28378;&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="tx-propagation-nested"></a>9.5.7.3.&nbsp;Nested</h4></div></div><div></div></div><p><tt class="literal">PROPAGATION_NESTED</tt> &#26159;&#19968;&#20010;&#23436;&#20840;&#19981;&#21516;&#30340;&#35774;&#32622;&#12290;&#23427;&#20351;&#29992;&#20102;&#19968;&#20010;<span class="emphasis"><em>&#21333;&#29420;</em></span>&#30340;&#29289;&#29702;&#20107;&#21153;&#65292;
				&#36825;&#20010;&#20107;&#21153;&#25317;&#26377;&#22810;&#20010;&#21487;&#20197;&#22238;&#28378;&#30340;&#20445;&#23384;&#28857;&#12290;&#36825;&#26679;&#37096;&#20998;&#22238;&#28378;&#20801;&#35768;&#20869;&#37096;&#20107;&#21153;<span class="emphasis"><em>&#22312;&#23427;&#30340;&#20316;&#29992;&#22495;&#20869;</em></span>&#35302;&#21457;&#19968;&#20010;&#22238;&#28378;&#65292;
				&#24182;&#19988;&#22806;&#37096;&#20107;&#21153;&#33021;&#22815;&#19981;&#21463;&#24433;&#21709;&#30340;&#32487;&#32493;&#12290; &#36825;&#36890;&#24120;&#26159;&#23545;&#24212;&#20110;JDBC&#30340;&#20445;&#23384;&#28857;&#65292;&#25152;&#20197;&#21482;&#20250;&#22312; JDBC &#36164;&#28304;&#20107;&#21153;&#31649;&#29702;&#19978;&#36215;&#25928;
				(&#20855;&#20307;&#35831;&#21442;&#35265; Spring&#30340;<tt class="classname">DataSourceTransactionManager</tt>).</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-applying-more-than-just-tx-advice"></a>9.5.8.&nbsp;&#36890;&#30693;&#20107;&#21153;&#25805;&#20316;</h3></div></div><div></div></div><p>&#32771;&#34385;&#19968;&#19979;&#36825;&#26679;&#30340;&#24773;&#20917;&#65292;&#22914;&#26524;&#20320;&#24076;&#26395; <span class="emphasis"><em>&#21516;&#26102;</em></span>&#25191;&#34892;&#20107;&#21153;&#24615;&#36890;&#30693;&#65288;advice&#65289;<span class="emphasis"><em>&#21644;</em></span>&#19968;&#20123;&#22522;&#26412;&#30340;&#21078;&#26512;&#65288;profiling&#65289;&#36890;&#30693;&#12290;
			&#37027;&#20040;&#65292;&#22312;<tt class="literal">&lt;tx:annotation-driven/&gt;</tt>&#29615;&#22659;&#20013;&#35813;&#24590;&#20040;&#20570;&#65311;</p><p>&#25105;&#20204;&#35843;&#29992; <tt class="methodname">updateFoo(Foo)</tt> &#26041;&#27861;&#26102;&#24076;&#26395;&#36825;&#26679;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p>&#37197;&#32622;&#30340;&#21078;&#26512;&#20999;&#38754;&#65288;profiling aspect&#65289;&#24320;&#22987;&#21551;&#21160;&#65292;</p></li><li><p>&#28982;&#21518;&#36827;&#20837;&#20107;&#21153;&#36890;&#30693;&#65288;&#26681;&#25454;&#37197;&#32622;&#21019;&#24314;&#19968;&#20010;&#26032;&#20107;&#21153;&#25110;&#21152;&#20837;&#19968;&#20010;&#24050;&#32463;&#23384;&#22312;&#30340;&#20107;&#21153;&#65289;&#65292;</p></li><li><p>&#28982;&#21518;&#25191;&#34892;&#21407;&#22987;&#23545;&#35937;&#30340;&#26041;&#27861;&#65292;</p></li><li><p>&#28982;&#21518;&#20107;&#21153;&#25552;&#20132;&#65288;&#25105;&#20204;&#20551;&#23450;&#36825;&#37324;&#19968;&#20999;&#27491;&#24120;&#65289;&#65292;</p></li><li><p>&#26368;&#21518;&#21078;&#26512;&#20999;&#38754;&#25253;&#21578;&#25972;&#20010;&#20107;&#21153;&#26041;&#27861;&#25191;&#34892;&#36807;&#31243;&#33457;&#20102;&#22810;&#23569;&#26102;&#38388;&#12290;</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>&#36825;&#31456;&#19981;&#20250;&#19987;&#38376;&#35762;&#36848;AOP&#30340;&#25152;&#26377;&#32454;&#33410;&#65288;&#38500;&#20102;&#24212;&#29992;&#20110;&#20107;&#21153;&#26041;&#38754;&#30340;&#20043;&#22806;&#65289;&#12290;
				&#35831;&#21442;&#32771; <a href="aop.html" title="Chapter&nbsp;6.&nbsp;&#20351;&#29992;Spring&#36827;&#34892;&#38754;&#21521;&#20999;&#38754;&#32534;&#31243;&#65288;AOP&#65289;">Chapter&nbsp;6, <i>&#20351;&#29992;Spring&#36827;&#34892;&#38754;&#21521;&#20999;&#38754;&#32534;&#31243;&#65288;AOP&#65289;</i></a> &#31456;&#33410;&#20197;&#33719;&#24471;&#23545;&#21508;&#31181;AOP&#37197;&#32622;&#21450;&#20854;&#19968;&#33324;&#27010;&#24565;&#30340;&#35814;&#32454;&#21465;&#36848;&#12290;
                </p></td></tr></table></div><p>&#36825;&#37324;&#26377;&#19968;&#20221;&#31616;&#21333;&#30340;&#21078;&#26512;&#20999;&#38754;&#65288;profiling aspect&#65289;&#30340;&#20195;&#30721;&#12290;<span class="emphasis"><em>
			&#65288;&#35831;&#27880;&#24847;&#65292;&#36890;&#30693;&#30340;&#39034;&#24207;&#26159;&#30001; <tt class="interfacename">Ordered</tt> &#25509;&#21475;&#26469;&#25511;&#21046;&#30340;&#12290;
			&#35201;&#24819;&#20102;&#35299;&#26356;&#22810;&#32454;&#33410;&#65292;&#35831;&#21442;&#32771; <a href="aop.html#aop-ataspectj-advice-ordering" title="6.2.4.7.&nbsp;&#36890;&#30693;&#39034;&#24207;">Section&nbsp;6.2.4.7, &#8220;&#36890;&#30693;&#39034;&#24207;&#8221;</a> &#33410;&#12290;&#65289;</em></span>
			</p><pre class="programlisting">package x.y;

import org.aspectj.lang.ProceedingJoinPoint;
import org.springframework.util.StopWatch;
import org.springframework.core.Ordered;

public class SimpleProfiler implements Ordered {

  private int order;

  <i class="lineannotation"><span class="lineannotation">// allows us to control the ordering of advice</span></i>
  public int getOrder() {
    return this.order;
  }

  public void setOrder(int order) {
    this.order = order;
  }

  <i class="lineannotation"><span class="lineannotation">// this method <span class="emphasis"><em>is</em></span> the around advice</span></i>
  public Object profile(ProceedingJoinPoint call) throws Throwable {
    Object returnValue;
    StopWatch clock = new StopWatch(getClass().getName());
    try {
      clock.start(call.toShortString());
      returnValue = call.proceed();
    } finally {
      clock.stop();
      System.out.println(clock.prettyPrint());
    }
    return returnValue;
  }
}
</pre><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xmlns:aop="http://www.springframework.org/schema/aop"
     xmlns:tx="http://www.springframework.org/schema/tx"
     xsi:schemaLocation="
   http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
   http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd
   http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd"&gt;

  &lt;bean id="fooService" class="x.y.service.DefaultFooService"/&gt;

  <i class="lineannotation"><span class="lineannotation">&lt;!-- this is the aspect --&gt;</span></i>
  &lt;bean id="profiler" class="x.y.SimpleProfiler"&gt;
    <i class="lineannotation"><span class="lineannotation">&lt;!-- execute before the transactional advice (hence the lower order number) --&gt;</span></i>
    &lt;property name="order" <span class="bold"><b>value="1"</b></span>/&gt;
  &lt;/bean&gt;

  &lt;tx:annotation-driven transaction-manager="txManager" <span class="bold"><b>order="200"</b></span>/&gt;

  &lt;aop:config&gt;
    <i class="lineannotation"><span class="lineannotation">&lt;!-- this advice will execute <span class="bold"><b>around</b></span> the transactional advice --&gt;</span></i>
    &lt;aop:aspect id="profilingAspect" ref="profiler"&gt;
      &lt;aop:pointcut id="serviceMethodWithReturnValue"
              expression="execution(!void x.y..*Service.*(..))"/&gt;
      &lt;aop:around method="profile" pointcut-ref="serviceMethodWithReturnValue"/&gt;
    &lt;/aop:aspect&gt;
  &lt;/aop:config&gt;

  &lt;bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"&gt;
    &lt;property name="driverClassName" value="oracle.jdbc.driver.OracleDriver"/&gt;
    &lt;property name="url" value="jdbc:oracle:thin:@rj-t42:1521:elvis"/&gt;
    &lt;property name="username" value="scott"/&gt;
    &lt;property name="password" value="tiger"/&gt;
  &lt;/bean&gt;

  &lt;bean id="txManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt;
    &lt;property name="dataSource" ref="dataSource"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><p>
            &#19978;&#38754;&#37197;&#32622;&#30340;&#32467;&#26524;&#23558;&#33719;&#24471;&#21040;&#19968;&#20010;&#25317;&#26377;&#21078;&#26512;&#21644;&#20107;&#21153;&#26041;&#38754;&#30340; <span class="emphasis"><em>&#25353;&#37027;&#26679;&#30340;&#39034;&#24207;</em></span> &#24212;&#29992;&#20110;&#23427;&#19978;&#38754;&#30340; <tt class="literal">'fooService'</tt> bean&#12290;
            &#35768;&#22810;&#38468;&#21152;&#30340;&#26041;&#38754;&#30340;&#37197;&#32622;&#23558;&#19968;&#36215;&#36798;&#21040;&#36825;&#26679;&#30340;&#25928;&#26524;&#12290;
            </p><p>
            &#26368;&#21518;&#65292;&#19979;&#38754;&#30340;&#19968;&#20123;&#31034;&#20363;&#28436;&#31034;&#20102;&#20351;&#29992;&#32431;XML&#22768;&#26126;&#30340;&#26041;&#27861;&#26469;&#36798;&#21040;&#19978;&#38754;&#19968;&#26679;&#30340;&#35774;&#32622;&#25928;&#26524;&#12290;
            </p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xmlns:aop="http://www.springframework.org/schema/aop"
     xmlns:tx="http://www.springframework.org/schema/tx"
     xsi:schemaLocation="
   http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
   http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd
   http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd"&gt;

  &lt;bean id="fooService" class="x.y.service.DefaultFooService"/&gt;

  <i class="lineannotation"><span class="lineannotation">&lt;!-- the profiling advice --&gt;</span></i>
  &lt;bean id="profiler" class="x.y.SimpleProfiler"&gt;
    <i class="lineannotation"><span class="lineannotation">&lt;!-- execute before the transactional advice (hence the lower order number) --&gt;</span></i>
    <span class="bold"><b>&lt;property name="order" value="1</b></span>"/&gt;
  &lt;/bean&gt;

  &lt;aop:config&gt;

    &lt;aop:pointcut id="entryPointMethod" expression="execution(* x.y..*Service.*(..))"/&gt;

    <i class="lineannotation"><span class="lineannotation">&lt;!-- will execute after the profiling advice (c.f. the order attribute) --&gt;</span></i>
    &lt;aop:advisor
        advice-ref="txAdvice"
        pointcut-ref="entryPointMethod"
        <span class="bold"><b>order="2</b></span>"/&gt; <i class="lineannotation"><span class="lineannotation">&lt;!-- order value is higher than the profiling aspect --&gt;</span></i>

    &lt;aop:aspect id="profilingAspect" ref="profiler"&gt;
      &lt;aop:pointcut id="serviceMethodWithReturnValue"
              expression="execution(!void x.y..*Service.*(..))"/&gt;
      &lt;aop:around method="profile" pointcut-ref="serviceMethodWithReturnValue"/&gt;
    &lt;/aop:aspect&gt;

  &lt;/aop:config&gt;

  &lt;tx:advice id="txAdvice" transaction-manager="txManager"&gt;
    &lt;tx:attributes&gt;
      &lt;tx:method name="get*" read-only="true"/&gt;
      &lt;tx:method name="*"/&gt;
    &lt;/tx:attributes&gt;
  &lt;/tx:advice&gt;

  <i class="lineannotation"><span class="lineannotation">&lt;!-- other &lt;bean/&gt; definitions such as a <tt class="interfacename">DataSource</tt> and a <tt class="interfacename">PlatformTransactionManager</tt> here --&gt;</span></i>

&lt;/beans&gt;</pre><p>&#19978;&#38754;&#37197;&#32622;&#30340;&#32467;&#26524;&#26159;&#21019;&#24314;&#20102;&#19968;&#20010; <tt class="literal">'fooService'</tt> bean&#65292;&#21078;&#26512;&#26041;&#38754;&#21644;&#20107;&#21153;&#26041;&#38754;&#34987; <span class="emphasis"><em>&#20381;&#29031;&#39034;&#24207;</em></span> &#26045;&#21152;&#20854;&#19978;&#12290;&#22914;&#26524;&#25105;&#20204;&#24076;&#26395;&#21078;&#26512;&#36890;&#30693;&#22312;&#30446;&#26631;&#26041;&#27861;&#25191;&#34892;&#20043;&#21069; <span class="emphasis"><em>&#21518;&#20110;</em></span> &#20107;&#21153;&#36890;&#30693;&#25191;&#34892;&#65292;&#32780;&#19988;&#22312;&#30446;&#26631;&#26041;&#27861;&#25191;&#34892;&#20043;&#21518; <span class="emphasis"><em>&#20808;&#20110;</em></span> &#20107;&#21153;&#36890;&#30693;&#65292;&#25105;&#20204;&#21487;&#20197;&#31616;&#21333;&#22320;&#20132;&#25442;&#20004;&#20010;&#36890;&#30693;bean&#30340;order&#20540;&#12290;</p><p>&#22914;&#26524;&#37197;&#32622;&#20013;&#21253;&#21547;&#26356;&#22810;&#30340;&#26041;&#38754;&#65292;&#23427;&#20204;&#23558;&#20197;&#21516;&#26679;&#30340;&#26041;&#24335;&#21463;&#21040;&#24433;&#21709;&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-declarative-aspectj"></a>9.5.9.&nbsp;&#32467;&#21512;AspectJ&#20351;&#29992; <tt class="interfacename">@Transactional</tt></h3></div></div><div></div></div><p>&#36890;&#36807;AspectJ&#20999;&#38754;&#65292;&#20320;&#20063;&#21487;&#20197;&#22312;Spring&#23481;&#22120;&#20043;&#22806;&#20351;&#29992;Spring&#26694;&#26550;&#30340; <tt class="interfacename">@Transactional</tt> &#21151;&#33021;&#12290;&#35201;&#20351;&#29992;&#36825;&#39033;&#21151;&#33021;&#20320;&#24517;&#39035;&#20808;&#32473;&#30456;&#24212;&#30340;&#31867;&#21644;&#26041;&#27861;&#21152;&#19978; <tt class="interfacename">@Transactional</tt>&#27880;&#35299;&#65292;&#28982;&#21518;&#25226; <tt class="filename">spring-aspects.jar</tt> &#25991;&#20214;&#20013;&#23450;&#20041;&#30340; <tt class="classname">org.springframework.transaction.aspectj.AnnotationTransactionAspect</tt> &#20999;&#38754;&#36830;&#25509;&#36827;&#65288;&#32455;&#20837;&#65289;&#20320;&#30340;&#24212;&#29992;&#12290;&#21516;&#26679;&#65292;&#35813;&#20999;&#38754;&#24517;&#39035;&#37197;&#32622;&#19968;&#20010;&#20107;&#21153;&#31649;&#29702;&#22120;&#12290;&#20320;&#24403;&#28982;&#21487;&#20197;&#36890;&#36807;Spring&#26694;&#26550;&#23481;&#22120;&#26469;&#22788;&#29702;&#27880;&#20837;&#65292;&#20294;&#22240;&#20026;&#25105;&#20204;&#36825;&#37324;&#20851;&#27880;&#20110;&#22312;Spring&#23481;&#22120;&#20043;&#22806;&#36816;&#34892;&#24212;&#29992;&#65292;&#25105;&#20204;&#23558;&#21521;&#20320;&#23637;&#31034;&#22914;&#20309;&#36890;&#36807;&#25163;&#21160;&#20070;&#20889;&#20195;&#30721;&#26469;&#23436;&#25104;&#12290;</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>&#22312;&#25105;&#20204;&#32487;&#32493;&#20043;&#21069;&#65292;&#20320;&#21487;&#33021;&#38656;&#35201;&#22909;&#22909;&#35835;&#19968;&#19979;&#21069;&#38754;&#30340;<a href="transaction.html#transaction-declarative-annotations" title="9.5.6.&nbsp;&#20351;&#29992; @Transactional">Section&nbsp;9.5.6, &#8220;&#20351;&#29992; @Transactional&#8221;</a> &#21644; <a href="aop.html" title="Chapter&nbsp;6.&nbsp;&#20351;&#29992;Spring&#36827;&#34892;&#38754;&#21521;&#20999;&#38754;&#32534;&#31243;&#65288;AOP&#65289;">Chapter&nbsp;6, <i>&#20351;&#29992;Spring&#36827;&#34892;&#38754;&#21521;&#20999;&#38754;&#32534;&#31243;&#65288;AOP&#65289;</i></a> &#20004;&#31456;&#12290;</p></td></tr></table></div><pre class="programlisting"><i class="lineannotation"><span class="lineannotation">// construct an appropriate transaction manager </span></i>
DataSourceTransactionManager txManager = new DataSourceTransactionManager(getDataSource());

<i class="lineannotation"><span class="lineannotation">// configure the <tt class="classname">AnnotationTransactionAspect</tt> to use it; this must be done before executing any transactional methods</span></i>
AnnotationTransactionAspect.aspectOf().setTransactionManager(txManager); </pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>
	            &#20351;&#29992;&#27492;&#20999;&#38754;&#65288;aspect&#65289;&#65292;&#20320;&#24517;&#39035;&#22312; <span class="emphasis"><em>&#23454;&#29616;</em></span> &#31867;&#65288;&#21644;/&#25110;&#31867;&#37324;&#30340;&#26041;&#27861;&#65289;&#12289;&#32780; <span class="emphasis"><em>&#19981;&#26159;</em></span> &#31867;&#30340;&#20219;&#20309;&#25152;&#23454;&#29616;&#30340;&#25509;&#21475;&#19978;&#38754;&#36827;&#34892;&#27880;&#35299;&#12290;AspectJ&#36981;&#24490;Java&#30340;&#25509;&#21475;&#19978;&#30340;&#27880;&#35299; <span class="emphasis"><em>&#19981;&#34987;&#32487;&#25215;</em></span> &#30340;&#35268;&#21017;&#12290;
	            </p></td></tr></table></div><p>
	        &#23450;&#20041;&#22312;&#31867;&#19978;&#30340; <tt class="interfacename">@Transactional</tt> &#27880;&#35299;&#25351;&#23450;&#20102;&#31867;&#20013;&#25152;&#26377;&#26041;&#27861;&#25191;&#34892;&#26102;&#30340;&#40664;&#35748;&#20107;&#21153;&#35821;&#20041;&#12290;
	        </p><p>
	        &#23450;&#20041;&#22312;&#31867;&#30340;&#26041;&#27861;&#19978;&#30340; <tt class="interfacename">@Transactional</tt> &#27880;&#35299;&#23558;&#35206;&#30422;&#25481;&#31867;&#19978;&#27880;&#35299;&#30340;&#25152;&#25351;&#23450;&#30340;&#40664;&#35748;&#20107;&#21153;&#35821;&#20041;&#65288;&#22914;&#36807;&#23384;&#22312;&#30340;&#35805;&#65289;&#12290;
	        &#25152;&#26377;&#30340;&#26041;&#27861;&#37117;&#21487;&#20197;&#27880;&#35299;&#65292;&#19981;&#31649;&#23427;&#30340;&#21487;&#35265;&#24230;&#26159;&#20160;&#20040;&#26679;&#30340;&#12290;
	        </p><p>
			&#35201;&#25226; <tt class="classname">AnnotationTransactionAspect</tt> &#32455;&#20837;&#20320;&#30340;&#24212;&#29992;&#65292;&#20320;&#25110;&#32773;&#22522;&#20110;AspectJ&#26500;&#24314;&#20320;&#30340;&#24212;&#29992;&#65288;&#21442;&#32771; <a href="http://www.eclipse.org/aspectj/doc/released/devguide/index.html" target="_top">AspectJ Development Guide</a>&#65289;&#65292;&#25110;&#32773;&#37319;&#21462;&#8220;&#36733;&#20837;&#26102;&#32455;&#20837;&#8221;&#65288;load-time weaving&#65289;&#65292;&#21442;&#32771; <a href="aop.html#aop-aj-ltw" title="6.8.4.&nbsp;&#22312;Spring&#24212;&#29992;&#20013;&#20351;&#29992;AspectJ&#21152;&#36733;&#26102;&#32455;&#20837;&#65288;LTW&#65289;">Section&nbsp;6.8.4, &#8220;&#22312;Spring&#24212;&#29992;&#20013;&#20351;&#29992;AspectJ&#21152;&#36733;&#26102;&#32455;&#20837;&#65288;LTW&#65289;&#8221;</a> &#33719;&#24471;&#20851;&#20110;&#20351;&#29992;AspectJ&#36827;&#34892;&#8220;&#36733;&#20837;&#26102;&#32455;&#20837;&#8221;&#30340;&#35752;&#35770;&#12290;
			</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-programmatic"></a>9.6.&nbsp;&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;</h2></div></div><div></div></div><p>Spring&#25552;&#20379;&#20004;&#31181;&#26041;&#24335;&#30340;&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p>&#20351;&#29992; <tt class="classname">TransactionTemplate</tt></p></li><li><p>&#30452;&#25509;&#20351;&#29992;&#19968;&#20010; <tt class="interfacename">PlatformTransactionManager</tt> &#23454;&#29616;</p></li></ul></div><p>&#22914;&#26524;&#20320;&#36873;&#25321;&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;&#65292;Spring&#23567;&#32452;&#25512;&#33616;&#20351;&#29992; <tt class="classname">TransactionTemplate</tt>&#12290;
	&#31532;&#20108;&#31181;&#26041;&#27861;&#21017;&#31867;&#20284;&#20351;&#29992;JTA&#30340; <tt class="interfacename">UserTransaction</tt> API &#65288;&#38500;&#20102;&#24322;&#24120;&#22788;&#29702;&#30340;&#37096;&#20998;&#31245;&#24494;&#31616;&#21333;&#28857;&#65289;&#12290;</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="tx-prog-template"></a>9.6.1.&nbsp;&#20351;&#29992;<tt class="classname">TransactionTemplate</tt></h3></div></div><div></div></div><p><tt class="classname">TransactionTemplate</tt> &#37319;&#29992;&#19982;Spring&#20013;&#21035;&#30340; <span class="emphasis"><em>&#27169;&#26495;</em></span> &#21516;&#26679;&#30340;&#26041;&#27861;&#65292;
	  &#22914; <tt class="classname">JdbcTemplate</tt> &#12290;&#23427;&#20351;&#29992;&#22238;&#35843;&#26426;&#21046;&#65292;&#23558;&#24212;&#29992;&#20195;&#30721;&#20174;&#26679;&#26495;&#24335;&#30340;&#36164;&#28304;&#33719;&#21462;&#21644;&#37322;&#25918;&#20195;&#30721;&#20013;&#35299;&#25918;&#20986;&#26469;&#65292;
	  &#36825;&#26679;&#20889;&#20986;&#30340;&#20195;&#30721;&#26159;&#30446;&#30340;&#39537;&#21160;&#30340;&#65292;&#25226;&#31934;&#21147;&#38598;&#20013;&#22312;&#24320;&#21457;&#32773;&#24819;&#35201;&#20570;&#30340;&#20107;&#24773;&#19978;&#12290;</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>&#23601;&#20687;&#20320;&#39532;&#19978;&#35201;&#22312;&#21518;&#38754;&#30340;&#20363;&#23376;&#20013;&#30475;&#21040;&#30340;&#37027;&#26679;&#65292;
				&#20351;&#29992; <tt class="classname">TransactionTemplate</tt> &#32477;&#23545;&#20250;&#22686;&#21152;&#20320;&#30340;&#20195;&#30721;&#19982;Spring&#30340;&#20107;&#21153;&#26694;&#26550;&#21644;API&#38388;&#30340;&#32806;&#21512;&#12290;
				&#21040;&#24213;&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;&#26159;&#19981;&#26159;&#36866;&#21512;&#20320;&#30340;&#39033;&#30446;&#38656;&#35201;&#30001;&#20320;&#33258;&#24049;&#26469;&#20915;&#23450;&#12290; </p></td></tr></table></div><p>&#24212;&#29992;&#30340;&#20195;&#30721;&#24517;&#39035;&#22312;&#19968;&#20010;&#20107;&#21153;&#24615;&#30340;&#19978;&#19979;&#25991;&#20013;&#25191;&#34892;&#65292;&#36825;&#26679;&#23601;&#20250;&#20687;&#36825;&#26679;&#19968;&#26679;&#26174;&#24335;&#30340;&#20351;&#29992;<tt class="classname">TransactionTemplate</tt>&#12290;&#20320;&#20316;&#20026;&#19968;&#20010;&#24212;&#29992;&#31243;&#24207;&#21592;&#65292;
			&#20250;&#20889;&#19968;&#20010; <tt class="interfacename">TransactionCallback</tt> &#30340;&#23454;&#29616;&#65292;
			(&#36890;&#24120;&#20250;&#29992;&#21311;&#21517;&#31867;&#26469;&#23454;&#29616; )&#36825;&#26679;&#30340;&#23454;&#29616;&#20250;&#21253;&#21547;&#25152;&#20197;&#20320;&#38656;&#35201;&#22312;&#35813;&#20107;&#21153;&#19978;&#19979;&#25991;&#20013;&#25191;&#34892;&#30340;&#20195;&#30721;&#12290;
			&#28982;&#21518;&#20320;&#20250;&#25226;&#19968;&#20010;&#20320;&#33258;&#24049;&#23454;&#29616;<tt class="interfacename">TransactionCallback</tt>&#30340;&#23454;&#20363;&#20256;&#36882;&#32473;<tt class="classname">TransactionTemplate</tt>&#26292;&#38706;&#30340;<tt class="methodname">execute(..)</tt> &#26041;&#27861;&#12290;</p><pre class="programlisting">public class SimpleService implements Service {

  <i class="lineannotation"><span class="lineannotation">// single <tt class="classname">TransactionTemplate</tt> shared amongst all methods in this instance</span></i>
  private final TransactionTemplate transactionTemplate;

  <i class="lineannotation"><span class="lineannotation">// use constructor-injection to supply the <tt class="interfacename">PlatformTransactionManager</tt></span></i>
  public SimpleService(PlatformTransactionManager transactionManager) {
    Assert.notNull(transactionManager, "The 'transactionManager' argument must not be null.");
    this.transactionTemplate = new TransactionTemplate(transactionManager);
  }

  public Object someServiceMethod() {
    return transactionTemplate.execute(new TransactionCallback() {

      <i class="lineannotation"><span class="lineannotation">// the code in this method executes in a transactional context</span></i>
      public Object doInTransaction(TransactionStatus status) {
        updateOperation1();
        return resultOfUpdateOperation2();
      }
    });
  }
}</pre><p>&#22914;&#26524;&#19981;&#38656;&#35201;&#36820;&#22238;&#20540;&#65292;&#26356;&#26041;&#20415;&#30340;&#26041;&#24335;&#26159;&#21019;&#24314;&#19968;&#20010; <tt class="classname">TransactionCallbackWithoutResult</tt> &#30340;&#21311;&#21517;&#31867;&#65292;&#22914;&#19979;&#65306;</p><pre class="programlisting">transactionTemplate.execute(new <span class="bold"><b>TransactionCallbackWithoutResult</b></span>() {

  protected void doInTransactionWithoutResult(TransactionStatus status) {
    updateOperation1();
    updateOperation2();
  }
});</pre><p>&#22238;&#35843;&#26041;&#27861;&#20869;&#30340;&#20195;&#30721;&#21487;&#20197;&#36890;&#36807;&#35843;&#29992; <tt class="interfacename">TransactionStatus</tt> &#23545;&#35937;&#30340; <tt class="literal">setRollbackOnly()</tt> &#26041;&#27861;&#26469;&#22238;&#28378;&#20107;&#21153;&#12290;</p><pre class="programlisting">transactionTemplate.execute(new TransactionCallbackWithoutResult() {

  protected void doInTransactionWithoutResult(TransactionStatus status) {
    try {
      updateOperation1();
      updateOperation2();
    } catch (SomeBusinessExeption ex) {
      <span class="bold"><b>status.setRollbackOnly();</b></span>
    }
  }
});</pre><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="tx-prog-template-settings"></a>9.6.1.1.&nbsp;&#25351;&#23450;&#20107;&#21153;&#35774;&#32622;</h4></div></div><div></div></div><p>&#35832;&#22914;&#20256;&#25773;&#27169;&#24335;&#12289;&#38548;&#31163;&#31561;&#32423;&#12289;&#36229;&#26102;&#31561;&#31561;&#30340;&#20107;&#21153;&#35774;&#32622;&#37117;&#21487;&#20197;&#22312;<tt class="classname">TransactionTemplate</tt>&#20013;&#25110;&#32773;&#36890;&#36807;&#37197;&#32622;&#25110;&#32773;&#32534;&#31243;&#24335;&#22320;&#23454;&#29616;&#12290;
				<tt class="classname">TransactionTemplate</tt>&#23454;&#20363;&#40664;&#35748;&#32487;&#25215;&#20102;<a href="transaction.html#transaction-declarative-txadvice-settings" title="9.5.5.&nbsp;<tx:advice/&gt; &#26377;&#20851;&#30340;&#35774;&#32622;">&#40664;&#35748;&#20107;&#21153;&#35774;&#32622;</a>&#12290;
				&#19979;&#38754;&#26377;&#20010;&#32534;&#31243;&#24335;&#30340;&#20026;&#19968;&#20010;&#29305;&#23450;&#30340;<tt class="classname">TransactionTemplate</tt>&#23450;&#21046;&#20107;&#21153;&#35774;&#32622;&#30340;&#20363;&#23376;&#12290;
				</p><pre class="programlisting">public class SimpleService implements Service {

  private final TransactionTemplate transactionTemplate;

  public SimpleService(PlatformTransactionManager transactionManager) {
    Assert.notNull(transactionManager, "The 'transactionManager' argument must not be null.");
    this.transactionTemplate = new TransactionTemplate(transactionManager);

    <i class="lineannotation"><span class="lineannotation">// the transaction settings can be set here explicitly if so desired</span></i>
    this.transactionTemplate.setIsolationLevel(TransactionDefinition.ISOLATION_READ_UNCOMMITTED);
    this.transactionTemplate.setTimeout(30); <i class="lineannotation"><span class="lineannotation">// 30 seconds</span></i>
    <i class="lineannotation"><span class="lineannotation">// and so forth...</span></i>
  }
}</pre><p>&#22312;&#19979;&#38754;&#30340;&#20363;&#23376;&#20013;&#65292;&#25105;&#20204;&#23558;&#20250;&#28436;&#31034;&#22914;&#20309;&#20351;&#29992;Spring XML&#37197;&#32622;&#26469;&#23450;&#21046;<tt class="classname">TransactionTemplate</tt>&#30340;&#20107;&#21153;&#23646;&#24615;&#12290;
				'<tt class="literal">sharedTransactionTemplate</tt>'&#21487;&#20197;&#34987;&#27880;&#20837;&#21040;&#25152;&#26377;&#38656;&#35201;&#30340;&#26381;&#21153;&#20013;&#21435;&#12290; </p><pre class="programlisting">&lt;bean id="sharedTransactionTemplate"
    class="org.springframework.transaction.support.TransactionTemplate"&gt;
  &lt;property name="isolationLevelName" value="ISOLATION_READ_UNCOMMITTED"/&gt;
  &lt;property name="timeout" value="30"/&gt;
&lt;/bean&gt;"</pre></div><p>
			&#26368;&#21518;&#65292;<tt class="classname">TransactionTemplate</tt> &#31867;&#30340;&#23454;&#20363;&#26159;&#32447;&#31243;&#23433;&#20840;&#30340;&#65292;&#20219;&#20309;&#29366;&#24577;&#37117;&#19981;&#20250;&#34987;&#20445;&#23384;&#12290;
			<tt class="classname">TransactionTemplate</tt> &#23454;&#20363; <span class="emphasis"><em>&#30340;&#30830;&#20250;</em></span>
			&#32500;&#25252;&#37197;&#32622;&#29366;&#24577;&#65292;&#25152;&#20197;&#24403;&#19968;&#20123;&#31867;&#36873;&#25321;&#20849;&#20139;&#19968;&#20010;&#21333;&#29420;&#30340; <tt class="classname">TransactionTemplate</tt>&#23454;&#20363;&#26102;&#65292;
			&#22914;&#26524;&#19968;&#20010;&#31867;&#38656;&#35201;&#20351;&#29992;&#19981;&#21516;&#37197;&#32622;&#30340;<tt class="classname">TransactionTemplate</tt>(&#27604;&#22914;&#65292;&#19981;&#21516;&#30340;&#38548;&#31163;&#31561;&#32423;)&#65292;
			&#37027;&#23601;&#38656;&#35201;&#21019;&#24314;&#21644;&#20351;&#29992;&#20004;&#20010;&#19981;&#21516;&#30340;<tt class="classname">TransactionTemplate</tt>&#12290;
			</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-programmatic-ptm"></a>9.6.2.&nbsp;&#20351;&#29992;<tt class="interfacename">PlatformTransactionManager</tt></h3></div></div><div></div></div><p>&#20320;&#20063;&#21487;&#20197;&#20351;&#29992; <tt class="interfacename">org.springframework.transaction.PlatformTransactionManager</tt>
			&#26469;&#30452;&#25509;&#31649;&#29702;&#20320;&#30340;&#20107;&#21153;&#12290;&#21482;&#38656;&#36890;&#36807;bean&#30340;&#24341;&#29992;&#65292;&#31616;&#21333;&#30340;&#25226;&#20320;&#22312;&#20351;&#29992;&#30340;<tt class="interfacename">PlatformTransactionManager</tt> &#20256;&#36882;&#32473;&#20320;&#30340;bean&#12290;
	  		&#28982;&#21518;&#65292;&#20351;&#29992;<tt class="interfacename">TransactionDefinition</tt>&#21644;<tt class="interfacename">TransactionStatus</tt>&#23545;&#35937;&#65292;
	  		&#20320;&#21487;&#20197;&#21551;&#21160;&#65292;&#22238;&#28378;&#21644;&#25552;&#20132;&#20107;&#21153;&#12290;</p><pre class="programlisting">DefaultTransactionDefinition def = new DefaultTransactionDefinition();
<i class="lineannotation"><span class="lineannotation">// explicitly setting the transaction name is something that can only be done programmatically</span></i>
def.setName("SomeTxName");
def.setPropagationBehavior(TransactionDefinition.PROPAGATION_REQUIRED);

TransactionStatus status = txManager.getTransaction(def);
try {
  <i class="lineannotation"><span class="lineannotation">// execute your business logic here</span></i>
}
catch (MyException ex) {
  txManager.rollback(status);
  throw ex;
}
txManager.commit(status);</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tx-decl-vs-prog"></a>9.7.&nbsp;&#36873;&#25321;&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;&#36824;&#26159;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;</h2></div></div><div></div></div><p>&#24403;&#20320;&#21482;&#26377;&#24456;&#23569;&#30340;&#20107;&#21153;&#25805;&#20316;&#26102;&#65292;&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;&#36890;&#24120;&#27604;&#36739;&#21512;&#36866;&#12290;&#20363;&#22914;&#65292;&#22914;&#26524;&#20320;&#26377;&#19968;&#20010;Web&#24212;&#29992;&#65292;&#20854;&#20013;&#21482;&#26377;&#29305;&#23450;&#30340;&#26356;&#26032;&#25805;&#20316;&#26377;&#20107;&#21153;&#35201;&#27714;&#65292;
	&#20320;&#21487;&#33021;&#19981;&#24895;&#20351;&#29992;Spring&#25110;&#20854;&#20182;&#25216;&#26415;&#35774;&#32622;&#20107;&#21153;&#20195;&#29702;&#12290;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#20351;&#29992; <tt class="classname">TransactionTemplate</tt> <span class="emphasis"><em>&#21487;&#33021;</em></span> &#26159;&#20010;&#22909;&#21150;&#27861;&#12290;
	&#21482;&#26377;&#32534;&#31243;&#24335;&#20107;&#21153;&#31649;&#29702;&#25165;&#33021;&#26174;&#24335;&#30340;&#35774;&#32622;&#20107;&#21153;&#21517;&#31216;&#12290;
	</p><p>&#21478;&#19968;&#26041;&#38754;&#65292;&#22914;&#26524;&#20320;&#30340;&#24212;&#29992;&#20013;&#23384;&#22312;&#22823;&#37327;&#20107;&#21153;&#25805;&#20316;&#65292;&#37027;&#20040;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#36890;&#24120;&#26159;&#20540;&#24471;&#30340;&#12290;&#23427;&#23558;&#20107;&#21153;&#31649;&#29702;&#19982;&#19994;&#21153;&#36923;&#36753;&#20998;&#31163;&#65292;
	&#32780;&#19988;&#22312;Spring&#20013;&#37197;&#32622;&#20063;&#19981;&#38590;&#12290;&#20351;&#29992;Spring&#65292;&#32780;&#19981;&#26159;EJB CMT&#65292;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#22312;&#37197;&#32622;&#19978;&#30340;&#25104;&#26412;&#26497;&#22823;&#22320;&#38477;&#20302;&#20102;&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-application-server-integration"></a>9.8.&nbsp;&#19982;&#29305;&#23450;&#24212;&#29992;&#26381;&#21153;&#22120;&#38598;&#25104;</h2></div></div><div></div></div><p>&#19968;&#33324;&#26469;&#35828;&#65292;Spring&#30340;&#20107;&#21153;&#25277;&#35937;&#19982;&#24212;&#29992;&#26381;&#21153;&#22120;&#26159;&#26080;&#20851;&#30340;&#12290;&#27492;&#22806;&#65292;&#20351;&#29992;Spring&#30340; <tt class="classname">JtaTransactionManager</tt> &#31867;&#26102;&#65292;
	&#19968;&#31181;&#21487;&#36873;&#30340;&#26041;&#24335;&#26159;&#36890;&#36807;JNDI&#26597;&#35810;&#33719;&#24471;JTA <tt class="interfacename">UserTransaction</tt> &#21644; <tt class="interfacename">TransactionManager</tt> &#23545;&#35937;&#65292;
	&#20854;&#20013;&#21518;&#32773;&#21487;&#20197;&#34987;&#35774;&#32622;&#20026;&#33258;&#21160;&#25506;&#27979;&#65292;&#36825;&#26102;&#38024;&#23545;&#19981;&#21516;&#30340;&#24212;&#29992;&#26381;&#21153;&#22120;&#26377;&#19981;&#21516;&#30340;&#26041;&#24335;&#12290;&#33021;&#22815;&#30452;&#25509;&#35775;&#38382; <tt class="interfacename">TransactionManager</tt>&#65292;
	&#30830;&#23454;&#22312;&#24456;&#22823;&#31243;&#24230;&#19978;&#22686;&#24378;&#20102;&#20107;&#21153;&#35821;&#20041;&#65292;&#21487;&#20197;&#21442;&#32771; <tt class="classname">JtaTransactionManager</tt> &#31867;&#30340;javadoc&#33719;&#24471;&#26356;&#22810;&#32454;&#33410;&#12290;</p><p>&#24403;&#22312;J2EE&#24212;&#29992;&#26381;&#21153;&#22120;&#19978;&#36816;&#34892;&#26102;&#65292;Spring&#30340;<tt class="classname">JtaTransactionManager</tt>&#26159;&#19968;&#20010;&#26631;&#20934;&#30340;&#36873;&#25321;&#65292;&#23427;&#22312;&#24050;&#30693;&#30340;&#25152;&#26377;&#36890;&#29992;&#26381;&#21153;&#22120;&#19978;&#37117;&#33021;&#27491;&#24120;&#24037;&#20316;&#12290;
	&#23427;&#30340;&#19968;&#20123;&#35832;&#22914;&#20107;&#21153;&#25346;&#36215;&#31561;&#39640;&#32423;&#21151;&#33021;&#20063;&#21487;&#20197;&#22312;&#26080;&#39035;&#29305;&#27530;&#37197;&#32622;&#30340;&#24773;&#20917;&#19979;&#22312;&#24050;&#30693;&#30340;&#35768;&#22810;&#26381;&#21153;&#22120;&#19978;&#24037;&#20316;&#65288;&#21253;&#25324; GlassFish&#12289;JBoss&#12289;Geronimo&#21644;Oracle OC4J&#65289;&#65292;
	&#28982;&#32780;&#65292;&#20026;&#20102;&#23436;&#20840;&#25903;&#25345;&#20107;&#21153;&#25346;&#36215;&#31561;&#39640;&#32423;&#21151;&#33021;&#65292;Spring&#20026;IBM WebSphere &#12289;BEA WebLogic&#20197;&#21450;Oracle OC4J&#25552;&#20379;&#20102;&#29305;&#27530;&#25903;&#25345;&#12290;&#25105;&#20204;&#20250;&#22312;&#21518;&#38754;&#30340;&#31456;&#33410;&#20013;&#35752;&#35770;&#36825;&#20010;&#35805;&#39064;.</p><p><span class="emphasis"><em>&#22312;&#26631;&#20934;&#30340;&#22330;&#26223;&#20013;&#65292;&#21253;&#25324; WebLogic&#12289;WebSphere&#21644;OC4J&#65292;&#35831;&#32771;&#34385;&#31616;&#21333;&#30340;&#20351;&#29992;<tt class="literal">'&lt;tx:jta-transaction-manager/&gt;'</tt>&#37197;&#32622;&#20803;&#32032;&#12290;
    </em></span> &#23427;&#20250;&#33258;&#21160;&#26816;&#27979;&#24213;&#23618;&#25152;&#20351;&#29992;&#30340;&#26381;&#21153;&#22120;&#20197;&#27492;&#26469;&#36873;&#25321;&#26368;&#21512;&#36866;&#30340;&#20107;&#21153;&#31649;&#29702;&#22120;&#12290; 
	&#36825;&#24847;&#21619;&#30528;&#20320;&#19981;&#38656;&#35201;&#26174;&#24335;&#30340;&#20026;&#26381;&#21153;&#22120;&#37197;&#32622;&#29305;&#27530;&#30340;&#36866;&#37197;&#22120;&#65288;&#23601;&#20687;&#22312;&#21518;&#38754;&#30340;&#37096;&#20998;&#35752;&#35770;&#30340;&#37027;&#26679;&#65289;&#65292;&#36873;&#25321;&#20250;&#33258;&#21160;&#23436;&#25104;&#65292;
	&#24182;&#19988;&#22914;&#26524;&#25214;&#19981;&#21040;&#30340;&#35805;&#20250;&#21551;&#29992;&#26631;&#20934;&#30340; <tt class="classname">JtaTransactionManager</tt>&#26469;&#31649;&#29702;&#12290;
	 </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-application-server-integration-websphere"></a>9.8.1.&nbsp;IBM WebSphere</h3></div></div><div></div></div><p>&#22312;WebSphere 6.0&#20197;&#21450;&#21518;&#32493;&#29256;&#26412;&#20013;&#65292;&#25512;&#33616;&#20351;&#29992;&#30340;Spring JTA &#20107;&#21153;&#31649;&#29702;&#22120;&#26159;<tt class="classname">WebSphereUowTransactionManager</tt>&#12290;
	  &#36825;&#20010;&#36866;&#37197;&#22120;&#20805;&#20998;&#21033;&#29992;&#20102;WebSphere&#24212;&#29992;&#26381;&#21153;&#22120; &#65288;6.0.2.19 &#20197;&#21450;&#26356;&#39640;&#30340;&#29256;&#26412;&#21644;6.1.0.9&#20197;&#21450;&#26356;&#39640;&#30340;&#29256;&#26412;&#65289;&#20013;&#25552;&#20379;&#30340; <tt class="interfacename">UOWManager</tt> API&#12290;
	  &#36890;&#36807;&#20351;&#29992;&#36825;&#20010;&#36866;&#37197;&#22120;&#65292;Spring&#39537;&#21160;&#30340;&#20107;&#21153;&#25346;&#36215;&#65288;<tt class="literal">PROPAGATION_REQUIRES_NEW</tt>&#21457;&#36215;&#30340;&#25346;&#36215;/&#24674;&#22797;&#65289;&#24471;&#21040;&#20102;IBM&#30340;&#23448;&#26041;&#25903;&#25345;&#12290;
	  </p><p>&#22312;WebSphere 5.1&#29615;&#22659;&#19979;&#65292;&#20320;&#21487;&#20197;&#20351;&#29992;Spring&#30340; <tt class="classname">WebSphereTransactionManagerFactoryBean</tt> &#31867;&#12290; 
	  &#36825;&#26159;&#19968;&#20010;&#24037;&#21378;&#31867;&#65292;&#36890;&#36807;WebSphere&#30340; <tt class="literal">&#38745;&#24577;</tt> &#35775;&#38382;&#26041;&#27861;&#33719;&#21462;&#21040;JTA <tt class="literal">TransactionManager</tt> &#23454;&#20363;&#12290;
	  &#19968;&#26086;&#36890;&#36807;&#24037;&#21378;bean&#33719;&#21462;&#21040;JTA <tt class="interfacename">TransactionManager</tt> &#23454;&#20363;&#65292;
	  &#23601;&#21487;&#20197;&#20351;&#29992;&#35813;&#23454;&#20363;&#35013;&#37197;&#19968;&#20010;Spring&#30340; <tt class="classname">JtaTransactionManager</tt> bean&#65292;
	  &#23427;&#23553;&#35013;&#20102;JTA <tt class="interfacename">UserTransaction</tt>&#65292;&#25552;&#20379;&#22686;&#24378;&#30340;&#20107;&#21153;&#35821;&#20041;&#12290;&#35831;&#21442;&#32771;&#30456;&#20851;javadoc&#20197;&#33719;&#24471;&#23436;&#25972;&#20449;&#24687;&#12290;</p><p><span class="emphasis"><em>&#35831;&#27880;&#24847;<tt class="classname">WebSphereTransactionManagerFactoryBean</tt>&#34429;&#28982;&#21487;&#20197;&#22312;WAS 5.1&#21644;6.0&#19978;&#27491;&#24120;&#24037;&#20316;&#65292;&#20294;&#26159;&#24182;&#27809;&#26377;&#24471;&#21040;&#23448;&#26041;&#30340;&#27491;&#24335;&#25903;&#25345;&#12290;
	 </em></span> &#22914;&#26524;&#38656;&#35201;&#36816;&#34892;&#22312;WAS6.0&#25110;&#32773;&#26356;&#39640;&#30340;&#29256;&#26412;&#19978;&#65292;&#35831;&#21442;&#32771;&#19978;&#38754;&#30340;<tt class="classname">WebSphereUowTransactionManager</tt>&#37096;&#20998;&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-application-server-integration-weblogic"></a>9.8.2.&nbsp;BEA WebLogic</h3></div></div><div></div></div><p>&#22312;&#19968;&#20010;&#20351;&#29992;WebLogic 8.1&#25110;&#26356;&#39640;&#29256;&#26412;&#30340;&#29615;&#22659;&#20013;&#65292;&#20320;&#19968;&#33324;&#20250;&#20248;&#20808;&#36873;&#29992;&#29305;&#23450;&#20110;WebLogic&#30340; <tt class="classname">WebLogicJtaTransactionManager</tt> &#31867;&#12290; 
		&#26469;&#21462;&#20195;<tt class="classname">JtaTransactionManager</tt> &#31867;&#12290;&#22312;WebLogic&#29615;&#22659;&#20013;&#65292;&#35813;&#31867;&#25552;&#20379;&#20102;&#23545;Spring&#20107;&#21153;&#23450;&#20041;&#30340;&#23436;&#20840;&#25903;&#25345;&#65292;&#36229;&#36807;&#20102;&#26631;&#20934;&#30340;JTA&#35821;&#20041;&#12290;
		&#23427;&#30340;&#29305;&#24615;&#21253;&#25324;&#65306;&#25903;&#25345;&#20107;&#21153;&#21517;&#65292;&#25903;&#25345;&#20026;&#27599;&#20010;&#20107;&#21153;&#23450;&#20041;&#38548;&#31163;&#32423;&#21035;&#65292;&#20197;&#21450;&#22312;&#20219;&#20309;&#29615;&#22659;&#19979;&#27491;&#30830;&#22320;&#24674;&#22797;&#20107;&#21153;&#30340;&#33021;&#21147;&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-application-server-integration-oc4j"></a>9.8.3.&nbsp;Oracle OC4J</h3></div></div><div></div></div><p>Spring&#20026;OC4J 10.1.3&#20197;&#21450;&#26356;&#39640;&#30340;&#29256;&#26412;&#25552;&#20379;&#20102;&#19968;&#20010;&#29305;&#27530;&#30340;&#36866;&#37197;&#22120;&#65306;
	  <tt class="classname">OC4JJtaTransactionManager</tt>&#12290;&#36825;&#20010;&#36866;&#37197;&#22120;&#36319;&#21069;&#38754;&#30340;<tt class="classname">WebLogicJtaTransactionManager</tt>&#24456;&#31867;&#20284;&#65292;
	  &#22312;OC4J&#19978;&#25552;&#20379;&#31867;&#20284;&#30340;&#36741;&#21161;&#21151;&#33021;&#65306;&#20107;&#21153;&#21517;&#31216;&#21644;&#38024;&#23545;&#27599;&#20010;&#20107;&#21153;&#19981;&#21516;&#30340;&#29420;&#31435;&#31561;&#32423;&#12290; </p><p>&#35831;&#27880;&#24847;&#25152;&#26377;&#30340; JTA &#21151;&#33021;&#65292;&#21253;&#25324;&#20107;&#21153;&#25346;&#36215;&#65292;&#37117;&#21487;&#20197;&#24456;&#22909;&#30340;&#36890;&#36807;Spring&#30340; <tt class="classname">JtaTransactionManager</tt>&#22312; OC4J &#24037;&#20316;&#12290;
	  &#29305;&#27530;&#30340;<tt class="classname">OC4JJtaTransactionManager</tt>&#25552;&#20379;&#20102;&#27604;&#26631;&#20934;JTA&#26356;&#22810;&#30340;&#36229;&#20540;&#21151;&#33021;&#12290; </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-solutions-to-common-problems"></a>9.9.&nbsp;&#24120;&#35265;&#38382;&#39064;&#30340;&#35299;&#20915;&#26041;&#27861;</h2></div></div><div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transaction-solutions-to-common-problems-wrong-ptm"></a>9.9.1.&nbsp;&#23545;&#19968;&#20010;&#29305;&#23450;&#30340; <tt class="interfacename">DataSource</tt> &#20351;&#29992;&#20102;&#38169;&#35823;&#30340;&#20107;&#21153;&#31649;&#29702;&#22120;</h3></div></div><div></div></div><p>&#20320;&#38656;&#35201;&#25353;&#29031;&#38656;&#27714;&#20180;&#32454;&#22320;&#36873;&#25321; <span class="emphasis"><em>&#27491;&#30830;&#30340;</em></span><tt class="interfacename">PlatformTransactionManager</tt> &#23454;&#29616;&#12290;
		&#21482;&#35201;&#20351;&#29992;&#24471;&#24403;&#23601;&#21487;&#20197;&#24471;&#21040;&#19968;&#20010;Spring&#25552;&#20379;&#30340;&#30452;&#35266;&#30340;&#12289;&#21487;&#31227;&#26893;&#30340;&#25277;&#35937;&#23618;&#12290;&#22914;&#26524;&#20320;&#20351;&#29992;&#20840;&#23616;&#20107;&#21153;&#65292;
		&#20320;<span class="emphasis"><em>&#24517;&#39035;</em></span>&#20026;&#25152;&#26377;&#20107;&#21153;&#25805;&#20316;&#20351;&#29992;Spring&#30340;<tt class="classname">org.springframework.transaction.jta.JtaTransactionManager</tt>&#31867;
	   &#65288;&#25110; <a href="transaction.html#transaction-application-server-integration" title="9.8.&nbsp;&#19982;&#29305;&#23450;&#24212;&#29992;&#26381;&#21153;&#22120;&#38598;&#25104;">&#29305;&#23450;&#20110;&#26576;&#31181;&#24212;&#29992;&#26381;&#21153;&#22120;&#30340;&#23376;&#31867;</a>&#65289;&#12290;
	   &#21542;&#21017;Spring&#23558;&#35797;&#22270;&#22312;&#20687;&#23481;&#22120;&#25968;&#25454;&#28304;&#36825;&#26679;&#30340;&#36164;&#28304;&#19978;&#25191;&#34892;&#23616;&#37096;&#20107;&#21153;&#12290;&#36825;&#26679;&#30340;&#23616;&#37096;&#20107;&#21153;&#27809;&#26377;&#20219;&#20309;&#24847;&#20041;&#65292;&#20248;&#31168;&#30340;&#24212;&#29992;&#26381;&#21153;&#22120;&#20250;&#25226;&#36825;&#20123;&#24773;&#20917;&#35270;&#20026;&#38169;&#35823;&#12290;<tt class="literal"></tt>
	   </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transaction-resources"></a>9.10.&nbsp;&#26356;&#22810;&#30340;&#36164;&#28304;</h2></div></div><div></div></div><p>&#20174;&#19979;&#38754;&#30340;&#38142;&#25509;&#20013;&#20320;&#21487;&#20197;&#25214;&#21040;&#26356;&#22810;&#20851;&#20110;Spring&#26694;&#26550;&#20107;&#21153;&#25903;&#25345;&#26041;&#38754;&#30340;&#36164;&#28304;</p><div class="itemizedlist"><ul type="disc"><li><p>&#26469;&#33258; <a href="http://www.infoq.com/" target="_top">InfoQ</a> &#30340; <a href="http://www.infoq.com/minibooks/JTDS" target="_top">
				Java&#20107;&#21153;&#35774;&#35745;&#31574;&#30053;&#65288;Java Transaction Design Strategies&#65289;</a> &#26159;&#19968;&#26412;&#20171;&#32461;Java&#20107;&#21153;&#26041;&#38754;&#30456;&#24403;&#22909;&#30340;&#20070;&#12290;
				&#21516;&#26102;&#23427;&#20063;&#21253;&#21547;&#20102;&#22914;&#20309;&#22312;Spring&#26694;&#26550;&#21644;EJB3&#20013;&#37197;&#32622;&#19982;&#20351;&#29992;&#20107;&#21153;&#30340;&#23545;&#27604;&#31034;&#20363;&#12290;</p></li></ul></div></div></div><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="spring-middle-tier.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="dao.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Part&nbsp;II.&nbsp;&#20013;&#38388;&#23618;&#25968;&#25454;&#35775;&#38382;&nbsp;</td><td width="20%" align="center"><span style="color:white;font-size:90%;"><a href="http://www.springsource.com/" title="SpringSource">Sponsored by SpringSource</a></span></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;10.&nbsp;DAO&#25903;&#25345;</td></tr></table></div></body></html>