<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;12.&nbsp;&#20351;&#29992;ORM&#24037;&#20855;&#36827;&#34892;&#25968;&#25454;&#35775;&#38382;</title><link rel="stylesheet" href="html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.60.1"><link rel="home" href="index.html" title="Spring Framework &#24320;&#21457;&#21442;&#32771;&#25163;&#20876;"><link rel="up" href="spring-middle-tier.html" title="Part&nbsp;II.&nbsp;&#20013;&#38388;&#23618;&#25968;&#25454;&#35775;&#38382;"><link rel="previous" href="jdbc.html" title="Chapter&nbsp;11.&nbsp;&#20351;&#29992;JDBC&#36827;&#34892;&#25968;&#25454;&#35775;&#38382;"><link rel="next" href="spring-web.html" title="Part&nbsp;III.&nbsp;The Web"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div xmlns="http://www.w3.org/TR/xhtml1/transitional" style="background-color:white;border:none;height:73px;border:1px solid black;"><a style="border:none;" href="http://www.springframework.org/" title="The Spring Framework"><img style="border:none;" src="images/xdev-spring_logo.jpg"></a><a style="border:none;" href="http://www.springsource.com/" title="SpringSource"><img style="border:none;position:absolute;padding-top:5px;right:42px;" src="images/springsource-banner-rhs.png"></a></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="orm"></a>Chapter&nbsp;12.&nbsp;&#20351;&#29992;ORM&#24037;&#20855;&#36827;&#34892;&#25968;&#25454;&#35775;&#38382;</h2></div></div><div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="orm-introduction"></a>12.1.&nbsp;&#31616;&#20171;</h2></div></div><div></div></div><p>Spring Framework&#22312;&#36164;&#28304;&#31649;&#29702;&#65292;DAO&#23454;&#29616;&#25903;&#25345;&#20197;&#21450;&#20107;&#21153;&#31574;&#30053;&#31561;&#26041;&#38754;&#25552;&#20379;&#20102;&#19982; <span class="emphasis"><em>Hibernate&#12289;JDO&#12289;Oracle TopLink&#12289;iBATIS SQL Mappings</em></span> &#20197;&#21450; <span class="emphasis"><em>JPA</em></span> &#30340;&#38598;&#25104;&#12290;
&#20197;Hibernate&#20026;&#20363;&#65292;Spring&#36890;&#36807;&#20351;&#29992;&#35768;&#22810;IoC&#30340;&#20415;&#25463;&#29305;&#24615;&#23545;&#23427;&#25552;&#20379;&#20102;&#19968;&#27969;&#30340;&#25903;&#25345;&#65292;&#24110;&#21161;&#20320;&#22788;&#29702;&#24456;&#22810;&#20856;&#22411;&#30340;Hibernate&#25972;&#21512;&#30340;&#38382;&#39064;&#12290;
&#25152;&#26377;&#29992;&#20110;&#25903;&#25345;O/R&#65288;&#23545;&#35937;&#20851;&#31995;&#65289;&#26144;&#23556;&#30340;&#21253;&#65292;&#37117;&#36981;&#24490;Spring&#36890;&#29992;&#30340;&#20107;&#21153;&#21644;DAO&#24322;&#24120;&#20307;&#31995;&#12290;&#36890;&#24120;&#26469;&#35828;&#26377;&#20004;&#31181;&#19981;&#21516;&#30340;&#25972;&#21512;&#39118;&#26684;&#65306;&#20320;&#21487;&#20197;&#20351;&#29992;Spring&#25552;&#20379;&#30340;DAO&#27169;&#26495;&#65292;&#25110;&#32773;&#30452;&#25509;&#20351;&#29992;Hibernate/JDO/TopLink&#31561;&#24037;&#20855;&#30340;&#21407;&#29983;API&#32534;&#20889;DAO&#12290;
&#26080;&#35770;&#37319;&#21462;&#21738;&#31181;&#39118;&#26684;&#65292;&#36825;&#20123;DAO&#37117;&#21487;&#20197;&#36890;&#36807;IoC&#36827;&#34892;&#37197;&#32622;&#65292;&#24182;&#21442;&#19982;&#21040;Spring&#30340;&#36164;&#28304;&#21644;&#20107;&#21153;&#31649;&#29702;&#20013;&#21435;&#12290;</p><p>&#24403;&#29992;&#25143;&#36873;&#25321;O/R Mapping&#26469;&#21019;&#24314;&#25968;&#25454;&#35775;&#38382;&#30340;&#24212;&#29992;&#26102;&#65292;Spring&#25552;&#20379;&#20102;&#24378;&#22823;&#30340;&#25903;&#25345;&#12290;
&#39318;&#20808;&#24212;&#35813;&#20102;&#35299;&#30340;&#26159;&#65292;&#19968;&#26086;&#20351;&#29992;&#20102;Spring&#23545;O/R Mapping&#30340;&#25903;&#25345;&#65292;&#20320;&#19981;&#38656;&#35201;&#20146;&#33258;&#20570;&#25152;&#26377;&#30340;&#20107;&#24773;&#12290;
&#26080;&#35770;&#22914;&#20309;&#65292;&#22312;&#20915;&#23450;&#33457;&#36153;&#21147;&#27668;&#24182;&#20882;&#30528;&#39118;&#38505;&#21435;&#26500;&#36896;&#31867;&#20284;&#30340;&#20869;&#37096;&#24213;&#23618;&#26550;&#26500;&#20043;&#21069;&#65292;&#25105;&#20204;&#37117;&#24314;&#35758;&#20320;&#32771;&#34385;&#21644;&#20351;&#29992;Spring&#30340;&#35299;&#20915;&#26041;&#26696;&#12290;
&#26080;&#35770;&#24744;&#37319;&#29992;&#20309;&#31181;&#25216;&#26415;&#65292;Spring&#23545;&#22823;&#37096;&#20998;O/R Mapping&#30340;&#25903;&#25345;&#37117;&#21487;&#20197;&#20197;library&#30340;&#24418;&#24335;&#34987;&#35843;&#29992;&#65292;&#22240;&#20026;&#25152;&#26377;&#30340;&#20869;&#23481;&#37117;&#34987;&#35774;&#35745;&#25104;&#19968;&#32452;&#21487;&#37325;&#29992;&#30340;JavaBeans&#12290;
&#22312;Spring&#30340;IoC&#23481;&#22120;&#20013;&#20351;&#29992;&#36825;&#20123;&#31867;&#65292;&#26356;&#26159;&#26377;&#30528;&#37197;&#32622;&#21644;&#37096;&#32626;&#31616;&#21333;&#30340;&#22909;&#22788;&#12290;
&#22240;&#32780;&#65292;&#22312;&#36825;&#19968;&#31456;&#20013;&#20320;&#30475;&#21040;&#30340;&#22823;&#22810;&#25968;&#20363;&#23376;&#37117;&#26159;&#22312;Spring&#23481;&#22120;&#20013;&#36827;&#34892;&#30340;&#37197;&#32622;&#12290;</p><p>&#20351;&#29992;Spring Framework&#26500;&#24314;&#20320;&#30340;O/R Mapping DAO&#30340;&#22909;&#22788;&#21253;&#25324;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>&#20415;&#20110;&#27979;&#35797;&#12290;</em></span> Spring&#30340;IoC&#26041;&#24335;&#20351;&#24471;&#26367;&#25442;&#19981;&#21516;&#30340;&#23454;&#29616;&#21644;&#37197;&#32622;&#21464;&#24471;&#38750;&#24120;&#31616;&#21333;&#65292;
&#36825;&#20123;&#20869;&#23481;&#21253;&#25324;&#65306;Hibernate <tt class="interfacename">SessionFactory</tt> &#23454;&#20363;&#30340;&#20301;&#32622;&#65292;JDBC <tt class="interfacename">DataSource</tt>&#23454;&#20363;&#65292;&#20107;&#21153;&#31649;&#29702;&#22120;&#20197;&#21450;&#26144;&#23556;&#23545;&#35937;&#30340;&#23454;&#29616;&#65288;&#22914;&#26524;&#38656;&#35201;&#65289;&#31561;&#12290;&#36825;&#26679;&#20063;&#23601;&#24456;&#23481;&#26131;&#38548;&#31163;&#24182;&#27979;&#35797;&#25345;&#20037;&#21270;&#30456;&#20851;&#30340;&#20195;&#30721;&#30340;&#21508;&#20010;&#37096;&#20998;&#12290;
        </p></li><li><p><span class="emphasis"><em>&#36890;&#29992;&#25968;&#25454;&#35775;&#38382;&#24322;&#24120;&#23553;&#35013;&#12290;</em></span> Spring&#33021;&#22815;&#23553;&#35013;&#20320;&#25152;&#36873;&#25321;&#30340;O/R Mapping&#24037;&#20855;&#25152;&#25243;&#20986;&#30340;&#24322;&#24120;&#65292;
&#23558;&#23427;&#20204;&#20174;&#19987;&#26377;&#30340;&#65288;&#28508;&#22312;&#30340;checked&#65289;&#24322;&#24120;&#36716;&#21270;&#20026;&#19968;&#32452;&#25277;&#35937;&#30340;runtime DataAccessException&#20307;&#31995;&#12290;
&#36825;&#21487;&#20197;&#20351;&#20320;&#20165;&#38656;&#35201;&#22312;&#24688;&#24403;&#30340;&#24212;&#29992;&#31243;&#24207;&#23618;&#27425;&#21435;&#22788;&#29702;&#22823;&#37096;&#20998;&#19981;&#21487;&#24674;&#22797;&#30340;&#25345;&#20037;&#23618;&#24322;&#24120;&#65292;&#20174;&#32780;&#36991;&#20813;&#20102;&#24456;&#22810;&#20196;&#20154;&#35752;&#21388;&#30340;catch/throw&#20197;&#21450;&#24322;&#24120;&#22768;&#26126;&#12290;
&#24403;&#28982;&#65292;&#20320;&#36824;&#26159;&#21487;&#20197;&#22312;&#20320;&#38656;&#35201;&#30340;&#22320;&#26041;&#25429;&#25417;&#21644;&#22788;&#29702;&#24322;&#24120;&#12290;&#22238;&#24819;&#19968;&#19979;JDBC&#24322;&#24120;&#65288;&#21253;&#25324;&#19982;DB&#30456;&#20851;&#30340;Dialect&#65289;&#34987;&#36716;&#21464;&#20026;&#21516;&#26679;&#30340;&#24322;&#24120;&#20307;&#31995;&#65292;&#36825;&#23601;&#24847;&#21619;&#30528;&#20320;&#21487;&#20197;&#22312;&#19968;&#33268;&#30340;&#32534;&#31243;&#27169;&#22411;&#20013;&#22788;&#29702;JDBC&#25805;&#20316;&#12290;</p></li><li><p><span class="emphasis"><em>&#36890;&#29992;&#30340;&#36164;&#28304;&#31649;&#29702;&#12290;</em></span> Spring&#30340;application context&#33021;&#22815;&#22788;&#29702;&#35832;&#22914;Hibernate&#30340; <tt class="interfacename">SessionFactory</tt>&#23454;&#20363;&#65292;
JDBC&#30340; <tt class="interfacename">DataSource</tt>&#23454;&#20363;&#65292;iBATIS&#30340;SQL Maps&#37197;&#32622;&#23545;&#35937;&#20197;&#21450;&#20854;&#20182;&#30456;&#20851;&#36164;&#28304;&#30340;&#23450;&#20301;&#21644;&#37197;&#32622;&#12290;
&#36825;&#26679;&#65292;&#36825;&#20123;&#37197;&#32622;&#30340;&#20540;&#24456;&#23481;&#26131;&#34987;&#31649;&#29702;&#21644;&#20462;&#25913;&#12290;Spring&#25552;&#20379;&#20102;&#31616;&#21333;&#12289;&#39640;&#25928;&#12289;&#23433;&#20840;&#30340;&#23545;&#25345;&#20037;&#23618;&#36164;&#28304;&#30340;&#22788;&#29702;&#12290;
&#20197;Hibernate&#20026;&#20363;&#65292;&#36890;&#24120;&#22312;&#20351;&#29992;Hibernate&#26102;&#65292;&#38656;&#35201;&#20351;&#29992;&#21516;&#19968;&#20010;Hibernate <tt class="interfacename">Session</tt> &#23454;&#20363;&#20197;&#30830;&#20445;&#39640;&#25928;&#21644;&#24688;&#24403;&#22320;&#20107;&#21153;&#22788;&#29702;&#12290;
Spring&#35753;&#25105;&#20204;&#33021;&#22815;&#24456;&#23481;&#26131;&#36879;&#26126;&#22320;&#21019;&#24314;&#24182;&#32465;&#23450;&#19968;&#20010; <tt class="interfacename">Session</tt> &#21040;&#24403;&#21069;&#32447;&#31243;&#12290;
&#20320;&#21487;&#20197;&#20351;&#29992;&#20197;&#19979;&#20004;&#31181;&#21150;&#27861;&#20043;&#19968;&#65306;&#36890;&#36807;&#20351;&#29992;&#19968;&#20010;&#22806;&#37096;&#30340;template&#21253;&#35013;&#31867;&#22312;Java&#20195;&#30721;&#23618;&#27425;&#23454;&#29616;&#65292;
&#25110;&#32773;&#36890;&#36807;Hibernate&#30340; <tt class="interfacename">SessionFactory</tt> &#26292;&#38706;&#24403;&#21069; <tt class="interfacename">Session</tt> &#23545;&#35937;&#65288;&#23545;&#20110;&#37027;&#20123;&#24314;&#31435;&#22312;Hibernate&#21407;&#29983;&#30340;API&#19978;&#30340;DAO&#65289;&#12290;
&#36825;&#26679;&#65292;&#23545;&#20110;&#20219;&#20309;&#30340;&#20107;&#21153;&#29615;&#22659;&#65288;&#26412;&#22320;&#20107;&#21153;&#25110;&#32773;JTA&#65289;&#65292;Spring&#35299;&#20915;&#20102;&#35768;&#22810;&#22312;&#20856;&#22411;Hibernate&#20351;&#29992;&#20013;&#19981;&#26029;&#20986;&#29616;&#30340;&#36825;&#26679;&#37027;&#26679;&#30340;&#38382;&#39064;&#12290;
        </p></li><li><p><span class="emphasis"><em>&#23436;&#25972;&#30340;&#20107;&#21153;&#31649;&#29702;&#12290;</em></span> Spring&#20801;&#35768;&#20320;&#23553;&#35013;&#20320;&#30340;O/R Mapping&#20195;&#30721;&#65292;
&#36825;&#21487;&#20197;&#36890;&#36807;&#22768;&#26126;&#24335;&#30340;AOP&#26041;&#27861;&#25318;&#25130;&#22120;&#25110;&#32773;&#22312;Java&#20195;&#30721;&#32423;&#21035;&#19978;&#20351;&#29992;&#19968;&#20010;&#22806;&#37096;&#30340;template&#21253;&#35013;&#31867;&#12290;
&#26080;&#35770;&#20351;&#29992;&#21738;&#19968;&#31181;&#26041;&#24335;&#65292;&#20107;&#21153;&#25511;&#21046;&#37117;&#20250;&#24110;&#21161;&#20320;&#20570;&#30456;&#20851;&#22788;&#29702;&#65292;&#20363;&#22914;&#19968;&#26086;&#26377;&#24322;&#24120;&#21457;&#29983;&#26102;&#30340;&#20107;&#21153;&#25805;&#20316;&#65288;rollback&#31561;&#65289;&#12290;
&#27491;&#22914;&#25105;&#20204;&#19979;&#38754;&#35201;&#35752;&#35770;&#30340;&#19968;&#26679;&#65292;&#20320;&#33021;&#22815;&#20351;&#29992;&#21644;&#26367;&#25442;&#21508;&#31181;&#20107;&#21153;&#31649;&#29702;&#22120;&#65292;&#21364;&#19981;&#20250;&#20351;&#20320;&#30340;Hibernate/JDO&#30456;&#20851;&#30340;&#20195;&#30721;&#21463;&#21040;&#24433;&#21709;&#12290;
&#20363;&#22914;&#65292;&#19981;&#31649;&#37319;&#29992;&#26412;&#22320;&#20107;&#21153;&#36824;&#26159;JTA&#65292;&#23436;&#25972;&#30340;Service&#23618;&#30340;&#20195;&#30721;&#65288;&#22914;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#65289;&#22312;&#36825;&#31181;&#22330;&#26223;&#19979;&#37117;&#26159;&#30456;&#21516;&#30340;&#12290;
&#20316;&#20026;&#19968;&#20010;&#38468;&#21152;&#30340;&#21151;&#33021;&#65292;JDBC&#30456;&#20851;&#30340;&#20195;&#30721;&#33021;&#22815;&#22312;&#20107;&#21153;&#32423;&#21035;&#19978;&#19982;&#20320;&#25152;&#20351;&#29992;&#30340;O/R&#26144;&#23556;&#20195;&#30721;&#26080;&#32541;&#25972;&#21512;&#12290;
&#36825;&#19968;&#21151;&#33021;&#23545;&#20110;&#37027;&#20123;&#35832;&#22914;&#25209;&#37327;&#22788;&#29702;&#12289;BLOB&#30340;&#25805;&#20316;&#31561;&#24182;&#19981;&#36866;&#21512;&#37319;&#29992;O/R Mapping&#25805;&#20316;&#30340;&#65292;&#20294;&#26159;&#38656;&#35201;&#19982;ORM&#25805;&#20316;&#19968;&#36215;&#21442;&#19982;&#30456;&#21516;&#30340;&#20107;&#21153;&#26469;&#35828;&#26159;&#30456;&#24403;&#26377;&#29992;&#30340;&#12290;</p></li></ul></div><p>&#22312;Spring&#21457;&#24067;&#21253;&#20013;&#30340;PetClinic&#25552;&#20379;&#20102;&#21508;&#31181;&#21487;&#36873;&#25321;&#30340;DAO&#23454;&#29616;&#21644;application context&#23545;JDBC&#12289;Hibernate&#12289;Oracle TopLink&#21644;JPA&#30340;&#37197;&#32622;&#12290;
&#22240;&#32780;PetClinic&#33021;&#22815;&#20316;&#20026;&#19968;&#20010;Spring&#30340;web&#24212;&#29992;&#31034;&#20363;&#31243;&#24207;&#26469;&#25551;&#36848;Hibernate&#12289;TopLink&#21644;JPA&#30340;&#20351;&#29992;&#26041;&#27861;&#30340;&#12290;&#23427;&#21516;&#26102;&#28085;&#30422;&#20102;&#22768;&#26126;&#24335;&#20107;&#21153;&#20013;&#19981;&#21516;&#20107;&#21153;&#31574;&#30053;&#30340;&#37197;&#32622;&#12290;</p><p>JPetStore&#31034;&#20363;&#20027;&#35201;&#20030;&#20363;&#35828;&#26126;&#20102;iBATIS SQL Maps&#22312;Spring&#29615;&#22659;&#20013;&#30340;&#20351;&#29992;&#12290;&#23427;&#21516;&#26102;&#21253;&#21547;&#20102;&#20004;&#22871;&#19981;&#21516;&#30340;Web&#23618;&#36873;&#25321;&#65292;&#19968;&#22871;&#22522;&#20110;Spring Web MVC&#65292;&#32780;&#21478;&#22806;&#19968;&#22871;&#21017;&#22522;&#20110;Struts&#12290;</p><p>&#38500;&#20102;Spring&#33258;&#36523;&#25552;&#20379;&#30340;&#31034;&#20363;&#20043;&#22806;&#65292;&#26377;&#24456;&#22810;&#20854;&#20182;&#30340;&#22522;&#20110;Spring&#30340;O/R Mapping&#30340;&#31034;&#20363;&#65292;&#20182;&#20204;&#30001;&#21508;&#33258;&#30340;&#20379;&#24212;&#21830;&#25552;&#20379;&#12290;
&#20363;&#22914;&#65306;JDO&#30340;JPOX&#23454;&#29616;&#65288;<a href="http://www.jpox.org/" target="_top">http://www.jpox.org/</a>&#65289;&#20197;&#21450;Kodo&#65288;<a href="http://www.bea.com/kodo" target="_top">http://www.bea.com/kodo</a>&#65289;&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="orm-hibernate"></a>12.2.&nbsp;Hibernate</h2></div></div><div></div></div><p>&#25105;&#20204;&#23558;&#39318;&#20808;&#20174;Hibernate3 &#65288;<a href="http://www.hibernate.org/" target="_top">http://www.hibernate.org/</a>&#65289;&#24320;&#22987;&#65292;&#36890;&#36807;&#35762;&#35299;Hibernate&#22312;Spring&#29615;&#22659;&#20013;&#30340;&#20351;&#29992;&#26469;&#38416;&#36848;Spring&#26694;&#26550;&#23545;&#20110;O/R Mapping&#24037;&#20855;&#30340;&#25972;&#21512;&#26041;&#24335;&#12290;
&#26412;&#31456;&#33410;&#23558;&#28041;&#21450;&#21040;&#35768;&#22810;&#32454;&#33410;&#38382;&#39064;&#65292;&#24182;&#21521;&#20320;&#23637;&#31034;&#21508;&#31181;&#19981;&#21516;&#30340;DAO&#23454;&#29616;&#26041;&#24335;&#21644;&#20107;&#21153;&#21010;&#20998;&#12290;&#36825;&#20854;&#20013;&#30340;&#32477;&#22823;&#22810;&#25968;&#27169;&#24335;&#33021;&#22815;&#34987;Spring&#25903;&#25345;&#30340;&#20854;&#20182;O/R Mapping&#24037;&#20855;&#25152;&#20351;&#29992;&#12290;
&#36825;&#19968;&#31456;&#33410;&#30340;&#20854;&#20182;&#37096;&#20998;&#23558;&#20026;&#20320;&#35762;&#36848;&#20854;&#20182;&#30340;O/R Mapping&#25216;&#26415;&#65292;&#24182;&#32473;&#20986;&#19968;&#20123;&#31616;&#30701;&#30340;&#20363;&#23376;&#12290;</p><p><span class="emphasis"><em>&#27880;&#24847;&#65306;Spring2.5&#29256;&#26412;&#38656;&#35201;Hibernate3.1&#25110;&#26356;&#39640;&#29256;&#26412;&#65292;&#19981;&#20877;&#25552;&#20379;&#23545;Hibernate2.1&#19982;Hibernate3.0&#29256;&#26412;&#30340;&#25903;&#25345;&#12290;</em></span></p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-resource-mngmnt"></a>12.2.1.&nbsp;&#36164;&#28304;&#31649;&#29702;</h3></div></div><div></div></div><p>&#20856;&#22411;&#30340;&#19994;&#21153;&#31243;&#24207;&#32463;&#24120;&#20250;&#34987;&#37325;&#22797;&#30340;&#36164;&#28304;&#31649;&#29702;&#20195;&#30721;&#25630;&#24471;&#28151;&#20081;&#12290;&#24456;&#22810;&#39033;&#30446;&#37117;&#35797;&#22270;&#21019;&#24314;&#33258;&#24049;&#30340;&#26041;&#26696;&#26469;&#35299;&#20915;&#36825;&#20010;&#38382;&#39064;&#65292;&#26377;&#26102;&#20250;&#20026;&#20102;&#32534;&#31243;&#26041;&#20415;&#32780;&#29306;&#29298;&#24688;&#24403;&#30340;&#38169;&#35823;&#22788;&#29702;&#12290;
&#23545;&#20110;&#24688;&#24403;&#30340;&#36164;&#28304;&#31649;&#29702;&#65292;Spring&#25552;&#20513;&#19968;&#31181;&#30633;&#30446;&#32780;&#21448;&#31616;&#27905;&#30340;&#35299;&#20915;&#26041;&#26696;&#65306;&#20351;&#29992;&#27169;&#26495;&#21270;&#30340;IoC&#65292;&#35832;&#22914;&#22522;&#30784;&#26500;&#24314;&#31867;&#12289;&#22238;&#35843;&#25509;&#21475;&#20197;&#21450;&#20351;&#29992;AOP&#25318;&#25130;&#22120;&#12290;
&#22522;&#30784;&#26500;&#24314;&#31867;&#36127;&#36131;&#24688;&#24403;&#30340;&#36164;&#28304;&#22788;&#29702;&#65292;&#20197;&#21450;&#23558;&#29305;&#23450;&#30340;&#24322;&#24120;&#20195;&#30721;&#36716;&#25442;&#20026;unchecked exception&#20307;&#31995;&#12290;Spring&#24341;&#36827;&#20102;DAO&#24322;&#24120;&#20307;&#31995;&#65292;&#21487;&#36866;&#29992;&#20110;&#20219;&#20309;&#25968;&#25454;&#35775;&#38382;&#31574;&#30053;&#12290;
&#23545;&#20110;&#30452;&#25509;&#20351;&#29992;JDBC&#30340;&#24773;&#20917;&#65292;&#21069;&#38754;&#31456;&#33410;&#25552;&#21040;&#30340; <tt class="classname">JdbcTemplate</tt> &#31867;&#36127;&#36131;&#22788;&#29702;connection&#65292;&#24182;&#27491;&#30830;&#22320;&#25226; <tt class="classname">SQLException</tt> &#36716;&#25442;&#20026; <tt class="classname">DataAccessException</tt> &#20307;&#31995;&#65292;&#21253;&#25324;&#23558;&#19982;&#25968;&#25454;&#24211;&#30456;&#20851;&#30340;SQL&#38169;&#35823;&#20195;&#30721;&#21464;&#25104;&#26377;&#24847;&#20041;&#30340;&#24322;&#24120;&#31867;&#12290;
Spring&#21516;&#26102;&#36890;&#36807;&#23427;&#20204;&#21508;&#33258;&#30340;&#20107;&#21153;&#31649;&#29702;&#22120;&#25903;&#25345;JTA&#21644;JDBC&#20107;&#21153;&#12290;</p><p>Spring&#21516;&#26679;&#20063;&#25552;&#20379;&#20102;&#23545;Hibernate&#21644;JDO&#30340;&#25903;&#25345;&#65292;&#21253;&#25324; <tt class="classname">HibernateTemplate</tt> / <tt class="classname">JdoTemplate</tt> &#31867;&#20284;&#20110; <tt class="classname">JdbcTemplate</tt>&#65292;
<tt class="classname">HibernateInterceptor</tt> / <tt class="classname">JdoInterceptor</tt> &#20197;&#21450;&#19968;&#20010; Hibernate / JDO &#20107;&#21153;&#31649;&#29702;&#22120;&#12290;
&#36825;&#26679;&#20570;&#30340;&#20027;&#35201;&#30446;&#30340;&#26159;&#20026;&#20102;&#33021;&#22815;&#28165;&#26224;&#22320;&#21010;&#20998;&#24212;&#29992;&#31243;&#24207;&#23618;&#27425;&#32780;&#19981;&#31649;&#20351;&#29992;&#20309;&#31181;&#25968;&#25454;&#35775;&#38382;&#21644;&#20107;&#21153;&#31649;&#29702;&#25216;&#26415;&#65292;&#20174;&#32780;&#38477;&#20302;&#21508;&#20010;&#24212;&#29992;&#31243;&#24207;&#23545;&#35937;&#20043;&#38388;&#30340;&#32806;&#21512;&#12290;
&#19994;&#21153;&#36923;&#36753;&#19981;&#20877;&#20381;&#36182;&#20110;&#29305;&#23450;&#30340;&#25968;&#25454;&#35775;&#38382;&#19982;&#20107;&#21153;&#31574;&#30053;&#65307;&#19981;&#20877;&#26377;&#30828;&#32534;&#30721;&#30340;&#36164;&#28304;&#26597;&#25214;&#12289;&#19981;&#20877;&#26377;&#38590;&#20197;&#26367;&#25442;&#30340;singletons&#12289;&#19981;&#20877;&#26377;&#29992;&#25143;&#33258;&#23450;&#20041;&#30340;&#26381;&#21153;&#27880;&#20876;&#12290;
Spring&#25552;&#20379;&#20102;&#19968;&#20010;&#31616;&#21333;&#19988;&#31283;&#22266;&#30340;&#26041;&#26696;&#20351;&#24471;&#21508;&#31181;&#24212;&#29992;&#36923;&#36753;&#23545;&#35937;&#36830;&#25509;&#22312;&#19968;&#36215;&#65292;&#20351;&#36825;&#20123;&#23545;&#35937;&#21487;&#37325;&#29992;&#65292;&#24182;&#23613;&#21487;&#33021;&#19981;&#20381;&#36182;&#23481;&#22120;&#12290;
&#25152;&#26377;&#30340;&#25968;&#25454;&#35775;&#38382;&#25216;&#26415;&#37117;&#33021;&#29420;&#31435;&#20351;&#29992;&#65292;&#20294;&#26159;&#20182;&#20204;&#22312;Spring&#25552;&#20379;&#30340;&#22522;&#20110;XML&#37197;&#32622;&#19988;&#26080;&#38656;&#20381;&#36182;Spring&#30340;&#26222;&#36890;JavaBean&#19979;&#20250;&#19982;application Context&#25972;&#21512;&#30340;&#26356;&#22909;&#12290;
&#22312;&#20856;&#22411;&#30340;Spring&#24212;&#29992;&#31243;&#24207;&#20013;&#65292;&#24456;&#22810;&#37325;&#35201;&#30340;&#23545;&#35937;&#37117;&#26159;JavaBeans&#65306;&#25968;&#25454;&#35775;&#38382;template&#12289;&#25968;&#25454;&#35775;&#38382;&#23545;&#35937;&#65288;&#20351;&#29992;template&#65289;&#12289;&#20107;&#21153;&#31649;&#29702;&#22120;&#12289;&#19994;&#21153;&#36923;&#36753;&#23545;&#35937;&#65288;&#20351;&#29992;&#25968;&#25454;&#35775;&#38382;&#23545;&#35937;&#21644;&#20107;&#21153;&#31649;&#29702;&#22120;&#65289;&#12289;web&#35270;&#22270;&#35299;&#26512;&#22120;&#12289;web&#25511;&#21046;&#22120;&#65288;&#20351;&#29992;&#19994;&#21153;&#26381;&#21153;&#65289;&#31561;&#31561;&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-session-factory-setup"></a>12.2.2.&nbsp;&#22312;Spring&#23481;&#22120;&#20013;&#21019;&#24314; <tt class="interfacename">SessionFactory</tt></h3></div></div><div></div></div><p>&#20026;&#20102;&#36991;&#20813;&#30828;&#32534;&#30721;&#30340;&#36164;&#28304;&#26597;&#25214;&#19982;&#24212;&#29992;&#31243;&#24207;&#23545;&#35937;&#32039;&#23494;&#32806;&#21512;&#65292;Spring&#20801;&#35768;&#20320;&#22312;Spring&#23481;&#22120;&#20013;&#20197;bean&#30340;&#26041;&#24335;&#23450;&#20041;&#35832;&#22914;JDBC <tt class="interfacename">DataSource</tt>&#25110;&#32773;Hibernate <tt class="interfacename">SessionFactory</tt> &#30340;&#25968;&#25454;&#35775;&#38382;&#36164;&#28304;&#12290;
&#20219;&#20309;&#38656;&#35201;&#36827;&#34892;&#36164;&#28304;&#35775;&#38382;&#30340;&#24212;&#29992;&#31243;&#24207;&#23545;&#35937;&#21482;&#38656;&#35201;&#25345;&#26377;&#36825;&#20123;&#20107;&#20808;&#23450;&#20041;&#22909;&#30340;&#23454;&#20363;&#30340;&#24341;&#29992;&#65288;DAO&#23450;&#20041;&#22312;&#19979;&#19968;&#31456;&#33410;&#20171;&#32461;&#65289;&#65292;&#19979;&#38754;&#30340;&#20195;&#30721;&#28436;&#31034;&#22914;&#20309;&#21019;&#24314;&#19968;&#20010;JDBC <tt class="classname">DataSource</tt> &#21644;Hibernate <tt class="interfacename">SessionFactory</tt>
	  </p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="myDataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"&gt;
    &lt;property name="driverClassName" value="org.hsqldb.jdbcDriver"/&gt;
    &lt;property name="url" value="jdbc:hsqldb:hsql://localhost:9001"/&gt;
    &lt;property name="username" value="sa"/&gt;
    &lt;property name="password" value=""/&gt;
  &lt;/bean&gt;

  &lt;bean id="mySessionFactory" class="org.springframework.orm.hibernate3.LocalSessionFactoryBean"&gt;
    &lt;property name="dataSource" ref="myDataSource"/&gt;
    &lt;property name="mappingResources"&gt;
      &lt;list&gt;
        &lt;value&gt;product.hbm.xml&lt;/value&gt;
      &lt;/list&gt;
    &lt;/property&gt;
    &lt;property name="hibernateProperties"&gt;
      &lt;value&gt;
        hibernate.dialect=org.hibernate.dialect.HSQLDialect
      &lt;/value&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><p>&#23558;&#19968;&#20010;&#26412;&#22320;&#23450;&#20041;&#30340;&#65292;&#22914;Jakarta Commons DBCP&#30340; <tt class="classname">BasicDataSource</tt> &#20999;&#25442;&#20026;&#19968;&#20010;JNDI&#23450;&#20301;&#30340;DataSource&#65288;&#36890;&#24120;&#30001;&#24212;&#29992;&#31243;&#24207;&#26381;&#21153;&#22120;&#31649;&#29702;&#65289;&#65292;&#20165;&#20165;&#38656;&#35201;&#25913;&#21464;&#37197;&#32622;:</p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="myDataSource" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
    &lt;property name="jndiName" value="java:comp/env/jdbc/myds"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><p>&#36890;&#36807;&#20351;&#29992;Spring&#30340; <tt class="classname">JndiObjectFactoryBean</tt> &#26469;&#26292;&#38706;&#21644;&#33719;&#65292;&#20320;&#20063;&#21487;&#20197;&#35775;&#38382;&#19968;&#20010;JNDI&#23450;&#20301;&#30340;Hibernate <tt class="interfacename">SessionFactory</tt>&#12290;
		&#24403;&#28982;&#65292;&#22914;&#26524;&#22312;EJB&#19978;&#19979;&#25991;&#20043;&#22806;&#65292;&#36825;&#26159;&#19981;&#24517;&#35201;&#30340;&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-hibernate-template"></a>12.2.3.&nbsp;The <tt class="classname">HibernateTemplate</tt></h3></div></div><div></div></div><p>&#23545;&#20110;&#29305;&#23450;&#30340;&#25968;&#25454;&#35775;&#38382;&#23545;&#35937;&#25110;&#19994;&#21153;&#23545;&#35937;&#30340;&#26041;&#27861;&#65292;&#22522;&#26412;&#30340;&#27169;&#26495;&#32534;&#31243;&#27169;&#22411;&#30475;&#36215;&#26469;&#20687;&#19979;&#38754;&#25152;&#31034;&#30340;&#20195;&#30721;&#37027;&#26679;&#12290;
		&#23545;&#20110;&#36825;&#20123;&#22806;&#37096;&#23545;&#35937;&#26469;&#35828;&#65292;&#27809;&#26377;&#20219;&#20309;&#23454;&#29616;&#29305;&#23450;&#25509;&#21475;&#30340;&#32422;&#26463;&#65292;&#20165;&#20165;&#35201;&#27714;&#25552;&#20379;&#19968;&#20010;Hibernate <tt class="interfacename">SessionFactory</tt>&#12290;
		&#23427;&#21487;&#20197;&#20174;&#20219;&#20309;&#22320;&#26041;&#24471;&#21040;&#65292;&#19981;&#36807;&#27604;&#36739;&#36866;&#23452;&#30340;&#26041;&#27861;&#26159;&#20174;Spring&#30340;IoC&#23481;&#22120;&#20013;&#21462;&#24471;bean&#30340;&#24341;&#29992;&#65306;&#36890;&#36807;&#31616;&#21333;&#30340; <tt class="literal">setSessionFactory(..)</tt> &#36825;&#20010;bean&#30340;setter&#26041;&#27861;&#12290;
		&#19979;&#38754;&#30340;&#20195;&#30721;&#29255;&#27573;&#23637;&#31034;&#20102;&#22312;Spring&#23481;&#22120;&#20013;&#19968;&#20010;DAO&#30340;&#23450;&#20041;&#65292;&#23427;&#24341;&#29992;&#20102;&#19978;&#38754;&#23450;&#20041;&#30340; <tt class="interfacename">SessionFactory</tt>&#65292;&#21516;&#26102;&#23637;&#31034;&#20102;&#19968;&#20010;DAO&#26041;&#27861;&#30340;&#20855;&#20307;&#23454;&#29616;&#12290;
      </p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"&gt;
    &lt;property name="sessionFactory" ref="mySessionFactory"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><pre class="programlisting">public class ProductDaoImpl implements ProductDao {

    private HibernateTemplate hibernateTemplate;

    public void setSessionFactory(SessionFactory sessionFactory) {
        this.hibernateTemplate = new HibernateTemplate(sessionFactory);
    }

    public Collection loadProductsByCategory(String category) throws DataAccessException {
    	return this.hibernateTemplate.find("from test.Product product where product.category=?", category);
    }
}</pre><p>&#38500;&#20102;&#24456;&#22810;&#31867;&#20284;&#19978;&#20363;&#20013;&#26131;&#29992;&#30340;&#26041;&#27861;&#22806;&#65292;<tt class="classname">HibernateTemplate</tt>&#31867;&#25552;&#20379;&#20102;&#22823;&#37327;&#26041;&#27861;&#23545;&#24212;Hibernate <tt class="interfacename">Session</tt>&#25509;&#21475;&#20013;&#26292;&#38706;&#30340;&#26041;&#27861;&#12290;&#24403;&#20320;&#38656;&#35201;&#20351;&#29992;&#30340;<tt class="interfacename">Session</tt>&#26041;&#27861;&#27809;&#26377;&#22312;<tt class="classname">HibernateTemplate</tt>&#20013;&#25552;&#20379;&#26102;&#65292;&#21487;&#20197;&#36890;&#36807;&#19979;&#38754;&#25552;&#20379;&#30340;&#22522;&#20110;&#22238;&#35843;&#30340;&#26041;&#26696;&#26469;&#23454;&#29616;&#12290;</p><pre class="programlisting">public class ProductDaoImpl implements ProductDao {

    private HibernateTemplate hibernateTemplate;

    public void setSessionFactory(SessionFactory sessionFactory) {
        this.hibernateTemplate = new HibernateTemplate(sessionFactory);
    }

    public Collection loadProductsByCategory(final String category) throws DataAccessException {
        return this.hibernateTemplate.execute(new HibernateCallback() {

            public Object doInHibernate(Session session) {
                Criteria criteria = session.createCriteria(Product.class);
                criteria.add(Expression.eq("category", category));
                criteria.setMaxResults(6);
                return criteria.list();
            }
        };
    }
}</pre><p>&#19968;&#20010;&#22238;&#35843;&#23454;&#29616;&#33021;&#22815;&#26377;&#25928;&#22320;&#22312;&#20219;&#20309;Hibernate&#25968;&#25454;&#35775;&#38382;&#20013;&#20351;&#29992;&#12290;<tt class="classname">HibernateTemplate</tt> &#20250;&#30830;&#20445;&#24403;&#21069;Hibernate&#30340; <tt class="interfacename">Session</tt> &#23454;&#20363;&#30340;&#27491;&#30830;&#25171;&#24320;&#21644;&#20851;&#38381;&#65292;&#24182;&#30452;&#25509;&#21442;&#19982;&#21040;&#20107;&#21153;&#31649;&#29702;&#20013;&#21435;&#12290;
		Template&#23454;&#20363;&#19981;&#20165;&#26159;&#32447;&#31243;&#23433;&#20840;&#30340;&#65292;&#21516;&#26102;&#23427;&#20063;&#26159;&#21487;&#37325;&#29992;&#30340;&#12290;&#22240;&#32780;&#20182;&#20204;&#21487;&#20197;&#20316;&#20026;&#22806;&#37096;&#23545;&#35937;&#30340;&#23454;&#20363;&#21464;&#37327;&#32780;&#34987;&#25345;&#26377;&#12290;&#23545;&#20110;&#37027;&#20123;&#31616;&#21333;&#30340;&#35832;&#22914;find&#12289;load&#12289;saveOrUpdate&#25110;&#32773;delete&#25805;&#20316;&#30340;&#35843;&#29992;&#65292;<tt class="classname">HibernateTemplate</tt> &#25552;&#20379;&#21487;&#36873;&#25321;&#30340;&#24555;&#25463;&#20989;&#25968;&#26469;&#26367;&#25442;&#36825;&#31181;&#22238;&#35843;&#30340;&#23454;&#29616;&#12290;
		&#19981;&#20165;&#22914;&#27492;&#65292;Spring&#36824;&#25552;&#20379;&#20102;&#19968;&#20010;&#31616;&#20415;&#30340; <tt class="classname">HibernateDaoSupport</tt> &#22522;&#31867;&#65292;&#36825;&#20010;&#31867;&#25552;&#20379;&#20102; <tt class="methodname">setSessionFactory(..)</tt> &#26041;&#27861;&#26469;&#25509;&#21463;&#19968;&#20010; <tt class="interfacename">SessionFactory</tt> &#23545;&#35937;&#65292;&#21516;&#26102;&#25552;&#20379;&#20102; <tt class="methodname">getSessionFactory()</tt> &#21644; <tt class="methodname">getHibernateTemplate()</tt> &#26041;&#27861;&#32473;&#23376;&#31867;&#20351;&#29992;&#12290;
		&#32508;&#21512;&#20102;&#36825;&#20123;&#65292;&#23545;&#20110;&#37027;&#20123;&#20856;&#22411;&#30340;&#19994;&#21153;&#38656;&#27714;&#65292;&#23601;&#26377;&#20102;&#19968;&#20010;&#38750;&#24120;&#31616;&#21333;&#30340;DAO&#23454;&#29616;: </p><pre class="programlisting">public class ProductDaoImpl extends HibernateDaoSupport implements ProductDao {

    public Collection loadProductsByCategory(String category) throws DataAccessException {
        return this.getHibernateTemplate().find(
            "from test.Product product where product.category=?", category);
    }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-hibernate-daos"></a>12.2.4.&nbsp;&#19981;&#20351;&#29992;&#22238;&#35843;&#30340;&#22522;&#20110;Spring&#30340;DAO&#23454;&#29616;</h3></div></div><div></div></div><p>&#20316;&#20026;&#19981;&#20351;&#29992;Spring&#30340; <tt class="classname">HibernateTemplate</tt> &#26469;&#23454;&#29616;DAO&#30340;&#26367;&#20195;&#35299;&#20915;&#26041;&#26696;&#65292;&#20320;&#20381;&#28982;&#21487;&#20197;&#29992;&#20256;&#32479;&#30340;&#32534;&#31243;&#39118;&#26684;&#26469;&#32534;&#20889;&#20320;&#30340;&#25968;&#25454;&#35775;&#38382;&#20195;&#30721;&#12290;
		&#26080;&#38656;&#23558;&#20320;&#30340;Hibernate&#35775;&#38382;&#20195;&#30721;&#21253;&#35013;&#22312;&#19968;&#20010;&#22238;&#35843;&#20013;&#65292;&#21482;&#38656;&#31526;&#21512;Spring&#30340;&#36890;&#29992;&#30340; <tt class="classname">DataAccessException</tt> &#24322;&#24120;&#20307;&#31995;&#12290;
		<tt class="classname">HibernateDaoSupport</tt> &#22522;&#31867;&#25552;&#20379;&#20102;&#35775;&#38382;&#19982;&#24403;&#21069;&#20107;&#21153;&#32465;&#23450;&#30340; <tt class="interfacename">Session</tt> &#23545;&#35937;&#30340;&#20989;&#25968;&#65292;&#22240;&#32780;&#33021;&#20445;&#35777;&#22312;&#36825;&#31181;&#24773;&#20917;&#19979;&#24322;&#24120;&#30340;&#27491;&#30830;&#36716;&#21270;&#12290;
		&#31867;&#20284;&#30340;&#20989;&#25968;&#21516;&#26679;&#21487;&#20197;&#22312; <tt class="classname">SessionFactoryUtils</tt> &#31867;&#20013;&#25214;&#21040;&#65292;&#20294;&#20182;&#20204;&#20197;&#38745;&#24577;&#26041;&#27861;&#30340;&#24418;&#24335;&#20986;&#29616;&#12290;
		&#20540;&#24471;&#27880;&#24847;&#30340;&#26159;&#65292;&#36890;&#24120;&#23558; '<tt class="literal">false</tt>' &#20316;&#20026;&#21442;&#25968;&#20540;&#65288;&#34920;&#31034;&#26159;&#21542;&#20801;&#35768;&#21019;&#24314;&#65289;&#20256;&#36882;&#32473; <tt class="methodname">getSession(..)</tt> &#26041;&#27861;&#36827;&#34892;&#35843;&#29992;&#12290;
		&#27492;&#26102;&#65292;&#25972;&#20010;&#35843;&#29992;&#23558;&#22312;&#21516;&#19968;&#20010;&#20107;&#21153;&#20869;&#23436;&#25104;&#65288;&#23427;&#30340;&#25972;&#20010;&#29983;&#21629;&#21608;&#26399;&#30001;&#20107;&#21153;&#25511;&#21046;&#65292;&#36991;&#20813;&#20102;&#20851;&#38381;&#36820;&#22238;&#30340; <tt class="interfacename">Session</tt> &#30340;&#38656;&#35201;&#65289;&#12290;
      </p><pre class="programlisting">public class HibernateProductDao extends HibernateDaoSupport implements ProductDao {

    public Collection loadProductsByCategory(String category) throws DataAccessException, MyException {
        Session session = getSession(false);
        try {
            Query query = session.createQuery("from test.Product product where product.category=?");
            query.setString(0, category);
            List result = query.list();
            if (result == null) {
                throw new MyException("No search results.");
            }
            return result;
        }
        catch (HibernateException ex) {
            throw convertHibernateAccessException(ex);
        }
    }
}</pre><p>&#36825;&#31181;&#30452;&#25509;&#20351;&#29992;Hibernate&#35775;&#38382;&#20195;&#30721;&#30340;&#22909;&#22788;&#22312;&#20110;&#23427;&#20801;&#35768;&#20320;&#22312;&#25968;&#25454;&#35775;&#38382;&#20195;&#30721;&#20013;&#25243;&#20986; <span class="emphasis"><em>&#20219;&#20309;</em></span> checked exception&#65292;&#32780; <tt class="classname">HibernateTemplate</tt> &#21364;&#21463;&#38480;&#20110;&#22238;&#35843;&#20013;&#30340;unchecked exception&#12290;
		&#27880;&#24847;&#65292;&#20320;&#36890;&#24120;&#21487;&#20197;&#23558;&#36825;&#20123;&#24212;&#29992;&#31243;&#24207;&#30340;&#24322;&#24120;&#22788;&#29702;&#25512;&#36831;&#21040;&#22238;&#35843;&#20989;&#25968;&#20043;&#21518;&#65292;&#36825;&#26679;&#65292;&#20320;&#20381;&#28982;&#21487;&#20197;&#27491;&#24120;&#20351;&#29992; <tt class="classname">HibernateTemplate</tt>&#12290;
		&#19968;&#33324;&#26469;&#35828;&#65292;<tt class="classname">HibernateTemplate</tt> &#31867;&#25152;&#25552;&#20379;&#30340;&#35768;&#22810;&#26041;&#27861;&#22312;&#35768;&#22810;&#24773;&#20917;&#19979;&#30475;&#19978;&#21435;&#26356;&#31616;&#21333;&#21644;&#20415;&#25463;&#12290;
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-hibernate-straight"></a>12.2.5.&nbsp;&#22522;&#20110;Hibernate3&#30340;&#21407;&#29983;API&#23454;&#29616;DAO</h3></div></div><div></div></div><p>Hibernate3 &#24341;&#20837;&#20102;&#19968;&#20010;&#26032;&#30340;&#29305;&#24615;&#65306;&#8220;&#24102;&#19978;&#19979;&#25991;&#29615;&#22659;&#30340;Session&#8221;&#12290; &#36825;&#19968;&#29305;&#24615;&#20351;&#24471;Hibernate&#33258;&#36523;&#20855;&#22791;&#20102;&#27599;&#20010;&#20107;&#21153;&#32465;&#23450;&#24403;&#21069; <tt class="interfacename">Session</tt> &#23545;&#35937;&#30340;&#21151;&#33021;&#12290;
		&#36825;&#19982;Spring&#20013;&#27599;&#20010;Hibernate&#30340; <tt class="interfacename">Session</tt> &#19982;&#20107;&#21153;&#21516;&#27493;&#30340;&#21151;&#33021;&#22823;&#33268;&#30456;&#21516;&#12290;&#19968;&#20010;&#30456;&#24212;&#30340;&#22522;&#20110;&#21407;&#29983;&#30340;Hibernate API&#30340;DAO&#23454;&#29616;&#27491;&#22914;&#19979;&#20363;&#25152;&#31034;&#65306;
      </p><pre class="programlisting">public class ProductDaoImpl implements ProductDao {

    private SessionFactory sessionFactory;

    public void setSessionFactory(SessionFactory sessionFactory) {
        this.sessionFactory = sessionFactory;
    }

    public Collection loadProductsByCategory(String category) {
        return this.sessionFactory.getCurrentSession()
                .createQuery("from test.Product product where product.category=?")
                .setParameter(0, category)
                .list();
    }
}</pre><p>&#36825;&#31181;&#39118;&#26684;&#19982;&#20320;&#22312;Hibernate&#25991;&#26723;&#21644;&#31034;&#20363;&#20013;&#35265;&#21040;&#30340;&#38750;&#24120;&#31867;&#20284;&#65292;&#38500;&#20102;DAO&#23454;&#29616;&#31867;&#20013;&#25345;&#26377;&#20102;&#19968;&#20010; <tt class="interfacename">SessionFactory</tt> &#30340;&#23454;&#20363;&#21464;&#37327;&#12290;
		&#25105;&#20204;&#24378;&#28872;&#25512;&#33616;&#36825;&#31181;&#22522;&#20110;&#23454;&#20363;&#21464;&#37327;&#30340;DAO&#26500;&#24314;&#26041;&#24335;&#65292;&#32780;&#19981;&#26159;&#20351;&#29992;&#37027;&#31181;&#36807;&#21435;&#30001;Hibernate&#30340;&#31034;&#20363;&#31243;&#24207;&#20013;&#25552;&#21040;&#30340; <tt class="literal">&#38745;&#24577;&#30340;</tt>
				<tt class="classname">HibernateUtil</tt> &#31867;&#12290;
		&#65288;&#36890;&#24120;&#26469;&#35828;&#65292;&#19981;&#35201;&#22312;&#38745;&#24577;&#21464;&#37327;&#20013;&#20445;&#23384;&#20219;&#20309;&#36164;&#28304;&#20449;&#24687;&#38500;&#38750; <span class="emphasis"><em>&#30830;&#23454;</em></span> &#26377;&#36825;&#20010;&#24517;&#35201;&#65289;&#12290;
      </p><p>&#19978;&#36848;DAO&#36981;&#24490;&#20381;&#36182;&#27880;&#20837;&#27169;&#24335;&#65306;&#23427;&#22914;&#21516;&#20351;&#29992;Spring&#30340; <tt class="classname">HibernateTemplate</tt> &#36827;&#34892;&#32534;&#31243;&#37027;&#26679;&#65292;&#36866;&#21512;&#22312;Spring IoC&#23481;&#22120;&#20013;&#36827;&#34892;&#37197;&#32622;&#12290;
		&#24403;&#28982;&#65292;&#36825;&#26679;&#30340;DAO&#36824;&#21487;&#20197;&#24314;&#31435;&#22312;&#19968;&#20010;&#26222;&#36890;&#30340;Java&#31867;&#20013;&#65288;&#35832;&#22914;&#22312;Unit Test&#20013;&#65289;: &#20165;&#20165;&#38656;&#35201;&#21021;&#22987;&#21270;&#36825;&#20010;&#31867;&#65292;
		&#35843;&#29992; <tt class="methodname">setSessionFactory(..)</tt> &#26041;&#27861;&#35774;&#32622;&#20320;&#25152;&#26399;&#26395;&#30340;&#24037;&#21378;&#36164;&#28304;&#12290; &#20197;Spring&#30340;bean&#30340;&#23450;&#20041;&#26041;&#24335;&#65292;&#23427;&#30475;&#19978;&#21435;&#23601;&#20687;&#36825;&#26679;&#65306;
	  </p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"&gt;
    &lt;property name="sessionFactory" ref="mySessionFactory"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><p>&#36825;&#31181;DAO&#35775;&#38382;&#26041;&#24335;&#30340;&#20027;&#35201;&#20248;&#21183;&#22312;&#20110;&#23427;&#20165;&#20165;&#20381;&#36182;&#20110;Hibernate API&#26412;&#36523;&#32780;&#26080;&#38656;&#24341;&#20837;&#20219;&#20309;Spring&#30340;&#31867;&#12290;
		&#20174;&#26080;&#20837;&#20405;&#24615;&#30340;&#35282;&#24230;&#26469;&#30475;&#65292;&#36825;&#19968;&#28857;&#38750;&#24120;&#21560;&#24341;&#20154;&#12290;&#23545;&#20110;Hibernate&#24320;&#21457;&#20154;&#21592;&#26469;&#35828;&#20063;&#26080;&#30097;&#26356;&#21152;&#33258;&#28982;&#12290;</p><p>&#28982;&#32780;&#65292;&#36825;&#26679;&#30340;DAO&#35775;&#38382;&#26041;&#24335;&#20250;&#25243;&#20986;&#21407;&#29983; <tt class="classname">HibernateException</tt> &#65288;&#36825;&#26159;&#19968;&#20010;&#26080;&#38656;&#22768;&#26126;&#25110;&#25429;&#33719;&#30340;unchecked exception&#65289;&#65292;
		&#36825;&#24847;&#21619;&#30528;&#65292;DAO&#30340;&#35843;&#29992;&#32773;&#21482;&#33021;&#20197;&#33268;&#21629;&#30340;&#38169;&#35823;&#26469;&#22788;&#29702;&#36825;&#20123;&#24322;&#24120;&#65292;&#38500;&#38750;&#23436;&#20840;&#20381;&#36182;Hibernate&#33258;&#36523;&#30340;&#24322;&#24120;&#20307;&#31995;&#12290;
		&#22240;&#32780;&#65292;&#38500;&#38750;&#20320;&#23558;DAO&#30340;&#35843;&#29992;&#32773;&#32465;&#23450;&#21040;&#20855;&#20307;&#30340;&#23454;&#29616;&#31574;&#30053;&#19978;&#21435;&#65292;&#21542;&#21017;&#20320;&#23558;&#26080;&#27861;&#25429;&#33719;&#29305;&#23450;&#30340;&#24322;&#24120;&#21407;&#22240;&#65292;&#35832;&#22914;&#20048;&#35266;&#38145;&#24322;&#24120;&#12290;
		&#36825;&#31181;&#25240;&#20013;&#24179;&#34913;&#25110;&#35768;&#21487;&#20197;&#34987;&#25509;&#21463;&#65292;&#22914;&#26524;&#20320;&#30340;&#24212;&#29992;&#23436;&#20840;&#22522;&#20110;Hibernate&#25110;&#32773;&#26080;&#38656;&#36827;&#34892;&#29305;&#27530;&#30340;&#24322;&#24120;&#22788;&#29702;&#12290;</p><p>&#24184;&#36816;&#30340;&#26159;&#65292;Spring&#30340; <tt class="classname">LocalSessionFactoryBean</tt> &#21487;&#20197;&#22312;&#20219;&#20309;Spring&#30340;&#20107;&#21153;&#31649;&#29702;&#31574;&#30053;&#19979;&#65292;
	      &#25552;&#20379;&#23545;Hibernate&#30340; <tt class="methodname">SessionFactory.getCurrentSession()</tt> &#26041;&#27861;&#30340;&#25903;&#25345;&#65292;&#23427;&#23558;&#36820;&#22238;&#24403;&#21069;&#21463;Spring&#20107;&#21153;&#31649;&#29702;&#65288;&#29978;&#33267;&#26159; <tt class="classname">HibernateTransactionManager</tt> &#31649;&#29702;&#30340;&#65289;&#30340; <tt class="interfacename">Session</tt> &#23545;&#35937;&#12290;
		 &#24403;&#28982;&#65292;&#35813;&#20989;&#25968;&#30340;&#26631;&#20934;&#34892;&#20026;&#20381;&#28982;&#26377;&#25928;&#65306;&#36820;&#22238;&#24403;&#21069;&#19982;&#27491;&#22312;&#36827;&#34892;&#30340;JTA&#20107;&#21153;&#65288;&#26080;&#35770;&#26159;Spring&#30340; <tt class="classname">JtaTransactionManager</tt>&#12289;EJB CMT&#25110;&#32773;&#26222;&#36890;&#30340;JTA&#65289;&#32465;&#23450;&#30340; <tt class="interfacename">Session</tt> &#23545;&#35937;&#12290;
      </p><p>&#24635;&#20307;&#26469;&#35828;&#65292;DAO&#21487;&#20197;&#22522;&#20110;Hibernate3&#30340;&#21407;&#29983;API&#23454;&#29616;&#65292;&#21516;&#26102;&#65292;&#23427;&#20381;&#26087;&#38656;&#35201;&#33021;&#22815;&#21442;&#19982;&#21040;Spring&#30340;&#20107;&#21153;&#31649;&#29702;&#20013;&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-hibernate-tx-programmatic"></a>12.2.6.&nbsp;&#32534;&#31243;&#24335;&#30340;&#20107;&#21153;&#21010;&#20998;</h3></div></div><div></div></div><p>&#25105;&#20204;&#21487;&#20197;&#22312;&#36825;&#20123;&#20302;&#23618;&#27425;&#30340;&#25968;&#25454;&#35775;&#38382;&#26381;&#21153;&#20043;&#19978;&#30340;&#24212;&#29992;&#31243;&#24207;&#36827;&#34892;&#26356;&#39640;&#23618;&#27425;&#30340;&#20107;&#21153;&#21010;&#20998;&#65292;&#20174;&#32780;&#35753;&#20107;&#21153;&#33021;&#22815;&#27178;&#36328;&#22810;&#20010;&#25805;&#20316;&#12290;
		&#36825;&#37324;&#23545;&#20110;&#30456;&#20851;&#30340;&#19994;&#21153;&#36923;&#36753;&#23545;&#35937;&#21516;&#26679;&#27809;&#26377;&#23454;&#29616;&#25509;&#21475;&#30340;&#38480;&#21046;&#65292;&#23427;&#21482;&#38656;&#35201;&#19968;&#20010;Spring&#30340; <tt class="classname">PlatformTransactionManager</tt>&#12290;
		&#21516;SessionFactory&#19968;&#26679;&#65292;&#23427;&#21487;&#20197;&#26469;&#33258;&#20219;&#20309;&#22320;&#26041;&#65292;&#20294;&#26159;&#26368;&#22909;&#26159;&#19968;&#20010;&#32463;&#30001; <tt class="methodname">setTransactionManager(..)</tt> &#26041;&#27861;&#27880;&#20837;&#30340;bean&#30340;&#24341;&#29992;&#65292;&#27491;&#22914;&#20351;&#29992; <tt class="methodname">setProductDao</tt> &#26041;&#27861;&#26469;&#35774;&#32622; <tt class="classname">productDAO</tt> &#19968;&#26679;&#12290;
		&#19979;&#38754;&#28436;&#31034;&#20102;&#22312;Spring&#30340;application context&#20013;&#23450;&#20041;&#19968;&#20010;&#20107;&#21153;&#31649;&#29702;&#22120;&#21644;&#19968;&#20010;&#19994;&#21153;&#23545;&#35937;&#65292;&#20197;&#21450;&#20855;&#20307;&#30340;&#19994;&#21153;&#26041;&#27861;&#23454;&#29616;&#65306;
      </p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="myTxManager" class="org.springframework.orm.hibernate3.HibernateTransactionManager"&gt;
    &lt;property name="sessionFactory" ref="mySessionFactory"/&gt;
  &lt;/bean&gt;

  &lt;bean id="myProductService" class="product.ProductServiceImpl"&gt;
    &lt;property name="transactionManager" ref="myTxManager"/&gt;
    &lt;property name="productDao" ref="myProductDao"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><pre class="programlisting">public class ProductServiceImpl implements ProductService {

    private TransactionTemplate transactionTemplate;
    private ProductDao productDao;

    public void setTransactionManager(PlatformTransactionManager transactionManager) {
        this.transactionTemplate = new TransactionTemplate(transactionManager);
    }

    public void setProductDao(ProductDao productDao) {
        this.productDao = productDao;
    }

    public void increasePriceOfAllProductsInCategory(final String category) {
        this.transactionTemplate.execute(new TransactionCallbackWithoutResult() {

                public void doInTransactionWithoutResult(TransactionStatus status) {
                    List productsToChange = this.productDao.loadProductsByCategory(category);
                    <i class="lineannotation"><span class="lineannotation">// do the price increase...</span></i>
                }
            }
        );
    }
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-hibernate-tx-declarative"></a>12.2.7.&nbsp;&#22768;&#26126;&#24335;&#30340;&#20107;&#21153;&#21010;&#20998;</h3></div></div><div></div></div><p>&#20316;&#20026;&#21487;&#36873;&#26041;&#26696;&#65292;&#25105;&#20204;&#21487;&#20197;&#20351;&#29992;Spring&#22768;&#26126;&#24335;&#30340;&#20107;&#21153;&#25903;&#25345;&#12290;&#22768;&#26126;&#24335;&#30340;&#20107;&#21153;&#25903;&#25345;&#36890;&#36807;&#37197;&#32622;Spring&#23481;&#22120;&#20013;&#30340;AOP Transaction Interceptor&#26469;&#26367;&#25442;&#20107;&#21153;&#21010;&#20998;&#30340;&#30828;&#32534;&#30721;&#12290;
		&#36825;&#23558;&#20351;&#20320;&#21487;&#20197;&#20174;&#27599;&#20010;&#19994;&#21153;&#26041;&#27861;&#20013;&#37325;&#22797;&#30340;&#20107;&#21153;&#21010;&#20998;&#20195;&#30721;&#20013;&#35299;&#25918;&#20986;&#26469;&#65292;&#30495;&#27491;&#19987;&#27880;&#20110;&#20026;&#20320;&#30340;&#24212;&#29992;&#28155;&#21152;&#26377;&#20215;&#20540;&#30340;&#19994;&#21153;&#36923;&#36753;&#20195;&#30721;&#12290;&#27492;&#22806;&#65292;&#31867;&#20284;&#20256;&#25773;&#34892;&#20026;&#21644;&#38548;&#31163;&#32423;&#21035;&#31561;&#20107;&#21153;&#35821;&#20041;&#33021;&#22815;&#22312;&#37197;&#32622;&#25991;&#20214;&#20013;&#25913;&#21464;&#65292;&#32780;&#19981;&#20250;&#24433;&#21709;&#20855;&#20307;&#30340;&#19994;&#21153;&#23545;&#35937;&#23454;&#29616;&#12290;
      </p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="myTxManager" class="org.springframework.orm.hibernate3.HibernateTransactionManager"&gt;
    &lt;property name="sessionFactory" ref="mySessionFactory"/&gt;
  &lt;/bean&gt;

  &lt;bean id="myProductService" class="org.springframework.aop.framework.ProxyFactoryBean"&gt;
    &lt;property name="proxyInterfaces" value="product.ProductService"/&gt;
    &lt;property name="target"&gt;
        &lt;bean class="product.DefaultProductService"&gt;
            &lt;property name="productDao" ref="myProductDao"/&gt;
        &lt;/bean&gt;
    &lt;/property&gt;
    &lt;property name="interceptorNames"&gt;
      &lt;list&gt;
        &lt;value&gt;myTxInterceptor&lt;/value&gt; <i class="lineannotation"><span class="lineannotation">&lt;!-- the transaction interceptor (configured elsewhere) --&gt;</span></i>
      &lt;/list&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><pre class="programlisting">public class ProductServiceImpl implements ProductService {

    private ProductDao productDao;

    public void setProductDao(ProductDao productDao) {
        this.productDao = productDao;
    }

    <i class="lineannotation"><span class="lineannotation">// notice the absence of transaction demarcation code in this method</span></i>
    <i class="lineannotation"><span class="lineannotation">// Spring's declarative transaction infrastructure will be demarcating transactions on your behalf </span></i>
    public void increasePriceOfAllProductsInCategory(final String category) {
        List productsToChange = this.productDao.loadProductsByCategory(category);
        <i class="lineannotation"><span class="lineannotation">// ...</span></i>
    }
}</pre><p>Spring&#30340; <tt class="classname">TransactionInterceptor</tt> &#20801;&#35768;&#20219;&#20309;&#24212;&#29992;&#31243;&#24207;&#30340;checked exception&#22312;&#22238;&#35843;&#20195;&#30721;&#20013;&#25243;&#20986;&#65292;&#32780; <tt class="classname">TransactionTemplate</tt> &#22312;&#22238;&#35843;&#20013;&#21017;&#20005;&#26684;&#35201;&#27714;&#34987;&#23553;&#35013;&#25104;unchecked exception&#12290;
<tt class="classname">TransactionTemplate</tt> &#20250;&#22312;&#19968;&#20010;unchecked exception&#25243;&#20986;&#26102;&#65292;&#25110;&#32773;&#24403;&#20107;&#21153;&#34987;&#24212;&#29992;&#31243;&#24207;&#36890;&#36807; <tt class="classname">TransactionStatus</tt> &#26631;&#35760;&#20026;rollback-only&#26102;&#35302;&#21457;&#19968;&#20010;&#25968;&#25454;&#24211;&#22238;&#28378;&#25805;&#20316;&#12290;
<tt class="classname">TransactionInterceptor</tt> &#40664;&#35748;&#36827;&#34892;&#21516;&#26679;&#30340;&#25805;&#20316;&#65292;&#20294;&#26159;&#23427;&#20801;&#35768;&#23545;&#27599;&#20010;&#26041;&#27861;&#37197;&#32622;&#33258;&#24049;&#30340;rollback&#31574;&#30053;&#12290;
      </p><p>&#19979;&#38754;&#21015;&#20986;&#30340;&#39640;&#32423;&#21035;&#30340;&#22768;&#26126;&#24335;&#30340;&#20107;&#21153;&#31649;&#29702;&#26041;&#26696;&#24182;&#27809;&#26377;&#20351;&#29992; <tt class="classname">ProxyFactoryBean</tt>&#65292;&#23427;&#23558;&#20351;&#37027;&#20123;&#22823;&#37327;&#30340;&#19994;&#21153;&#23545;&#35937;&#38656;&#35201;&#34987;&#32435;&#20837;&#21040;&#20107;&#21153;&#31649;&#29702;&#20013;&#26102;&#30340;&#37197;&#32622;&#21464;&#24471;&#38750;&#24120;&#31616;&#21333;&#12290;
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>&#22312;&#20320;&#25171;&#31639;&#32487;&#32493;&#38405;&#35835;&#19979;&#19968;&#37096;&#20998;&#20043;&#21069;&#65292;&#25105;&#20204; <span class="emphasis"><em>&#24378;&#28872;</em></span> &#25512;&#33616;&#20320;&#24819;&#21435;&#38405;&#35835; <a href="transaction.html#transaction-declarative" title="9.5.&nbsp;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;">Section&nbsp;9.5, &#8220;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#8221;</a> &#36825;&#19968;&#31456;&#33410;&#12290;</p></td></tr></table></div><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
       http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd
       http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd"&gt;

  <i class="lineannotation"><span class="lineannotation">&lt;!-- <tt class="interfacename">SessionFactory</tt>, <tt class="interfacename">DataSource</tt>, etc. omitted --&gt;</span></i>

  &lt;bean id="myTxManager" class="org.springframework.orm.hibernate3.HibernateTransactionManager"&gt;
    &lt;property name="sessionFactory" ref="mySessionFactory"/&gt;
  &lt;/bean&gt;
  
  &lt;aop:config&gt;
    &lt;aop:pointcut id="productServiceMethods" expression="execution(* product.ProductService.*(..))"/&gt;
    &lt;aop:advisor advice-ref="txAdvice" pointcut-ref="productServiceMethods"/&gt;
  &lt;/aop:config&gt;

  &lt;tx:advice id="txAdvice" transaction-manager="myTxManager"&gt;
    &lt;tx:attributes&gt;
      &lt;tx:method name="increasePrice*" propagation="REQUIRED"/&gt;
      &lt;tx:method name="someOtherBusinessMethod" propagation="REQUIRES_NEW"/&gt;
      &lt;tx:method name="*" propagation="SUPPORTS" read-only="true"/&gt;
    &lt;/tx:attributes&gt;
  &lt;/tx:advice&gt;

  &lt;bean id="myProductService" class="product.SimpleProductService"&gt;
    &lt;property name="productDao" ref="myProductDao"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-hibernate-tx-strategies"></a>12.2.8.&nbsp;&#20107;&#21153;&#31649;&#29702;&#31574;&#30053;</h3></div></div><div></div></div><p><tt class="classname">TransactionTemplate</tt> &#21644; <tt class="classname">TransactionInterceptor</tt> &#37117;&#23558;&#30495;&#27491;&#30340;&#20107;&#21153;&#22788;&#29702;&#22996;&#25176;&#32473;&#19968;&#20010; <tt class="classname">PlatformTransactionManager</tt> &#23454;&#20363;&#26469;&#22788;&#29702;&#12290;
&#22312;Hibernate&#24212;&#29992;&#20013;&#65292;&#23427;&#21487;&#20197;&#26159;&#19968;&#20010; <tt class="classname">HibernateTransactionManager</tt>&#65288;&#23545;&#20110;&#21333;&#29420;&#19968;&#20010;&#30340;Hibernate <tt class="interfacename">SessionFactory</tt> &#20351;&#29992;&#19968;&#20010; <tt class="classname">ThreadLocal</tt> &#30340; <tt class="interfacename">Session</tt>&#65289;&#25110;&#19968;&#20010; <tt class="classname">JtaTransactionManager</tt>&#65288;&#20195;&#29702;&#32473;&#23481;&#22120;&#30340;JTA&#23376;&#31995;&#32479;&#65289;&#12290;
&#20320;&#29978;&#33267;&#21487;&#20197;&#20351;&#29992;&#33258;&#23450;&#20041;&#30340; <tt class="classname">PlatformTransactionManager</tt> &#30340;&#23454;&#29616;&#12290;&#22240;&#32780;&#65292;&#22312;&#20320;&#30340;&#24212;&#29992;&#30896;&#21040;&#20102;&#29305;&#23450;&#30340;&#20998;&#24067;&#24335;&#20107;&#21153;&#30340;&#37096;&#32626;&#38656;&#27714;&#26102;&#65288;&#31867;&#20284;&#23558;&#21407;&#26469;&#30340;Hibernate&#20107;&#21153;&#31649;&#29702;&#36716;&#21464;&#20026;JTA&#65289;&#65292;&#20165;&#20165;&#38656;&#35201;&#25913;&#21464;&#37197;&#32622;&#32780;&#24050;&#65306;&#31616;&#21333;&#23558;Hibernate&#30340;&#20107;&#21153;&#31649;&#29702;&#22120;&#26367;&#25442;&#25104;JTA&#20107;&#21153;&#23454;&#29616;&#12290;
&#20219;&#20309;&#30340;&#20107;&#21153;&#21010;&#20998;&#21644;&#25968;&#25454;&#35775;&#38382;&#30340;&#20195;&#30721;&#37117;&#26080;&#38656;&#22240;&#27492;&#32780;&#25913;&#21464;&#65292;&#22240;&#20026;&#20182;&#20204;&#20165;&#20165;&#20351;&#29992;&#20102;&#36890;&#29992;&#30340;&#20107;&#21153;&#31649;&#29702;API&#12290;</p><p>&#23545;&#20110;&#27178;&#36328;&#22810;&#20010;Hibernate SessionFacotry&#30340;&#20998;&#24067;&#24335;&#20107;&#21153;&#65292;&#21482;&#38656;&#31616;&#21333;&#22320;&#23558; <tt class="classname">JtaTransactionManager</tt> &#21516;&#22810;&#20010; <tt class="classname">LocalSessionFactoryBean</tt> &#30340;&#23450;&#20041;&#32467;&#21512;&#36215;&#26469;&#20316;&#20026;&#20107;&#21153;&#31574;&#30053;&#12290;
&#20320;&#30340;&#27599;&#19968;&#20010;DAO&#36890;&#36807;bean&#23646;&#24615;&#24471;&#21040;&#21508;&#33258;&#30340; <tt class="interfacename">SessionFactory</tt> &#24341;&#29992;&#12290;&#22914;&#26524;&#25152;&#26377;&#30340;&#24213;&#23618;JDBC&#25968;&#25454;&#28304;&#37117;&#26159;&#25903;&#25345;&#20107;&#21153;&#30340;&#23481;&#22120;&#65292;&#37027;&#20040;&#21482;&#35201;&#19994;&#21153;&#23545;&#35937;&#20351;&#29992;&#20102; <tt class="classname">JtaTransactionManager</tt> &#20316;&#20026;&#20107;&#21153;&#31574;&#30053;&#65292;&#23427;&#23601;&#21487;&#20197;&#27178;&#36328;&#22810;&#20010;DAO&#21644;&#22810;&#20010;session factories&#26469;&#21010;&#20998;&#20107;&#21153;&#65292;&#32780;&#19981;&#38656;&#35201;&#20570;&#20219;&#20309;&#29305;&#27530;&#22788;&#29702;&#12290;
      </p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="myDataSource1" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
    &lt;property name="jndiName value="java:comp/env/jdbc/myds1"/&gt;
  &lt;/bean&gt;

  &lt;bean id="myDataSource2" class="org.springframework.jndi.JndiObjectFactoryBean"&gt;
    &lt;property name="jndiName" value="java:comp/env/jdbc/myds2"/&gt;
  &lt;/bean&gt;

  &lt;bean id="mySessionFactory1" class="org.springframework.orm.hibernate3.LocalSessionFactoryBean"&gt;
    &lt;property name="dataSource" ref="myDataSource1"/&gt;
    &lt;property name="mappingResources"&gt;
      &lt;list&gt;
        &lt;value&gt;product.hbm.xml&lt;/value&gt;
      &lt;/list&gt;
    &lt;/property&gt;
    &lt;property name="hibernateProperties"&gt;
      &lt;value&gt;
        hibernate.dialect=org.hibernate.dialect.MySQLDialect
        hibernate.show_sql=true
      &lt;/value&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

  &lt;bean id="mySessionFactory2" class="org.springframework.orm.hibernate3.LocalSessionFactoryBean"&gt;
    &lt;property name="dataSource" ref="myDataSource2"/&gt;
    &lt;property name="mappingResources"&gt;
      &lt;list&gt;
        &lt;value&gt;inventory.hbm.xml&lt;/value&gt;
      &lt;/list&gt;
    &lt;/property&gt;
    &lt;property name="hibernateProperties"&gt;
      &lt;value&gt;
        hibernate.dialect=org.hibernate.dialect.OracleDialect
      &lt;/value&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

  &lt;bean id="myTxManager" class="org.springframework.transaction.jta.JtaTransactionManager"/&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"&gt;
    &lt;property name="sessionFactory" ref="mySessionFactory1"/&gt;
  &lt;/bean&gt;

  &lt;bean id="myInventoryDao" class="product.InventoryDaoImpl"&gt;
    &lt;property name="sessionFactory" ref="mySessionFactory2"/&gt;
  &lt;/bean&gt;

  <i class="lineannotation"><span class="lineannotation">&lt;!-- this shows the Spring 1.x style of declarative transaction configuration --&gt;</span></i>
  <i class="lineannotation"><span class="lineannotation">&lt;!-- it is totally supported, 100% legal in Spring 2.x, but see also above for the sleeker, Spring 2.0 style --&gt;</span></i>
  &lt;bean id="myProductService"
      class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean"&gt;
    &lt;property name="transactionManager" ref="myTxManager"/&gt;
    &lt;property name="target"&gt;
      &lt;bean class="product.ProductServiceImpl"&gt;
        &lt;property name="productDao" ref="myProductDao"/&gt;
        &lt;property name="inventoryDao" ref="myInventoryDao"/&gt;
      &lt;/bean&gt;
    &lt;/property&gt;
    &lt;property name="transactionAttributes"&gt;
      &lt;props&gt;
        &lt;prop key="increasePrice*"&gt;PROPAGATION_REQUIRED&lt;/prop&gt;
        &lt;prop key="someOtherBusinessMethod"&gt;PROPAGATION_REQUIRES_NEW&lt;/prop&gt;
        &lt;prop key="*"&gt;PROPAGATION_SUPPORTS,readOnly&lt;/prop&gt;
      &lt;/props&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><p><tt class="classname">HibernateTransactionManager</tt> &#21644; <tt class="classname">JtaTransactionManager</tt> &#37117;&#20801;&#35768;&#24688;&#24403;&#30340;JVM&#32423;&#21035;&#30340;Hibernate&#32531;&#23384;&#22788;&#29702;&#65292;&#32780;&#26080;&#38656;&#20351;&#29992;&#19982;&#23481;&#22120;&#30456;&#20851;&#30340;&#20107;&#21153;&#31649;&#29702;&#22120;&#25110;JCA&#36830;&#25509;&#22120;&#12290;&#65288;&#21482;&#35201;&#19981;&#26159;&#30001;EJB&#21457;&#36215;&#30340;&#20107;&#21153;&#65289;</p><p>&#23545;&#20110;&#29305;&#23450;&#30340; <tt class="interfacename">DataSource</tt>&#65292;<tt class="classname">HibernateTransactionManager</tt> &#33021;&#22815;&#20026;&#26222;&#36890;&#30340;JDBC&#35775;&#38382;&#20195;&#30721;&#25552;&#20379;Hibernate&#25152;&#20351;&#29992;&#30340; <tt class="interfacename">Connection</tt>&#12290;
		&#36825;&#19968;&#21151;&#33021;&#20801;&#35768;&#20320;&#21487;&#20197;&#23436;&#20840;&#28151;&#21644;&#20351;&#29992;Hibernate/JDBC&#36827;&#34892;&#25968;&#25454;&#35775;&#38382;&#32780;&#26080;&#38656;&#20381;&#36182;JTA&#22312;&#39640;&#23618;&#27425;&#20195;&#30721;&#20013;&#36827;&#34892;&#20107;&#21153;&#21010;&#20998;&#65292;&#21482;&#35201;&#20320;&#20381;&#28982;&#35775;&#38382;&#30340;&#26159;&#21516;&#19968;&#20010;&#25968;&#25454;&#24211;&#65281;
		<tt class="classname">HibernateTransactionManager</tt> &#33021;&#22815;&#33258;&#21160;&#22320;&#23558;Hibernate&#20107;&#21153;&#26292;&#38706;&#20026;JDBC&#20107;&#21153;&#65292;&#22914;&#26524;&#20320;&#36890;&#36807;&#35774;&#32622; <tt class="interfacename">DataSource</tt>&#26469;&#24314;&#31435;<tt class="interfacename">SessionFactory</tt> &#23545;&#35937;&#65288;&#36890;&#36807;&#35774;&#32622; <tt class="classname">LocalSessionFactoryBean</tt> &#20013;&#30340;&#8220;dataSource&#8221;&#23646;&#24615;&#65289;&#12290;
		&#21478;&#22806;&#19968;&#31181;&#37197;&#32622;&#26041;&#27861;&#26159;&#36890;&#36807;&#35774;&#32622; <tt class="classname">HibernateTransactionManager</tt> &#30340;&#8220;dataSource&#8221;&#23646;&#24615;&#65292;&#26126;&#30830;&#25351;&#23450;&#20107;&#21153;&#38656;&#35201;&#26292;&#38706;&#30340; <tt class="interfacename">DataSource</tt>&#12290;
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-hibernate-resources"></a>12.2.9.&nbsp;&#23481;&#22120;&#36164;&#28304; vs &#26412;&#22320;&#36164;&#28304;</h3></div></div><div></div></div><p>Spring&#30340;&#36164;&#28304;&#31649;&#29702;&#20801;&#35768;&#20320;&#31616;&#21333;&#22320;&#22312;&#19968;&#20010;JNDI&#30340; <tt class="interfacename">SessionFactory</tt> &#21644;&#19968;&#20010;&#26412;&#22320;&#30340; <tt class="interfacename">SessionFactory</tt> &#20043;&#38388;&#20999;&#25442;&#32780;&#26080;&#38656;&#26356;&#25913;&#20219;&#20309;&#19968;&#34892;&#24212;&#29992;&#31243;&#24207;&#20195;&#30721;&#12290;
      	&#25226;&#36164;&#28304;&#23450;&#20041;&#25918;&#22312;&#23481;&#22120;&#20013;&#36824;&#26159;&#25918;&#22312;&#24212;&#29992;&#31243;&#24207;&#26412;&#22320;&#20013;&#20027;&#35201;&#26159;&#30001;&#20351;&#29992;&#30340;&#20107;&#21153;&#31574;&#30053;&#20915;&#23450;&#30340;&#12290;&#19982;Spring&#23450;&#20041;&#30340;&#26412;&#22320; <tt class="interfacename">SessionFactory</tt> &#30456;&#27604;&#65292;&#19968;&#20010;&#25163;&#24037;&#27880;&#20876;&#30340;JNDI <tt class="interfacename">SessionFactory</tt> &#24182;&#27809;&#26377;&#20307;&#29616;&#20986;&#22810;&#22823;&#30340;&#20248;&#21183;&#12290;
	 	&#36890;&#36807;Hibernate&#30340;JCA&#36830;&#25509;&#22120;&#26469;&#37096;&#32626;&#19968;&#20010; <tt class="interfacename">SessionFactory</tt> &#25552;&#20379;&#20102;&#33021;&#20351;&#20043;&#21442;&#19982;&#21040;J2EE&#26381;&#21153;&#22120;&#31649;&#29702;&#26550;&#26500;&#30340;&#22686;&#20540;&#26381;&#21153;&#65292;&#19981;&#36807;&#38500;&#27492;&#20043;&#22806;&#20063;&#24182;&#27809;&#26377;&#22686;&#21152;&#23454;&#38469;&#30340;&#20215;&#20540;&#12290;
      </p><p>Spring&#23545;&#20107;&#21153;&#31649;&#29702;&#30340;&#25903;&#25345;&#26377;&#19968;&#20010;&#38750;&#24120;&#37325;&#35201;&#30340;&#22909;&#22788;&#65306;&#23427;&#19981;&#20381;&#36182;&#20110;&#20219;&#20309;&#23481;&#22120;&#12290;&#20351;&#29992;&#38750;JTA&#30340;&#20219;&#20309;&#20854;&#20182;&#20107;&#21153;&#31574;&#30053;&#30340;&#37197;&#32622;&#65292;&#31243;&#24207;&#20063;&#33021;&#22312;&#29420;&#31435;&#30340;&#27979;&#35797;&#29615;&#22659;&#19979;&#27491;&#24120;&#24037;&#20316;&#12290;
		&#23588;&#20854;&#23545;&#20110;&#37027;&#20123;&#20856;&#22411;&#30340;&#21333;&#25968;&#25454;&#24211;&#20107;&#21153;&#24773;&#20917;&#19979;&#65292;&#36825;&#23558;&#26159;&#19968;&#20010;&#38750;&#24120;&#36731;&#37327;&#32423;&#32780;&#21448;&#24378;&#22823;&#30340;JTA&#26367;&#20195;&#26041;&#26696;&#12290;&#24403;&#20320;&#20351;&#29992;&#19968;&#20010;&#26412;&#22320;&#30340;EJB SLSB&#26469;&#39537;&#21160;&#20107;&#21153;&#26102;&#65292;&#21363;&#26102;&#20320;&#21487;&#33021;&#21482;&#35775;&#38382;&#19968;&#20010;&#25968;&#25454;&#24211;&#32780;&#19988;&#20165;&#20165;&#36890;&#36807;CMT&#20351;&#29992;SLSB&#30340;&#22768;&#26126;&#24615;&#20107;&#21153;&#65292;&#20320;&#20173;&#28982;&#35201;&#20381;&#36182;&#20110;EJB&#23481;&#22120;&#21644;JTA&#12290;
		&#20351;&#29992;&#32534;&#31243;&#24335;JTA&#26367;&#25442;&#26041;&#26696;&#20381;&#28982;&#38656;&#35201;J2EE&#29615;&#22659;&#65292;JTA&#19981;&#20165;&#23545;&#20110;JTA&#26412;&#36523;&#65292;&#36824;&#23545;&#20110;JNDI&#30340; <tt class="interfacename">DataSource</tt> &#23454;&#20363;&#24341;&#20837;&#20102;&#23481;&#22120;&#20381;&#36182;&#12290;
		&#23545;&#20110;&#38750;Spring&#29615;&#22659;&#30340;JTA&#39537;&#21160;&#30340;Hibernate&#20107;&#21153;&#65292;&#20320;&#24517;&#39035;&#20351;&#29992;Hibernate JCA&#36830;&#25509;&#22120;&#25110;&#32773;&#39069;&#22806;&#30340;Hibernate&#20107;&#21153;&#20195;&#30721;&#21450; <tt class="interfacename">TransactionManagerLookup</tt> &#37197;&#32622;&#65292;&#26469;&#24688;&#24403;&#22320;&#22788;&#29702;JVM&#32423;&#21035;&#30340;&#32531;&#23384;&#12290;
      </p><p>Spring&#39537;&#21160;&#30340;&#20107;&#21153;&#31649;&#29702;&#19982;&#26412;&#22320;&#23450;&#20041;&#30340; <tt class="interfacename">SessionFactory</tt> &#33021;&#22815;&#24037;&#20316;&#24471;&#38750;&#24120;&#22909;&#65292;&#23601;&#20687;&#20351;&#29992;&#26412;&#22320;&#30340;JDBC <tt class="interfacename">DataSource</tt> &#19968;&#26679;&#65292;&#24403;&#28982;&#21069;&#25552;&#24517;&#39035;&#26159;&#35775;&#38382;&#21333;&#20010;&#25968;&#25454;&#24211;&#12290;
		&#22240;&#27492;&#24403;&#20320;&#30495;&#27491;&#38754;&#23545;&#20998;&#24067;&#24335;&#20107;&#21153;&#30340;&#38656;&#27714;&#26102;&#65292;&#21487;&#20197;&#39532;&#19978;&#22238;&#21040;Spring&#30340;JTA&#20107;&#21153;&#12290;&#24517;&#39035;&#35201;&#27880;&#24847;&#65292;&#19968;&#20010;JCA&#36830;&#25509;&#22120;&#38656;&#35201;&#29305;&#23450;&#23481;&#22120;&#30340;&#37096;&#32626;&#27493;&#39588;&#65292;&#32780;&#19988;&#39318;&#20808;&#23481;&#22120;&#35201;&#25903;&#25345;JCA&#12290;
		&#36825;&#35201;&#27604;&#20351;&#29992;&#26412;&#22320;&#36164;&#28304;&#23450;&#20041;&#21644;Spring&#39537;&#21160;&#20107;&#21153;&#26469;&#37096;&#32626;&#19968;&#20010;&#31616;&#21333;&#30340;Web&#24212;&#29992;&#40635;&#28902;&#24471;&#22810;&#12290;&#32780;&#19988;&#20320;&#36890;&#24120;&#38656;&#35201;&#29305;&#23450;&#20225;&#19994;&#29256;&#26412;&#30340;&#23481;&#22120;&#65292;&#20294;&#26159;&#20687;&#31867;&#20284;WebLogic&#30340;Express&#29256;&#26412;&#24182;&#19981;&#25552;&#20379;JCA&#12290;
		&#19968;&#20010;&#20165;&#20351;&#29992;&#26412;&#22320;&#36164;&#28304;&#24182;&#19988;&#38024;&#23545;&#19968;&#20010;&#25968;&#25454;&#24211;&#30340;&#20107;&#21153;&#25805;&#20316;&#30340;Spring&#24212;&#29992;&#23558;&#21487;&#20197;&#22312;&#20219;&#20309;&#19968;&#31181;J2EE&#30340;Web&#23481;&#22120;&#20013;&#24037;&#20316;&#65288;&#19981;&#38656;&#35201;JTA&#12289;JCA&#25110;&#32773;EJB&#65289;&#65292;&#27604;&#22914;Tomcat&#12289;Resin&#29978;&#33267;&#26222;&#36890;&#30340;Jetty&#12290;
		&#38500;&#27492;&#20043;&#22806;&#65292;&#36825;&#26679;&#30340;&#20013;&#38388;&#23618;&#21487;&#20197;&#22312;&#26700;&#38754;&#24212;&#29992;&#25110;&#27979;&#35797;&#29992;&#20363;&#20013;&#34987;&#31616;&#21333;&#22320;&#37325;&#29992;&#12290;
	  </p><p>&#32771;&#34385;&#19968;&#19979;&#25152;&#26377;&#30340;&#24773;&#20917;&#65306;&#22914;&#26524;&#20320;&#19981;&#20351;&#29992;EJB&#65292;&#22362;&#25345;&#20351;&#29992;&#26412;&#22320; <tt class="interfacename">SessionFactory</tt> &#20197;&#21450;Spring&#30340; <tt class="classname">HibernateTransactionManager</tt> &#25110;&#32773; <tt class="classname">JtaTransactionManager</tt>&#65292;
      	&#20320;&#23558;&#33719;&#24471;&#21253;&#25324;&#36866;&#24403;&#30340;JVM&#32423;&#21035;&#19978;&#30340;&#32531;&#23384;&#20197;&#21450;&#20998;&#24067;&#24335;&#20107;&#21153;&#22312;&#20869;&#30340;&#25152;&#26377;&#22909;&#22788;&#65292;&#32780;&#19981;&#20250;&#26377;&#20219;&#20309;&#23481;&#22120;&#37096;&#32626;&#30340;&#40635;&#28902;&#12290;&#36890;&#36807;JCA&#36830;&#25509;&#22120;&#30340;Hibernate&#30340; <tt class="interfacename">SessionFactory</tt> &#30340;JNDI&#27880;&#20876;&#20165;&#20165;&#22312;EJB&#20013;&#20351;&#29992;&#20250;&#24102;&#26469;&#22909;&#22788;&#12290;
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-hibernate-invalid-jdbc-access-error"></a>12.2.10.&nbsp;&#22312;&#24212;&#29992;&#26381;&#21153;&#22120;&#20013;&#20351;&#29992;Hibernate&#30340;&#27880;&#24847;&#20107;&#39033;</h3></div></div><div></div></div><p>&#22312;&#19968;&#20123;&#20855;&#26377;&#38750;&#24120;&#20005;&#26684;&#30340; <tt class="interfacename">XADataSource</tt> &#23454;&#29616;&#30340;JTA&#29615;&#22659;&#20013;&#65288;&#30446;&#21069;&#26469;&#35828;&#21482;&#26159;WebLogic&#21644;WebSphere&#30340;&#26576;&#20123;&#29256;&#26412;&#65289;&#24403;&#20320;&#23558;Hibernate&#37197;&#32622;&#25104;&#19981;&#24863;&#30693;JTA <tt class="interfacename">PlatformTransactionManager</tt> &#23545;&#35937;&#26102;&#65292;&#23481;&#22120;&#21487;&#33021;&#20250;&#22312;&#24212;&#29992;&#26381;&#21153;&#22120;&#26085;&#24535;&#20013;&#25253;&#20986;&#19968;&#20123;&#35686;&#21578;&#21644;&#24322;&#24120;&#12290;
		&#36825;&#20123;&#35686;&#21578;&#21644;&#24322;&#24120;&#36890;&#24120;&#20250;&#35828;&#65306;&#8220;&#27491;&#22312;&#34987;&#35775;&#38382;&#30340;&#36830;&#25509;&#19981;&#20877;&#26377;&#25928;&#65292;&#25110;&#32773;JDBC&#36830;&#25509;&#19981;&#20877;&#26377;&#25928;&#65292;&#21487;&#33021;&#30001;&#20110;&#20107;&#21153;&#19981;&#20877;&#22788;&#20110;&#28608;&#27963;&#29366;&#24577;&#8221;&#12290;&#19979;&#38754;&#26159;&#19968;&#20010;&#20174;WebLogic&#19978;&#25243;&#20986;&#30340;&#24322;&#24120;&#65306;</p><pre class="programlisting">java.sql.SQLException: The transaction is no longer active - status: 'Committed'.
   No further JDBC access is allowed within this transaction.</pre><p>&#36825;&#26679;&#30340;&#38169;&#35823;&#35686;&#21578;&#24456;&#23481;&#26131;&#35299;&#20915;&#65306;&#21482;&#35201;&#31616;&#21333;&#30340;&#25226;Hibernate&#37197;&#32622;&#25104;&#24863;&#30693;&#21040;JTA <tt class="interfacename">PlatformTransactionManager</tt> &#23454;&#20363;&#30340;&#23384;&#22312;&#21363;&#21487;&#65292;&#21516;&#26102;&#23558;&#20182;&#20204;&#36827;&#34892;&#21516;&#27493;&#65288;&#19982;Spring&#21516;&#27493;&#65289;&#12290;&#21487;&#20197;&#26377;&#20004;&#31181;&#26041;&#27861;&#36798;&#21040;&#36825;&#31181;&#25928;&#26524;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p>&#22914;&#26524;&#20320;&#24050;&#32463;&#22312;application context&#20013;&#23450;&#20041;&#24182;&#33719;&#21462;&#20102;JTA <tt class="interfacename">PlatformTransactionManager</tt> &#23545;&#35937;&#65288;&#25110;&#35768;&#26469;&#33258;&#36890;&#36807; <tt class="literal">JndiObjectFactoryBean</tt> &#24471;&#21040;&#30340;JNDI&#65289;&#24182;&#24050;&#32463;&#23558;&#23427;&#27880;&#20837;&#21040;&#31867;&#20284;Spring&#30340; <tt class="classname">JtaTransactionManager</tt> &#20013;&#65292;
          	&#37027;&#20040;&#26368;&#31616;&#21333;&#30340;&#26041;&#24335;&#23601;&#26159;&#25351;&#23450;&#36825;&#20010;bean&#30340;&#24341;&#29992;&#20316;&#20026; <tt class="classname">LocalSessionFactoryBean</tt> &#30340; <span class="emphasis"><em>jtaTransactionManager</em></span> &#23646;&#24615;&#12290;Spring&#23558;&#20351;&#36825;&#20010;&#23545;&#35937;&#34987;Hibernate&#25152;&#24863;&#30693;&#12290;
          </p></li><li><p>&#22810;&#25968;&#24773;&#20917;&#19979;&#65292;&#20320;&#36824;&#27809;&#26377;&#24471;&#21040;JTA&#30340; <tt class="interfacename">PlatformTransactionManager</tt> &#23454;&#20363;&#65288;&#30001;&#20110;Spring&#30340; <tt class="classname">JtaTransactionManager</tt> &#33021;&#22815;&#33258;&#24049;&#25214;&#21040;&#23427;&#65289;&#65292;&#25152;&#20197;&#20320;&#38656;&#35201;&#33258;&#34892;&#37197;&#32622;Hibernate&#24182;&#30452;&#25509;&#23547;&#25214;&#36164;&#28304;&#12290;
			&#27491;&#22914;Hibernate&#25991;&#26723;&#20013;&#25552;&#21040;&#30340;&#65292;&#36825;&#21487;&#20197;&#36890;&#36807;&#22312;Hibernate&#37197;&#32622;&#19968;&#20010;&#24212;&#29992;&#26381;&#21153;&#22120;&#29305;&#23450;&#30340; <tt class="literal">TransactionManagerLookup</tt> &#31867;&#26469;&#23436;&#25104;&#12290;
          </p></li></ul></div><p>&#23545;&#20110;&#24688;&#24403;&#30340;&#20351;&#29992;&#26041;&#27861;&#65292;&#20320;&#26080;&#38656;&#20102;&#35299;&#26356;&#22810;&#30340;&#19996;&#35199;&#12290;&#20294;&#26159;&#25105;&#20204;&#22312;&#36825;&#37324;&#23558;&#25551;&#36848;&#19968;&#19979;&#65292;&#23545;&#20110;&#23558;Hibernate&#37197;&#32622;&#20026;&#24863;&#30693;&#25110;&#32773;&#19981;&#24863;&#30693;JTA&#30340; <tt class="interfacename">PlatformTransactionManager</tt> &#23545;&#35937;&#36825;&#20004;&#31181;&#24773;&#20917;&#19979;&#65292;&#25972;&#20010;&#20107;&#21153;&#30340;&#25191;&#34892;&#39034;&#24207;&#12290;</p><p>Hibernate&#34987;&#37197;&#32622;&#25104;&#19981;&#24863;&#30693;JTA <tt class="interfacename">PlatformTransactionManager</tt> &#30340;&#24773;&#20917;&#19979;&#65292;&#24403;&#19968;&#20010;JTA&#20107;&#21153;&#25552;&#20132;&#26102;&#65292;&#25972;&#20010;&#20107;&#20214;&#30340;&#25191;&#34892;&#39034;&#24207;&#22914;&#19979;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p>JTA &#20107;&#21153;&#25552;&#20132;</p></li><li><p>Spring&#30340; <tt class="classname">JtaTransactionManager</tt> &#21516;&#27493;&#21040;JTA&#20107;&#21153;&#65292;&#23427;&#34987;JTA&#20107;&#21153;&#31649;&#29702;&#22120;&#36890;&#36807;&#35843;&#29992; <span class="emphasis"><em>afterCompletion</em></span> &#25191;&#34892;&#22238;&#35843;&#12290;</p></li><li><p>&#22312;&#25152;&#26377;&#20854;&#20182;&#27963;&#21160;&#20013;&#65292;&#36825;&#23558;&#30001;Spring&#21521;Hibernate&#35302;&#21457;&#19968;&#20010;&#22238;&#35843;&#65292;&#36890;&#36807;Hibernate&#30340; <tt class="literal">afterTransactionCompletion</tt> &#22238;&#35843;&#65288;&#29992;&#20110;&#28165;&#38500;Hibernate&#32531;&#23384;&#65289;&#65292;&#28982;&#21518;&#32039;&#36319;&#30528;&#19968;&#20010;&#26126;&#30830;&#30340;Hibernate Session&#30340; <tt class="literal">close()</tt> &#35843;&#29992;&#12290;
			&#36825;&#23558;&#20351;Hibernate&#35797;&#22270;&#21435;&#20851;&#38381;JDBC&#30340;Connection&#12290;</p></li><li><p>&#22312;&#26576;&#20123;&#29615;&#22659;&#20013;&#65292;<tt class="methodname">Connection.close()</tt> &#30340;&#35843;&#29992;&#23558;&#20250;&#35302;&#21457;&#19968;&#20010;&#35686;&#21578;&#25110;&#32773;&#38169;&#35823;&#20449;&#24687;&#12290;
			&#36825;&#26159;&#30001;&#20110;&#29305;&#23450;&#30340;&#24212;&#29992;&#26381;&#21153;&#22120;&#23558;&#19981;&#20877;&#32771;&#34385; <tt class="interfacename">Connection</tt> &#30340;&#21487;&#29992;&#24615;&#65292;&#22240;&#20026;&#27492;&#26102;&#20107;&#21153;&#24050;&#32463;&#34987;&#25552;&#20132;&#20102;&#12290;</p></li></ul></div><p>&#22312;Hibernate&#34987;&#37197;&#32622;&#25104;&#24863;&#30693;JTA&#30340; <tt class="interfacename">PlatformTransactionManager</tt> &#30340;&#24773;&#20917;&#19979;&#65292;&#24403;&#19968;&#20010;JTA&#20107;&#21153;&#25552;&#20132;&#26102;&#65292;&#25972;&#20010;&#20107;&#20214;&#30340;&#25191;&#34892;&#39034;&#24207;&#22914;&#19979;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p>JTA &#20107;&#21153;&#20934;&#22791;&#25552;&#20132;</p></li><li><p>Spring&#30340; <tt class="classname">JtaTransactionManager</tt> &#21516;&#27493;&#21040;JTA&#20107;&#21153;&#65292;&#22240;&#32780;&#23427;&#34987;JTA&#20107;&#21153;&#31649;&#29702;&#22120;&#36890;&#36807;&#35843;&#29992; <span class="emphasis"><em>beforeCompletion</em></span> &#25191;&#34892;&#22238;&#35843;&#12290;</p></li><li><p>Spring&#33021;&#24863;&#30693;&#21040;Hibernate&#33258;&#36523;&#34987;&#21516;&#27493;&#21040;JTA Transaction&#65292;&#22240;&#32780;&#34920;&#29616;&#24471;&#19982;&#20808;&#21069;&#37027;&#31181;&#24773;&#20917;&#26377;&#25152;&#19981;&#21516;&#12290;
			&#20551;&#35774;Hibernate&#30340; <tt class="interfacename">Session</tt> &#38656;&#35201;&#34987;&#20851;&#38381;&#65292;Spring&#23558;&#36127;&#36131;&#20851;&#38381;&#23427;&#12290;</p></li><li><p>JTA &#20107;&#21153;&#25552;&#20132;</p></li><li><p>Hibernate&#23558;&#19982;JTA transaction&#36827;&#34892;&#21516;&#27493;&#65292;&#22240;&#32780;&#23427;&#34987;JTA&#20107;&#21153;&#31649;&#29702;&#22120;&#36890;&#36807;&#35843;&#29992; <span class="emphasis"><em>afterCompletion</em></span> &#25191;&#34892;&#22238;&#35843;&#65292;&#24182;&#19988;&#36866;&#26102;&#22320;&#28165;&#38500;&#32531;&#23384;&#12290;</p></li></ul></div><p></p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="orm-jdo"></a>12.3.&nbsp;JDO</h2></div></div><div></div></div><p>Spring&#25903;&#25345;&#26631;&#20934;&#30340;JDO 1.0/2.0 API&#20316;&#20026;&#25968;&#25454;&#35775;&#38382;&#31574;&#30053;&#65292;&#21516;&#26679;&#36981;&#24490;&#31867;&#20284;&#20110;Spring&#23545;Hibernate&#30340;&#25903;&#25345;&#39118;&#26684;&#12290;&#23545;&#24212;&#30340;&#25903;&#25345;&#19982;&#25972;&#21512;&#31867;&#20301;&#20110; <tt class="literal">org.springframework.orm.jdo</tt> &#21253;&#20013;&#12290;</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-jdo-setup"></a>12.3.1.&nbsp;&#24314;&#31435;<tt class="interfacename">PersistenceManagerFactory</tt>
      </h3></div></div><div></div></div><p>Spring&#25552;&#20379;&#20102;&#19968;&#20010; <tt class="classname">LocalPersistenceManagerFactoryBean</tt> &#31867;&#65292;&#20801;&#35768;&#20320;&#36890;&#36807;Spring&#30340;application context&#26469;&#23450;&#20041;&#19968;&#20010;&#26412;&#22320;&#30340;JDO <tt class="interfacename">PersistenceManagerFactory</tt>&#65306;
      </p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="myPmf" class="org.springframework.orm.jdo.LocalPersistenceManagerFactoryBean"&gt;
    &lt;property name="configLocation" value="classpath:kodo.properties"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><p>&#20316;&#20026;&#21487;&#36873;&#26041;&#26696;&#65292;<tt class="interfacename">PersistenceManagerFactory</tt> &#20063;&#21487;&#20197;&#36890;&#36807;&#30452;&#25509;&#23454;&#20363;&#21270;&#19968;&#20010; <tt class="interfacename">PersistenceManagerFactory</tt> &#30340;&#23454;&#29616;&#31867;&#24471;&#21040;&#12290;
		&#19968;&#20010;JDO <tt class="interfacename">PersistenceManagerFactory</tt> &#30340;&#23454;&#29616;&#31867;&#36981;&#24490;JavaBeans&#30340;&#27169;&#24335;&#65292;&#23427;&#38750;&#24120;&#20687;&#19968;&#20010;JDBC <tt class="interfacename">DataSource</tt> &#30340;&#23454;&#29616;&#31867;&#65292;&#36825;&#20351;&#24471;&#23427;&#22825;&#28982;&#30340;&#38750;&#24120;&#36866;&#21512;&#20316;&#20026;&#19968;&#20010;Spring&#30340;bean&#23450;&#20041;&#12290;
		&#36825;&#31181;&#21019;&#24314;&#39118;&#26684;&#36890;&#24120;&#25903;&#25345;&#19968;&#20010;Spring&#23450;&#20041;&#30340;JDBC <tt class="interfacename">DataSource</tt>&#65292;&#23558;&#23427;&#20256;&#20837;&#21040;&#23545;&#24212;&#30340;&#23454;&#29616;&#31867;&#30340;connectionFactory&#30340;&#23646;&#24615;&#20013;&#36827;&#34892;bean&#30340;&#21019;&#24314;&#12290;&#20855;&#20307;&#30340;&#20363;&#23376;&#21442;&#35265;&#24320;&#28304;&#30340;JDO&#23454;&#29616;JPOX&#65288;<a href="http://www.jpox.org" target="_top">http://www.jpox.org</a>&#65289;&#65306;</p><pre class="programlisting">&lt;beans&gt;

 &lt;bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"&gt;
   &lt;property name="driverClassName" value="${jdbc.driverClassName}"/&gt;
   &lt;property name="url" value="${jdbc.url}"/&gt;
   &lt;property name="username" value="${jdbc.username}"/&gt;
   &lt;property name="password" value="${jdbc.password}"/&gt;
 &lt;/bean&gt;

 &lt;bean id="myPmf" class="org.jpox.PersistenceManagerFactoryImpl" destroy-method="close"&gt;
   &lt;property name="connectionFactory" ref="dataSource"/&gt;
   &lt;property name="nontransactionalRead" value="true"/&gt;
 &lt;/bean&gt;

&lt;/beans&gt;</pre><p>&#19968;&#20010;JDO&#30340; <tt class="interfacename">PersistenceManagerFactory</tt> &#33021;&#22815;&#21516;&#26679;&#22312;&#19968;&#20010;J2EE&#24212;&#29992;&#26381;&#21153;&#22120;&#30340;JNDI&#29615;&#22659;&#19979;&#34987;&#21019;&#24314;&#12290;
		&#36825;&#36890;&#24120;&#30001;&#29305;&#23450;&#30340;JDO&#23454;&#29616;&#25152;&#25552;&#20379;&#30340;JCA&#36830;&#25509;&#22120;&#26469;&#23436;&#25104;&#12290;Spring&#26631;&#20934;&#30340; <tt class="literal">JndiObjectFactoryBean</tt> &#20063;&#33021;&#22815;&#34987;&#29992;&#26469;&#33719;&#21462;&#21644;&#26292;&#38706;&#36825;&#20010; <tt class="interfacename">PersistenceManagerFactory</tt>&#12290;
		&#24403;&#28982;&#65292;&#36890;&#24120;&#22312;&#19968;&#20010;EJB&#29615;&#22659;&#20043;&#22806;&#65292;&#22312;JNDI&#20013;&#25345;&#26377; <tt class="interfacename">PersistenceManagerFactory</tt> &#30340;&#23454;&#20363;&#27809;&#26377;&#20160;&#20040;&#29305;&#21035;&#21560;&#24341;&#20154;&#30340;&#22909;&#22788;&#65292;&#22240;&#32780;&#25105;&#20204;&#19968;&#33324;&#21482;&#22312;&#26377;&#38750;&#24120;&#20805;&#36275;&#30340;&#29702;&#30001;&#26102;&#36873;&#25321;&#36825;&#31181;&#24314;&#31435;&#26041;&#24335;&#12290;
		&#35831;&#21442;&#30475;Hibernate&#31456;&#33410;&#20013;&#8220;&#23481;&#22120;&#36164;&#28304; vs &#26412;&#22320;&#36164;&#28304;&#8221;&#36825;&#19968;&#33410;&#30340;&#35752;&#35770;&#65292;&#37027;&#37324;&#30340;&#35752;&#35770;&#21516;&#26679;&#36866;&#29992;&#20110;JDO&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-jdo-template"></a>12.3.2.&nbsp;<tt class="classname">JdoTemplate</tt>&#21644;<tt class="classname">JdoDaoSupport</tt></h3></div></div><div></div></div><p>
      
       &#27599;&#19968;&#20010;&#22522;&#20110;JDO&#30340;DAO&#31867;&#37117;&#38656;&#35201;&#36890;&#36807;IoC&#26469;&#27880;&#20837;&#19968;&#20010; 
      <tt class="interfacename">PersistenceManagerFactory</tt>&#12290;
			&#36825;&#26679;&#30340;DAO&#31867;&#21487;&#20197;&#22312; <tt class="interfacename">PersistenceManagerFactory</tt> &#30340;&#24110;&#21161;&#19979;&#26469;&#25805;&#20316;&#21407;&#29983;&#30340;JDO API&#36827;&#34892;&#32534;&#31243;&#65292;
			&#20294;&#26159;&#36890;&#24120;&#26469;&#35828;&#25105;&#20204;&#26356;&#24895;&#24847;&#20351;&#29992;Spring&#25552;&#20379;&#30340; <tt class="classname">JdoTemplate</tt>&#65306;
      </p><pre class="programlisting">&lt;beans&gt;
  
  &lt;bean id="myProductDao" class="product.ProductDaoImpl"&gt;
    &lt;property name="persistenceManagerFactory" ref="myPmf"/&gt;
  &lt;/bean&gt;
  
&lt;/beans&gt;</pre><pre class="programlisting">public class ProductDaoImpl implements ProductDao {
  
    private JdoTemplate jdoTemplate;

    public void setPersistenceManagerFactory(PersistenceManagerFactory pmf) {
        this.jdoTemplate = new JdoTemplate(pmf);
    }

    public Collection loadProductsByCategory(final String category) throws DataAccessException {
        return (Collection) this.jdoTemplate.execute(new JdoCallback() {
            public Object doInJdo(PersistenceManager pm) throws JDOException {
                Query query = pm.newQuery(Product.class, "category = pCategory");
                query.declareParameters("String pCategory"); 
                List result = query.execute(category);
                <i class="lineannotation"><span class="lineannotation">// do some further stuff with the result list</span></i>
                return result;
            }
        });
    }
}</pre><p>
       &#19968;&#20010;&#22238;&#35843;&#30340;&#23454;&#29616;&#33021;&#22815;&#26377;&#25928;&#22320;&#22312;&#20219;&#20309;JDO&#25968;&#25454;&#35775;&#38382;&#20013;&#20351;&#29992;&#12290;
      <tt class="classname">JdoTemplate</tt> &#20250;&#30830;&#20445;&#24403;&#21069;&#30340; <tt class="classname">PersistenceManager</tt> 
       &#23545;&#35937;&#30340;&#27491;&#30830;&#25171;&#24320;&#21644;&#20851;&#38381;&#65292;&#24182;&#33258;&#21160;&#21442;&#19982;&#21040;&#20107;&#21153;&#31649;&#29702;&#20013;&#21435;&#12290;
		  Template&#23454;&#20363;&#19981;&#20165;&#26159;&#32447;&#31243;&#23433;&#20840;&#30340;&#65292;&#21516;&#26102;&#23427;&#20063;&#26159;&#21487;&#37325;&#29992;&#30340;&#65292;&#22240;&#32780;&#20182;&#20204;&#21487;&#20197;&#20316;&#20026;&#22806;&#37096;&#23545;&#35937;&#30340;&#23454;&#20363;&#21464;&#37327;&#32780;&#34987;&#25345;&#26377;&#12290;
		  &#23545;&#20110;&#37027;&#20123;&#31616;&#21333;&#30340;&#35832;&#22914; <tt class="literal">find</tt>&#12289;<tt class="literal">load</tt>&#12289;
		  <tt class="literal">makePersistent</tt> &#25110;&#32773; <tt class="literal">delete</tt> &#25805;&#20316;&#30340;&#35843;&#29992;&#65292;
		  <tt class="classname">JdoTemplate</tt> &#25552;&#20379;&#21487;&#36873;&#25321;&#30340;&#24555;&#25463;&#20989;&#25968;&#26469;&#26367;&#25442;&#36825;&#31181;&#22238;&#35843;&#30340;&#23454;&#29616;&#12290;
		  &#19981;&#20165;&#22914;&#27492;&#65292;Spring&#36824;&#25552;&#20379;&#20102;&#19968;&#20010;&#31616;&#20415;&#30340; <tt class="classname">JdoDaoSupport</tt> &#22522;&#31867;&#65292;
		  &#36825;&#20010;&#31867;&#25552;&#20379;&#20102; <tt class="literal">setPersistenceManagerFactory(..)</tt> &#26041;&#27861;&#26469;&#25509;&#21463;&#19968;&#20010; 
		  <tt class="classname">PersistenceManagerFactory</tt> &#23545;&#35937;&#65292;
		  &#21516;&#26102;&#25552;&#20379;&#20102; <tt class="methodname">getPersistenceManagerFactory()</tt> 
		  &#21644; <tt class="methodname">getJdoTemplate()</tt> &#32473;&#23376;&#31867;&#20351;&#29992;&#12290;
		  &#32508;&#21512;&#20102;&#36825;&#20123;&#65292;&#23545;&#20110;&#37027;&#20123;&#20856;&#22411;&#30340;&#19994;&#21153;&#38656;&#27714;&#65292;&#23601;&#26377;&#20102;&#19968;&#20010;&#38750;&#24120;&#31616;&#21333;&#30340;DAO&#23454;&#29616;&#65306;
      </p><pre class="programlisting">public class ProductDaoImpl extends JdoDaoSupport implements ProductDao {
  
    public Collection loadProductsByCategory(String category) throws DataAccessException {
        return getJdoTemplate().find(
            Product.class, "category = pCategory", "String category", new Object[] {category});
    }
}</pre><p>&#20316;&#20026;&#19981;&#20351;&#29992;Spring&#30340; <tt class="classname">JdoTemplate</tt> &#26469;&#23454;&#29616;DAO&#30340;&#26367;&#20195;&#35299;&#20915;&#26041;&#26696;&#65292;&#20320;&#20381;&#28982;&#21487;&#20197;&#36890;&#36807;&#22312;&#21407;&#29983;JDO API&#30340;&#32423;&#21035;&#23545;&#37027;&#20123;&#22522;&#20110;Spring&#30340;DAO&#36827;&#34892;&#32534;&#31243;&#65292;&#27492;&#26102;&#20320;&#24517;&#39035;&#26126;&#30830;&#22320;&#25171;&#24320;&#21644;&#20851;&#38381;&#19968;&#20010; <tt class="interfacename">PersistenceManager</tt>&#12290;
		&#27491;&#22914;&#22312;&#30456;&#24212;&#30340;Hibernate&#31456;&#33410;&#25551;&#36848;&#30340;&#19968;&#26679;&#65292;&#36825;&#31181;&#20570;&#27861;&#30340;&#20027;&#35201;&#20248;&#28857;&#22312;&#20110;&#20320;&#30340;&#25968;&#25454;&#35775;&#38382;&#20195;&#30721;&#21487;&#20197;&#22312;&#25972;&#20010;&#36807;&#31243;&#20013;&#25243;&#20986;checked exceptions&#12290;<tt class="classname">JdoDaoSupport</tt> &#20026;&#36825;&#31181;&#24773;&#20917;&#25552;&#20379;&#20102;&#22810;&#31181;&#20989;&#25968;&#25903;&#25345;&#65292;
		&#21253;&#25324;&#33719;&#21462;&#21644;&#37322;&#25918;&#19968;&#20010;&#20855;&#22791;&#20107;&#21153;&#31649;&#29702;&#21151;&#33021;&#30340; <tt class="interfacename">PersistenceManager</tt> &#21644;&#30456;&#20851;&#30340;&#24322;&#24120;&#36716;&#21270;&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-jdo-daos-straight"></a>12.3.3.&nbsp;
      
      &#22522;&#20110;&#21407;&#29983;&#30340;JDO API&#23454;&#29616;DAO
      </h3></div></div><div></div></div><p>&#25105;&#20204;&#21487;&#20197;&#30452;&#25509;&#25805;&#20316;JDO API&#26469;&#23454;&#29616;DAO&#65292;&#36890;&#36807;&#30452;&#25509;&#20351;&#29992;&#19968;&#20010;&#27880;&#20837;&#30340; <tt class="interfacename">PersistenceManagerFactory</tt>&#65292;&#32780;&#26080;&#38656;&#23545;Spring&#20135;&#29983;&#30340;&#20219;&#20309;&#20381;&#36182;&#12290;
		&#19968;&#20010;&#30456;&#24212;&#30340;DAO&#23454;&#29616;&#30475;&#19978;&#21435;&#23601;&#20687;&#19979;&#38754;&#36825;&#26679;&#65306;</p><pre class="programlisting">public class ProductDaoImpl implements ProductDao {

    private PersistenceManagerFactory persistenceManagerFactory;

    public void setPersistenceManagerFactory(PersistenceManagerFactory pmf) {
        this.persistenceManagerFactory = pmf;
    }

    public Collection loadProductsByCategory(String category) {
        PersistenceManager pm = this.persistenceManagerFactory.getPersistenceManager();
        try {
            Query query = pm.newQuery(Product.class, "category = pCategory");
            query.declareParameters("String pCategory"); 
            return query.execute(category);
        }
        finally {
          pm.close();
        }
    }
}</pre><p>
      
      &#19978;&#38754;&#25105;&#20204;&#25152;&#21015;&#20986;&#30340;DAO&#23436;&#20840;&#36981;&#24490;IoC&#65292;&#23427;&#22914;&#21516;&#20351;&#29992;Spring&#30340; 
      <tt class="classname">JdoTemplate</tt> &#36827;&#34892;&#32534;&#30721;&#37027;&#26679;&#65292;&#38750;&#24120;&#36866;&#21512;&#22312;Spring&#23481;&#22120;&#20013;&#36827;&#34892;&#37197;&#32622;&#65306;
      </p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"&gt;
    &lt;property name="persistenceManagerFactory" ref="myPmf"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><p>&#36825;&#31867;DAO&#30340;&#20027;&#35201;&#38382;&#39064;&#22312;&#20110;&#20182;&#20204;&#27599;&#27425;&#24635;&#26159;&#20174;&#24037;&#21378;&#20013;&#24471;&#21040;&#19968;&#20010;&#26032;&#30340; <tt class="interfacename">PersistenceManager</tt> 
       &#23454;&#20363;&#12290;&#20026;&#20102;&#20381;&#28982;&#33021;&#22815;&#35775;&#38382;&#21463;&#21040;Spring&#31649;&#29702;&#30340;&#12289;&#20855;&#22791;&#20107;&#21153;&#31649;&#29702;&#21151;&#33021;&#30340; <tt class="interfacename">PersistenceManager</tt>&#65292;
       &#19981;&#22952;&#32771;&#34385;&#19968;&#19979;&#22312;&#30446;&#26631; <tt class="interfacename">PersistenceManagerFactory</tt> &#20043;&#21069;&#65292;
			&#23450;&#20041;&#19968;&#20010; <tt class="classname">TransactionAwarePersistenceManagerFactoryProxy</tt>&#65288;Spring&#24050;&#32463;&#25552;&#20379;&#65289;&#65292;
			&#28982;&#21518;&#23558;&#36825;&#20010;&#20195;&#29702;&#27880;&#20837;&#21040;&#20320;&#30340;DAO&#20013;&#21435;&#12290;
      </p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="myPmfProxy"
      class="org.springframework.orm.jdo.TransactionAwarePersistenceManagerFactoryProxy"&gt;
    &lt;property name="targetPersistenceManagerFactory" ref="myPmf"/&gt;
  &lt;/bean&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"&gt;
    &lt;property name="persistenceManagerFactory" ref="myPmfProxy"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><p>
      	&#36825;&#26679;&#65292;&#20320;&#30340;&#25968;&#25454;&#35775;&#38382;&#20195;&#30721;&#23601;&#21487;&#20197;&#36890;&#36807; <tt class="methodname">PersistenceManagerFactory.getPersistenceManager()</tt> 
       	&#26041;&#27861;&#24471;&#21040;&#19968;&#20010;&#20855;&#22791;&#20107;&#21153;&#31649;&#29702;&#21151;&#33021;&#30340; <tt class="interfacename">PersistenceManager</tt>&#12290;
				&#32780;&#36825;&#19968;&#26041;&#27861;&#23558;&#36890;&#36807;&#20195;&#29702;&#31867;&#30340;&#22788;&#29702;&#65306;&#22312;&#20174;&#24037;&#21378;&#33719;&#21462;&#19968;&#20010;&#26032;&#30340; <tt class="interfacename">PersistenceManager</tt> 
				&#23454;&#20363;&#20043;&#21069;&#26816;&#26597;&#19968;&#19979;&#24403;&#21069;&#20855;&#22791;&#20107;&#21153;&#31649;&#29702;&#21151;&#33021;&#30340; <tt class="interfacename">PersistenceManager</tt>&#65292;
				&#22914;&#26524;&#36825;&#26159;&#19968;&#20010;&#20855;&#22791;&#20107;&#21153;&#31649;&#29702;&#21151;&#33021;&#30340; <tt class="interfacename">PersistenceManager</tt>&#65292;
				<tt class="methodname">close()</tt> &#35843;&#29992;&#22312;&#27492;&#26102;&#23558;&#34987;&#24573;&#30053;&#12290;
      </p><p>
      	&#22914;&#26524;&#20320;&#30340;&#25968;&#25454;&#35775;&#38382;&#20195;&#30721;&#24635;&#26159;&#22312;&#19968;&#20010;&#22788;&#20110;&#27963;&#36291;&#29366;&#24577;&#30340;&#20107;&#21153;&#20013;&#25191;&#34892;&#65288;&#25110;&#32773;&#33267;&#23569;&#22312;&#19968;&#20010;&#27963;&#36291;&#30340;&#20107;&#21153;&#21516;&#27493;&#20013;&#65289;&#65292;
      	&#37027;&#20040;&#20320;&#33021;&#22815;&#38750;&#24120;&#23433;&#20840;&#22320;&#24573;&#30053; <tt class="methodname">PersistenceManager.close()</tt> &#30340;&#35843;&#29992;&#21644;&#25972;&#20010; 
      	<tt class="literal">finally</tt> &#22359;&#30340;&#20195;&#30721;&#12290;&#36825;&#23558;&#20351;&#20320;&#30340;DAO&#23454;&#29616;&#21464;&#24471;&#27604;&#36739;&#31616;&#27905;&#65306;
      </p><pre class="programlisting">public class ProductDaoImpl implements ProductDao {

    private PersistenceManagerFactory persistenceManagerFactory;

    public void setPersistenceManagerFactory(PersistenceManagerFactory pmf) {
        this.persistenceManagerFactory = pmf;
    }

    public Collection loadProductsByCategory(String category) {
        PersistenceManager pm = this.persistenceManagerFactory.getPersistenceManager();
        Query query = pm.newQuery(Product.class, "category = pCategory");
        query.declareParameters("String pCategory"); 
        return query.execute(category);
    }
}</pre><p>&#23545;&#20110;&#36825;&#31181;&#20381;&#36182;&#20110;&#27963;&#36291;&#20107;&#21153;&#30340;DAO&#65292;&#27604;&#36739;&#25512;&#33616;&#30340;&#20570;&#27861;&#26159;&#23558; 
      <tt class="classname">TransactionAwarePersistenceManagerFactoryProxy</tt> 
      &#20013;&#30340;"allowCreate"&#26631;&#24535;&#20851;&#38381;&#65292;&#20174;&#32780;&#24378;&#21046;&#27963;&#36291;&#20107;&#21153;&#12290;</p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="myPmfProxy"
      class="org.springframework.orm.jdo.TransactionAwarePersistenceManagerFactoryProxy"&gt;
    &lt;property name="targetPersistenceManagerFactory" ref="myPmf"/&gt;
    &lt;property name="allowCreate" value="false"/&gt;
  &lt;/bean&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"&gt;
    &lt;property name="persistenceManagerFactory" ref="myPmfProxy"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><p>&#36825;&#31181;DAO&#35775;&#38382;&#26041;&#24335;&#30340;&#20027;&#35201;&#20248;&#21183;&#22312;&#20110;&#23427;&#20165;&#20165;&#20381;&#36182;&#20110;JDO API&#26412;&#36523;&#32780;&#26080;&#38656;&#24341;&#20837;&#20219;&#20309;&#30340;Spring&#30340;&#31867;&#12290;
      &#20174;&#26080;&#20837;&#20405;&#24615;&#30340;&#35282;&#24230;&#26469;&#30475;&#65292;&#36825;&#19968;&#28857;&#38750;&#24120;&#21560;&#24341;&#20154;&#12290;&#21516;&#26102;&#65292;&#23545;&#20110;JDO&#24320;&#21457;&#20154;&#21592;&#26469;&#35828;&#20063;&#26356;&#33258;&#28982;&#12290;</p><p>
      	&#28982;&#32780;&#65292;&#36825;&#26679;&#30340;DAO&#35775;&#38382;&#26041;&#24335;&#20250;&#25243;&#20986; <tt class="exceptionname">JDOException</tt>&#65292;
      	&#36825;&#26159;&#19968;&#20010;&#26080;&#38656;&#22768;&#26126;&#25110;&#25429;&#33719;&#30340;unchecked exception&#12290;&#36825;&#24847;&#21619;&#30528;&#65292;DAO&#30340;&#35843;&#29992;&#32773;&#21482;&#33021;&#20197;&#26222;&#36890;&#30340;&#38169;&#35823;&#26469;&#22788;&#29702;&#36825;&#20123;&#24322;&#24120;&#65292;
      	&#38500;&#38750;&#23436;&#20840;&#20381;&#36182;JDO&#33258;&#36523;&#30340;&#24322;&#24120;&#20307;&#31995;&#12290;&#22240;&#32780;&#65292;&#38500;&#38750;&#20320;&#23558;DAO&#30340;&#35843;&#29992;&#32773;&#32465;&#23450;&#21040;&#20855;&#20307;&#30340;&#23454;&#29616;&#31574;&#30053;&#19978;&#21435;&#65292;
      	&#21542;&#21017;&#20320;&#23558;&#26080;&#27861;&#25429;&#33719;&#29305;&#23450;&#30340;&#24322;&#24120;&#21407;&#22240;&#65288;&#35832;&#22914;&#20048;&#35266;&#38145;&#24322;&#24120;&#65289;&#12290;&#36825;&#31181;&#25240;&#20013;&#24179;&#34913;&#25110;&#35768;&#21487;&#20197;&#34987;&#25509;&#21463;&#65292;
      	&#22914;&#26524;&#20320;&#30340;&#24212;&#29992;&#23436;&#20840;&#22522;&#20110;JDO&#25110;&#32773;&#26080;&#38656;&#36827;&#34892;&#29305;&#27530;&#30340;&#24322;&#24120;&#22788;&#29702;&#12290;
      </p><p>
      	&#24635;&#20307;&#26469;&#35828;&#65292;DAO&#21487;&#20197;&#22522;&#20110;JDO&#30340;&#21407;&#29983;API&#23454;&#29616;&#65292;&#21516;&#26102;&#65292;&#23427;&#20381;&#26087;&#38656;&#35201;&#33021;&#22815;&#21442;&#19982;&#21040;Spring&#30340;&#20107;&#21153;&#31649;&#29702;&#20013;&#12290;
			&#36825;&#23545;&#20110;&#37027;&#20123;&#24050;&#32463;&#23545;JDO&#38750;&#24120;&#29087;&#24713;&#30340;&#20154;&#26469;&#35828;&#24456;&#26377;&#21560;&#24341;&#21147;&#65292;&#22240;&#20026;&#36825;&#31181;&#26041;&#24335;&#26356;&#21152;&#33258;&#28982;&#12290;
			&#19981;&#36807;&#65292;&#36825;&#31181;DAO&#23558;&#25243;&#20986; <tt class="exceptionname">JDOException</tt>&#65292;&#22240;&#32780;&#65292;
			&#22914;&#26524;&#26377;&#24517;&#35201;&#30340;&#35805;&#38656;&#35201;&#26126;&#30830;&#22320;&#21435;&#20570;&#30001; <tt class="exceptionname">JDOException</tt> &#21040;Spring&#30340; 
			<tt class="exceptionname">DataAccessException</tt> &#30340;&#36716;&#21270;&#12290;
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-jdo-tx"></a>12.3.4.&nbsp;&#20107;&#21153;&#31649;&#29702;</h3></div></div><div></div></div><p>&#23558;&#20107;&#21153;&#31649;&#29702;&#32435;&#20837;&#21040;Service&#25805;&#20316;&#30340;&#25191;&#34892;&#20013;&#65292;&#20320;&#21487;&#20197;&#20351;&#29992;Spring&#36890;&#29992;&#30340;&#22768;&#26126;&#24335;&#30340;&#20107;&#21153;&#31649;&#29702;&#21151;&#33021;&#65292;
      &#21442;&#21152;&#19979;&#38754;&#30340;&#20363;&#23376;&#65306;</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans
        xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:aop="http://www.springframework.org/schema/aop"
        xmlns:tx="http://www.springframework.org/schema/tx"
        xsi:schemaLocation="
   http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
   http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd
   http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd"&gt;

  &lt;bean id="myTxManager" class="org.springframework.orm.jdo.JdoTransactionManager"&gt;
    &lt;property name="persistenceManagerFactory" ref="myPmf"/&gt;
  &lt;/bean&gt;

  &lt;bean id="myProductService" class="product.ProductServiceImpl"&gt;
    &lt;property name="productDao" ref="myProductDao"/&gt;
  &lt;/bean&gt;

  &lt;tx:advice id="txAdvice" transaction-manager="txManager"&gt;
    &lt;tx:attributes&gt;
      &lt;tx:method name="increasePrice*" propagation="REQUIRED"/&gt;
      &lt;tx:method name="someOtherBusinessMethod" propagation="REQUIRES_NEW"/&gt;
      &lt;tx:method name="*" propagation="SUPPORTS" read-only="true"/&gt;
    &lt;/tx:attributes&gt;
  &lt;/tx:advice&gt;

  &lt;aop:config&gt;
    &lt;aop:pointcut id="productServiceMethods" expression="execution(* product.ProductService.*(..))"/&gt;
    &lt;aop:advisor advice-ref="txAdvice" pointcut-ref="productServiceMethods"/&gt;
  &lt;/aop:config&gt;

&lt;/beans&gt;</pre><p>&#27880;&#24847;&#65292;JDO&#35201;&#27714;&#20320;&#24517;&#39035;&#22312;&#19968;&#20010;&#27963;&#36291;&#30340;&#20107;&#21153;&#20013;&#20462;&#25913;&#19968;&#20010;&#25345;&#20037;&#21270;&#23545;&#35937;&#12290;
       &#19982;Hibernate&#30456;&#27604;&#65292;&#22312;JDO&#20013;&#24182;&#27809;&#26377;&#19968;&#31181;&#31867;&#20284;&#33073;&#31163;&#20107;&#21153;&#21047;&#20986;&#65288;non-transactional flush&#65289;&#30340;&#27010;&#24565;&#12290;
			&#22522;&#20110;&#36825;&#31181;&#21407;&#22240;&#65292;&#20320;&#25152;&#36873;&#25321;&#30340;JDO&#23454;&#29616;&#38656;&#35201;&#34987;&#24314;&#31435;&#22312;&#29305;&#23450;&#30340;&#29615;&#22659;&#20013;&#65292;&#23588;&#20854;&#26159;&#23427;&#38656;&#35201;&#20026;JTA&#21516;&#27493;&#20570;&#26126;&#30830;&#30340;&#21019;&#24314;&#65292;
			&#30001;&#27492;&#26469;&#33258;&#34892;&#26816;&#27979;&#19968;&#20010;JTA&#20107;&#21153;&#12290;&#36825;&#19968;&#28857;&#23545;&#20110;&#26412;&#22320;&#20107;&#21153;&#19981;&#26159;&#24517;&#35201;&#30340;&#65292;&#30001;&#20110;&#23427;&#24050;&#32463;&#34987;Spring&#30340; 
			<tt class="classname">JdoTransactionManager</tt> &#22788;&#29702;&#65292;&#20294;&#26159;&#23545;&#20110;&#38656;&#35201;&#21442;&#19982;&#21040;JTA&#20107;&#21153;&#20013;&#30340;&#24773;&#20917;&#65292;&#26159;&#24517;&#39035;&#30340;
			&#65288;&#26080;&#35770;&#26159;&#30001;Spring&#30340; <tt class="classname">JtaTransactionManager</tt>&#12289;EJB CMT&#25110;&#32773;&#26222;&#36890;&#30340;JTA&#25152;&#39537;&#21160;&#30340;&#20107;&#21153;&#65289;&#12290;
			</p><p>
      	<tt class="classname">JdoTransactionManager</tt> &#33021;&#22815;&#23558;&#19968;&#20010;JDO&#20107;&#21153;&#26292;&#38706;&#32473;&#35775;&#38382;&#30456;&#21516;&#30340;JDBC 
      	<tt class="interfacename">DataSource</tt> &#30340;JDBC&#35775;&#38382;&#20195;&#30721;&#12290;&#21069;&#25552;&#26465;&#20214;&#26159;&#65292;&#34987;&#27880;&#20876;&#30340; 
      	<tt class="classname">JdoDialect</tt> &#33021;&#22815;&#25903;&#25345;&#33719;&#21462;&#24213;&#23618;&#30340;JDBC <tt class="interfacename">Connection</tt>&#12290;
				&#36825;&#19968;&#21151;&#33021;&#40664;&#35748;&#34987;&#22522;&#20110;JDBC&#30340;JDO 2.0 &#23454;&#29616;&#12290;&#23545;&#20110;JDO 1.0&#30340;&#23454;&#29616;&#65292;&#24517;&#39035;&#27880;&#20876;&#19968;&#20010;&#29992;&#25143;&#33258;&#23450;&#20041;&#30340; 
				<tt class="classname">JdoDialect</tt>&#12290;&#20855;&#20307;&#21442;&#35265;&#19979;&#19968;&#33410;&#26377;&#20851; <tt class="classname">JdoDialect</tt> &#30340;&#26426;&#21046;&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-jdo-dialect"></a>12.3.5.&nbsp;<tt class="interfacename">JdoDialect</tt></h3></div></div><div></div></div><p>
      
      	&#20316;&#20026;&#39640;&#32423;&#29305;&#24615;&#65292;<tt class="classname">JdoTemplate</tt> &#21644; <tt class="classname">interfacename</tt> 
      	&#37117;&#25903;&#25345;&#19968;&#20010;&#29992;&#25143;&#33258;&#23450;&#20041;&#30340; <tt class="interfacename">JdoDialect</tt> &#20316;&#20026;&#8220;jdoDialect&#8221;&#30340;bean&#23646;&#24615;&#36827;&#34892;&#27880;&#20837;&#12290;
				&#22312;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;DAO&#23558;&#19981;&#20877;&#25509;&#25910; <tt class="interfacename">PersistenceManagerFactory</tt> &#30340;&#24341;&#29992;&#20316;&#20026;&#21442;&#25968;&#65292;
				&#32780;&#26159;&#25509;&#25910;&#19968;&#20010;&#23436;&#25972;&#30340; <tt class="classname">JdoTemplate</tt> &#23454;&#20363;&#65288;&#20063;&#23601;&#26159;&#23558;&#23427;&#27880;&#20837;&#21040; 
				<tt class="classname">JdoDaoSupport</tt> &#30340;"jdoTemplate"&#23646;&#24615;&#20013;&#21435;&#65289;&#12290;&#19968;&#20010; <tt class="interfacename">JdoDialect</tt> 
				&#23454;&#29616;&#33021;&#22815;&#28608;&#27963;&#19968;&#20123;&#30001;Spring&#25903;&#25345;&#30340;&#39640;&#32423;&#29305;&#24615;&#65292;&#36825;&#36890;&#24120;&#30001;&#29305;&#23450;&#30340;&#23454;&#29616;&#20379;&#24212;&#21830;&#25351;&#23450;&#65306;
      </p><div class="itemizedlist"><ul type="disc"><li><p>&#25191;&#34892;&#29305;&#23450;&#30340;&#20107;&#21153;&#35821;&#20041;&#65288;&#20363;&#22914;&#29992;&#25143;&#33258;&#23450;&#20041;&#30340;&#20107;&#21153;&#38548;&#31163;&#32423;&#21035;&#21644;&#20107;&#21153;&#36229;&#26102;&#65289;</p></li><li><p>&#33719;&#21462;&#20855;&#22791;&#20107;&#21153;&#21151;&#33021;&#30340;JDBC <tt class="interfacename">Connection</tt> &#65288;&#26292;&#38706;&#32473;&#22522;&#20110;JDBC&#30340;DAO&#65289;</p></li><li><p>&#24212;&#29992;&#26597;&#35810;&#36229;&#26102;&#21151;&#33021;&#65288;&#33258;&#21160;&#22320;&#20174;Spring&#31649;&#29702;&#30340;&#20107;&#21153;&#36229;&#26102;&#20013;&#35745;&#31639;&#65289;</p></li><li><p>&#21450;&#26102;&#21047;&#20986; <tt class="interfacename">PersistenceManager</tt> &#65288;&#20351;&#24471;&#20107;&#21153;&#21464;&#21270;&#23545;&#20110;&#22522;&#20110;JDBC&#30340;&#25968;&#25454;&#35775;&#38382;&#20195;&#30721;&#21487;&#35265;&#65289;</p></li><li><p>&#20174; <tt class="literal">JDOExceptions</tt> &#21040;Spring&#30340; <tt class="literal">DataAccessExceptions</tt> &#30340;&#39640;&#32423;&#36716;&#21270;</p></li></ul></div><p>&#36825;&#23545;&#20110;JDO 1.0&#30340;&#23454;&#29616;&#26377;&#29305;&#21035;&#30340;&#20215;&#20540;&#65292;&#30001;&#20110;&#36825;&#20123;&#29305;&#24615;&#37117;&#27809;&#26377;&#22312;&#20854;&#26631;&#20934;&#30340;API&#20013;&#21253;&#21547;&#12290;
			&#23545;&#20110;JDO 2.0&#65292;&#20854;&#20013;&#30340;&#32477;&#22823;&#22810;&#25968;&#30340;&#29305;&#24615;&#24050;&#32463;&#20197;&#26631;&#20934;&#30340;&#26041;&#24335;&#34987;&#25903;&#25345;&#12290;&#22240;&#32780;&#65292;Spring&#30340; <tt class="literal">DefaultJdoDialect</tt> 
			&#22312;&#40664;&#35748;&#24773;&#20917;&#19979;&#65288;Spring 1.2&#21518;&#65289;&#20351;&#29992;&#30456;&#24212;&#30340;JDO 2.0 API&#20989;&#25968;&#12290;&#23545;&#20110;&#29305;&#27530;&#30340;&#20107;&#21153;&#35821;&#20041;&#21644;&#24322;&#24120;&#30340;&#39640;&#32423;&#36716;&#21270;&#36825;&#26679;&#30340;&#39640;&#32423;&#29305;&#24615;&#65292;
			&#33719;&#21462;&#21644;&#20351;&#29992;JDO&#23454;&#29616;&#20379;&#24212;&#21830;&#29305;&#23450;&#30340; <tt class="classname">JdoDialect</tt> &#23376;&#31867;&#36824;&#26159;&#27604;&#36739;&#26377;&#20215;&#20540;&#30340;&#12290;
			</p><p>&#26356;&#22810;&#26377;&#20851;&#23427;&#30340;&#25805;&#20316;&#20197;&#21450;&#23427;&#22914;&#20309;&#22312;Spring&#30340;JDO&#25903;&#25345;&#20013;&#20351;&#29992;&#30340;&#35814;&#32454;&#20449;&#24687;&#35831;&#21442;&#30475;
       <tt class="classname">JdoDialect</tt> &#30340;Javadoc&#12290;</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="orm-toplink"></a>12.4.&nbsp;Oracle TopLink</h2></div></div><div></div></div><p>
    Spring&#20174;Spring 1.2&#29256;&#26412;&#24320;&#22987;&#25903;&#25345;Oracle TopLink &#65288;<a href="http://www.oracle.com/technology/products/ias/toplink" target="_top">http://www.oracle.com/technology/products/ias/toplink</a>&#65289;
    &#20316;&#20026;&#25968;&#25454;&#35775;&#38382;&#31574;&#30053;&#65292;&#21516;&#26679;&#36981;&#24490;&#31867;&#20284;&#20110;Spring&#23545;Hibernate&#30340;&#25903;&#25345;&#39118;&#26684;&#12290;Spring&#23545;&#20854;&#30340;&#25903;&#25345;&#21253;&#25324;
    TopLink 9.0.4&#65288;Spring 1.2&#25903;&#25345;&#30340;&#20135;&#21697;&#29256;&#26412;&#65289;&#21644;TopLink 10.1.3&#65288;Spring 1.2&#25903;&#25345;&#30340;&#65292;&#20381;&#28982;&#22788;&#20110;beta&#29256;&#65289;&#12290;
		&#23545;&#24212;&#30340;&#25903;&#25345;&#19982;&#25972;&#21512;&#31867;&#20301;&#20110; <tt class="literal">org.springframework.orm.toplink</tt> &#21253;&#20013;&#12290;
		</p><p>
    TopLink&#25903;&#25345;&#30001;Spring&#21644;Oracle TopLink&#22242;&#38431;&#20849;&#21516;&#24320;&#21457;&#12290;
		&#38750;&#24120;&#24863;&#35874;TopLink&#22242;&#38431;&#65292;&#23588;&#20854;&#26159;Jim Clark&#65292;&#26367;&#25105;&#20204;&#38416;&#26126;&#20102;&#25152;&#26377;&#26041;&#38754;&#30340;&#32454;&#33410;&#65281;
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-toplink-abstraction"></a>12.4.1.&nbsp;<tt class="interfacename">SessionFactory</tt> &#25277;&#35937;&#23618;</h3></div></div><div></div></div><p>
      	TopLink&#26412;&#36523;&#24182;&#27809;&#26377;&#25552;&#20379;SessionFactory&#25277;&#35937;&#23618;&#36923;&#36753;&#65292;&#22810;&#32447;&#31243;&#30340;&#25968;&#25454;&#35775;&#38382;&#26159;&#24314;&#31435;&#22312;&#20013;&#22830; 
      	<tt class="literal">ServerSession</tt> &#19978;&#30340;&#12290;&#23545;&#20110;&#21333;&#32447;&#31243;&#35775;&#38382;&#65292;
      	&#36825;&#20010;&#20013;&#22830; <tt class="literal">ServerSession</tt> &#20250;&#20026;&#23427;&#19968;&#20010; 
      	<tt class="literal">ClientSession</tt> &#30340;&#23454;&#20363;&#20379;&#20854;&#20351;&#29992;&#12290;&#20026;&#20102;&#25552;&#20379;&#28789;&#27963;&#20415;&#25463;&#30340;&#21019;&#24314;&#36873;&#39033;&#65292;
      	Spring&#20026;TopLink&#23450;&#20041;&#20102;&#19968;&#20010; <tt class="interfacename">SessionFactory</tt> &#25509;&#21475;&#65292;
      	&#20174;&#32780;&#20351;&#20320;&#21487;&#20197;&#20219;&#24847;&#22320;&#22312;&#19981;&#21516;&#30340; <tt class="interfacename">Session</tt> &#21019;&#24314;&#31574;&#30053;&#20043;&#38388;&#36827;&#34892;&#20999;&#25442;&#12290;
      </p><p>
      	&#20316;&#20026;&#19968;&#20010;&#19968;&#31449;&#24335;&#30340;&#21830;&#24215;&#65292;Spring&#25552;&#20379;&#20102;&#19968;&#20010; <tt class="classname">LocalSessionFactoryBean</tt> &#31867;&#65292;
     	 	&#20801;&#35768;&#20320;&#20197;bean&#39118;&#26684;&#30340;&#37197;&#32622;&#26041;&#24335;&#26469;&#23450;&#20041;&#19968;&#20010;TopLink&#30340; <tt class="interfacename">SessionFactory</tt>&#12290;
				&#38656;&#35201;&#36827;&#34892;&#37197;&#32622;&#30340;&#22320;&#26041;&#20027;&#35201;&#26159;TopLink session&#37197;&#32622;&#25991;&#20214;&#65292;&#36890;&#24120;&#26469;&#35828;&#36824;&#38656;&#37197;&#32622;&#19968;&#20010;&#21463;&#21040;Spring&#31649;&#29702;&#30340;JDBC 
				<tt class="interfacename">DataSource</tt>&#12290;
      </p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"&gt;
    &lt;property name="driverClassName" value="${jdbc.driverClassName}"/&gt;
    &lt;property name="url" value="${jdbc.url}"/&gt;
    &lt;property name="username" value="${jdbc.username}"/&gt;
    &lt;property name="password" value="${jdbc.password}"/&gt;
  &lt;/bean&gt;

  &lt;bean id="mySessionFactory" class="org.springframework.orm.toplink.LocalSessionFactoryBean"&gt;
    &lt;property name="configLocation" value="toplink-sessions.xml"/&gt;
    &lt;property name="dataSource" ref="dataSource"/&gt;
  &lt;/bean&gt;
    
&lt;/beans&gt;</pre><pre class="programlisting">&lt;toplink-configuration&gt;

  &lt;session&gt;
    &lt;name&gt;Session&lt;/name&gt;
    &lt;project-xml&gt;toplink-mappings.xml&lt;/project-xml&gt;
    &lt;session-type&gt;
      &lt;server-session/&gt;
    &lt;/session-type&gt;
    &lt;enable-logging&gt;true&lt;/enable-logging&gt;
    &lt;logging-options/&gt;
  &lt;/session&gt;

&lt;/toplink-configuration&gt;</pre><p>
      	&#36890;&#24120;&#24773;&#20917;&#19979;&#65292;<tt class="classname">LocalSessionFactoryBean</tt> &#22312;&#24213;&#23618;&#23558;&#25345;&#26377;&#19968;&#20010;&#22810;&#32447;&#31243;&#30340;TopLink 
      	<tt class="literal">ServerSession</tt> &#24182;&#21019;&#24314;&#21512;&#36866;&#30340;&#23458;&#25143;&#31471; <tt class="interfacename">Session</tt>&#65306;
				&#23427;&#25110;&#32773;&#26159;&#19968;&#20010;&#26222;&#36890;&#30340; <tt class="interfacename">Session</tt>&#65288;&#20856;&#22411;&#24773;&#20917;&#65289; &#8212;&#8212; &#19968;&#20010;&#21463;&#31649;&#29702;&#30340; <tt class="literal">ClientSession</tt>&#65307;
				&#25110;&#32773;&#26159;&#19968;&#20010;&#20855;&#22791;&#20107;&#21153;&#21151;&#33021;&#30340; <tt class="interfacename">Session</tt> &#65288;&#21518;&#32773;&#20027;&#35201;&#22312;Spring&#20869;&#37096;&#23545;TopLink&#30340;&#25903;&#25345;&#20013;&#34987;&#20351;&#29992;&#65289;&#12290;
				&#36824;&#26377;&#19968;&#31181;&#24773;&#20917;&#65292;<tt class="classname">LocalSessionFactoryBean</tt> &#21487;&#33021;&#20250;&#25345;&#26377;&#19968;&#20010;&#21333;&#32447;&#31243;&#30340;TopLink&#30340; 
				<tt class="literal">DatabaseSession</tt>&#65292;&#36825;&#26159;&#38750;&#24120;&#29305;&#27530;&#30340;&#24773;&#20917;&#20102;&#12290;
			</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-toplink-template"></a>12.4.2.&nbsp;<tt class="classname">TopLinkTemplate</tt> and
      <tt class="classname">TopLinkDaoSupport</tt></h3></div></div><div></div></div><p>
      	&#27599;&#20010;&#22522;&#20110;TopLink&#30340;DAO&#23558;&#36890;&#36807;IoC&#34987;&#27880;&#20837;&#19968;&#20010; <tt class="interfacename">SessionFactory</tt>&#65292;
      	&#20320;&#21487;&#20197;&#36890;&#36807;Setter&#26041;&#24335;&#27880;&#20837;&#65292;&#20063;&#21487;&#20197;&#29992;&#26500;&#36896;&#20989;&#25968;&#26041;&#24335;&#27880;&#20837;&#12290;&#36825;&#26679;&#30340;DAO&#21487;&#20197;&#30452;&#25509;&#25805;&#20316;&#21407;&#29983;&#30340;TopLink API&#65292;&#36890;&#36807; 
      	<tt class="interfacename">SessionFactory</tt> &#26469;&#33719;&#21462;&#19968;&#20010; <tt class="interfacename">Session</tt>&#65292;
      	&#20294;&#26159;&#36890;&#24120;&#24773;&#20917;&#19979;&#65292;&#20320;&#26356;&#24895;&#24847;&#20351;&#29992;Spring&#30340; <tt class="literal">TopLinkTemplate</tt>&#65306;
      </p><pre class="programlisting">&lt;beans&gt;
  
  &lt;bean id="myProductDao" class="product.ProductDaoImpl"&gt;
    &lt;property name="sessionFactory" ref="mySessionFactory"/&gt;
  &lt;/bean&gt;
  
&lt;/beans&gt;</pre><pre class="programlisting">public class TopLinkProductDao implements ProductDao {
  
    private TopLinkTemplate tlTemplate;

    public void setSessionFactory(SessionFactory sessionFactory) {
        this.tlTemplate = new TopLinkTemplate(sessionFactory);
    }

    public Collection loadProductsByCategory(final String category) throws DataAccessException {
        return (Collection) this.tlTemplate.execute(new TopLinkCallback() {
            public Object doInTopLink(Session session) throws TopLinkException {
                ReadAllQuery findOwnersQuery = new ReadAllQuery(Product.class);
                findOwnersQuery.addArgument("Category");
                ExpressionBuilder builder = this.findOwnersQuery.getExpressionBuilder();
                findOwnersQuery.setSelectionCriteria(
                    builder.get("category").like(builder.getParameter("Category")));

                Vector args = new Vector();
                args.add(category);
                List result = session.executeQuery(findOwnersQuery, args);
                <i class="lineannotation"><span class="lineannotation">// do some further stuff with the result list</span></i>
                return result;
            }
        });
    }
}</pre><p>
      	&#19968;&#20010;&#22238;&#35843;&#30340;&#23454;&#29616;&#33021;&#22815;&#26377;&#25928;&#22320;&#22312;&#20219;&#20309;TopLink&#25968;&#25454;&#35775;&#38382;&#20013;&#20351;&#29992;&#12290;<tt class="classname">TopLinkTemplate</tt> 
      	&#20250;&#30830;&#20445;&#24403;&#21069;&#30340; <tt class="interfacename">Session</tt> &#23545;&#35937;&#30340;&#27491;&#30830;&#25171;&#24320;&#21644;&#20851;&#38381;&#65292;&#24182;&#33258;&#21160;&#21442;&#19982;&#21040;&#20107;&#21153;&#31649;&#29702;&#20013;&#21435;&#12290;
				Template&#23454;&#20363;&#19981;&#20165;&#26159;&#32447;&#31243;&#23433;&#20840;&#30340;&#65292;&#21516;&#26102;&#23427;&#20063;&#26159;&#21487;&#37325;&#29992;&#30340;&#12290;&#22240;&#32780;&#20182;&#20204;&#21487;&#20197;&#20316;&#20026;&#22806;&#37096;&#23545;&#35937;&#30340;&#23454;&#20363;&#21464;&#37327;&#32780;&#34987;&#25345;&#26377;&#12290;&#23545;&#20110;&#37027;&#20123;&#31616;&#21333;&#30340;&#35832;&#22914; 
				<tt class="literal">executeQuery</tt>&#12289;<tt class="literal">readAll</tt>&#12289;<tt class="literal">readById</tt> &#21644; 
				<tt class="literal">merge</tt> &#25805;&#20316;&#30340;&#35843;&#29992;&#65292;<tt class="classname">TopLinkTemplate</tt>
				&#65288;&#35793;&#32773;&#27880;&#65306;&#21407;&#25991;&#35823;&#20889;&#25104;<tt class="classname">JdoTemplate</tt>&#65289;&#25552;&#20379;&#21487;&#36873;&#25321;&#30340;&#24555;&#25463;&#20989;&#25968;&#26469;&#26367;&#25442;&#36825;&#31181;&#22238;&#35843;&#30340;&#23454;&#29616;&#12290;
				&#19981;&#20165;&#22914;&#27492;&#65292;Spring&#36824;&#25552;&#20379;&#20102;&#19968;&#20010;&#31616;&#20415;&#30340; <tt class="classname">TopLinkDaoSupport</tt> &#22522;&#31867;&#65292;&#36825;&#20010;&#31867;&#25552;&#20379;&#20102; 
				<tt class="literal">setSessionFactory(..)</tt> &#26041;&#27861;&#26469;&#25509;&#21463;&#19968;&#20010; <tt class="interfacename">SessionFactory</tt> 
				&#23545;&#35937;&#65292;&#21516;&#26102;&#25552;&#20379;&#20102; <tt class="literal">getSessionFactory()</tt> &#21644; <tt class="literal">getTopLinkTemplate()</tt> 
				&#26041;&#27861;&#32473;&#23376;&#31867;&#20351;&#29992;&#12290;&#32508;&#21512;&#20102;&#36825;&#20123;&#65292;&#23545;&#20110;&#37027;&#20123;&#20856;&#22411;&#30340;&#19994;&#21153;&#38656;&#27714;&#65292;&#23601;&#26377;&#20102;&#19968;&#20010;&#38750;&#24120;&#31616;&#21333;&#30340;DAO&#23454;&#29616;&#12290;
      </p><pre class="programlisting">public class ProductDaoImpl extends TopLinkDaoSupport implements ProductDao {
  
    public Collection loadProductsByCategory(String category) throws DataAccessException {
        ReadAllQuery findOwnersQuery = new ReadAllQuery(Product.class);
        findOwnersQuery.addArgument("Category");
        ExpressionBuilder builder = this.findOwnersQuery.getExpressionBuilder();
        findOwnersQuery.setSelectionCriteria(
            builder.get("category").like(builder.getParameter("Category")));

        return getTopLinkTemplate().executeQuery(findOwnersQuery, new Object[] {category});
    }
}</pre><p>&#36793;&#27880;&#65306;TopLink&#26597;&#35810;&#23545;&#35937;&#26159;&#32447;&#31243;&#23433;&#20840;&#30340;&#65292;&#24182;&#19988;&#33021;&#22815;&#22312;DAO&#23618;&#34987;&#32531;&#23384;&#12290;&#22312;&#19968;&#24320;&#22987;&#34987;&#21019;&#24314;&#26102;&#20197;&#23454;&#20363;&#21464;&#37327;&#30340;&#26041;&#24335;&#34987;&#20445;&#25345;&#12290;</p><p>
      	&#20316;&#20026;&#19981;&#20351;&#29992;Spring&#30340; <tt class="classname">TopLinkTemplate</tt> &#26469;&#23454;&#29616;DAO&#30340;&#26367;&#20195;&#35299;&#20915;&#26041;&#26696;&#65292;
      	&#20320;&#20381;&#28982;&#21487;&#20197;&#36890;&#36807;&#21407;&#29983;TopLink API&#23545;&#37027;&#20123;&#22522;&#20110;Spring&#30340;DAO&#36827;&#34892;&#32534;&#31243;&#65292;&#27492;&#26102;&#20320;&#24517;&#39035;&#26126;&#30830;&#22320;&#25171;&#24320;&#21644;&#20851;
      	&#38381;&#19968;&#20010; <tt class="interfacename">Session</tt>&#12290;&#27491;&#22914;&#22312;&#30456;&#24212;&#30340;Hibernate&#31456;&#33410;&#25551;&#36848;&#30340;
      	&#19968;&#26679;&#65292;&#36825;&#31181;&#20570;&#27861;&#30340;&#20027;&#35201;&#20248;&#28857;&#22312;&#20110;&#20320;&#30340;&#25968;&#25454;&#35775;&#38382;&#20195;&#30721;&#21487;&#20197;&#22312;&#25972;&#20010;&#36807;&#31243;&#20013;&#25243;&#20986;checked exceptions&#12290;
				<tt class="classname">TopLinkDaoSupport</tt> &#20026;&#36825;&#31181;&#24773;&#20917;&#25552;&#20379;&#20102;&#22810;&#31181;&#20989;&#25968;&#25903;&#25345;&#65292;&#21253;&#25324;&#33719;&#21462;&#21644;&#37322;&#25918;
				&#19968;&#20010;&#20855;&#22791;&#20107;&#21153;&#30340; <tt class="interfacename">Session</tt> &#24182;&#20570;&#30456;&#20851;&#30340;&#24322;&#24120;&#36716;&#21270;&#12290;
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-toplink-straight"></a>12.4.3.&nbsp;&#22522;&#20110;&#21407;&#29983;&#30340;TopLink API&#30340;DAO&#23454;&#29616;</h3></div></div><div></div></div><p>
      	&#25105;&#20204;&#21487;&#20197;&#30452;&#25509;&#25805;&#20316;TopLink API&#26469;&#23454;&#29616;DAO&#65292;&#30452;&#25509;&#20351;&#29992;&#19968;&#20010;&#27880;&#20837;&#30340; <tt class="interfacename">Session</tt> 
      	&#32780;&#26080;&#38656;&#23545;Spring&#20135;&#29983;&#30340;&#20219;&#20309;&#20381;&#36182;&#12290;&#23427;&#36890;&#24120;&#22522;&#20110;&#19968;&#20010;&#30001; <tt class="classname">LocalSessionFactoryBean</tt> 
      	&#23450;&#20041;&#30340; <tt class="interfacename">SessionFactory</tt>&#65292;&#24182;&#36890;&#36807;Spring&#30340; 
      	<tt class="literal">TransactionAwareSessionAdapter</tt> &#26292;&#38706;&#25104;&#20026;&#19968;&#20010; <tt class="interfacename">Session</tt> 
      	&#31867;&#22411;&#30340;&#24341;&#29992;&#12290;
      </p><p>
      	TopLink&#30340; <tt class="interfacename">Session</tt> &#25509;&#21475;&#20013;&#23450;&#20041;&#30340; 
      	<tt class="literal">getActiveSession()</tt> &#26041;&#27861;&#23558;&#36820;&#22238;&#24403;&#21069;&#20855;&#22791;&#20107;&#21153;&#31649;&#29702;&#21151;&#33021;&#30340; 
      	<tt class="interfacename">Session</tt> &#23545;&#35937;&#12290;&#22914;&#26524;&#24403;&#21069;&#27809;&#26377;&#22788;&#20110;&#27963;&#36291;&#29366;&#24577;&#30340;&#20107;&#21153;&#65292;
      	&#36825;&#20010;&#20989;&#25968;&#23558;&#36820;&#22238;&#19968;&#20010;&#20849;&#20139;&#30340;TopLink&#30340; <tt class="literal">ServerSession</tt>&#65292;&#20063;&#23601;&#26159;&#35828;&#65292;
      	&#36825;&#31181;&#24773;&#20917;&#24212;&#35813;&#21482;&#26159;&#19968;&#20010;&#30452;&#25509;&#20351;&#29992;&#30340;&#21482;&#35835;&#35775;&#38382;&#12290;&#21478;&#22806;&#36824;&#26377;&#19968;&#20010; <tt class="methodname">getActiveUnitOfWork()</tt> 
      	&#26041;&#27861;, &#36820;&#22238;TopLink&#30340;&#19982;&#24403;&#21069;&#20107;&#21153;&#32465;&#23450;&#30340; <tt class="interfacename">UnitOfWork</tt> 
      	&#65288;&#22914;&#26524;&#27809;&#26377;&#24403;&#21069;&#20107;&#21153;&#21017;&#36820;&#22238; <tt class="literal">null</tt>&#65289;&#12290;
      </p><p>&#19968;&#20010;&#30456;&#24212;&#30340;DAO&#23454;&#29616;&#31867;&#30475;&#19978;&#21435;&#23601;&#20687;&#19979;&#38754;&#37027;&#26679;:</p><pre class="programlisting">public class ProductDaoImpl implements ProductDao {

    private Session session;

    public void setSession(Session session) {
        this.session = session;
    }

    public Collection loadProductsByCategory(String category) {
        ReadAllQuery findOwnersQuery = new ReadAllQuery(Product.class);
        findOwnersQuery.addArgument("Category");
        ExpressionBuilder builder = this.findOwnersQuery.getExpressionBuilder();
        findOwnersQuery.setSelectionCriteria(
            builder.get("category").like(builder.getParameter("Category")));

        Vector args = new Vector();
        args.add(category);
        return session.getActiveSession().executeQuery(findOwnersQuery, args);
    }
}</pre><p>
      	&#19978;&#38754;&#25105;&#20204;&#25152;&#21015;&#20986;&#30340;DAO&#23436;&#20840;&#36981;&#24490;IoC&#65306;&#23427;&#22914;&#21516;&#20351;&#29992;Spring&#30340; <tt class="classname">TopLinkTemplate</tt> 
      	&#36827;&#34892;&#32534;&#30721;&#37027;&#26679;&#65292;&#38750;&#24120;&#36866;&#21512;&#22312;application context&#20013;&#36827;&#34892;&#37197;&#32622;&#12290;Spring&#30340; 
      	<tt class="literal">TransactionAwareSessionAdapter</tt> &#23558;&#26292;&#38706;&#19968;&#20010; 
      	<tt class="interfacename">Session</tt> &#31867;&#22411;&#30340;bean&#30340;&#24341;&#29992;&#65292;&#24182;&#20256;&#20837;&#21040;DAO&#20013;&#21435;&#65306;
      </p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="mySessionAdapter"
      class="org.springframework.orm.toplink.support.TransactionAwareSessionAdapter"&gt;
    &lt;property name="sessionFactory" ref="mySessionFactory"/&gt;
  &lt;/bean&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"&gt;
    &lt;property name="session" ref="mySessionAdapter"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><p>
      	&#36825;&#31181;DAO&#39118;&#26684;&#30340;&#20027;&#35201;&#22909;&#22788;&#22312;&#20110;&#23427;&#20165;&#20165;&#20381;&#36182;&#20110;TopLink&#33258;&#36523;&#30340;API&#65292;&#32780;&#26080;&#38656;&#24341;&#20837;&#20219;&#20309;&#30340;Spring
      	&#30340;&#31867;&#12290;&#20174;&#26080;&#20837;&#20405;&#24615;&#30340;&#35282;&#24230;&#26469;&#30475;&#65292;&#36825;&#19968;&#28857;&#38750;&#24120;&#21560;&#24341;&#20154;&#12290;&#21516;&#26102;&#65292;&#23545;&#20110;TopLink&#30340;&#24320;&#21457;&#20154;&#21592;&#26469;&#35828;&#20063;&#26356;&#33258;&#28982;&#12290;
      </p><p>
      
      	&#28982;&#32780;&#65292;&#36825;&#26679;&#30340;DAO&#35775;&#38382;&#26041;&#24335;&#20250;&#25243;&#20986; <tt class="exceptionname">TopLinkException</tt>
      	&#65288;&#36825;&#26159;&#19968;&#20010;&#26080;&#38656;&#22768;&#26126;&#25110;&#25429;&#33719;&#30340;unchecked exception&#65289;&#65292;&#36825;&#24847;&#21619;&#30528;&#65292;DAO&#30340;&#35843;&#29992;&#32773;&#21482;&#33021;&#20197;&#26222;&#36890;&#30340;
      	&#38169;&#35823;&#26469;&#22788;&#29702;&#36825;&#20123;&#24322;&#24120;&#65292;&#38500;&#38750;&#23436;&#20840;&#20381;&#36182;TopLink&#33258;&#36523;&#30340;&#24322;&#24120;&#20307;&#31995;&#12290;&#22240;&#32780;&#65292;&#38500;&#38750;&#20320;&#23558;DAO&#30340;&#35843;&#29992;&#32773;&#32465;&#23450;
      	&#21040;&#20855;&#20307;&#30340;&#23454;&#29616;&#31574;&#30053;&#19978;&#21435;&#65292;&#21542;&#21017;&#20320;&#23558;&#26080;&#27861;&#25429;&#33719;&#29305;&#23450;&#30340;&#24322;&#24120;&#21407;&#22240;&#65288;&#35832;&#22914;&#20048;&#35266;&#38145;&#24322;&#24120;&#65289;&#12290;&#36825;&#31181;&#25240;&#20013;&#24179;&#34913;&#25110;&#35768;
      	&#21487;&#20197;&#34987;&#25509;&#21463;&#65292;&#22914;&#26524;&#20320;&#30340;&#24212;&#29992;&#23436;&#20840;&#22522;&#20110;TopLink&#25110;&#32773;&#26080;&#38656;&#36827;&#34892;&#29305;&#27530;&#30340;&#24322;&#24120;&#22788;&#29702;&#12290;
      </p><p>
      
      &#36825;&#26679;&#30340;DAO&#39118;&#26684;&#26377;&#19968;&#20010;&#19981;&#21033;&#22240;&#32032;&#22312;&#20110;TopLink&#30340;&#26631;&#20934;&#30340; <tt class="methodname">getActiveSession()</tt> 
      &#20989;&#25968;&#20165;&#20165;&#22312;JTA&#20107;&#21153;&#20013;&#26377;&#25928;&#12290;&#32780;&#23545;&#20110;&#20854;&#20182;&#30340;&#20107;&#21153;&#31649;&#29702;&#31574;&#30053;&#23588;&#20854;&#26102;&#26412;&#22320;&#30340;TopLink&#20107;&#21153;&#65292;&#23427;&#23558; <span class="emphasis"><em>&#26080;&#27861;</em></span> &#24037;&#20316;&#12290;
      </p><p>
      	&#24184;&#36816;&#30340;&#26159;&#65292;Spring&#30340; <tt class="literal">TransactionAwareSessionAdapter</tt> 
      	&#20026;TopLink&#30340; <tt class="literal">ServerSession</tt> &#26292;&#38706;&#20102;&#19968;&#20010;&#30456;&#24212;&#30340;&#20195;&#29702;&#31867;&#12290;
				&#36825;&#20010;&#20195;&#29702;&#31867;&#33021;&#22815;&#22312;&#20219;&#20309;&#30340;&#20107;&#21153;&#31574;&#30053;&#20043;&#19978;&#25903;&#25345;TopLink&#30340; <tt class="literal">Session.getActiveSession()</tt> 
				&#21644; <tt class="literal">Session.getActiveUnitOfWork()</tt> &#20989;&#25968;&#65292;&#36820;&#22238;&#24403;&#21069;&#25910;&#21040;Spring&#31649;&#29702;
				&#65288;&#21363;&#20415;&#30001; <tt class="literal">TopLinkTransactionManager</tt> &#31649;&#29702;&#65289;&#30340;&#20855;&#22791;&#20107;&#21153;&#31649;&#29702;&#21151;&#33021;&#30340; 
				<tt class="interfacename">Session</tt> &#23454;&#20363;&#12290;&#24403;&#28982;&#65292;&#36825;&#20010;&#20989;&#25968;&#30340;&#26631;&#20934;&#34892;&#20026;&#20381;&#28982;&#26377;&#25928;&#65306;
				&#36820;&#22238;&#19982;&#24403;&#21069;&#30340;JTA&#20107;&#21153;&#32465;&#23450;&#30340; <tt class="interfacename">Session</tt> &#23545;&#35937;&#12290;
				&#65288;&#26080;&#35770;&#36825;&#20010;JTA&#20107;&#21153;&#26159;&#30001;Spring&#30340; <tt class="classname">JtaTransactionManager</tt>&#12289;
				EJB CMT&#25110;&#32773;&#26222;&#36890;&#30340;JTA&#25152;&#39537;&#21160;&#30340;&#20107;&#21153;&#65289;&#12290;
      </p><p>
      	&#24635;&#20307;&#26469;&#35828;&#65292;DAO&#21487;&#20197;&#22522;&#20110;TopLink&#30340;&#21407;&#29983;API&#23454;&#29616;&#65292;&#21516;&#26102;&#65292;&#23427;&#20381;&#26087;&#38656;&#35201;&#33021;&#22815;&#21442;&#19982;&#21040;Spring&#30340;&#20107;&#21153;&#31649;&#29702;&#20013;&#12290;
				&#36825;&#23545;&#20110;&#37027;&#20123;&#24050;&#32463;&#23545;TopLink&#38750;&#24120;&#29087;&#24713;&#30340;&#20154;&#26469;&#35828;&#24456;&#26377;&#21560;&#24341;&#21147;&#65292;&#22240;&#20026;&#36825;&#31181;&#26041;&#24335;&#26356;&#21152;&#33258;&#28982;&#12290;&#19981;&#36807;&#65292;&#36825;&#31181;DAO&#23558;&#25243;&#20986; 
				<tt class="exceptionname">TopLinkException</tt>&#65292;&#22240;&#32780;&#65292;&#22914;&#26524;&#26377;&#24517;&#35201;&#30340;&#35805;&#38656;&#35201;&#26126;&#30830;&#22320;&#21435;&#20570;&#30001; 
				<tt class="exceptionname">TopLinkException</tt> &#21040;Spring&#30340; <tt class="classname">DataAccessException</tt> 
				&#30340;&#36716;&#21270;&#12290;
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-toplink-tx"></a>12.4.4.&nbsp;&#20107;&#21153;&#31649;&#29702;</h3></div></div><div></div></div><p>&#23558;&#20107;&#21153;&#31649;&#29702;&#32435;&#20837;&#21040;Service&#25805;&#20316;&#30340;&#25191;&#34892;&#20013;&#65292;&#20320;&#21487;&#20197;&#20351;&#29992;Spring&#36890;&#29992;&#30340;&#22768;&#26126;&#24335;&#30340;&#20107;&#21153;&#31649;&#29702;&#21151;&#33021;&#65292;&#21442;&#21152;&#19979;&#38754;&#30340;&#20363;&#23376;&#65306;</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans
        xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:aop="http://www.springframework.org/schema/aop"
        xmlns:tx="http://www.springframework.org/schema/tx"
        xsi:schemaLocation="
   http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
   http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd
   http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd"&gt;

  &lt;bean id="myTxManager" class="org.springframework.orm.toplink.TopLinkTransactionManager"&gt;
    &lt;property name="sessionFactory" ref="mySessionFactory"/&gt;
  &lt;/bean&gt;

  &lt;bean id="myProductService" class="product.ProductServiceImpl"&gt;
    &lt;property name="productDao" ref="myProductDao"/&gt;
  &lt;/bean&gt;
  
  &lt;aop:config&gt;
    &lt;aop:pointcut id="productServiceMethods" expression="execution(* product.ProductService.*(..))"/&gt;
    &lt;aop:advisor advice-ref="txAdvice" pointcut-ref="productServiceMethods"/&gt;
  &lt;/aop:config&gt;

  &lt;tx:advice id="txAdvice" transaction-manager="myTxManager"&gt;
    &lt;tx:attributes&gt;
      &lt;tx:method name="increasePrice*" propagation="REQUIRED"/&gt;
      &lt;tx:method name="someOtherBusinessMethod" propagation="REQUIRES_NEW"/&gt;
      &lt;tx:method name="*" propagation="SUPPORTS" read-only="true"/&gt;
    &lt;/tx:attributes&gt;
  &lt;/tx:advice&gt;

&lt;/beans&gt;</pre><p>
      	&#27880;&#24847;&#65292;TopLink&#35201;&#27714;&#20320;&#24517;&#39035;&#22312;&#19968;&#20010;&#27963;&#36291;&#30340; <tt class="interfacename">&#24037;&#20316;&#21333;&#20803;&#65288;UnitOfWork&#65289;</tt> 
      	&#20013;&#20462;&#25913;&#19968;&#20010;&#25345;&#20037;&#21270;&#23545;&#35937;&#65288;&#20320;&#36890;&#24120;&#19981;&#33021;&#20462;&#25913;&#30001;&#26222;&#36890;&#30340;TopLink&#30340; <tt class="interfacename">Session</tt> 
      	&#26597;&#35810;&#36820;&#22238;&#30340;&#23545;&#35937;&#65292;&#22240;&#20026;&#36825;&#20123;&#23545;&#35937;&#36890;&#24120;&#26159;&#19968;&#20123;&#20174;&#20108;&#32423;&#32531;&#23384;&#20013;&#35835;&#20986;&#30340;&#21482;&#35835;&#23545;&#35937;&#65289;&#12290;&#19982;Hibernate&#30456;&#27604;&#65292;
      	&#22312;TopLink&#20013;&#24182;&#27809;&#26377;&#19968;&#31181;&#31867;&#20284;&#33073;&#31163;&#20107;&#21153;&#21047;&#20986;&#65288;non-transactional flush&#65289;&#30340;&#27010;&#24565;&#12290;&#22522;&#20110;&#36825;
      	&#31181;&#21407;&#22240;&#65292;TopLink&#38656;&#35201;&#34987;&#24314;&#31435;&#22312;&#29305;&#23450;&#30340;&#29615;&#22659;&#20013;&#65292;&#23588;&#20854;&#26159;&#23427;&#38656;&#35201;&#20026;JTA&#21516;&#27493;&#20570;&#26126;&#30830;&#30340;&#21019;&#24314;&#65292;&#30001;&#27492;&#26469;
      	&#33258;&#34892;&#26816;&#27979;&#19968;&#20010;JTA&#20107;&#21153;&#20197;&#21450;&#26292;&#38706;&#19968;&#20010;&#30456;&#24212;&#30340;&#27963;&#36291;&#30340; <tt class="interfacename">Session</tt> 
      	&#21644; <tt class="interfacename">UnitOfWork</tt>&#12290;&#36825;&#19968;&#28857;&#23545;&#20110;&#26412;&#22320;&#20107;&#21153;&#19981;&#26159;&#24517;&#35201;&#30340;&#65292;&#30001;&#20110;&#23427;&#24050;&#32463;&#34987;
      	Spring&#30340; <tt class="literal">TopLinkTransactionManager</tt> &#22788;&#29702;&#65292;&#20294;&#26159;&#23545;&#20110;
      	&#38656;&#35201;&#21442;&#19982;&#21040;JTA&#20107;&#21153;&#20013;&#30340;&#24773;&#20917;&#65292;&#26159;&#24517;&#39035;&#30340;&#65288;&#26080;&#35770;&#26159;&#30001;Spring&#30340; 
      	<tt class="classname">JtaTransactionManager</tt>&#12289;EJB CMT&#25110;&#32773;&#26222;&#36890;&#30340;JTA&#25152;&#39537;&#21160;&#30340;&#20107;&#21153;&#65289;&#12290;
      </p><p>
      	&#22312;&#20320;&#30340;&#22522;&#20110;TopLink&#30340;DAO&#20195;&#30721;&#20013;&#65292;&#20320;&#21487;&#20197;&#20351;&#29992; <tt class="literal">Session.getActiveUnitOfWork()</tt> 
      	&#26041;&#27861;&#26469;&#35775;&#38382;&#24403;&#21069;&#30340; <tt class="interfacename">UnitOfWork</tt> &#24182;&#36890;&#36807;&#23427;&#26469;&#25191;&#34892;&#20889;&#25805;&#20316;&#12290;&#36825;&#23558;&#21482;&#22312;&#19968;&#20010;&#27963;&#36291;&#30340;&#20107;&#21153;&#20013;&#26377;&#25928;
      	&#65288;&#22312;&#19968;&#20010;&#25910;&#21040;Spring&#31649;&#29702;&#30340;&#20107;&#21153;&#25110;&#32773;JTA&#20107;&#21153;&#20013;&#65289;&#12290;&#23545;&#20110;&#29305;&#27530;&#30340;&#38656;&#27714;&#65292;&#20320;&#21516;&#26679;&#21487;&#20197;&#33719;&#21462;&#21333;&#29420;&#30340; 
      	<tt class="interfacename">UnitOfWork</tt> &#23454;&#20363;&#65292;&#23427;&#23558;&#19981;&#21442;&#19982;&#21040;&#24403;&#21069;&#30340;&#20107;&#21153;&#20013;&#21435;&#65292;&#19981;&#36807;&#36825;&#31181;&#24773;&#20917;&#38750;&#24120;&#23569;&#12290;
      </p><p>
      	<tt class="classname">TopLinkTransactionManager</tt> &#33021;&#22815;&#23558;&#19968;&#20010;TopLink&#20107;&#21153;&#26292;&#38706;&#32473;
      	&#35775;&#38382;&#30456;&#21516;&#30340;JDBC <tt class="interfacename">DataSource</tt> &#30340;JDBC&#35775;&#38382;&#20195;&#30721;&#12290;
				&#21069;&#25552;&#26465;&#20214;&#26159;&#65292;TopLink&#22312;&#24213;&#23618;&#26159;&#20197;JDBC&#26041;&#24335;&#24037;&#20316;&#30340;&#24182;&#19988;&#33021;&#22815;&#26292;&#38706;&#24213;&#23618;&#30340;JDBC <tt class="interfacename">Connection</tt>&#12290;
				&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#29992;&#20110;&#26292;&#38706;&#20107;&#21153;&#30340; <tt class="interfacename">DataSource</tt> &#24517;&#39035;&#34987;&#26126;&#30830;&#25351;&#23450;&#65292;
				&#23427;&#26159;&#26080;&#27861;&#34987;&#33258;&#21160;&#26816;&#27979;&#21040;&#30340;&#12290;
      </p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="orm-ibatis"></a>12.5.&nbsp;iBATIS SQL Maps</h2></div></div><div></div></div><p>
    
    &#22312;Spring&#26694;&#26550;&#20013;&#65292;iBatis&#30340;&#25903;&#25345;&#24456;&#31867;&#20284;JDBC&#25110;&#32773;Hibernate&#30340;&#25903;&#25345;&#65292;&#22240;&#20026;&#23427;&#21644;JDBC&#25110;Hibernate&#19968;&#26679;&#25903;&#25345;&#30456;&#21516;&#30340;&#27169;&#26495;&#24335;&#32534;&#31243;&#65292; 
    iBatis&#30340;&#25903;&#25345;&#33021;&#19982;Spring&#30340;&#24322;&#24120;&#20307;&#31995;&#19968;&#36215;&#24037;&#20316;&#24182;&#35753;&#20320;&#20139;&#29992;&#25152;&#26377;Spring&#30340;Ioc&#29305;&#28857;&#12290;
    </p><p>
    	&#20107;&#21153;&#31649;&#29702;&#21487;&#20197;&#30001;Spring&#26631;&#20934;&#26426;&#21046;&#36827;&#34892;&#22788;&#29702;&#12290;&#23545;&#20110;iBATIS&#26469;&#35828;&#27809;&#26377;&#29305;&#21035;&#30340;&#20107;&#21153;&#31574;&#30053;&#65292;&#38500;&#20102;JDBC 
    	<tt class="interfacename">Connection</tt> &#20197;&#22806;&#65292;&#20063;&#27809;&#26377;&#29305;&#21035;&#30340;&#20107;&#21153;&#36164;&#28304;&#12290;&#22240;&#27492;&#65292;Spring
    	&#26631;&#20934;&#30340;JDBC <tt class="classname">DataSourceTransactionManager</tt> &#25110;&#32773; <tt class="classname">
    	JtaTransactionManager</tt> &#24050;&#32463;&#33021;&#22815;&#23436;&#20840;&#36275;&#22815;&#20102;&#12290;
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>
      
      Spring&#30340;&#30830;&#25903;&#25345;iBatis&#30340;1.x&#21644;2.x.&#20294;&#26159;&#65292;&#21482;&#26377;iBatis 2.x&#30340;&#25903;&#25345;&#21253;&#21547;&#22312;&#26680;&#24515;Spring&#21457;&#24067;&#29256;&#26412;&#20013;&#12290;
			iBatis1.x&#30340;&#25903;&#25345;&#31867;&#34987;&#36716;&#31227;&#21040;Spring 2.0&#30340;Spring Modules project&#65292;&#20320;&#21487;&#20197;&#22312;&#37027;&#37324;&#25214;&#21040;&#25991;&#26723;&#25351;&#23548;&#12290;
      </p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-ibatis-setup"></a>12.5.1.&nbsp;
      
      &#21019;&#24314;SqlMapClient
      </h3></div></div><div></div></div><p>
      
      &#22914;&#26524;&#25105;&#20204;&#24076;&#26395;&#20351;&#29992;iBATIS 2.x&#26469;&#26144;&#23556;&#21018;&#25165;&#30340;&#37027;&#20010;Account&#31867;&#65292;&#21017;&#38656;&#35201;&#21019;&#24314;&#36825;&#26679;&#19968;&#20010;SQL map <tt class="literal">Account.xml</tt>&#65306;
      </p><pre class="programlisting">&lt;sqlMap namespace="Account"&gt;

  &lt;resultMap id="result" class="examples.Account"&gt;
    &lt;result property="name" column="NAME" columnIndex="1"/&gt;
    &lt;result property="email" column="EMAIL" columnIndex="2"/&gt;
  &lt;/resultMap&gt;

  &lt;select id="getAccountByEmail" resultMap="result"&gt;
    select ACCOUNT.NAME, ACCOUNT.EMAIL
    from ACCOUNT
    where ACCOUNT.EMAIL = #value#
  &lt;/select&gt;

  &lt;insert id="insertAccount"&gt;
    insert into ACCOUNT (NAME, EMAIL) values (#name#, #email#)
  &lt;/insert&gt;

&lt;/sqlMap&gt;</pre><p>
      
      iBATIS2&#30340;&#37197;&#32622;&#25991;&#20214;&#30475;&#36215;&#26469;&#20687;&#36825;&#26679;&#65306;
      </p><pre class="programlisting">&lt;sqlMapConfig&gt;

  &lt;sqlMap resource="example/Account.xml"/&gt;

&lt;/sqlMapConfig&gt;</pre><p>
      
      &#35760;&#20303;iBATIS&#20174;CLASSPATH&#19979;&#21152;&#36733;&#36164;&#28304;&#65292;&#25152;&#20197;&#24517;&#39035;&#30830;&#20445; <tt class="literal">Account.xml</tt> &#22312;CLASSPATH&#19979;&#12290;
      </p><p>
      
      	&#25105;&#20204;&#21487;&#20197;&#20351;&#29992;Spring container&#20013;&#30340; <tt class="classname">SqlMapClientFactoryBean</tt>&#12290;
				&#27880;&#24847;iBATIS SQL Map 2.x&#20013;&#65292;JDBC <tt class="interfacename">DataSource</tt> &#36890;&#24120;&#30001; 
				<tt class="classname">SqlMapClientFactoryBean</tt> &#25351;&#23450;&#65292;&#24182;&#24320;&#21551;&#20102;&#24310;&#36831;&#21152;&#36733;&#12290;
      </p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"&gt;
    &lt;property name="driverClassName" value="${jdbc.driverClassName}"/&gt;
    &lt;property name="url" value="${jdbc.url}"/&gt;
    &lt;property name="username" value="${jdbc.username}"/&gt;
    &lt;property name="password" value="${jdbc.password}"/&gt;
  &lt;/bean&gt;

  &lt;bean id="sqlMapClient" class="org.springframework.orm.ibatis.SqlMapClientFactoryBean"&gt;
    &lt;property name="configLocation" value="WEB-INF/sqlmap-config.xml"/&gt;
    &lt;property name="dataSource" ref="dataSource"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-ibatis-template"></a>12.5.2.&nbsp;
      
      	&#20351;&#29992; <tt class="classname">SqlMapClientTemplate</tt> &#21644; <tt class="classname">SqlMapClientDaoSupport</tt>
      </h3></div></div><div></div></div><p>
      <tt class="classname">SqlMapClientDaoSupport</tt> &#25552;&#20379;&#20102;&#31867;&#20284; <tt class="classname">SqlMapDaoSupport</tt> &#30340;&#21151;&#33021;&#12290;&#25105;&#20204;&#21487;&#20197;&#32487;&#25215;&#23427;&#26469;&#23454;&#29616;&#25105;&#20204;&#33258;&#24049;&#30340;DAO&#65306;
      </p><pre class="programlisting">public class SqlMapAccountDao extends SqlMapClientDaoSupport implements AccountDao {

    public Account getAccount(String email) throws DataAccessException {
        return (Account) getSqlMapClientTemplate().queryForObject("getAccountByEmail", email);
    }

    public void insertAccount(Account account) throws DataAccessException {
        getSqlMapClientTemplate().update("insertAccount", account);
    }
}</pre><p>
      &#25105;&#20204;&#21487;&#20197;&#22312;application context&#20013;&#21019;&#24314;&#20102; <tt class="literal">SqlMapAccountDao</tt> 
      &#24182;&#19988;&#27880;&#20837; <tt class="literal">SqlMapClient</tt> &#23454;&#20363;&#65292;&#36825;&#26679;&#25105;&#20204;&#23601;&#21487;&#20197;&#22312;DAO&#20013;&#20351;&#29992;&#39044;&#20808;&#37197;&#32622;&#30340; 
      <tt class="classname">SqlMapClientTemplate</tt> &#26469;&#25191;&#34892;&#26597;&#35810;&#20102;&#65306;
      </p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="accountDao" class="example.SqlMapAccountDao"&gt;
    &lt;property name="sqlMapClient" ref="sqlMapClient"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><p>
      	&#27880;&#24847; <tt class="classname">SqlMapTemplate</tt> &#23454;&#20363;&#20063;&#21487;&#20197;&#25163;&#24037;&#21019;&#24314;&#65292;&#20351;&#29992; 
      	<tt class="literal">SqlMapClient</tt> &#20316;&#20026;&#26500;&#36896;&#20989;&#25968;&#21442;&#25968;&#12290;
      	<tt class="literal">SqlMapClientDaoSupport</tt> &#22522;&#31867;&#20026;&#25105;&#20204;&#39044;&#20808;&#21021;&#22987;&#21270;&#20102;&#19968;&#20010; 
      	<tt class="classname">SqlMapClientTemplate</tt> &#23454;&#20363;&#12290;
      </p><p>
      	<tt class="classname">SqlMapClientTemplate</tt> &#36824;&#25552;&#20379;&#20102;&#19968;&#20010;&#36890;&#29992;&#30340; 
      	<tt class="literal">execute</tt> &#26041;&#27861;&#65292;&#23558;&#29992;&#25143;&#33258;&#23450;&#20041;&#30340; <tt class="literal">SqlMapClientCallback</tt> 
      	&#30340;&#23454;&#29616;&#20316;&#20026;&#21442;&#25968;&#12290;&#20030;&#20363;&#26469;&#35828;&#65292;&#36825;&#21487;&#20197;&#23454;&#29616;&#25209;&#37327;&#25805;&#20316;&#65306;
      </p><pre class="programlisting">public class SqlMapAccountDao extends SqlMapClientDaoSupport implements AccountDao {

    public void insertAccount(Account account) throws DataAccessException {
        getSqlMapClientTemplate().execute(new SqlMapClientCallback() {
            public Object doInSqlMapClient(SqlMapExecutor executor) throws SQLException {
                executor.startBatch();
                executor.update("insertAccount", account);
                executor.update("insertAddress", account.getAddress());
                executor.executeBatch();
            }
        });
    }
}</pre><p>
      &#19968;&#33324;&#26469;&#35828;&#65292;&#20219;&#20309;&#30001; <tt class="literal">SqlMapExecutor</tt> API&#25552;&#20379;&#30340;&#25805;&#20316;&#32452;&#21512;&#37117;&#20197;&#36825;&#26679;&#30340;&#22238;&#35843;&#24418;&#24335;&#34987;&#20351;&#29992;&#12290;
			&#32780;&#22312;&#36825;&#20010;&#36807;&#31243;&#20013;&#20135;&#29983;&#30340;&#20219;&#20309; <tt class="literal">SQLException</tt> &#37117;&#23558;&#34987;&#33258;&#21160;&#22320;&#36716;&#21270;&#20026;Spring&#30340;&#36890;&#29992;&#30340; <tt class="classname">DataAccessException</tt> &#24322;&#24120;&#20307;&#31995;&#12290;
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-ibatis-straight"></a>12.5.3.&nbsp;&#22522;&#20110;&#21407;&#29983;&#30340;iBATIS API&#30340;DAO&#23454;&#29616;</h3></div></div><div></div></div><p>
      	&#20320;&#20063;&#21487;&#20197;&#22522;&#20110;&#21407;&#29983;&#30340;iBATIS API&#26469;&#32534;&#31243;&#65292;&#32780;&#26080;&#38656;&#23545;Spring&#20135;&#29983;&#20219;&#20309;&#20381;&#36182;&#12290;&#30452;&#25509;&#20351;&#29992;&#27880;&#20837;&#30340; 
      	<tt class="literal">SqlMapClient</tt>&#12290;&#19968;&#20010;&#30456;&#24212;&#30340;DAO&#23454;&#29616;&#31867;&#30475;&#19978;&#21435;&#23601;&#20687;&#19979;&#38754;&#36825;&#26679;&#65306;
      </p><pre class="programlisting">public class SqlMapAccountDao implements AccountDao {
        
    private SqlMapClient sqlMapClient;
    
    public void setSqlMapClient(SqlMapClient sqlMapClient) {
        this.sqlMapClient = sqlMapClient;
    }

    public Account getAccount(String email) {
        try {
            return (Account) this.sqlMapClient.queryForObject("getAccountByEmail", email);
        }
        catch (SQLException ex) {
            throw new MyDaoException(ex);
        }
    }

    public void insertAccount(Account account) throws DataAccessException {
        try {
            this.sqlMapClient.update("insertAccount", account);
        }
        catch (SQLException ex) {
            throw new MyDaoException(ex);
        }
    }
}</pre><p>
      	&#22312;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#30001;iBATIS API&#25243;&#20986;&#30340; <tt class="literal">SQLException</tt> &#24322;&#24120;&#38656;&#35201;&#20197;
      	&#29992;&#25143;&#33258;&#23450;&#20041;&#30340;&#26041;&#24335;&#36827;&#34892;&#22788;&#29702;&#65306;&#36890;&#24120;&#23553;&#35013;&#25104;&#20026;&#20320;&#30340;&#24212;&#29992;&#31243;&#24207;&#33258;&#36523;&#30340;DAO&#24322;&#24120;&#12290;&#22312;application context
      	&#20013;&#36827;&#34892;&#30340;&#25972;&#21512;&#30475;&#19978;&#21435;&#20381;&#28982;&#20687;&#20197;&#21069;&#19968;&#26679;&#65292;&#36825;&#26159;&#30001;&#20110;&#22522;&#20110;&#21407;&#29983;&#30340;iBATIS&#30340;DAO&#20381;&#28982;&#36981;&#24490;IoC&#30340;&#27169;&#24335;&#65306;
      </p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="accountDao" class="example.SqlMapAccountDao"&gt;
    &lt;property name="sqlMapClient" ref="sqlMapClient"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="orm-jpa"></a>12.6.&nbsp;JPA</h2></div></div><div></div></div><p>&#65288;<tt class="literal">org.springframework.orm.jpa</tt> &#21253;&#19979;&#30340;&#65289;Spring JPA&#20197;&#31867;&#20284;&#25972;&#21512;Hibernate&#25110;&#32773;JDO&#30340;&#26041;&#24335;&#65292;
		&#25552;&#20379;&#20102;&#23545; <a href="http://java.sun.com/developer/technicalArticles/J2EE/jpa/index.html" target="_top">Java Persistence API</a>
		&#30340;&#20840;&#38754;&#25903;&#25345;&#65292;&#21516;&#26102;&#20026;&#25552;&#20379;&#38468;&#21152;&#30340;&#29305;&#24615;&#65292;&#24517;&#39035;&#20102;&#35299;&#24213;&#23618;&#30340;&#23454;&#29616;&#12290;</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-jpa-setup"></a>12.6.1.&nbsp;&#22312;Spring&#29615;&#22659;&#20013;&#24314;&#31435;JPA</h3></div></div><div></div></div><p>Spring JPA &#25552;&#20379;&#20102;&#19977;&#31181;&#26041;&#27861;&#21019;&#24314;JPA <tt class="interfacename">EntityManagerFactory</tt>&#65306;</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="orm-jpa-setup-lemfb"></a>12.6.1.1.&nbsp;<tt class="classname">LocalEntityManagerFactoryBean</tt></h4></div></div><div></div></div><p>
			<tt class="classname">LocalEntityManagerFactoryBean</tt>&#36127;&#36131;&#21019;&#24314;&#19968;&#20010;&#36866;&#21512;&#20110;&#20165;&#20351;&#29992;JPA&#36827;&#34892;&#25968;&#25454;&#35775;&#38382;&#30340;&#29615;&#22659;&#30340;
					<tt class="interfacename">EntityManager</tt>&#12290;
			Factory bean&#23558;&#20351;&#29992;JPA <tt class="interfacename">PersistenceProvider</tt> &#31867;&#30340;&#33258;&#21160;&#26816;&#27979;&#26426;&#21046;&#65288;&#26681;&#25454;JPA&#30340;
			Java SE&#21551;&#21160;&#65289;&#65292;&#32780;&#22312;&#32477;&#22823;&#22810;&#25968;&#24773;&#20917;&#19979;&#65292;&#21482;&#38656;&#35201;&#25351;&#23450;persistence unit&#21517;&#31216;&#65306;</p><pre class="programlisting">&lt;beans&gt;

   &lt;bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalEntityManagerFactoryBean"&gt;
      &lt;property name="persistenceUnitName" value="myPersistenceUnit"/&gt;
   &lt;/bean&gt;

&lt;/beans&gt;</pre><p>&#36825;&#31181;JPA&#37096;&#32626;&#26041;&#24335;&#26368;&#20026;&#31616;&#21333;&#65292;&#20294;&#21364;&#26368;&#21463;&#38480;&#21046;&#12290;&#20363;&#22914;&#65292;&#19981;&#33021;&#36830;&#25509;&#21040;&#29616;&#26377;&#30340;JDBC<tt class="interfacename">DataSource</tt>&#65292;
        &#24182;&#19988;&#19981;&#25903;&#25345;&#20840;&#23616;&#20107;&#21153;&#12290;&#29978;&#33267;&#65292;&#25345;&#20037;&#21270;&#31867;&#30340;&#32455;&#20837;&#65288;&#23383;&#33410;&#30721;&#36716;&#25442;&#65289;&#20063;&#26159;&#29305;&#23450;&#20110;&#25552;&#20379;&#32773;&#30340;&#65292;&#32463;&#24120;&#38656;&#35201;&#22312;&#21551;&#21160;&#26102;&#25351;&#23450;&#19968;&#20010;&#29305;&#23450;&#30340;JVM&#20195;&#29702;&#12290;
        &#24635;&#20043;&#65292;&#36825;&#31181;&#26041;&#27861;&#23454;&#38469;&#19978;&#21482;&#36866;&#29992;&#20110;&#29420;&#31435;&#30340;&#24212;&#29992;&#31243;&#24207;&#21644;&#27979;&#35797;&#29615;&#22659;&#65288;&#36825;&#27491;&#26159;JPA&#35268;&#33539;&#35774;&#35745;&#23427;&#30340;&#21407;&#22240;&#65289;&#12290;</p><p><span class="emphasis"><em>&#20165;&#22312;&#31616;&#21333;&#37096;&#32626;&#29615;&#22659;&#20013;&#21482;&#20351;&#29992;&#36825;&#31181;&#26041;&#24335;&#65292;&#27604;&#22914;&#29420;&#31435;&#30340;&#24212;&#29992;&#31243;&#24207;&#21644;&#38598;&#25104;&#27979;&#35797;&#12290;</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="orm-jpa-setup-jndi"></a>12.6.1.2.&nbsp;&#20174;JNDI&#20013;&#33719;&#21462; <tt class="classname">EntityManagerFactory</tt> </h4></div></div><div></div></div><p>&#20174;JNDI&#33719;&#21462; <tt class="interfacename">EntityManagerFactory</tt> &#65288;&#20363;&#22914;&#22312;Java EE 5&#29615;&#22659;&#20013;&#65289;&#65292;&#20165;&#36890;&#36807;&#20462;&#25913;XML&#37197;&#32622;&#21363;&#21487;&#23454;&#29616;&#65306;</p><pre class="programlisting">&lt;beans&gt;

    &lt;jee:jndi-lookup id="entityManagerFactory" jndi-name="persistence/myPersistenceUnit"/&gt;

&lt;/beans&gt;</pre><p>&#22312;&#26631;&#20934;&#30340;Java EE 5&#21551;&#21160;&#36807;&#31243;&#20013;&#65292;Java EE&#26381;&#21153;&#22120;&#33258;&#21160;&#26816;&#27979;&#25345;&#20037;&#21270;&#21333;&#20803;&#65288;&#20363;&#22914;&#24212;&#29992;&#31243;&#24207;&#25991;&#20214;&#21253;&#20013;&#30340;<tt class="literal">META-INF/persistence.xml</tt>&#65289;
        &#65292;&#20197;&#21450;Java EE&#37096;&#32626;&#25551;&#36848;&#31526;&#20013;&#23450;&#20041;&#32473;&#37027;&#20123;&#25345;&#20037;&#21270;&#21333;&#20803;&#21629;&#21517;&#19978;&#19979;&#25991;&#20301;&#32622;&#30340;&#29615;&#22659;&#30340;<tt class="literal">persistence-unit-ref</tt>&#39033;&#65288;&#20363;&#22914;<tt class="literal">web.xml</tt>&#65289;&#12290;</p><p>&#22312;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#25972;&#20010;&#25345;&#20037;&#21270;&#21333;&#20803;&#37096;&#32626;&#65292;&#21253;&#25324;&#25345;&#20037;&#21270;&#31867;&#30340;&#32455;&#20837;&#65288;&#23383;&#30721;&#30721;&#36716;&#25442;&#65289;&#37117;&#21462;&#20915;&#20110;Java EE&#26381;&#21153;&#22120;&#12290;
        JDBC <tt class="interfacename">DataSource</tt> &#36890;&#36807;&#22312;<tt class="literal">META-INF/persistence.xml</tt>
        &#25991;&#20214;&#20013;&#30340;JNDI&#20301;&#32622;&#36827;&#34892;&#23450;&#20041;&#65307;EntityManager&#20107;&#21153;&#19982;&#26381;&#21153;&#22120;&#30340;JTA&#23376;&#31995;&#32479;&#25972;&#21512;&#12290;Spring&#20165;&#20165;&#29992;&#33719;&#24471;&#30340;<tt class="interfacename">EntityManagerFactory</tt>,
        &#36890;&#36807;&#20381;&#36182;&#27880;&#20837;&#23558;&#23427;&#20256;&#36882;&#32473;&#24212;&#29992;&#31243;&#24207;&#23545;&#35937;&#65292;&#24182;&#20026;&#23427;&#31649;&#29702;&#20107;&#21153;&#65288;&#19968;&#33324;&#36890;&#36807;<tt class="classname">JtaTransactionManager</tt>&#65289;&#12290;</p><p>&#27880;&#24847;&#65292;&#22914;&#26524;&#22312;&#21516;&#19968;&#20010;&#24212;&#29992;&#31243;&#24207;&#20013;&#20351;&#29992;&#20102;&#22810;&#20010;&#25345;&#20037;&#21270;&#21333;&#20803;&#65292;JNDI&#33719;&#21462;&#30340;&#36825;&#31181;&#25345;&#20037;&#21270;&#21333;&#20803;&#30340;bean&#21517;&#31216;
        &#24212;&#35813;&#19982;&#24212;&#29992;&#31243;&#24207;&#29992;&#26469;&#24341;&#29992;&#23427;&#20204;&#30340;&#25345;&#20037;&#21270;&#21333;&#20803;&#21517;&#31216;&#30456;&#31526;&#65288;&#20363;&#22914;<tt class="literal">@PersistenceUnit</tt>&#21644;
        <tt class="literal">@PersistenceContext&#27880;&#35299;&#65289;&#12290;</tt></p><p><span class="emphasis"><em>&#22312;&#37096;&#32626;&#21040;Java EE 5&#26381;&#21153;&#22120;&#26102;&#20351;&#29992;&#35813;&#26041;&#27861;&#12290;&#20851;&#20110;&#22914;&#20309;&#23558;&#33258;&#23450;&#20041;JPA&#25552;&#20379;&#32773;&#37096;&#32626;&#21040;&#26381;&#21153;&#22120;&#65292;&#20197;&#21450;&#20801;&#35768;&#20351;&#29992;&#26381;&#21153;&#22120;&#25552;&#20379;&#30340;&#32570;&#30465;&#25552;&#20379;&#32773;&#20043;&#22806;&#30340;JPA&#25552;&#20379;&#32773;&#65292;&#35831;&#26597;&#30475;&#26381;&#21153;&#22120;&#25991;&#26723;&#30340;&#30456;&#20851;&#35828;&#26126;&#12290;</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="orm-jpa-setup-lcemfb"></a>12.6.1.3.&nbsp;<tt class="classname">LocalContainerEntityManagerFactoryBean</tt></h4></div></div><div></div></div><p><tt class="classname">LocalContainerEntityManagerFactoryBean</tt> &#25552;&#20379;&#20102;&#23545;JPA <tt class="interfacename">EntityManagerFactory</tt> 
		&#30340;&#20840;&#38754;&#25511;&#21046;&#65292;&#38750;&#24120;&#36866;&#21512;&#37027;&#31181;&#38656;&#35201;&#32454;&#31890;&#24230;&#23450;&#21046;&#30340;&#29615;&#22659;&#12290;<tt class="classname">LocalContainerEntityManagerFactoryBean</tt> &#23558;&#22522;&#20110; 
		<tt class="literal">persistence.xml</tt> &#25991;&#20214;&#21019;&#24314; <tt class="interfacename">PersistenceUnitInfo</tt> &#31867;&#65292;&#24182;&#25552;&#20379; <tt class="literal">dataSourceLookup</tt> &#31574;&#30053;&#21644; <tt class="literal">loadTimeWeaver</tt>&#12290;
		&#22240;&#27492;&#23427;&#21487;&#20197;&#22312;JNDI&#20043;&#22806;&#30340;&#29992;&#25143;&#23450;&#20041;&#30340;&#25968;&#25454;&#28304;&#20043;&#19978;&#24037;&#20316;&#65292;&#24182;&#25511;&#21046;&#32455;&#20837;&#27969;&#31243;&#12290;</p><pre class="programlisting">&lt;beans&gt;
        
 &lt;bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"&gt;
  &lt;property name="dataSource" ref="someDataSource"/&gt;
  &lt;property name="loadTimeWeaver"&gt;
    &lt;bean class="org.springframework.instrument.classloading.InstrumentationLoadTimeWeaver"/&gt;
  &lt;/property&gt;
 &lt;/bean&gt;
 
&lt;/beans&gt;</pre><p>&#36825;&#26159;&#26368;&#20026;&#24378;&#22823;&#30340;JPA&#37197;&#32622;&#26041;&#24335;&#65292;&#20801;&#35768;&#22312;&#24212;&#29992;&#31243;&#24207;&#20013;&#28789;&#27963;&#36827;&#34892;&#26412;&#22320;&#37197;&#32622;&#12290;&#23427;&#25903;&#25345;&#36830;&#25509;&#29616;&#26377;JDBC <tt class="interfacename">DataSource</tt> &#65292;
        &#25903;&#25345;&#26412;&#22320;&#20107;&#21153;&#21644;&#20840;&#23616;&#20107;&#21153;&#31561;&#31561;&#12290;&#28982;&#32780;&#65292;&#23427;&#20063;&#23558;&#38656;&#27714;&#24378;&#21152;&#21040;&#20102;&#36816;&#34892;&#26102;&#29615;&#22659;&#20013;&#65292;&#20363;&#22914;&#65292;&#22914;&#26524;&#25345;&#20037;&#21270;&#25552;&#20379;&#32773;&#38656;&#35201;&#23383;&#33410;&#30721;&#36716;&#25442;&#65292;&#21017;&#24517;&#39035;&#26377;&#32455;&#20837;ClassLoader&#30340;&#33021;&#21147;&#12290;</p><p>&#27880;&#24847;&#65292;&#36825;&#20010;&#36873;&#39033;&#21487;&#33021;&#19982;Java EE 5&#26381;&#21153;&#22120;&#20869;&#24314;&#30340;JPA&#21151;&#33021;&#30456;&#20914;&#31361;&#12290;&#22240;&#27492;&#65292;&#24403;&#36816;&#34892;&#22312;&#23436;&#20840;Java EE 5&#29615;&#22659;&#20013;&#26102;&#65292;
        &#35201;&#32771;&#34385;&#20174;JNDI&#33719;&#21462;<tt class="interfacename">EntityManagerFactory</tt>&#12290;&#21478;&#19968;&#31181;&#21487;&#20197;&#26367;&#20195;&#30340;&#26041;&#27861;&#26159;&#65292;&#22312;
        <tt class="classname">LocalContainerEntityManagerFactoryBean</tt>&#23450;&#20041;&#20013;&#36890;&#36807;&#8220;persistenceXmlLocation&#8221;&#25351;&#23450;&#30456;&#20851;&#20301;&#32622;&#65292;
        &#20363;&#22914;&#8220;META-INF/my-persistence.xml&#8221;&#65292;&#24182;&#19988;&#21482;&#23558;&#21253;&#21547;&#35813;&#21517;&#31216;&#30340;&#25551;&#36848;&#31526;&#25918;&#22312;&#24212;&#29992;&#31243;&#24207;&#21253;&#25991;&#20214;&#20013;&#12290;&#22240;&#20026;Java EE 5&#26381;&#21153;&#22120;&#23558;&#21482;
        &#26597;&#25214;&#40664;&#35748;&#30340;<tt class="literal">META-INF/persistence.xml</tt>&#25991;&#20214;&#65292;&#23427;&#20250;&#24573;&#30053;&#36825;&#31181;&#23450;&#21046;&#30340;&#25345;&#20037;&#21270;&#21333;&#20803;&#65292;&#22240;&#32780;&#36991;&#20813;&#19982;&#21069;&#38754;Spring
        &#39537;&#21160;&#30340;JPA&#37197;&#32622;&#20914;&#31361;&#12290;&#65288;&#20363;&#22914;&#65292;&#36866;&#29992;&#20110;Rdsin 3.1&#65289;&#12290;</p><p><span class="emphasis"><em>&#22312;&#22522;&#20110;Spring&#30340;&#24212;&#29992;&#31243;&#24207;&#29615;&#22659;&#20013;&#20351;&#29992;&#35813;&#26041;&#24335;&#21487;&#33719;&#24471;&#20840;&#37096;JPA&#21151;&#33021;&#12290;&#36825;&#21253;&#25324;web&#23481;&#22120;&#65292;&#22914;Tomcat&#65292;
        &#20197;&#21450;&#29420;&#31435;&#30340;&#24212;&#29992;&#31243;&#24207;&#21644;&#21253;&#21547;&#22797;&#26434;&#25345;&#20037;&#21270;&#38656;&#27714;&#30340;&#38598;&#25104;&#27979;&#35797;&#12290;</em></span></p><div class="sidebar"><p class="title"><b>&#20309;&#26102;&#38656;&#35201;&#21152;&#36733;&#26102;&#32455;&#20837;&#65311;</b></p><p>&#24182;&#38750;&#25152;&#26377;&#30340;JPA&#25552;&#20379;&#32773;&#37117;&#38656;&#35201;JVM&#20195;&#29702;(Hibernate&#23601;&#26159;&#19968;&#20010;&#20363;&#23376;)&#12290;
          &#22914;&#26524;&#20320;&#30340;&#25552;&#20379;&#32773;&#19981;&#38656;&#35201;&#20195;&#29702;(agent)&#25110;&#32773;&#20320;&#26377;&#20854;&#20182;&#36873;&#25321;(&#20363;&#22914;&#36890;&#36807;&#33258;&#23450;&#20041;&#32534;&#35793;&#22120;&#25110;&#32773;ant&#20219;&#21153;&#22312;&#26500;&#24314;&#26102;&#36827;&#34892;&#22686;&#24378;)&#65292;&#37027;&#20040;&#23601;<span class="bold"><b>&#19981;&#24212;&#35813;</b></span>&#20351;&#29992;&#21152;&#36733;&#26102;&#32455;&#20837;&#12290;</p></div><p><tt class="interfacename">LoadTimeWeaver</tt> &#25509;&#21475;&#30001;Spring&#25552;&#20379;&#65292;&#20801;&#35768;JPA <tt class="interfacename">ClassTransformer</tt> &#23454;&#20363;
		&#33021;&#22815;&#26681;&#25454;&#29615;&#22659;&#65288;web&#23481;&#22120;/&#24212;&#29992;&#26381;&#21153;&#22120;&#65289;&#20197;&#29305;&#23450;&#30340;&#26041;&#24335;&#25554;&#20837;&#12290;
		&#36890;&#36807;Java 5 <a href="http://java.sun.com/j2se/1.5.0/docs/api/java/lang/instrument/package-summary.html" target="_top">&#20195;&#29702;</a>&#25346;&#38057;
		<tt class="literal">ClassTransformers</tt>&#32463;&#24120;&#26159;&#26080;&#25928;&#30340; &#8212;&#8212; &#20195;&#29702;&#36890;&#24120;&#22312; <span class="emphasis"><em>&#25972;&#20010;&#34394;&#25311;&#26426;</em></span> &#29615;&#22659;&#19979;&#24037;&#20316;&#65292;&#24182;&#19988;&#30417;&#25511;
		<span class="emphasis"><em>&#27599;&#19968;&#20010;</em></span> &#34987;&#21152;&#36733;&#30340;&#31867; &#8212;&#8212; &#36825;&#22312;&#29983;&#20135;&#29615;&#22659;&#19979;&#19968;&#33324;&#26159;&#19981;&#25552;&#20513;&#30340;&#12290;</p><p>Spring&#25552;&#20379;&#20102;&#22823;&#37327;&#29992;&#20110;&#19981;&#21516;&#29615;&#22659;&#30340; <tt class="interfacename">LoadTimeWeaver</tt> &#23454;&#29616;&#31867;&#65292;
		&#20801;&#35768; <tt class="interfacename">ClassTransformer</tt> &#23454;&#20363;&#33021;&#22815;&#20165;&#29992;&#20110;<span class="emphasis"><em>&#27599;&#20010;classloader</em></span> &#65292;&#32780;&#19981;&#26159;&#27599;&#20010;&#34394;&#25311;&#26426;&#12290;</p><p>&#25509;&#19979;&#26469;&#30340;&#19968;&#33410;&#23558;&#35752;&#35770;&#22312;Tomcat&#20197;&#21450;&#20351;&#29992;Spring&#30340;VM&#20195;&#29702;&#24773;&#20917;&#19979;&#30340;&#20856;&#22411;JPA&#32455;&#20837;&#37197;&#32622;&#12290;&#20851;&#20110;&#35774;&#32622;&#24120;&#29992;&#21152;&#36733;&#26102;&#32455;&#20837;&#30340;&#35814;&#32454;&#20869;&#23481;&#65292;
        &#35831;&#21442;&#35265;AOP&#19968;&#31456;&#20013;&#30340;<a href="aop.html#aop-aj-ltw-spring" title="6.8.4.5.&nbsp;Spring&#37197;&#32622;">Section&nbsp;6.8.4.5, &#8220;Spring&#37197;&#32622;&#8221;</a>&#19968;&#33410;&#65292;&#23427;&#28085;&#30422;&#20102;Tomcat&#12289;VM&#20195;&#29702;&#20197;&#21450;WebLogic&#12289;OC4J&#12289;GlassFish&#21644;Resin&#12290;</p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="orm-jpa-setup-lcemfb-tomcat"></a>12.6.1.3.1.&nbsp;Tomcat&#65288;5.0&#20197;&#19978;&#65289;&#21152;&#36733;&#26102;&#30340;&#32455;&#20837;&#37197;&#32622;</h5></div></div><div></div></div><p><a href="http://tomcat.apache.org/" target="_top">Apache Tomcat</a> &#32570;&#30465;&#30340;ClassLoader&#65288;&#31867;&#35013;&#36733;&#22120;&#65289;&#24182;&#19981;&#25903;&#25345;&#31867;&#30340;&#20999;&#25442;&#65292;
		  &#20294;&#26159;&#23427;&#20801;&#35768;&#20351;&#29992;&#29992;&#25143;&#33258;&#23450;&#20041;&#30340;&#31867;&#35013;&#36733;&#22120;&#12290;Spring&#25552;&#20379;&#20102; <tt class="classname">TomcatInstrumentableClassLoader</tt> &#31867;
		  &#65288;&#22312;<tt class="literal">org.springframework.instrument.classloading.tomcat</tt> &#21253;&#20013;&#65289;&#65292;&#36825;&#20010;&#31867;&#32487;&#25215;&#33258;Tomcat&#30340;&#31867;&#35013;&#36733;&#22120;
		  &#65288;<tt class="classname">WebappClassLoader</tt>&#65289;&#24182;&#19988;&#20801;&#35768;JPA <tt class="classname">ClassTransformer</tt> &#30340;&#23454;&#20363;&#26469;&#8220;&#22686;&#24378;&#8221;&#25152;&#26377;&#30001;&#23427;&#21152;&#36733;&#30340;&#31867;&#12290;
		&#31616;&#21333;&#35828;&#65292;JPA&#36716;&#21270;&#22120;&#65288;JPA transformer&#65289;&#20165;&#20165;&#22312;&#65288;&#20351;&#29992; <tt class="classname">TomcatInstrumentableClassLoader</tt> &#30340;&#65289;&#29305;&#23450;web&#24212;&#29992;&#31243;&#24207;&#20013;&#25165;&#33021;&#34987;&#20351;&#29992;&#12290;</p><p>&#20026;&#20351;&#29992;&#29992;&#25143;&#33258;&#23450;&#20041;&#30340;&#31867;&#35013;&#36733;&#22120;&#65306;</p><div class="itemizedlist"><div class="orderedlist"><ol type="1"><li><p>&#23558; <tt class="literal">spring-tomcat-weaver.jar</tt> &#22797;&#21046;&#21040; <span class="emphasis"><em>$CATALINA_HOME</em></span>/server/lib &#19979;
				&#65288;&#20854;&#20013;<span class="emphasis"><em>$CATALINA_HOME</em></span> &#34920;&#31034;Tomcat&#30340;&#23433;&#35013;&#36335;&#24452;&#65289;&#12290;</p></li><li><p>&#36890;&#36807;&#20462;&#25913;web application context&#20351;Tomcat&#20351;&#29992;&#29992;&#25143;&#33258;&#23450;&#20041;&#30340;&#31867;&#35013;&#36733;&#22120;&#65288;&#32780;&#19981;&#26159;&#40664;&#35748;&#30340;&#31867;&#35013;&#36733;&#22120;&#65289;&#65306;</p><pre class="programlisting">&lt;Context path="/myWebApp" docBase="/my/webApp/location"&gt;
    &lt;Loader loaderClass="org.springframework.instrument.classloading.tomcat.TomcatInstrumentableClassLoader"/&gt;
&lt;/Context&gt;</pre><p>Tomcat 5.0.x &#21644; 5.5.x &#31995;&#21015;&#25903;&#25345;&#22810;&#20010;&#19978;&#19979;&#25991;&#36335;&#24452;&#65288;context locations&#65289;&#65306;
							&#26381;&#21153;&#22120;&#37197;&#32622;&#25991;&#20214;(<span class="emphasis"><em>$CATALINA_HOME/conf/server.xml</em></span>)&#65292;
							&#40664;&#35748;&#30340;&#19978;&#19979;&#25991;&#37197;&#32622;&#65288;<span class="emphasis"><em>$CATALINA_HOME/conf/context.xml</em></span>&#65289;&#20250;&#24433;&#21709;&#25152;&#26377;&#34987;&#37096;&#32626;&#30340;web&#24212;&#29992;&#31243;&#24207;&#12289;
							&#21333;&#29420;&#37096;&#32626;&#22312;Server&#31471;&#30340;web&#24212;&#29992;&#31243;&#24207;&#30340;&#37197;&#32622;<span class="emphasis"><em>&#65288;$CATALINA_HOME/conf/[enginename]/[hostname]/my-webapp-context.xml</em></span>&#65289;
							&#25110;&#32773;&#19982;web&#24212;&#29992;&#31243;&#24207;&#19968;&#36215;&#65288;<span class="emphasis"><em>your-webapp.war/META-INF/context.xml</em></span>&#65289;&#12290;&#20174;&#25928;&#29575;&#30340;&#35282;&#24230;&#35828;&#65292;
							&#25105;&#20204;&#25512;&#33616;&#22312;web-app&#30340;&#20869;&#37096;&#37197;&#32622;&#30340;&#26041;&#24335;&#65292;&#22240;&#20026;&#20165;&#20165;&#20351;&#29992;JPA&#30340;&#24212;&#29992;&#31243;&#24207;&#20250;&#20351;&#29992;&#29992;&#25143;&#33258;&#23450;&#20041;&#30340;&#31867;&#35013;&#36733;&#22120;&#12290;
							&#26356;&#22810;&#20855;&#20307;&#26377;&#20851;&#21487;&#29992;&#30340;&#19978;&#19979;&#25991;&#36335;&#24452;&#30340;&#20869;&#23481;&#35831;&#21442;&#35265;Tomcat 5.x&#30340;<a href="http://tomcat.apache.org/tomcat-5.5-doc/config/context.html" target="_top">&#25991;&#26723;</a>&#12290;</p><p>&#27880;&#24847;&#65292;5.5.20&#20043;&#21069;&#30340;&#29256;&#26412;&#26377;&#19968;&#20010;XML&#37197;&#32622;&#35299;&#26512;&#30340;bug&#65292;&#36896;&#25104;<span class="emphasis"><em> server.xml </em></span>
							&#20013;&#26080;&#27861;&#20351;&#29992;<tt class="literal">Loader</tt>&#26631;&#31614;&#65292;&#26080;&#35770;&#26159;&#21542;&#25351;&#23450;&#20102;classloader&#65292;&#20063;&#19981;&#31649;&#36825;&#20010;classloader&#26159;&#23448;&#26041;&#30340;&#36824;&#26159;&#33258;&#23450;&#20041;&#30340;&#12290;</p>

&#12288;&#12288;&#12288;&#12288;&#12288;&#12288;&#12288;&#12288;<p>&#22914;&#26524;&#20320;&#27491;&#22312;&#20351;&#29992;&#30340;&#26159;Tomcat 5.5.20&#20197;&#19978;&#30340;&#29256;&#26412;&#65292;&#23601;&#21487;&#20197;&#23558;<span class="emphasis"><em>useSystemClassLoaderAsParent</em></span>&#35774;&#32622;&#25104;
&#12288;&#12288;&#12288;&#12288;&#12288;&#12288;&#12288;&#12288;<tt class="literal">false</tt>&#26469;&#35299;&#20915;&#36825;&#20010;&#38382;&#39064;&#65306;</p><pre class="programlisting">&lt;Context path="/myWebApp" docBase="/my/webApp/location"&gt;
    &lt;Loader loaderClass="org.springframework.instrument.classloading.tomcat.TomcatInstrumentableClassLoader"
            useSystemClassLoaderAsParent="false"/&gt;
&lt;/Context&gt;</pre></li></ol></div><div class="orderedlist"><ol type="1"><li><p>&#23558;<tt class="literal">spring-tomcat-weaver.jar</tt>&#22797;&#21046;&#21040;<span class="emphasis"><em>$CATALINA_HOME</em></span>/lib (where
                <span class="emphasis"><em>$CATALINA_HOME</em></span>&#34920;&#31034;Tomcat&#23433;&#35013;&#26681;&#30446;&#24405;&#30340;&#20301;&#32622;&#65289;&#12290;</p></li><li><p>&#36890;&#36807;&#32534;&#36753;web&#24212;&#29992;&#31243;&#24207;&#19978;&#19979;&#25991;&#25991;&#20214;&#65292;&#20351;Tomcat&#20351;&#29992;&#33258;&#23450;&#20041;&#30340;ClassLoader&#65288;&#32780;&#19981;&#26159;&#40664;&#35748;&#30340;ClassLoader&#65289;&#65306;</p><pre class="programlisting">&lt;Context path="/myWebApp" docBase="/my/webApp/location"&gt;
    &lt;Loader loaderClass="org.springframework.instrument.classloading.tomcat.TomcatInstrumentableClassLoader"/&gt;
&lt;/Context&gt;</pre><p>Tomcat 6.0.x (&#31867;&#20284;&#20110;5.0.x/5.5.x)&#31995;&#21015;&#25903;&#25345;&#20960;&#31181;&#19978;&#19979;&#25991;&#36335;&#24452;&#65306;&#65288;context locations&#65289;&#65306;
							&#26381;&#21153;&#22120;&#37197;&#32622;&#25991;&#20214;(<span class="emphasis"><em>$CATALINA_HOME/conf/server.xml</em></span>)&#65292;
							&#40664;&#35748;&#30340;&#19978;&#19979;&#25991;&#37197;&#32622;&#65288;<span class="emphasis"><em>$CATALINA_HOME/conf/context.xml</em></span>&#65289;&#20250;&#24433;&#21709;&#25152;&#26377;&#34987;&#37096;&#32626;&#30340;web&#24212;&#29992;&#31243;&#24207;&#12289;
							&#21333;&#29420;&#37096;&#32626;&#22312;Server&#31471;&#30340;web&#24212;&#29992;&#31243;&#24207;&#30340;&#37197;&#32622;<span class="emphasis"><em>&#65288;$CATALINA_HOME/conf/[enginename]/[hostname]/my-webapp-context.xml</em></span>&#65289;
							&#25110;&#32773;&#19982;web&#24212;&#29992;&#31243;&#24207;&#19968;&#36215;&#65288;<span class="emphasis"><em>your-webapp.war/META-INF/context.xml</em></span>&#65289;&#12290;&#20174;&#25928;&#29575;&#30340;&#35282;&#24230;&#35828;&#65292;
							&#25105;&#20204;&#25512;&#33616;&#22312;web-app&#30340;&#20869;&#37096;&#37197;&#32622;&#30340;&#26041;&#24335;&#65292;&#22240;&#20026;&#20165;&#20165;&#20351;&#29992;JPA&#30340;&#24212;&#29992;&#31243;&#24207;&#20250;&#20351;&#29992;&#29992;&#25143;&#33258;&#23450;&#20041;&#30340;&#31867;&#35013;&#36733;&#22120;&#12290;
							&#26356;&#22810;&#20855;&#20307;&#26377;&#20851;&#21487;&#29992;&#30340;&#19978;&#19979;&#25991;&#36335;&#24452;&#30340;&#20869;&#23481;&#35831;&#21442;&#35265;Tomcat 5.x <a href="http://tomcat.apache.org/tomcat-6.0-doc/config/context.html" target="_top">documentation</a>&#12290;</p></li></ol></div><ul type="disc"><li><p>Tomcat 5.0.x/5.5.x</p></li><li><p>Tomcat 6.0.x</p></li></ul></div><p>&#25152;&#26377;Tomcat&#29256;&#26412;&#25152;&#38656;&#30340;&#26368;&#21518;&#19968;&#27493;&#65292;&#26159;&#22312;&#37197;&#32622;<tt class="classname">LocalContainerEntityManagerFactoryBean</tt>&#30340;&#26102;&#65292;&#20351;&#29992;
          &#30456;&#24212;&#30340;<tt class="interfacename">LoadTimeWeaver</tt>&#65306;</p><pre class="programlisting">&lt;bean id="emf" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"&gt;
  &lt;property name="loadTimeWeaver"&gt;
    &lt;bean class="org.springframework.instrument.classloading.ReflectiveLoadTimeWeaver"/&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre><p>&#21033;&#29992;&#36825;&#31181;&#26041;&#27861;&#65292;&#20381;&#36182;&#24037;&#20855;&#30340;JPA&#24212;&#29992;&#31243;&#24207;&#26080;&#38656;&#20195;&#29702;&#23601;&#21487;&#20197;&#22312;Tomcat&#19978;&#36816;&#34892;&#12290;&#36825;&#22312;&#23487;&#20027;&#24212;&#29992;&#31243;&#24207;&#20381;&#36182;&#19981;&#21516;&#30340;JPA&#23454;&#29616;&#26102;&#23588;&#20026;&#37325;&#35201;&#65292;
          &#22240;&#20026;JPA&#36716;&#21270;&#22120;&#21482;&#36866;&#29992;&#20110;ClassLoader&#32423;&#21035;&#65292;&#23427;&#20204;&#20043;&#38388;&#26159;&#24444;&#27492;&#38548;&#31163;&#30340;&#12290;</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>&#22914;&#26524;Tomcat&#20351;&#29992;TopLink&#20316;&#20026;JPA&#25552;&#20379;&#32773;&#65292;&#35831;&#23558;&#26680;&#24515;&#30340;toplink jar&#21253;&#25918;&#22312;<span class="emphasis"><em>$CATALINA_HOME</em></span>/shared/lib&#25991;&#20214;&#22841;&#20013;&#65292;&#32780;&#19981;&#20877;&#25918;&#21040;war&#20013;&#12290;</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="orm-jpa-setup-lcemfb-agent"></a>12.6.1.3.2.&nbsp;&#20351;&#29992;VM&#20195;&#29702;&#30340;&#20840;&#23616;&#21152;&#36733;&#26102;&#32455;&#20837;</h5></div></div><div></div></div><p>&#23545;&#20110;&#38656;&#35201;&#31867;&#24037;&#20855;&#65292;&#21516;&#26102;&#29616;&#26377;&#30340;LoadTimeWeaver&#23454;&#29616;&#19981;&#25552;&#20379;&#36825;&#31181;&#25903;&#25345;&#30340;&#29615;&#22659;&#65292;JDK&#20195;&#29702;&#26159;&#21807;&#19968;&#30340;&#35299;&#20915;&#26041;&#26696;&#12290;&#23545;&#20110;&#36825;&#31181;&#24773;&#20917;&#65292;Spring&#25552;&#20379;&#20102;
          &#38656;&#35201;&#29305;&#23450;&#20110;Spring&#65288;&#20294;&#38750;&#24120;&#24120;&#29992;&#65289;&#30340;VM&#20195;&#29702;&#65288;<tt class="filename">spring-agent.jar</tt>&#65289;&#30340;<tt class="classname">InstrumentationLoadTimeWeaver</tt>&#65306;</p><pre class="programlisting">&lt;bean id="emf" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"&gt;
  &lt;property name="loadTimeWeaver"&gt;
    &lt;bean class="org.springframework.instrument.classloading.InstrumentationLoadTimeWeaver"/&gt;
  &lt;/property&gt;
&lt;/bean&gt;</pre><p>&#35831;&#27880;&#24847;&#22312;&#21551;&#21160;&#34394;&#25311;&#26426;&#26102;&#65292;&#21516;&#26102;&#21551;&#21160;Spring&#20195;&#29702;&#65292;&#26041;&#27861;&#26159;&#25552;&#20379;&#19979;&#21015;JVM&#36873;&#39033;&#65306;</p><pre class="programlisting">-javaagent:/path/to/spring-agent.jar</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="orm-jpa-setup-lcemfb-weaver"></a>12.6.1.3.3.&nbsp;&#19978;&#19979;&#25991;&#33539;&#22260;&#20869;&#30340;&#21152;&#36733;&#26102;&#32455;&#20837;&#37197;&#32622;</h5></div></div><div></div></div><p>&#33258;Spring 2.5&#65292;&#21487;&#20197;&#20351;&#29992;<tt class="literal">context:load-time-weaver</tt>&#20803;&#32032;&#26469;&#37197;&#32622;
          &#19978;&#19979;&#25991;&#33539;&#22260;&#30340;<tt class="interfacename">LoadTimeWeaver</tt>&#20102;&#12290;&#36825;&#31181;&#8220;&#20840;&#23616;&#8221;&#32455;&#20837;&#22120;&#30001;&#25152;&#26377;JPA
          <tt class="classname">LocalContainerEntityManagerFactoryBeans</tt>&#33258;&#21160;&#25315;&#36873;&#12290;</p><p>&#36825;&#26159;&#37197;&#32622;&#21152;&#36733;&#26102;&#32455;&#20837;&#22120;&#30340;&#25512;&#33616;&#26041;&#27861;&#65292;&#25552;&#20379;&#24179;&#21488;&#65288;ebLogic, OC4J, GlassFish, Tomcat, Resin, VM agent&#65289;&#30340;&#33258;&#21160;&#26816;&#27979;&#65292;&#20197;&#21450;&#32455;&#20837;&#22120;&#21040;&#25152;&#26377;&#32455;&#20837;&#22120;&#30693;&#36947;&#30340;bean&#30340;&#33258;&#21160;&#20256;&#25773;&#12290;</p><pre class="programlisting">&lt;context:load-time-weaver/&gt;

&lt;bean id="emf" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"&gt;
    ...
&lt;/bean&gt;</pre><p>&#20851;&#20110;&#22914;&#20309;&#24314;&#31435;&#24120;&#29992;&#21152;&#36733;&#26102;&#32455;&#20837;&#30340;&#35814;&#32454;&#20869;&#23481;&#65292;&#35831;&#21442;&#35265;<a href="aop.html#aop-aj-ltw-spring" title="6.8.4.5.&nbsp;Spring&#37197;&#32622;">Section&nbsp;6.8.4.5, &#8220;Spring&#37197;&#32622;&#8221;</a>&#19968;&#33410;&#65292;&#23427;&#28085;&#30422;&#20102;
          Tomcat&#12289;VM&#20195;&#29702;&#65292;&#20197;&#21450;WebLogic, OC4J, GlassFish&#21644;Resin&#12290;</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="orm-jpa-multiple-pu"></a>12.6.1.4.&nbsp;&#22788;&#29702;&#22810;&#25345;&#20037;&#21270;&#21333;&#20803;</h4></div></div><div></div></div><p>&#23545;&#20110;&#37027;&#20123;&#20381;&#38752;&#22810;&#20010;&#25345;&#20037;&#21270;&#21333;&#20803;&#20301;&#32622;(&#20363;&#22914;&#23384;&#25918;&#22312;classpath&#20013;&#30340;&#22810;&#20010;jar&#20013;)&#30340;&#24212;&#29992;&#31243;&#24207;&#65292;
        Spring&#25552;&#20379;&#20102;&#20316;&#20026;&#20013;&#22830;&#20179;&#24211;&#30340;<tt class="literal">PersistenceUnitManager</tt>&#65292;
        &#36991;&#20813;&#20102;&#25345;&#20037;&#21270;&#21333;&#20803;&#26597;&#25214;&#36807;&#31243;(&#30340;&#28508;&#22312;&#24320;&#38144;)&#12290;&#32570;&#30465;&#23454;&#29616;&#20801;&#35768;&#25351;&#23450;&#22810;&#20010;&#20301;&#32622;
        (&#40664;&#35748;&#24773;&#20917;&#19979;classpath&#20250;&#25628;&#32034;META-INF/persistence.xml&#25991;&#20214;)&#65292;&#23427;&#20204;&#20250;&#34987;&#35299;&#26512;&#28982;&#21518;&#36890;&#36807;&#25345;&#20037;&#21270;&#21333;&#20803;&#21517;&#31216;&#34987;&#33719;&#21462;&#65306;</p><pre class="programlisting">&lt;bean id="pum" class="org.springframework.orm.jpa.persistenceunit.DefaultPersistenceUnitManager"&gt;
  &lt;property name="persistenceXmlLocation"&gt;
    &lt;list&gt;
     &lt;value&gt;org/springframework/orm/jpa/domain/persistence-multi.xml&lt;/value&gt;
     &lt;value&gt;classpath:/my/package/**/custom-persistence.xml&lt;/value&gt;
     &lt;value&gt;classpath*:META-INF/persistence.xml&lt;/value&gt;
    &lt;/list&gt;
  &lt;/property&gt;
  &lt;property name="dataSources"&gt;
   &lt;map&gt;
    &lt;entry key="localDataSource" value-ref="local-db"/&gt;
    &lt;entry key="remoteDataSource" value-ref="remote-db"/&gt;
   &lt;/map&gt;
  &lt;/property&gt;
  <i class="lineannotation"><span class="lineannotation">&lt;!-- if no datasource is specified, use this one --&gt;</span></i>
  &lt;property name="defaultDataSource" ref="remoteDataSource"/&gt;
&lt;/bean&gt;

&lt;bean id="emf" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"&gt;
  &lt;property name="persistenceUnitManager" ref="pum"/&gt;
&lt;/bean&gt;</pre><p>&#35201;&#27880;&#24847;&#30340;&#26159;&#65292;&#32570;&#30465;&#23454;&#29616;&#20801;&#35768;&#22312;&#23558;&#25345;&#20037;&#21270;&#21333;&#20803;&#20449;&#24687;&#20256;&#20837;JPA provider&#20043;&#21069;&#29992;
        <tt class="literal">PersistenceUnitPostProcessor</tt>(&#23427;&#20801;&#35768;&#36873;&#25321;&#25345;&#20037;&#21270;&#21333;&#20803;)&#20462;&#25913;&#23427;&#20204;&#65292;
        &#20256;&#20837;&#30340;&#36807;&#31243;&#21487;&#20197;&#26159;&#36890;&#36807;&#23646;&#24615;&#22768;&#26126;&#24335;&#22320;&#20256;&#20837;(&#24433;&#21709;&#20854;&#20013;&#25152;&#26377;&#30340;&#21333;&#20803;)&#25110;&#32534;&#31243;&#24335;&#22320;&#20256;&#20837;&#12290;
        &#22914;&#26524;&#27809;&#26377;&#25351;&#23450;persistenceUnitManager&#65292;<tt class="literal">LocalContainerEntityManagerFactoryBean</tt>
        &#20250;&#21019;&#24314;&#19968;&#20010;&#24182;&#22312;&#20869;&#37096;&#20351;&#29992;&#23427;&#12290;</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-jpa-template"></a>12.6.2.&nbsp;<tt class="classname">JpaTemplate</tt> &#21644; <tt class="classname">JpaDaoSupport</tt></h3></div></div><div></div></div><p>&#27599;&#20010;&#22522;&#20110;JPA&#30340;DAO&#37117;&#23558;&#36890;&#36807;&#20381;&#36182;&#27880;&#20837;&#25509;&#25910;&#19968;&#20010; <tt class="interfacename">EntityManagerFactory</tt> &#23454;&#20363;&#12290;
		&#36825;&#26679;&#30340;DAO&#21487;&#20197;&#36890;&#36807;&#25351;&#23450;&#30340; <tt class="interfacename">EntityManagerFactory</tt> &#26469;&#25805;&#20316;&#21407;&#29983;JPA&#30340;API&#36827;&#34892;&#25968;&#25454;&#35775;&#38382;&#65292;
		&#20063;&#21487;&#20197;&#30452;&#25509;&#20351;&#29992;Spring&#30340; <tt class="classname">JpaTemplate</tt>&#65306;</p><pre class="programlisting">&lt;beans&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"&gt;
    &lt;property name="entityManagerFactory" ref="entityManagerFactory"/&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</pre><pre class="programlisting">public class JpaProductDao implements ProductDao {
  
    private JpaTemplate jpaTemplate;

    public void setEntityManagerFactory(EntityManagerFactory emf) {
        this.jpaTemplate = new JpaTemplate(emf);
    }

    public Collection loadProductsByCategory(final String category) throws DataAccessException {
        return (Collection) this.jpaTemplate.execute(new JpaCallback() {
            public Object doInJpa(EntityManager em) throws PersistenceException {
                Query query = em.createQuery("from Product as p where p.category = :category");
                query.setParameter("category", category);
                List result = query.getResultList(); 
                <i class="lineannotation"><span class="lineannotation">// do some further processing with the result list</span></i>
                return result;
            }
        });
    }
}</pre><p>
	<tt class="interfacename">JpaCallback</tt> &#23454;&#29616;&#20801;&#35768;&#20219;&#24847;&#31867;&#22411;&#30340;JPA&#25968;&#25454;&#35775;&#38382;&#12290;
<tt class="classname">JpaTemplate</tt> &#23558;&#30830;&#20445; <tt class="interfacename">EntityManager</tt> &#27491;&#30830;&#22320;&#25171;&#24320;&#21644;&#20851;&#38381;&#65292;&#24182;&#19988;&#33021;&#22815;&#33258;&#21160;&#22320;&#21442;&#19982;&#21040;&#20107;&#21153;&#20013;&#21435;&#12290;
&#38500;&#27492;&#20043;&#22806;&#65292;<tt class="classname">JpaTemplate</tt> &#33021;&#22815;&#24688;&#24403;&#22320;&#22788;&#29702;&#24322;&#24120;&#65292;&#30830;&#20445;&#36164;&#28304;&#30340;&#21450;&#26102;&#28165;&#29702;&#20197;&#21450;&#24517;&#35201;&#26102;&#30340;&#20107;&#21153;&#22238;&#28378;&#12290;
Template&#23454;&#20363;&#19981;&#20165;&#26159;&#32447;&#31243;&#23433;&#20840;&#30340;&#65292;&#32780;&#19988;&#23427;&#26159;&#21487;&#37325;&#29992;&#30340;&#65292;&#22240;&#32780;&#23427;&#33021;&#22815;&#20316;&#20026;&#23454;&#20363;&#21464;&#37327;&#34987;&#19968;&#20010;&#31867;&#25345;&#26377;&#12290;
&#27880;&#24847;&#65292; <tt class="classname">JpaTemplate</tt> &#25552;&#20379;&#20102;&#31616;&#21333;&#30340;&#35832;&#22914;find&#12289;load&#12289;merge&#31561;&#25805;&#20316;&#30340;&#24555;&#25463;&#20989;&#25968;&#26469;&#26367;&#20195;&#40664;&#35748;&#30340;&#22238;&#35843;&#23454;&#29616;&#12290;</p><p>&#19981;&#20165;&#22914;&#27492;&#65292;Spring&#36824;&#25552;&#20379;&#20102;&#19968;&#20010;&#26041;&#20415;&#30340; <tt class="classname">JpaDaoSupport</tt> &#22522;&#31867;&#65292;&#25552;&#20379;&#20102;
			<tt class="literal">get/setEntityManagerFactory</tt> &#26041;&#27861;&#20197;&#21450; <tt class="literal">getJpaTemplate()</tt> &#26041;&#27861;&#20379;&#23376;&#31867;&#35843;&#29992;&#65306;</p><pre class="programlisting">public class ProductDaoImpl extends JpaDaoSupport implements ProductDao {
  
    public Collection loadProductsByCategory(String category) throws DataAccessException {
        Map&lt;String, String&gt; params = new HashMap&lt;String, String&gt;();
        params.put("category", category);
        return getJpaTemplate().findByNamedParams("from Product as p where p.category = :category", params);
    }
}</pre><p>&#38500;&#20102;&#30452;&#25509;&#20351;&#29992;Spring&#30340; <tt class="classname">JpaTemplate</tt>&#20043;&#22806;&#65292;&#20063;&#21487;&#20197;&#20351;&#29992;&#21407;&#29983;JPA&#30340;API&#26469;&#23454;&#29616;&#22522;&#20110;Spring&#30340;DAO&#65292;
		&#27492;&#26102;&#20320;&#38656;&#35201;&#33258;&#34892;&#26126;&#30830;&#22320;&#22788;&#29702;<tt class="literal">EntityManager</tt>&#12290;&#27491;&#22914;&#22312;&#30456;&#24212;&#30340;Hibernate&#31456;&#33410;&#25551;&#36848;&#30340;&#19968;&#26679;&#65292;&#36825;&#31181;&#20570;&#27861;&#30340;&#20027;&#35201;&#20248;
		&#28857;&#22312;&#20110;&#20320;&#30340;&#25968;&#25454;&#35775;&#38382;&#20195;&#30721;&#21487;&#20197;&#22312;&#25972;&#20010;&#36807;&#31243;&#20013;&#25243;&#20986;checked exceptions&#12290;<tt class="classname">JpaDaoSupport</tt> &#20026;&#36825;&#31181;&#24773;&#20917;&#25552;
		&#20379;&#20102;&#22810;&#31181;&#20989;&#25968;&#25903;&#25345;&#65292;&#21253;&#25324;&#33719;&#21462;&#21644;&#37322;&#25918;&#19968;&#20010;&#20855;&#22791;&#20107;&#21153;&#31649;&#29702;&#21151;&#33021;&#30340; <tt class="interfacename">EntityManager</tt> &#21644;&#30456;&#20851;&#30340;&#24322;&#24120;&#36716;&#21270;&#12290;</p><p><span class="emphasis"><em>JpaTemplate&#20027;&#35201;&#20197;JdoTemplate&#21644;HibernateTemplate&#30340;&#21516;&#32990;&#32780;&#23384;&#22312;&#65292;&#20026;&#20351;&#29992;&#23427;&#30340;&#20154;&#20204;&#25552;&#20379;&#30456;&#21516;&#30340;&#39118;&#26684;&#12290;
      &#23545;&#20110;&#26032;&#21551;&#21160;&#30340;&#39033;&#30446;&#65292;&#35201;&#32771;&#34385;&#37319;&#29992;&#21407;&#29983;&#30340;JPA&#39118;&#26684;&#32534;&#20889;&#25968;&#25454;&#35775;&#38382;&#23545;&#35937;&#30340;&#20195;&#30721;&#65292;&#22522;&#20110;&#36890;&#36807;JPA<tt class="literal">@PersistenceContext</tt>&#27880;&#35299;
      &#33719;&#21462;&#30340;&#19968;&#20010;&#8220;&#20849;&#20139;EntityManager&#8221;&#24341;&#29992;&#65288;&#21033;&#29992;Spring&#30340;<tt class="classname">PersistenceAnnotationBeanPostProcessor</tt>&#65307;&#35814;&#24773;&#22914;&#19979;&#12290;&#65289;</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-jpa-straight"></a>12.6.3.&nbsp;&#22522;&#20110;&#21407;&#29983;&#30340;JPA&#23454;&#29616;DAO</h3></div></div><div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>&#34429;&#28982;<tt class="interfacename">EntityManagerFactory</tt>&#23454;&#20363;&#26159;&#32447;&#31243;&#23433;&#20840;&#30340;&#65292;
        &#20294;<tt class="interfacename">EntityManager</tt>&#23454;&#20363;&#30830;&#23454;&#19981;&#26159;&#36825;&#26679;&#12290;&#34987;&#27880;&#20837;&#30340;JPA 
        <tt class="interfacename">EntityManager</tt>&#30340;&#34892;&#20026;&#21644;&#20174;&#24212;&#29992;&#26381;&#21153;&#22120;JNDI&#29615;&#22659;&#20013;&#33719;&#21462;&#30340;&#27809;&#26377;&#21306;&#21035;&#65292;
        &#21644;JPA&#35268;&#33539;&#23450;&#20041;&#30340;&#19968;&#26679;&#12290;&#22914;&#26524;&#23384;&#22312;&#19968;&#20010;&#34987;&#27880;&#20837;&#30340;JPA <tt class="interfacename">EntityManager</tt>&#65292;
        &#23427;&#20250;&#20195;&#29702;&#23545;&#24403;&#21069;&#20107;&#21153;&#21270;&#30340;<tt class="interfacename">EntityManager</tt>&#30340;&#25152;&#26377;&#35843;&#29992;&#65307;
        &#21542;&#21017;&#27599;&#20010;&#25805;&#20316;&#37117;&#20250;&#21019;&#24314;&#19968;&#20010;<tt class="interfacename">EntityManager</tt>&#65292;&#30830;&#20445;&#32447;&#31243;&#23433;&#20840;&#12290;</p></td></tr></table></div><p>&#20320;&#23436;&#20840;&#21487;&#20197;&#20351;&#29992;&#21407;&#29983;&#30340;JPA&#30340;API&#36827;&#34892;&#32534;&#31243;&#65292;&#32780;&#26080;&#38656;&#23545;Spring&#20135;&#29983;&#20219;&#20309;&#20381;&#36182;&#65292;&#36825;&#21487;&#20197;&#36890;&#36807;&#19968;&#20010;&#34987;&#27880;&#20837;&#30340; 
			<tt class="interfacename">EntityManagerFactory</tt> &#25110; <tt class="interfacename">EntityManager</tt> &#26469;&#23436;&#25104;&#12290;
		&#27880;&#24847;&#65292;&#22914;&#26524; <tt class="classname">PersistenceAnnotationBeanPostProcessor</tt> &#34987;&#21551;&#29992;&#65292;Spring&#23601;&#33021;&#22815;&#35782;&#21035;&#23383;&#27573;&#25110;&#32773;&#26041;&#27861;&#32423;&#21035;&#30340; <tt class="interfacename">@PersistenceUnit</tt> &#21644; 
		<tt class="interfacename">@PersistenceContext</tt> &#27880;&#35299;&#12290;&#30456;&#24212;&#30340;DAO&#23454;&#29616;&#30475;&#36215;&#26469;&#20687;&#36825;&#26679;&#65306;</p><pre class="programlisting">public class ProductDaoImpl implements ProductDao {

    private EntityManagerFactory emf;

    @PersistenceUnit
    public void setEntityManagerFactory(EntityManagerFactory emf) {
        this.emf = emf;
    }

    public Collection loadProductsByCategory(String category) {
        EntityManager em = this.emf.createEntityManager();
        try {
             Query query = em.createQuery("from Product as p where p.category = ?1");
             query.setParameter(1, category);
             return query.getResultList();
        }
        finally {
            if (em != null) {
                em.close();
            }
        }
    }
}</pre><p>&#19978;&#36848;&#30340;DAO&#19981;&#23545;Spring&#20135;&#29983;&#20219;&#20309;&#20381;&#36182;&#65292;&#32780;&#23427;&#23601;&#22914;&#21516;&#20351;&#29992;Spring&#30340; <tt class="classname">JpaTemplate</tt> &#37027;&#26679;&#65292;&#20173;&#28982;&#38750;&#24120;&#36866;&#21512;
			&#22312;Spring&#30340;application context&#20013;&#36827;&#34892;&#37197;&#32622;&#12290;&#27492;&#22806;&#65292;&#36825;&#26679;&#30340;DAO&#21487;&#20197;&#21033;&#29992;&#27880;&#35299;&#26469;&#35201;&#27714;&#32570;&#30465;<tt class="interfacename">EntityManagerFactory</tt> &#30340;&#27880;&#20837;&#65306;</p><pre class="programlisting">&lt;beans&gt;

  <i class="lineannotation"><span class="lineannotation">&lt;!-- bean post-processor for JPA annotations --&gt;</span></i>
  &lt;bean class="org.springframework.orm.jpa.support.PersistenceAnnotationBeanPostProcessor"/&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"/&gt;

&lt;/beans&gt;</pre><p>&#27880;&#24847;&#65306;&#20316;&#20026;&#26174;&#24335;&#23450;&#20041;<tt class="classname">PersistenceAnnotationBeanPostProcessor</tt>&#30340;&#21478;&#19968;&#31181;&#26041;&#27861;&#65292;
      &#21487;&#20197;&#32771;&#34385;&#22312;&#24212;&#29992;&#31243;&#24207;&#19978;&#19979;&#25991;&#37197;&#32622;&#20013;&#20351;&#29992;Spring 2.5&#30340;<tt class="literal">context:annotation-config</tt> XML&#20803;&#32032;&#12290;
      &#23427;&#20250;&#33258;&#21160;&#20026;&#22522;&#20110;&#27880;&#35299;&#30340;&#37197;&#32622;&#27880;&#20876;Spring&#25152;&#26377;&#26631;&#20934;&#30340;&#21518;&#32622;&#22788;&#29702;&#22120;&#65288;&#21253;&#25324;<tt class="classname">CommonAnnotationBeanPostProcessor</tt>&#31561;&#31561;&#65289;&#12290;</p><pre class="programlisting">&lt;beans&gt;

  <i class="lineannotation"><span class="lineannotation">&lt;!-- post-processors for all standard config annotations --&gt;</span></i>
  &lt;context:annotation-config/&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"/&gt;

&lt;/beans&gt;</pre><p>&#36825;&#31867;DAO&#30340;&#20027;&#35201;&#38382;&#39064;&#22312;&#20110;&#27599;&#27425;&#24635;&#26159;&#20174;&#24037;&#21378;&#20013;&#33719;&#21462;&#19968;&#20010;&#26032;&#30340; <tt class="interfacename">EntityManager</tt> &#23454;&#20363;&#12290;
&#36825;&#19968;&#28857;&#21487;&#20197;&#36890;&#36807;&#23545; <tt class="interfacename">EntityManager</tt> &#32780;&#19981;&#26159;factory&#36827;&#34892;&#27880;&#20837;&#26469;&#35299;&#20915;&#65306;</p><pre class="programlisting">public class ProductDaoImpl implements ProductDao {

    @PersistenceContext
    private EntityManager em;

    public Collection loadProductsByCategory(String category) {
       Query query = em.createQuery("from Product as p where p.category = :category");
       query.setParameter("category", category);
       return query.getResultList(); 
    }
}</pre><p>&#27880;&#24847;&#65306;<tt class="literal">@PersistenceContext</tt>&#27880;&#35299;&#26377;&#19968;&#20010;&#21487;&#36873;&#30340;&#23646;&#24615;<tt class="literal">type</tt>&#65292;&#23427;&#30340;&#40664;&#35748;&#20540;&#26159;
      <tt class="literal">PersistenceContextType.TRANSACTION</tt>&#12290;&#35813;&#40664;&#35748;&#38656;&#35201;&#20320;&#25509;&#25910;&#19968;&#20010;&#8220;&#20849;&#20139;EntityManager&#8221;&#20195;&#29702;&#12290;
      &#21478;&#19968;&#31181;&#26041;&#24335;&#65292;<tt class="literal">PersistenceContextType.EXTENDED</tt>&#21017;&#23436;&#20840;&#19981;&#21516;&#65306;&#23427;&#20250;&#20135;&#29983;&#19968;&#20010;&#25152;&#35859;&#30340;&#8220;&#25193;&#23637;EntityManager&#8221;,
      &#36825;&#20010;<span class="emphasis"><em>&#19981;&#26159;&#32447;&#31243;&#23433;&#20840;&#30340;</em></span>&#65292;&#22240;&#27492;&#19981;&#24212;&#35813;&#29992;&#22312;&#24403;&#21069;&#34987;&#35775;&#38382;&#30340;&#32452;&#20214;&#20013;&#65292;&#20363;&#22914;Spring&#31649;&#29702;&#30340;singleton bean&#12290;
      &#25193;&#23637;&#30340;EntityManager&#21482;&#33021;&#29992;&#22312;&#26377;&#29366;&#24577;&#30340;&#32452;&#20214;&#20013;&#65292;&#20363;&#22914;&#65292;&#22312;&#20250;&#35805;&#20013;&#65292;EntityManager&#30340;&#29983;&#21629;&#21608;&#26399;&#19982;&#24403;&#21069;&#20107;&#21153;&#26080;&#20851;&#65292;&#23436;&#20840;&#21462;&#20915;&#20110;&#24212;&#29992;&#31243;&#24207;&#12290;</p><div class="sidebar"><p class="title"><b>&#26041;&#27861;&#32423;&#21644;&#23646;&#24615;&#32423;&#30340;&#27880;&#20837;</b></p><p>&#34920;&#26126;&#20381;&#36182;&#27880;&#20837;&#30340;&#27880;&#35299;(&#20363;&#22914;@PersistenceUnit&#21644;@PersistenceContext)&#33021;&#34987;&#29992;&#20110;&#31867;&#20869;&#30340;&#23646;&#24615;&#25110;&#32773;&#26041;&#27861;&#65292;
        &#36825;&#23601;&#21483;&#20570;&#8220;&#26041;&#27861;/&#23646;&#24615;&#32423;&#27880;&#20837;&#8221;&#12290;&#23646;&#24615;&#32423;&#27880;&#35299;&#30340;&#20351;&#29992;&#21313;&#20998;&#31616;&#21333;&#12289;&#31616;&#27905;&#65292;&#32780;&#26041;&#27861;&#32423;&#27880;&#35299;&#21017;&#20801;&#35768;&#22788;&#29702;&#27880;&#20837;&#30340;&#20381;&#36182;&#12290;
        &#36825;&#20004;&#31181;&#24773;&#20917;&#23545;&#25104;&#21592;&#21487;&#35265;&#24615;(public, protected, private)&#22343;&#27809;&#26377;&#35201;&#27714;&#12290;</p><p>&#37027;&#20040;&#31867;&#32423;&#30340;&#27880;&#35299;&#21448;&#20250;&#24590;&#20040;&#26679;&#21602;&#65311;</p><p>&#22312;JEE 5&#24179;&#21488;&#19978;&#65292;&#23427;&#20204;&#26159;&#29992;&#20110;&#20381;&#36182;&#22768;&#26126;&#65292;&#32780;&#38750;&#36164;&#28304;&#27880;&#20837;&#12290;</p></div><p>&#34987;&#27880;&#20837;&#30340; <tt class="interfacename">EntityManager</tt> &#30001;Spring&#31649;&#29702;&#65288;&#33021;&#22815;&#24863;&#30693;&#24403;&#21069;&#30340;&#20107;&#21153;&#65289;&#12290;
		&#20540;&#24471;&#27880;&#24847;&#30340;&#26159;&#65292;&#21363;&#20351;&#36825;&#31181;&#26032;&#30340;&#23454;&#29616;&#26356;&#20542;&#21521;&#20110;&#26041;&#27861;&#32423;&#21035;&#30340;&#27880;&#20837;&#65288;&#20351;&#29992; <tt class="interfacename">EntityManager</tt> 
		&#32780;&#19981;&#26159; <tt class="interfacename">EntityManagerFactory</tt>&#65289;&#65292;
		&#23545;&#20110;&#27880;&#35299;&#30340;&#20351;&#29992;&#65292;application context&#30340;XML&#37197;&#32622;&#21017;&#26080;&#38656;&#20219;&#20309;&#25913;&#21464;&#12290;</p><p>&#36825;&#31181;DAO&#39118;&#26684;&#30340;&#20027;&#35201;&#20248;&#28857;&#22312;&#20110;&#23427;&#20165;&#20165;&#20381;&#36182;JPA&#65292;&#32780;&#26080;&#38656;&#20381;&#36182;&#20219;&#20309;&#30340;Spring&#30340;&#31867;&#12290;&#38500;&#27492;&#20043;&#22806;&#65292;&#30001;&#20110;JPA&#30340;&#27880;&#35299;&#21487;&#34987;&#29702;&#35299;&#65292;&#27880;&#20837;&#33021;&#22815;&#34987;Spring&#23481;&#22120;&#33258;&#21160;&#24212;&#29992;&#12290;
&#20174;&#26080;&#20837;&#20405;&#24615;&#30340;&#35282;&#24230;&#26469;&#35828;&#65292;&#36825;&#19968;&#28857;&#38750;&#24120;&#26377;&#21560;&#24341;&#21147;&#65292;&#23427;&#23545;&#20110;JPA&#24320;&#21457;&#32773;&#26469;&#35828;&#20063;&#26356;&#33258;&#28982;&#12290;</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="orm-jpa-exceptions"></a>12.6.4.&nbsp;&#24322;&#24120;&#36716;&#21270;</h3></div></div><div></div></div><p>&#28982;&#32780;&#65292;DAO&#19981;&#20165;&#20250;&#25243;&#20986;&#26222;&#36890;&#30340; <tt class="classname">PersistenceException</tt> &#24322;&#24120;&#65288;&#36825;&#26159;&#19968;&#20010;&#26080;&#38656;&#22768;&#26126;&#21644;&#25429;&#33719;&#30340;unchecked exception&#65289;&#65292;
			&#36824;&#20250;&#25243;&#20986;&#35832;&#22914; <tt class="classname">IllegalArgumentException</tt> &#21644; <tt class="classname">IllegalStateException</tt> &#20043;&#31867;&#30340;&#24322;&#24120;&#12290;
		&#36825;&#24847;&#21619;&#30528;&#65292;DAO&#30340;&#35843;&#29992;&#32773;&#21482;&#33021;&#20197;&#26222;&#36890;&#30340;&#38169;&#35823;&#26469;&#22788;&#29702;&#36825;&#20123;&#24322;&#24120;&#65292;&#38500;&#38750;&#23436;&#20840;&#20381;&#36182;JPA&#33258;&#36523;&#30340;&#24322;&#24120;&#20307;&#31995;&#12290;&#22240;&#32780;&#65292;&#38500;&#38750;&#20320;&#23558;DAO&#30340;&#35843;&#29992;&#32773;&#32465;&#23450;&#21040;&#20855;&#20307;&#30340;&#23454;&#29616;&#31574;&#30053;&#19978;&#21435;&#65292;
		&#21542;&#21017;&#23558;&#26080;&#27861;&#25429;&#33719;&#29305;&#23450;&#30340;&#24322;&#24120;&#21407;&#22240;&#65288;&#35832;&#22914;&#20048;&#35266;&#38145;&#24322;&#24120;&#65289;&#12290;&#36825;&#31181;&#25240;&#20013;&#24179;&#34913;&#25110;&#35768;&#21487;&#20197;&#34987;&#25509;&#21463;&#65292;&#22914;&#26524;&#20320;&#30340;&#24212;&#29992;&#23436;&#20840;&#22522;&#20110;JPA&#25110;&#32773;&#26080;&#38656;&#36827;&#34892;&#29305;&#27530;&#30340;&#24322;&#24120;&#22788;&#29702;&#12290;&#19981;&#36807;&#65292;
		Spring&#25552;&#20379;&#20102;&#19968;&#20010;&#20801;&#35768;&#20320;&#36827;&#34892;&#36879;&#26126;&#30340;&#24322;&#24120;&#36716;&#21270;&#30340;&#35299;&#20915;&#26041;&#26696;&#65306;&#36890;&#36807;&#20351;&#29992; <tt class="interfacename">@Repository</tt> &#27880;&#35299;&#65306;</p><pre class="programlisting">@Repository
public class ProductDaoImpl implements ProductDao {

    <i class="lineannotation"><span class="lineannotation">// class body here...</span></i>

}</pre><pre class="programlisting">&lt;beans&gt;

  <i class="lineannotation"><span class="lineannotation">&lt;!-- <tt class="classname">Exception</tt> translation bean post processor --&gt;</span></i>
  &lt;bean class="org.springframework.dao.annotation.PersistenceExceptionTranslationPostProcessor"/&gt;

  &lt;bean id="myProductDao" class="product.ProductDaoImpl"/&gt;

&lt;/beans&gt;</pre><p>&#21518;&#32622;&#22788;&#29702;&#22120;&#23558;&#33258;&#21160;&#22320;&#23547;&#25214;&#25152;&#26377;&#30340;&#24322;&#24120;&#36716;&#21270;&#22120;&#65288;<tt class="interfacename">PersistenceExceptionTranslator</tt> &#25509;&#21475;&#30340;&#23454;&#29616;&#65289;&#65292;
			&#24182;&#36890;&#30693;&#25152;&#26377;&#26631;&#26377; <tt class="interfacename">@Repository</tt> &#27880;&#35299;&#30340;bean&#65292;&#20174;&#32780;&#33021;&#22815;&#20351;&#24471;&#34987;&#25214;&#21040;&#30340;&#24322;&#24120;&#36716;&#21270;&#22120;&#33021;&#22815;&#22312;&#25243;&#20986;&#24322;&#24120;&#26102;&#36827;&#34892;&#30456;&#24212;&#30340;&#24322;&#24120;&#36716;&#21270;&#24037;&#20316;&#12290;</p><p>&#24635;&#20043;&#65306;DAO&#33021;&#22815;&#22522;&#20110;&#26222;&#36890;&#30340;Java&#25345;&#20037;&#23618;API&#21644;&#27880;&#35299;&#26469;&#23454;&#29616;&#65292;&#20294;&#21516;&#26679;&#20063;&#33021;&#20139;&#21463;&#21040;&#30001;Spring&#31649;&#29702;&#20107;&#21153;&#12289;IoC&#21644;&#36879;&#26126;&#30340;&#24322;&#24120;&#36716;&#21270;
			&#65288;&#36716;&#21270;&#25104;&#20026;Spring&#30340;&#24322;&#24120;&#20307;&#31995;&#65289;&#31561;&#22909;&#22788;&#12290;</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="orm-jpa-tx"></a>12.7.&nbsp;&#20107;&#21153;&#31649;&#29702;</h2></div></div><div></div></div><p>&#23558;&#20107;&#21153;&#31649;&#29702;&#32435;&#20837;&#21040;Service&#25805;&#20316;&#30340;&#25191;&#34892;&#20013;&#65292;&#20320;&#21487;&#20197;&#20351;&#29992;Spring&#36890;&#29992;&#30340;&#22768;&#26126;&#24335;&#30340;&#20107;&#21153;&#31649;&#29702;&#21151;&#33021;&#12290;&#20363;&#22914;&#65306;</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
       http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd
       http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd"&gt;

  &lt;bean id="myTxManager" class="org.springframework.orm.jpa.JpaTransactionManager"&gt;
    &lt;property name="entityManagerFactory" ref="myEmf"/&gt;
  &lt;/bean&gt;

  &lt;bean id="myProductService" class="product.ProductServiceImpl"&gt;
    &lt;property name="productDao" ref="myProductDao"/&gt;
  &lt;/bean&gt;
  
  &lt;aop:config&gt;
    &lt;aop:pointcut id="productServiceMethods" expression="execution(* product.ProductService.*(..))"/&gt;
    &lt;aop:advisor advice-ref="txAdvice" pointcut-ref="productServiceMethods"/&gt;
  &lt;/aop:config&gt;

  &lt;tx:advice id="txAdvice" transaction-manager="myTxManager"&gt;
    &lt;tx:attributes&gt;
      &lt;tx:method name="increasePrice*" propagation="REQUIRED"/&gt;
      &lt;tx:method name="someOtherBusinessMethod" propagation="REQUIRES_NEW"/&gt;
      &lt;tx:method name="*" propagation="SUPPORTS" read-only="true"/&gt;
    &lt;/tx:attributes&gt;
  &lt;/tx:advice&gt;

&lt;/beans&gt;</pre><p>Spring JPA&#20801;&#35768;&#23558;&#19968;&#20010;&#24050;&#37197;&#32622;&#30340;<tt class="classname">JpaTransactionManager</tt>&#26292;&#38706;&#19968;&#20010;JPA&#20107;&#21153;&#32473;&#35775;&#38382;&#21516;&#19968;&#20010;JDBC <tt class="interfacename">DataSource</tt> &#30340;JDBC&#35775;&#38382;&#20195;&#30721;&#65292;
	&#21069;&#25552;&#26465;&#20214;&#26159;&#65292;&#34987;&#27880;&#20876;&#30340; <tt class="interfacename">JpaDialect</tt> &#33021;&#22815;&#25903;&#25345;&#33719;&#21462;&#24213;&#23618;&#30340;JDBC <tt class="interfacename">Connection</tt>&#12290;
		Spring&#25552;&#20379;&#20102;&#38024;&#23545;Toplink&#21644;Hibernate&#30340;JPA&#23454;&#29616;&#30340;Dialect&#12290;&#20855;&#20307;&#21442;&#35265;&#19979;&#19968;&#33410;&#26377;&#20851; <tt class="interfacename">JpaDialect</tt> &#30340;&#26426;&#21046;&#12290;
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="orm-jpa-dialect"></a>12.8.&nbsp;<tt class="interfacename">JpaDialect</tt></h2></div></div><div></div></div><p>&#20316;&#20026;&#19968;&#20010;&#39640;&#32423;&#29305;&#24615;&#65292;<tt class="classname">JpaTemplate</tt>&#12289;<tt class="classname">JpaTransactionManager</tt> &#21644;
			<tt class="classname">AbstractEntityManagerFactoryBean</tt> &#30340;&#23376;&#31867;&#25903;&#25345;&#29992;&#25143;&#33258;&#23450;&#20041;&#30340; <tt class="interfacename">JpaDialect</tt> 
			&#20316;&#20026;"jpaDialect"&#30340;bean&#23646;&#24615;&#36827;&#34892;&#27880;&#20837;&#12290;&#22312;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;DAO&#23558;&#19981;&#20877;&#25509;&#25910; <tt class="interfacename">EntityManagerFactory</tt> &#30340;&#24341;&#29992;
			&#20316;&#20026;&#21442;&#25968;&#65292;&#32780;&#26159;&#25509;&#25910;&#19968;&#20010;&#23436;&#25972;&#30340; <tt class="classname">JpaTemplate</tt>&#65288;&#20063;&#23601;&#26159;&#23558;&#23427;&#27880;&#20837;&#21040; <tt class="classname">JpaDaoSupport</tt> 
			&#30340;"jpaTemplate"&#23646;&#24615;&#20013;&#21435;&#65289;&#12290;<tt class="interfacename">JpaDialect</tt> &#23454;&#29616;&#33021;&#22815;&#28608;&#27963;&#19968;&#20123;&#30001;Spring&#25903;&#25345;&#30340;&#39640;&#32423;&#29305;&#24615;&#65292;&#36825;&#36890;&#24120;&#30001;&#29305;&#23450;&#30340;
			&#23454;&#29616;&#20379;&#24212;&#21830;&#25351;&#23450;&#65306;</p><div class="itemizedlist"><ul type="disc"><li><p>&#20351;&#29992;&#29305;&#23450;&#30340;&#20107;&#21153;&#35821;&#20041;&#65288;&#20363;&#22914;&#29992;&#25143;&#33258;&#23450;&#20041;&#30340;&#20107;&#21153;&#38548;&#31163;&#32423;&#21035;&#21644;&#20107;&#21153;&#36229;&#26102;&#65289;</p></li><li><p>&#33719;&#21462;&#20855;&#22791;&#20107;&#21153;&#21151;&#33021;&#30340;Connection&#23545;&#35937;&#65288;&#26292;&#38706;&#32473;&#22522;&#20110;JDBC&#30340;DAO&#65289;</p></li><li><p>&#20174; <tt class="literal">PersistenceExceptions</tt> &#21040;Spring&#30340; <tt class="literal">DataAccessExceptions</tt> &#39640;&#32423;&#36716;&#21270;</p></li></ul></div><p>&#36825;&#23545;&#20110;&#29305;&#27530;&#30340;&#20107;&#21153;&#35821;&#20041;&#21644;&#24322;&#24120;&#30340;&#39640;&#32423;&#36716;&#21270;&#36825;&#26679;&#30340;&#39640;&#32423;&#29305;&#24615;&#29305;&#21035;&#26377;&#20215;&#20540;&#12290;&#27880;&#24847;&#65292;&#25152;&#29992;&#30340;&#40664;&#35748;&#23454;&#29616;&#65288;<tt class="classname">DefaultJpaDialect</tt>&#65289;
	&#24182;&#19981;&#25552;&#20379;&#20219;&#20309;&#29305;&#27530;&#30340;&#21151;&#33021;&#65292;&#22914;&#26524;&#38656;&#35201;&#19978;&#36848;&#30340;&#29305;&#27530;&#21151;&#33021;&#65292;&#24517;&#39035;&#25351;&#23450;&#30456;&#24212;&#30340;Dialect&#12290;</p><p>&#26356;&#22810;&#26377;&#20851;&#23427;&#30340;&#25805;&#20316;&#20197;&#21450;&#23427;&#22914;&#20309;&#22312;Spring&#30340;JPA&#25903;&#25345;&#20013;&#20351;&#29992;&#30340;&#35814;&#32454;&#20449;&#24687;&#35831;&#21442;&#35265; <tt class="interfacename">JpaDialect</tt> &#30340;Javadoc&#12290;</p></div></div><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="jdbc.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="spring-web.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;11.&nbsp;&#20351;&#29992;JDBC&#36827;&#34892;&#25968;&#25454;&#35775;&#38382;&nbsp;</td><td width="20%" align="center"><span style="color:white;font-size:90%;"><a href="http://www.springsource.com/" title="SpringSource">Sponsored by SpringSource</a></span></td><td width="40%" align="right" valign="top">&nbsp;Part&nbsp;III.&nbsp;The Web</td></tr></table></div></body></html>