<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <title>6.3.&nbsp;Gawk变量</title>
      <link rel="stylesheet" href="docbook.css" type="text/css">
      <meta name="generator" content="DocBook XSL Stylesheets V1.69.1">
      <meta name="keywords" content="Linux, Scripts, linux, Bash, guide, Guide, Exercises, exercises, bash, scripting, Scripting, awk, sed, variables, functions, loops, conditionals">
      <link rel="start" href="index.html" title="Bash新手指南">
      <link rel="up" href="ch06.html" title="第&nbsp;6&nbsp;章&nbsp;GNU AWK编程语言">
      <link rel="prev" href="ch06s02.html" title="6.2.&nbsp;打印程序">
      <link rel="next" href="ch06s04.html" title="6.4.&nbsp;总结">
   </head>
   <body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
      <div class="navheader">
         <table width="100%" summary="Navigation header">
            <tr>
               <th colspan="3" align="center">6.3.&nbsp;Gawk变量</th>
            </tr>
            <tr>
               <td width="20%" align="left"><a accesskey="p" href="ch06s02.html">上一页</a>&nbsp;
               </td>
               <th width="60%" align="center">第&nbsp;6&nbsp;章&nbsp;GNU AWK编程语言</th>
               <td width="20%" align="right">&nbsp;<a accesskey="n" href="ch06s04.html">下一页</a></td>
            </tr>
         </table>
         <hr>
      </div>
      <div class="sect1" lang="zh-cn">
         <div class="titlepage">
            <div>
               <div>
                  <h2 class="title" style="clear: both"><a name="sect_06_03"></a>6.3.&nbsp;Gawk变量
                  </h2>
               </div>
            </div>
         </div>
         <p>既然 <span><strong class="command">awk</strong></span> 处理输入文件，他使用几个变量。一些是可以编辑的，一些是只读的。
         </p>
         <div class="sect2" lang="zh-cn">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="sect_06_03_01"></a>6.3.1.&nbsp;输入域的分隔符
                     </h3>
                  </div>
               </div>
            </div>
            <p> <span class="emphasis"><em>域分隔符</em></span>，既不是一个单独的字符也不是一个普通的表达式，是控制 <span><strong class="command">awk</strong></span> 把一个输入分割成几个域。输入记录按分割定义进行字符顺序扫描；域就是在相符的那些文字中间的那部分。
            </p>
            <p>域分隔符代表内建的变量 <code class="varname">FS</code>，注意POSIX标准的shell使用的变量 <code class="varname">IFS</code> 和他是有一些区别的。
            </p>
            <p>域分隔符变量的值可以在 <span><strong class="command">awk</strong></span> 程序中用赋值操作符 <span><strong class="command">=</strong></span> 来改变。通常最好的执行时间是一开始也就是还没有处理任何输入的时候，因此第一个记录就被随合适的分隔符一起读取。要这么做，清使用特殊的 <span><strong class="command">BEGIN</strong></span> pattern。
            </p>
            <p>以下的例子，我们编制了一条命令来显示系统里的所有用户及其描述：</p><pre class="screen">
<code class="prompt">kelly is in ~&gt;</code> <span><strong class="command">awk <em class="parameter"><code>'BEGIN { FS=":" } { print $1 "\t" $5 }'</code></em> <code class="filename">/etc/passwd</code></strong></span>
--output omitted--
kelly	Kelly Smith
franky	Franky B.
eddy	Eddy White
willy	William Black
cathy	Catherine the Great
sandy	Sandy Li Wong

<code class="prompt">kelly is in ~&gt;</code>
</pre><p>在一个 <span><strong class="command">awk</strong></span> 脚本中，它看起来像这样：
            </p><pre class="screen">
<code class="prompt">kelly is in ~&gt;</code> <span><strong class="command">cat <code class="filename">printnames.awk</code></strong></span>
BEGIN { FS=":" }
{ print $1 "\t" $5 }

<code class="prompt">kelly is in ~&gt;</code> <span><strong class="command">awk <code class="option">-f</code> <code class="filename">printnames.awk /etc/passwd</code></strong></span>
--output omitted--
</pre><p>小心地选择输入分隔域来防止出现问题。一个例子来说明这个：说你需要输入想这样的行的形式：</p>
            <p>“<span class="quote">Sandy L. Wong, 64 Zoo St., Antwerp, 2000X</span>”
            </p>
            <p>你这样写了一个打印出记录中人的名字的命令行或者是脚本：</p>
            <div class="cmdsynopsis">
               <p><code class="command">awk 'BEGIN { FS="," } { print $1, $2, $3 }' <code class="filename">inputfile</code></code> 
               </p>
            </div>
            <p>但是可能一个人有PhD，而且可能写成这样：</p>
            <p>“<span class="quote">Sandy L. Wong, PhD, 64 Zoo St., Antwerp, 2000X</span>”
            </p>
            <p>你的 <span><strong class="command">awk</strong></span> 会给出错误的输出。需要的话，使用额外的一个 <span><strong class="command">awk</strong></span> 或者 <span><strong class="command">sed</strong></span> 来统一数据输出的格式。
            </p>
            <p>默认的输入分隔符是一个或多个空格和制表符。</p>
         </div>
         <div class="sect2" lang="zh-cn">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="sect_06_03_02"></a>6.3.2.&nbsp;输出分隔符
                     </h3>
                  </div>
               </div>
            </div>
            <div class="sect3" lang="zh-cn">
               <div class="titlepage">
                  <div>
                     <div>
                        <h4 class="title"><a name="sect_06_03_02_01"></a>6.3.2.1.&nbsp;输出域分隔符
                        </h4>
                     </div>
                  </div>
               </div>
               <p>在输出中域通常被空格分隔。当你对 <span><strong class="command">print</strong></span> 命令使用正确的语法且字段用逗号分隔时，这将很明显的：
               </p><pre class="screen">
<code class="prompt">kelly@octarine ~/test&gt;</code> <span><strong class="command">cat <code class="filename">test</code></strong></span>
record1         data1
record2         data2

<code class="prompt">kelly@octarine ~/test&gt;</code> <span><strong class="command">awk <em class="parameter"><code>'{ print $1 $2}'</code></em> <code class="filename">test</code></strong></span>
record1data1
record2data2

<code class="prompt">kelly@octarine ~/test&gt;</code> <span><strong class="command">awk <em class="parameter"><code>'{ print $1, $2}'</code></em> <code class="filename">test</code></strong></span>
record1 data1
record2 data2

<code class="prompt">kelly@octarine ~/test&gt;</code>
</pre><p>如果你不输入逗号， <span><strong class="command">print</strong></span> 将把输出的项目全部当成一个字段，因此省略默认输出 <span class="emphasis"><em>分隔符</em></span>, <code class="varname">OFS</code>的使用。
               </p>
               <p>在摄制了这个内建变量的值之后任何字符串可以被用作一个输出域。</p>
            </div>
            <div class="sect3" lang="zh-cn">
               <div class="titlepage">
                  <div>
                     <div>
                        <h4 class="title"><a name="sect_06_03_02_02"></a>6.3.2.2.&nbsp;输出记录分隔符
                        </h4>
                     </div>
                  </div>
               </div>
               <p>整个 <span><strong class="command">print</strong></span> 语句的输出叫做<span class="emphasis"><em>输出记录</em></span>。每个在输出记录里的print命令的结果，输出一个叫做 <span class="emphasis"><em>输出记录分隔符 </em></span> <code class="varname">ORS</code>的字符串。这个变量的默认值是 “<span class="quote">\n</span>”，一个换行符。因此，每个 <span><strong class="command">print</strong></span> 语句生成一个单独的行。
               </p>
               <p>要改变输出域和记录的，只要给 <code class="varname">OFS</code> 和 <code class="varname">ORS</code> 赋新的值：
               </p><pre class="screen">
<code class="prompt">kelly@octarine ~/test&gt;</code> <span><strong class="command">awk <em class="parameter"><code>'BEGIN { OFS=";" ; ORS="\n--&gt;\n" } \
{ print $1,$2}'</code></em> <code class="filename">test</code></strong></span>
record1;data1
--&gt;
record2;data2
--&gt;

<code class="prompt">kelly@octarine ~/test&gt;</code>
</pre><p>如果 <code class="varname">ORS</code> 的值不包含换行，那么程序中的输出就会输出成一个单独行。
               </p>
            </div>
         </div>
         <div class="sect2" lang="zh-cn">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="sect_06_03_03"></a>6.3.3.&nbsp;记录的数量
                     </h3>
                  </div>
               </div>
            </div>
            <p>内建的 <code class="varname">NR</code> 包含了处理过的记录的数量。在读入一个新的输入行之后他会自行增加一次。你可以用它来计算记录的总数，或者在每个输出记录中：
            </p><pre class="screen">
<code class="prompt">kelly@octarine ~/test&gt;</code> <span><strong class="command">cat <code class="filename">processed.awk</code></strong></span>
BEGIN { OFS="-" ; ORS="\n--&gt; done\n" }
{ print "Record number " NR ":\t" $1,$2 }
END { print "Number of records processed: " NR }

<code class="prompt">kelly@octarine ~/test&gt;</code> <span><strong class="command">awk <code class="option">-f</code> <code class="filename">processed.awk test</code></strong></span>
Record number 1:        record1-data1
--&gt; done
Record number 2:        record2-data2
--&gt; done
Number of records processed: 2
--&gt; done

<code class="prompt">kelly@octarine ~/test&gt;</code>
</pre></div>
         <div class="sect2" lang="zh-cn">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="sect_06_03_04"></a>6.3.4.&nbsp;用户定义的变量
                     </h3>
                  </div>
               </div>
            </div>
            <p>除了内建的变量之外，你也可以定义自己的变量。当 <span><strong class="command">awk</strong></span> 碰到一个不存在的变量（没有事先定义的）的引用时，这个变量就被创建并且使用一个空字符串进行赋值。对于后来所有的引用，就是该变量最后被赋予的那个值。变量可以是一个字符串或者一个数字。输入域的内容也可以被赋予变量。
            </p>
            <p>值可以直接用 <span><strong class="command">=</strong></span> 来赋值，或者你可以使用现有变量的值和其他操作符组合：
            </p><pre class="screen">
<code class="prompt">kelly@octarine ~&gt;</code> <span><strong class="command">cat <code class="filename">revenues</code></strong></span>
20021009        20021013        consultancy     BigComp         2500
20021015        20021020        training        EduComp         2000
20021112        20021123        appdev          SmartComp       10000
20021204        20021215        training        EduComp         5000

<code class="prompt">kelly@octarine ~&gt;</code> <span><strong class="command">cat <code class="filename">total.awk</code></strong></span>
{ total=total + $5 }
{ print "Send bill for " $5 " dollar to " $4 }
END { print "---------------------------------\nTotal revenue: " total }

<code class="prompt">kelly@octarine ~&gt;</code> <span><strong class="command">awk <code class="option">-f</code> <code class="filename">total.awk test</code></strong></span>
Send bill for 2500 dollar to BigComp
Send bill for 2000 dollar to EduComp
Send bill for 10000 dollar to SmartComp
Send bill for 5000 dollar to EduComp
---------------------------------
Total revenue: 19500

<code class="prompt">kelly@octarine ~&gt;</code>
</pre><p>类似于C的简写 <span><strong class="command"><code class="varname">VAR</code>+= value</strong></span> 也是可以接受的。
            </p>
         </div>
         <div class="sect2" lang="zh-cn">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="sect_06_03_05"></a>6.3.5.&nbsp;更多例子
                     </h3>
                  </div>
               </div>
            </div>
            <p>当我们使用 <span><strong class="command">awk</strong></span> 脚本时， <a href="ch05s03.html#sect_05_03_02" title="5.3.2.&nbsp;写输出文件">第&nbsp;5.3.2&nbsp;节 “写输出文件”</a> 的例子会变得更加容易：
            </p><pre class="screen">
<code class="prompt">kelly@octarine ~/html&gt;</code> <span><strong class="command">cat <code class="filename">make-html-from-text.awk</code></strong></span>
BEGIN { print "&lt;html&gt;\n&lt;head&gt;&lt;title&gt;Awk-generated HTML&lt;/title&gt;&lt;/head&gt;\n&lt;body bgcolor=\"#ffffff\"&gt;\n&lt;pre&gt;" }
{ print $0 }
END { print "&lt;/pre&gt;\n&lt;/body&gt;\n&lt;/html&gt;" }
</pre><p>而且当用 <span><strong class="command">awk</strong></span> 来替代 <span><strong class="command">sed</strong></span> 后，命令也变得更加直截了当：
            </p><pre class="screen">
<code class="prompt">kelly@octarine ~/html&gt;</code> <span><strong class="command">awk <code class="option">-f</code> <code class="filename">make-html-from-text.awk testfile</code> &gt; <code class="filename">file.html</code></strong></span>
</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
               <table border="0" summary="Tip: 在你系统上的awk例子。">
                  <tr>
                     <td rowspan="2" align="center" valign="top" width="25"><img alt="[提示]" src="images/tip.png"></td>
                     <th align="left">在你系统上的awk例子。</th>
                  </tr>
                  <tr>
                     <td align="left" valign="top">
                        <p>我们再次回到包含你系统启动脚本的目录。输入一个和以下相似的命令来查看更多 <span><strong class="command">awk</strong></span> 命令的使用方法：
                        </p>
                        <div class="cmdsynopsis">
                           <p><code class="command">grep <em class="parameter"><code>awk</code></em> <code class="filename">/etc/init.d/*</code></code> 
                           </p>
                        </div>
                     </td>
                  </tr>
               </table>
            </div>
         </div>
         <div class="sect2" lang="zh-cn">
            <div class="titlepage">
               <div>
                  <div>
                     <h3 class="title"><a name="sect_06_03_06"></a>6.3.6.&nbsp;printf程序
                     </h3>
                  </div>
               </div>
            </div>
            <p>为了更精确的控制 <span><strong class="command">print</strong></span> 提供的正常输出格式，可以使用 <span><strong class="command">printf</strong></span>。 <span><strong class="command">printf</strong></span>命令可以用来指明每个项目使用的域的宽度，同时也有用于数字的多种格式选择。这一切只要增加一个字符串，叫做<span class="emphasis"><em>格式字符串</em></span>，控制怎样和那里来打印那些项目。
            </p>
            <p>语法也和C语言的 <span><strong class="command">printf</strong></span> 语句相似；请察看你的C介绍手册。 <span><strong class="command">gawk</strong></span> 信息页面包含完整的解释。
            </p>
         </div>
      </div>
      <div class="navfooter">
         <hr>
         <table width="100%" summary="Navigation footer">
            <tr>
               <td width="40%" align="left"><a accesskey="p" href="ch06s02.html">上一页</a>&nbsp;
               </td>
               <td width="20%" align="center"><a accesskey="u" href="ch06.html">上一级</a></td>
               <td width="40%" align="right">&nbsp;<a accesskey="n" href="ch06s04.html">下一页</a></td>
            </tr>
            <tr>
               <td width="40%" align="left" valign="top">6.2.&nbsp;打印程序&nbsp;</td>
               <td width="20%" align="center"><a accesskey="h" href="index.html">起始页</a></td>
               <td width="40%" align="right" valign="top">&nbsp;6.4.&nbsp;总结</td>
            </tr>
         </table>
      </div>
   </body>
</html>